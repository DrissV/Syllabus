<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Choquet Olivier & Vandenheede Driss">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SQL 1ère année - IANARCH - Suppléments - e-Syllabus HTML5 et CSS3</title>
        <!-- une icône dans la barre du navigateur -->
        <link rel="icon" href="../images/favicon.png" type="image/png">
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <!-- liens d'évitement -->
        <ul class="a11y-nav">
            <li>
                <a href="#container">Passer directement au contenu</a>
            </li>
            <li>
                <a href="#menu">Accéder au menu secondaire de la page</a>
            </li>
            <li>
                <a href="#aside">Accéder aux liens utiles</a>
            </li>
        </ul>
        <!-- bannière et menu -->
        <header role="banner">
            <div class="logoTitle">
                <h1>Cours d'introduction au Web</h1>
                <h2>HTML5 et CSS3</h2>
            </div>
            <nav role="navigation" aria-label="Menu principal de navigation">
                <ul>
                    <li><a href="../index.html">Le cours</a></li>
                    <li><a href="../internet.html">Internet</a></li>
                    <li><a href="../html5.html">HTML5</a></li>
                    <li><a href="../css3.html">CSS3</a></li>
                    <li><a href="../methodologie.html">Méthodologie</a></li>
                    <li><a href="../lexique.html">Lexique</a></li>
                    <li><a href="../supplements.html" class="current">Suppléments</a></li>
                </ul>
            </nav>
        </header>
        <main id="container" role="main" tabindex="-1">
            <div id="menu">
                <nav role="navigation">
                    <ol>
                        <li><a href="supplements_ianarch.html">Retour au sommaire</a></li>
                        <li><a href="#intro_sql">Introduction</a></li>
                        <li><a href="#sql_ajd">SQL de nos jours</a></li>
                        <li><a href="#rdbms">RDBMS</a></li>
                        <li><a href="#create_table">CREATE TABLE</a></li>
                        <li><a href="#cle_primaire">Clé primaire</a></li>
                        <li><a href="#commentaires">Commentaires</a></li>
                        <li><a href="#insert into">INSERT INTO</a></li>
                        <li><a href="#update_set_where">UPDATE... SET... WHERE...</a></li>
                        <li><a href="#delete_from">DELETE FROM...</a></li>
                        <li><a href="#select">SELECT</a></li>
                        <li><a href="#fonctions_agregees">Fonctions agrégées</a></li>
                        <li><a href="#relation_1_a_N">Relation 1 à N</a></li>
                        <li><a href="#relation_M_a_N">Relation M à N</a></li>
                        <li><a href="#cle_primaire_concatenee">Clé primaire concaténée</a></li>
                        <li><a href="#cle_etrangere_concatenee">Clé étrangère concaténée</a></li>
                        <li><a href="#sous-requete">Sous-requête</a></li>
                        <li><a href="#clauses_supplementaires">Clauses supplémentaires</a></li>
                        <li><a href="#conclusion_partie_1">Conclusion</a></li>
                        <li><a href="#exercices">Exercices</a></li>
                    </ol>
                </nav>
                <!-- aside lié à la page et pas à l'article donc pas à l'intérieur de article -->
                <aside id="aside">
                    <p>Liens utiles :</p>
                    <ul>
                        <li><a href="https://www.youtube.com/c/LeDesignerduWeb/videos">Le Designer du web</a></li>
                    </ul>
                </aside>
            </div>
            <section id="mainSection">
                <article id="partie_1">
                    <h1 id="partie_sql_1">Partie SQL 1ère année :</h1>
                    <h2 id="intro_sql">Introduction à SQL :</h2>
                    <p>L'informatique, comme le suggère son nom, est un ensemble de techniques destinées essentiellement à conserver et à <span class="em">manipuler des informations</span>.</p>
                    <p>En informatique, il est très fréquent de rencontrer encore et encore le même problème. Avec l’expérience, on peut évaluer les différentes solutions qui ont été apportées et choisir celle qui tient le mieux la route. Ce choix est d’ailleurs souvent très pragmatique : c’est la solution qui survit à l’épreuve du temps qui finit par être universellement acceptée.</p>
                    <p>Elle est particulièrement efficace dès qu'il s'agit de manpuler de grandes quantités d'informations de structure similaire, comme des listes de personnes (membres, clients, etc.), des listes d'articles, des séries de factures ou de contrats, etc.</p>
                    <p>De nombreuses organisations logiques et physiques ont été imaginées pour répondre à ce type de besoin, surtout depuis que les percées de l'électronique ont permis de créer des ordinateurs. Ainsi, on a d'abord parlé de "fichiers" : un fichier est une suite d'informations, en général toutes de même structure, conservées sur support électronique (disque dur, clé USB, etc.). Lorsqu'on a dû manipuler plusieurs fichiers et effectuer des traitements où leurs contenus interagissent, on s'est rendu compte qu'il valait mieux parler de "bases de données", qui sont essentiellement des ensembles de fichiers présentant certains liens entre eux.</p>
                    <p>Ainsi, dans le courant des années 1960, il existait un besoin grandissant d’automatiser la gestion des données. Non seulement il fallait pouvoir stocker ces données, mais en plus il fallait trouver un mécanisme permettant de les exploiter : récupérer les données, les faire évoluer d’une manière consistante, faire des croisements entre plusieurs informations, consolider des résultats, etc. Il y avait donc un besoin d’exprimer toutes sortes de requêtes et manipulations sur les données. Mais développer des algorithmes spécifiques à chaque besoin spécifique aurait été coûteux et contreproductif. C’est pourquoi Edgar F. Codd publia en 1970 un article intitulé "A Relational Model of Data for Large Shared Data Banks" proposant une manière de les représenter et de les manipuler. Cette approche donna naissance au langage SQL : Structured Query Language.</p>
                    <h3 id="sql_ajd">SQL de nos jours :</h3>
                    <p>SQL reste de nos jours incontestablement le standard pour gérer la persistance des données. SQL est tellement omniprésent sur Internet que probablement tous les sites web que vous fréquentez l’utilisent. Il commence aussi à avoir une grande présence sur les Smartphones pour toutes les applications ayant des données non triviales à gérer. Vous retrouverez SQL au cœur de la gestion des données de presque tous les systèmes informatique : applications bancaires, médicales, cartographie, multimédia, etc.….</p>
                    <p>Le marché est composé de poids lourds commerciaux (Access, SQL Server, DB2, Informix, Oracle, Microsoft, Sybase, …), mais aussi de produits issus du monde du logiciel libre (Ingres, MySQL, PostgreSQL, SQLite, …). SQL est un langage qui est normalisé mais reste très complexe. Ainsi chaque vendeur n’implémente qu’un sous ensemble plus ou moins complet du langage. De plus la concurrence étant bien présente, chaque vendeur essaie de se sortir du lot par des extensions qui lui sont propre. Au final, il y a un tronc SQL commun à toutes ces bases de données (BD), mais on se retrouve assez rapidement à utiliser des instructions qui sont spécifiques à un vendeur particulier.</p>
                    <p>Dans le cadre de ce cours, nous utiliserons <a href="https://www.postgresql.org/" target="_blank">PostgreSQL</a>. C’est un logiciel libre et donc gratuit. PostgreSQL est un <span class="em">Système de Gestion de Bases de données</span> (noté <span class="em">SGBD</span> ou, en anglais, <span class="em">DBMS</span> (<span class="em">DataBase Management System</span>)) relationnelles. Il attache une grande importance au respect de la norme SQL. C’est un produit moderne, avec une communauté de développeur très active. Il est fréquemment utilisé en milieu professionnel et il est fort probable que vous le rencontrerez à un moment ou un autre de votre future carrière. Pour toutes ces raisons nous avons choisi ce logiciel.</p>
                    <h3 id="rdbms">RDBMS (Relational Database Management System) :</h3>
                    <h4 id="modele_relationnel">Le modèle relationnel :</h4>
                    <p>Différentes générations de bases de donénes se sont succédé (hiérarchique, en réseaux et relationnelle), et les plus utilisées actuellement sont les "bases de données relationnelles", qui se sont répandues depuis les années 1980.</p>
                    <p>Une <span class="html">base de données relationnelle</span> est constituée d'un ensemble de "relations", souvent appelées "tables".</p>
                    <p>Chaque <span class="html">table</span> est divisée d'une part en colonnes et d'autre part en lignes.</p>
                    <p>Les <span class="html">colonnes</span> sont les "<span class="html">attributs</span>" (ou les "<span class="em">champs</span>"). Elles sont désignées par leur numéro d'ordre (1, 2, 3, ...) ou par des noms d'attributs; dans ce dernier cas, l'ordre des colonnes est sans importance. Chaque attribut peut se voir imposer un "<span class="em">domaine</span>", c'est-à-dire l'ensemble de toutes les valeurs possibles de cet attribut.</p>
                    <p>Les <span class="html">lignes</span> sont appelées les "<span class="em">tuples</span>" : elles correspondent plus ou moins aux "enregistrements" des fichiers classiques, à ceci près qu'une table n'est pas considérée comme une <span class="em">séquence</span> de tuples, mais bien comme un <span class="em">ensemble</span> (au sens mathématique) de tuples. Ceci entraîne deux conséquences :</p>
                    <ul>
                        <li>L'<span class="em">ordre</span> des tuples est <span class="html">sans importance</span> (c'est-à-dire que rien ne garantit un ordre déterminé, même pas l'ordre chronologique dans lequel les tuples ont été mis dans la table; cependant, le programmeur peut toujours, lors de l'affichage ou de l'impression d'une table, choisir un ordre bien précis).</li>
                        <li>Deux tuples devraient <span class="em">toujours être distincts l'un de l'autre</span>. On ne devrait jamais avoir dans une même table deux tuples qui soient exactement identiques.</li>
                    </ul>
                    <p>Les SGBD ont tous recours au langage SQL pour :</p>
                    <ul>
                        <li>créer des tables (vides).</li>
                        <li>insérer des informations (appelées "tuples") dans ces tables.</li>
                        <li>modifier ou supprimer certaines de ces informations.</li>
                        <li>consulter, de façon souple et puissante, les informations ainsi emmaganisinées.</li>
                    </ul>
                    <p>La définition en "intention" d'une base de données est constituée de la liste de ses tables, avec, pour chacune d'elles, la liste des attributs et de leurs domaines, ainsi que d'une série de "contraintes d'intégrité", servant à garantir la cohérence des donénes : cette définition, qui n'inclut pas le contenu actuel des tables, est la partie permanente, fixe de la base de données.</p>
                    <p>La définition en "extension" d'une base de données est constituée du contenu actuel de ses tables, c'est-à-dire des ensembles de tuples qu'elles contiennent.</p>
                    <p>La liste des attributs, c'est-à-dire le titre des colonnes, donne la structure de la table, elle indique la liste des informations qui vont être stockées pour chaque tuple.</p>
                    <p>Commençons par un exemple simple dans un classeur Excel :</p>
                    <img src="../images/classeur_excel_clients.PNG" alt="classeur Excel clients">
                    <p>Dans cet exemple, on conserve la liste de tous les clients d'une entreprise et pour chaque client, on mémorise :</p>
                    <ul>
                        <li>son numéro</li>
                        <li>son nom</li>
                        <li>son prénom</li>
                        <li>son adresse (rue et numéro)</li>
                        <li>son code postal</li>
                        <li>sa commune</li>
                        <li>son numéro de téléphone</li>
                        <li>son numéro de TVA</li>
                    </ul>
                    <p>De manière similaire, dans une base de données, les informations sont contenues dans une table.</p>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>num</th>
                                <th>nom</th>
                                <th>prenom</th>
                                <th>adresse</th>
                                <th>cp</th>
                                <th>ville</th>
                                <th>tel</th>
                                <th>numtva</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Dupuis</td>
                                <td>Benoit</td>
                                <td>clos Chapelle aux Champs, 43</td>
                                <td>1200</td>
                                <td>Bruxelles</td>
                                <td>02/764.46.46</td>
                                <td>BE413770425</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Dupuis</td>
                                <td>Luc</td>
                                <td>rue Lambert Fortune, 2</td>
                                <td>1300</td>
                                <td>Wavre</td>
                                <td>010/34.65.67</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>18</td>
                                <td>Van Moer</td>
                                <td>Willy</td>
                                <td>rue Sainte Anne, 6</td>
                                <td>1300</td>
                                <td>Wavre</td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Pour représenter la table, il est d'usage d'utiliser un <span class="html">diagramme de structure de données (DSD)</span>.</p>
                    <p>Par exemple, le DSD de la table <span class="em">clients</span> ressemble à :</p>
                    <table class="tableBalises">
                        <tbody>
                            <tr>
                                <td class="bold">clients</td>
                            </tr>
                            <tr>
                                <td>
                                    <p>num</p>
                                    <p>nom</p>
                                    <p>prenom</p>
                                    <p>adresse</p>
                                    <p>cp</p>
                                    <p>ville</p>
                                    <p>tel</p>
                                    <p>numtva</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Ces huit éléments sont les <span class="em">attributs</span> de la table des clients. Ils sont fixés lors de la création de la table, et existent donc quand la table est encore vide.</p>
                    <p>Les véritables informations, c'est-à-dire les coordonnées des clients réels, seront les <span class="em">tuples</span> de la table, chaque client constituant un tuple.</p>
                    <p>Lors de sa création, la table <span class="em">clients</span> définit 8 attributs. Normalement, cela ne changera pas. Si l'on a spécifié que le numéro est un nombre entier positif et que le nom est une suite de caractères de longueur maximale à 25, ces spécifications ne changeront pas non plus. Nous verrons en deuxième qu'il est quand même possible de modifier ces définitions.</p>
                    <h3 id="create_table">CREATE_TABLE :</h3>
                    <p>Pour créer une table, on utilise l'instruction <span class="html">CREATE TABLE</span> :</p>
<pre><code>CREATE TABLE nom_table ( [
    { nom_colonne type_donnees [ DEFAULT default_expr ] [ contrainte_colonne [...] ]
    | contrainte_table }
    [, ... ]
] )</code></pre>
                    <p>Cette représentation respecte les <span class="em">conventions syntaxiques</span> suivantes :</p>
<pre><code>MOT en MAJUSCULE = clause ou élément de l'instruction (mot réservé)
[] &#8594; élément facultatif
{ ... } &#8594; élément facultatif qui peut être répété
| &#8594; désigne une alternative (OU exclusif)</code></pre>
                    <p>Cette syntaxe de présentation est fréquemment utilisée dans les brochures.</p>
                    <ul>
                        <li>
                            <p><span class="em">contrainte_colonne</span> peut être :</p>
<pre><code>[ CONSTRAINT nom_contrainte ]
{ NOT NULL | NULL |
UNIQUE |
PRIMARY KEY |
CHECK ( expression ) |
REFERENCES table_reference [ ( colonne_reference ) ]
}</code></pre>
                        </li>
                        <li>
                            <p><span class="em">contrainte_table</span> peut être :</p>
<pre><code>[ CONSTRAINT nom_contrainte ]
{ UNIQUE ( nom_colonne [, ... ] ) |
PRIMARY KEY ( nom_colonne [, ... ] ) |
CHECK ( expression ) |
FOREIGN KEY ( nom_colonne [, ...
] ) REFERENCES table_reference [ (
colonne_reference [, ... ] ) ] }</code></pre>
                        </li>
                    </ul>
                    <p>Pour la table <span class="em">clients</span>, l'instruction est la suivante :</p>
<pre class="taille"><code>CREATE TABLE clients
(
    num INTEGER NOT NULL,
    nom VARCHAR(25) NOT NULL,
    prenom VARCHAR(15) NOT NULL,
    adresse VARCHAR(30) NOT NULL,
    cp INTEGER NOT NULL,
    ville VARCHAR(20) NOT NULL,
    tel VARCHAR(11) NULL,
    numtva VARCHAR(10) NULL
);</code></pre>
                    <p>Après le nom de la table, on définit les attributs. Pour chaque attribut : le premier correspond au nom de l'attribut, lesecond au type de l'attribut et enfin s'il peut être omis ou pas.</p>
                    <ol type="a">
                        <li>
                            <h4 id="conventions_ecritures">Les conventions d'écriture :</h4>
                            <p>Les noms de tables et d'attributs sont choisis par celui qui crée la table, de façon assez libre, mais en respectant toutefois certaines règles. Ils ne peuvent pas par exemple contenir des lettres accentuées (<span class="em">prenom</span> et non <span class="em">prénom</span>), ni espaces, ni caractères spéciaux.</p>
                            <p>Par contre les mots-clés (<span class="html">CREATE</span>, <span class="html">TABLE</span>, <span class="html">NULL</span>, etc.) doivent absolument figurer exactement tels quels, de mêmes que les signes particuliers : parenthèses, virgules, etc.</p>
                            <p>Seule la mise en page est totalement libre : alognement, espacements, identation, passages à la ligne. Provitons donc de cetteliberté pour améliorer la clarté et la visibilité de nos instructions.</p>
                            <p class="souligne">La sensibilité à la casse :</p>
                            <p>Les mots clés ainsi que ls noms de tables et d'attributs sans guillemets doubles, sont insensibles à la casse.</p>
                            <p>Écrire <span class="em">CREATE TABLE CLIENTS (...)</span> revient au même qu'écrire <span class="em">crEAtE taBLe cLIEnts (...)</span>.</p>
                            <p>Toutefois, une convention couramment utilisée revient à écrire les mots clés du langage en majuscule et les noms en minuscule, c'est-à-dire : <span class="em">CREATE TABLE CLIENTS (...)</span>.</p>
                            <p>On peut délimiter un identificateur en utilisant les doubles guillemets. Cela permet alors d'avoir des identifiants composés de n'importe quel caractère spécial (majuscule, minuscule, espace, ...). Exemple : CREATE TABLE "Un nOm 2 taBle trOp fUn !".</p>
                            <p>Les valeurs des attributs sont, elles, sensibles à la casse. Effectivement, si dans la table <span class="em">clients</span>, l'un des clients porte le nom <span class="em">'Dupont'</span>, cela est différent de la valeur <span class="em">'dupont'</span>.</p>
                            <p>Une chaîne de caractères en SQL est une séquence arbitraire de caractères entourée par des guillemets simples ('), c'est-à-dire <span class="em">'Ceci est une chaîne'</span>. Pour inclure un guillemet simple dans une chaîne constante,chaisissez deux guillemets adjacents, par exemple <span class="em">'L''odyssée d''Astérix'</span>. Notez que ce n'est pas un guillemet double (").</p>
                        </li>
                        <li>
                            <h4 id="types">Les types :</h4>
                            <p>Il existe différents types pour définir les attributs. Certains sont propres au SGBD, d'autres sont conformes à la norme SQL.</p>
                            <ul>
                                <li>
                                    <h5 id="types_champs_bits">Types champs de bits :</h5>
                                    <p>Les champs de bits sont des chaînes de 0 et de 1. Ils peuvent être utilisés pour stocker ou visualiser des masques de bits. Il y a deux types de bits SQL : <span class="html">bit (n)</span> et <span class="html">bit varying (n)</span>, où <span class="em">n</span> estun entier positif.</p>
                                    <p>Les données de type <span class="em">bit</span> doivent avoir une longueur de exactement <span class="em">n</span> bits. Essayer d'y affecter une chaîne de bit longue ou plus courte déclenche une erreur. Les données de type <span class="em">bit varying</span> ont une longueur variable, mais ne peuvent dépasser une taille de <span class="em">n</span> bits. Les chaînes plus longues sont rejetées. Écrire <span class="em">bit</span> sans longueur indique une taille illimitée.</p>
                                </li>
                                <li>
                                    <h5 id="type_booleen">Type booléen :</h5>
                                    <p>Le type booléen ne peut avoir que deux valeurs : <span class="html">true</span> et <span class="html">false</span> (ou encore la valeur <span class="html">NULL</span>).</p>
                                    <p><span class="em">true</span> peut s'écrire littéralement de plusieurs manières : <span class="html">t</span>, <span class="html">true</span>, <span class="html">yes</span>, <span class="html">y</span> ou <span class="html">1</span>.</p>
                                    <p><span class="em">false</span> peut s'écrire littéralement des manières suivantes : <span class="html">false</span>, <span class="html">f</span>, <span class="html">no</span>, <span class="html">n</span> ou <span class="html">0</span>.</p>
                                    <p>Il est recommandé d'utiliser <span class="html">TRUE</span> et <span class="html">FALSE</span> qui sont compatibles avec la norme SQL.</p>
                                </li>
                                <li>
                                    <h5 id="types_caracteres">Types caractères :</h5>
                                    <table class="tableBalises">
                                        <thead>
                                            <tr>
                                                <th>Nom</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><span class="html">character varying (n)</span>, <span class="html">varchar (n)</span></td>
                                                <td>Longueur variable avec limite</td>
                                            </tr>
                                            <tr>
                                                <td><span class="html">character (n)</span>, <span class="html">char (n)</span></td>
                                                <td>Longueur fixe, comblé avec des espaces</td>
                                            </tr>
                                            <tr>
                                                <td class="html">text</td>
                                                <td>Longueur variable illimitée</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <p>SQL définit deux types de caractères principaux : <span class="html">character varying (n)</span> et <span class="html">character (n)</span>, où <span class="html">n</span> est un entier positif. Ces deux types peuvent stocker des chaînes de caractères de taille inférieure ou égale à <span class="em">n</span>. Une tentative d'insérer une chaîne trop longue donnera une erreur, à moins que les caractères en trop soient tous des espaces, auquel cas la chaîne sera tronquée à la taille maximale. Si la chaîne est plus petite que la taille déclarée, elle sera complétée par des espaces pourle type <span class="em">character</span>, et elle sera stockée telle quelle pour le type <span class="em">character varying</span>.</p>
                                    <p>Les notations <span class="em">varchar (n)</span> et <span class="em">char (n)</span> sont des alias pour <span class="em">character varying (n)</span> et <span class="em">character (n)</span>, respectivement.</p>
                                    <p><span class="em">character</span> sans indication de taille, le type accepte des chaînes de toutes tailles. Il s'agit là d'une spécificité du PostgreSQL.</p>
                                    <p>PostgreSQL propose aussi le type <span class="em">text</span>, qui permet de stocker des chaînes de n'importe quelle taille. Bien que le type <span class="em">text</span> ne soit pas dans le standardSQL, plusieurs autres sytèmes de gestion de bases de données SQL le proposent aussi.</p>
                                </li>
                                <li>
                                    <h5 id="types_numeriques">Types numériques :</h5>
                                    <p>Les types numériques sont constitués d'entiers de 2, 4 ou 8 octets, de nombres à virgule flottante de 4 ou 8 octets, de décimaux à précision fixe.</p>
                                    <table class="tableBalises">
                                        <thead>
                                            <tr>
                                                <th>Nom</th>
                                                <th>Taille de stockage</th>
                                                <th>Description</th>
                                                <th>Étendue</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="html">bigint</td>
                                                <td>8 octets</td>
                                                <td>grand entier</td>
                                                <td>de -9223372036854775808 à 9223372036854775807</td>
                                            </tr>
                                            <tr>
                                                <td class="html">smallint</td>
                                                <td>2 octets</td>
                                                <td>entier de faible étendue</td>
                                                <td>de -32768 à 32767</td>
                                            </tr>
                                            <tr>
                                                <td class="html">integer</td>
                                                <td>4 octets</td>
                                                <td>entier (le plus fréquent)</td>
                                                <td>de -2147483648 à 2147483647</td>
                                            </tr>
                                            <tr>
                                                <td class="html">decimal</td>
                                                <td>variable</td>
                                                <td>Valeurs indiquées par l'utilisateur. Valeurs exactes.</td>
                                                <td>pas de limite</td>
                                            </tr>
                                            <tr>
                                                <td class="html">numeric</td>
                                                <td>variable</td>
                                                <td>Valeurs indiquées par l'utilisateur. Valeurs exactes.</td>
                                                <td>pas de limite</td>
                                            </tr>
                                            <tr>
                                                <td class="html">real</td>
                                                <td>4 octets</td>
                                                <td>Précision variable. Valeurs inexactes.</td>
                                                <td>Précision de 6 décimales</td>
                                            </tr>
                                            <tr>
                                                <td class="html">double precision</td>
                                                <td>8 octets</td>
                                                <td>Précision variable. Valeur inexactes.</td>
                                                <td>Précision de 15 décimales</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <p>Les types <span class="html">smallint</span>, <span class="html">integer</span> et <span class="html">bigint</span> stockent des nombres entiers, c'est-à-dire sans décimale, de différentes étendues. Toute tentative d'y stockerune valeur trop grande ou trop petite produit une erreur.</p>
                                    <p>Le type <span class="html">integr</span> est le plus courant. Il offre un bon compromis entre capacité, espace utilisé et performances. Le type <span class="html">smallint</span> est utilisé que si l'économie d'espace disque est le premier critère de choix. Le type <span class="html">bigint</span> ne doit être utilisé que si le type <span class="html">integer</span> n'offre pas une étendue suffisante, car le type <span class="html">integer</span> est nettement plus rapide.</p>
                                    <p>Le type <span class="html">numeric</span> peut stocker des nombres avec jusqu'au 1000 chiffres significatifs et effectuer des calculs exacts. Il est spécialement recommander pour stocker les montants financiers et autres quantités pour lesquelles l'exactitude est indispensable. Néanmoins, le type <span class="html">numeric</span> est très lent comparé aux types à virgule flottante décrit ci-après.</p>
                                    <p>L'échelle d'un <span class="html">numeric</span> est le nombre de chiffres décimaux de la partie fractionnaire, c'est-à-dire le nombre de chiffres après la virgule.</p>
                                    <p>La précision d'un <span class="html">numeric</span> est le nombre de chiffres permis avant et après la virgule.</p>
                                    <p>Donc, le nombre 23,5151 a une précision de 6 et une échelle de 4. On peut considérer que les entiers ont une échelle de 0.</p>
                                    <p>La précision et l'échelle d'un numérique peuvent être réglés. Pour déclarer une colonne de type numérique, il faut utiliser la syntaxe <span class="html">NUMERIC (précision, échelle)</span>.</p>
                                    <p>La précision peut être strictement positive, l'échelle positive ou nulle. Alternativement, on peut écrire <span class="html">NUMERIC (précision)</span>. Dans ce cas, l'échele est de 0.</p>
                                    <p>Les types <span class="html">decimal</span> et <span class="html">numeric</span> sont équivalents. Les deux types sont dans le standard SQL.</p>
                                    <p>Les types de données <span class="html">real</span> et <span class="html">double precision</span> sont des types numériques à précision variable inexacts. En pratique, ils sont généralement conformes à la norme IEEE 754 pour l'arithmétique binaire à virgule flottante (respectivement simplement et double précision), dans la mesure où les processeurs, le système d'exploitation et le compilateur les supportent.</p>
                                </li>
                                <li>
                                    <h5 id="types_date_heure">Types date/heure :</h5>
                                    <table class="tableBalises">
                                        <thead>
                                            <tr>
                                                <th>Nom</th>
                                                <th>Taille de stockage</th>
                                                <th>Description</th>
                                                <th>Valeur minimale</th>
                                                <th>Valeur maximale</th>
                                                <th>Résolution</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="html">timestamp [ (p) ] [ without time zone ]</td>
                                                <td>8 octets</td>
                                                <td>date et heure</td>
                                                <td>4713 avant J.C.</td>
                                                <td>5874897 après J.C.</td>
                                                <td>1 microseconde / 14 chiffres</td>
                                            </tr>
                                            <tr>
                                                <td class="html">timestamp [ (p) ] with time zone</td>
                                                <td>8 octets</td>
                                                <td>date et heure, avec fuseau horaire</td>
                                                <td>4713 avant J.C.</td>
                                                <td>5874897 après J.C.</td>
                                                <td>1 microseconde / 14 chiffres</td>
                                            </tr>
                                            <tr>
                                                <td class="html">interval [ (p) ]</td>
                                                <td>12 octets</td>
                                                <td>intervales de temps</td>
                                                <td>-178000000 années</td>
                                                <td>178000000 années</td>
                                                <td>1 microseconde</td>
                                            </tr>
                                            <tr>
                                                <td class="html">date</td>
                                                <td>4 octets</td>
                                                <td>date seulement</td>
                                                <td>4713 avant J.C.</td>
                                                <td>32767 après J.C.</td>
                                                <td>1 jour</td>
                                            </tr>
                                            <tr>
                                                <td class="html">time [ (p) ] [ without time zone ]</td>
                                                <td>8 octets</td>
                                                <td>heures seulement</td>
                                                <td>00:00:00.00</td>
                                                <td>23:59:59.99</td>
                                                <td>1 microseconde</td>
                                            </tr>
                                            <tr>
                                                <td class="html">time [ (p) ] [ with time zone ]</td>
                                                <td>8 octets</td>
                                                <td>heures seulement, avec fuseau horaire</td>
                                                <td>00:00:00.00+12</td>
                                                <td>1 microseconde</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <p><span class="html">time</span>, <span class="html">timestamp</span>, et <span class="html">interval</span> acceptent une précision optionnelle <span class="em">p</span>, qui précise le nombre de chiffres après la virgule pour les secondes. Par défaut, il n'y a pas de limiteexplicite à la précision. Les valeurs acceptées pour <span class="em">p</span> vont de 0 à 6 pour les types <span class="html">timestamp</span> et <span class="html">interval</span>.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4 id="null">NULL :</h4>
                            <p>Dans l'instruction <span class="html">CREATE TABLE</span>, après le type, <span class="html">NOT NULL</span> ou <span class="html">NULL</span> indique que cet attribut doit avoir une valeur bien spécifiée ou pas pour chaque tuple.</p>
                            <p>La valeur <span class="html">NULL</span> marque les colonnes ayant une valeur inconnue. Attention, il ne s'agit <span class="em">ni</span> de la valeur <span class="em">zéro ni</span> de la <span class="em">chaîne vide</span>. <span class="html">NULL</span> permet la distinction entre une saisie délibérée de zéro (pour les colonnes numériques) ou vide (pour les colonnes de type caractère) et la non saisie.</p>
                            <p>En gros, <span class="html">NULL</span> n'est ni <span class="em">0</span> ni <span class="em">''</span>.</p>
                            <p>Une valeur <span class="html">NULL</span> ne peut <span class="em">jamais vérifier une égalité</span>, même avec une autre valeur <span class="html">NULL</span>.</p>
                            <p>Une règle liée à une colonne doit inclure <span class="html">NULL</span> dans sa définition pour permettre l'insertion de valeur <span class="html">NULL</span>. Quand une ligne est créée, si aucune valeur n'est spécifiée dans la colonne, si aucun défaut n'est défini, si les <span class="html">NULL</span> sont permis dans la colonne, alors le serveur assinera automatiquement la valeur <span class="html">NULL</span>.</p>
                            <p>Lors de la création, la mention <span class="html">NULL</span> peut être omise car elle constitue l'option <span class="em">"par défaut"</span>; ce qui signifie que si on n'écrit ni <span class="html">NOT NULL</span> ni <span class="html">NULL</span> lors de la définition d'un attribut donné, le système le considère comme <span class="html">NULL</span> <span class="em">SAUF</span>, évidemment, pour la clé primaire !</p>
                        </li>
                    </ol>
                    <h3 id="cle_primaire">La clé primaire :</h3>
                    <p>Rien n'impose, pour le moment, que le numéro de client soit différent pour chaque client. La seule chose que l'on sait, c'est que deux tuples complets ne devraient pas être identiques. Mais rien n'empêche pour le moment d'ajouter le tuple suivant :</p>
                    <table class="tableBalises">
                        <tbody>
                            <tr>
                                <td class="bold">3</td>
                                <td>Dupuis</td>
                                <td>Luc</td>
                                <td>Rue Brol, 7</td>
                                <td>1000</td>
                                <td>Bruxelles</td>
                                <td>02/764.46.54</td>
                                <td>NULL</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Mais il existe déjà un client dont le numéro est 3 :</p>
                    <table class="tableBalises">
                        <tbody>
                            <tr>
                                <td class="bold">3</td>
                                <td>Dupuis</td>
                                <td>Luc</td>
                                <td>rue Lambert Fortune, 2</td>
                                <td>1300</td>
                                <td>Wavre</td>
                                <td>010/34.65.67</td>
                                <td>NULL</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Une telle situation est malsaine : ou bien il s'agit bien du même client et les programmes qui utilisent cette table pourraient croire qu'il y en a deux; ou bien il s'agit de deux clients distincts, mais alors des numéros distincts.</p>
                    <p>La notation de <span class="em">clé primaire</span> (<span class="em">PRIMARY KEY</span> en anglais) permet de résoudre ce problème. Si l'on spécifique que <span class="em">num</span> est une clé primaire, le SGBD va automatiquement s'assurer que toutes les valeurs données à cet attribut sont différentes une des autres, et, en particulier, refuser l'ajout du tuple proposé ci-dessus.</p>
                    <p>La clé primaire permet de rendre unique chaque tuple de la table; la table n'est pas considére comme une séquence de tuples, mais bien comme un <span class="em">ensemble</span> (au sens mathématique) de tuples.</p>
                    <table class="tableBalises">
                        <tbody>
                            <tr>
                                <td class="bold">clients</td>
                            </tr>
                            <tr>
                                <td class="bold">PK <span class="souligne">num</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <p>nom NN</p>
                                    <p>prenom NN</p>
                                    <p>adresse NN</p>
                                    <p>cp NN</p>
                                    <p>ville NN</p>
                                    <p>tel</p>
                                    <p>numtva</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <p>L'instruction de création de table deviendra :</p>
<pre><code>CREATE TABLE clients
(
    num INTEGER <span class="em">PRIMARY KEY</span>,
    nom VARCHAR(25) NOT NULL,
    prenom VARCHAR(15) NOT NULL,
    adresse VARCHAR(30) NOT NULL,
    cp INTEGER NOT NULL,
    ville VARCHAR(20) NOT NULL,
    tel VARCHAR(11),
    numtva VARCHAR(10),
);</code></pre>
                    <p>Notons qu'une <span class="em">clé primaire</span> est <span class="em">toujours</span> <span class="html">NOT NULL</span>, il est donc <span class="em">inutile</span> de le préciser !</p>
                    <p>Il s'agit du diagramme de structure de données correspondant à la table <span class="em">CLIENTS</span>. Dans ce diagramme, nous indiquons qu'un champ est <span class="html">NOT NULL</span> avec l'abréviation <span class="html">NN</span>.</p>
                    <h3 id="commentaires">Les commentaires :</h3>
                    <p>Un commentaire est une séquence de caractères commençant avec deux tirets qui s'étend jusqu'à la fin de la ligne, par exemple : <span class="em">-- Ceci est un commentaire standard en SQL</span>.</p>
                    <p>Autrement, les blocs de commentaires peuvent aussi être utilisés :</p>
<pre><code>/* commentaires multilignes
* et imbriqués : /* bloc de commentaire imbriqué */
*/</code></pre>
                    <p>où le commentaire commence avec <span class="html">/*</span> et s'étend jusqu'à l'occurence de <span class="html">*/</span>.</p>
                    <h3 id="insert_into">INSERT INTO :</h3>
                    <p>L'ajout d'un tuple dans une table se fait par l'instruction <span class="html">INSERT INTO</span>, dont la syntaxe est donnée ci-dessous :</p>
<pre><code>INSERT INTO table [ ( colonne [, ...] ) ]
{ DEFAULT VALUES
| VALUES ( { expression | DEFAULT } [, ...] ) [, ...]
[ RETURNING * | expression_sortie [ [ AS ] nom_sortie ] [, ...] ]</code></pre>
                    <p>Chaque valeur correspond à la colonne qui a la même position dans la liste.</p>
                    <p>Une <span class="em">valeur</span> est soit un nombre, soit une chaîne de caractères (entourée de 'simples guillemets') soit NULL, soit une date, etc.</p>
                    <p>L'ordre des noms des colonnes n'a pas d'importance. Si la liste des <span class="em">nom_colonne</span> n'est pas spécifiée, c'est la liste du <span class="em">CREATE TABLE</span> qui est supposée.</p>
                    <p>On voit qu'il peut y avoir deux situations :</p>
                    <ul>
                        <li>ou bien une liste de noms d'attributs est spécifiée : dans ce cas, la liste des valeurs doit comporter le même nombre d'éléments, et chaque valeur correspond au nom d'attribut situé au même numéro d'ordre dans la liste (la première valeur est celle du premier attribut listé, la deuxièmeest celle du deuxième attribut listé, etc.).</li>
                        <li>ou bien la liste n'est pas spécifiée : c'est comme si on avait noté tous les attributs de cette table, dans l'ordre où ils ont été fournis lors du <span class="html">CREATE TABLE</span>.</li>
                    </ul>
                    <p>Chaque colonne absente de la liste, implicite ou explicite, des colonnes se voit attribuer sa valeur par défaut, s'il y en a une, ou NULL dans le cas contraire.</p>
                    <p>Un trnastypage automatique est entrepris lorsque l'expression d'une colonne ne correspond pas au type de donnée déclaré.</p>
                    <p>La clause <span class="html">RETURNING</span> optionnelle fait que <span class="em">INSERT INTO</span> calcule et renvoie les valeurs basées sur chaque ligne en cours d'insertion. C'est principalement utile pour obtenir les valeurs qui ont été fournies par défaut, comme un numéro de séquence (confer 0). Néanmoins, toute expression utilisant les colonnes de la table est autorisée. La syntaxe de la liste <span class="em">RETURNING</span> est identique à celle de la commande <span class="em">SELECT</span>.</p>
                    <p>Voici différentes façons d'ajouter le tuple (à supposer qu'il ne soit pas encore présent dans la table) :</p>
<pre><code>INSERT INTO clients
VALUES (18, 'Van Moer', 'Willy', 'rue Sainte Anne, 6', 1300, 'Wavre', NULL, NULL);

INSER INTO clients (num, nom, prenom, adresse, cp, ville, tel, numtva)
VALUES (18, 'Van Moer', 'Willy', 'rue Sainte Anne, 6', 1300, 'Wavre', NULL, NULL);

INSERT INTO clients (num, nom, prenom, adresse, cp, ville)
VALUES (18, 'Van Moer', 'Willy', 'rue Sainte Anne, 6', 1300, 'Wavre');

INSERT INTO clients (num, nom, prenom, adresse, cp, ville, numtva
VALUES (18, 'Van Moer', 'Willy', 'rue Sainte Anne, 6', 1300, 'Wavre', NULL);

INSERT INTO clients (nom, prenom, numtva, num, tel, adresse, cp, ville)
VALUES ('Van Moer', 'Willy', NULL, 18, NULL, 'rue Sainte Anne, 6', 1300, 'Wavre');

INSERT INTO clients (num, prenom, nom, adresse, cp, ville)
VALUES (18, 'Willy', 'Van Moer', 'rue Sainte Anne, 6', 1300, 'Wavre');</code></pre>
                    <h3 id="update_set_where">UPDATE ... SET ... WHERE ...</h3>
<pre><code>UPDATE table
SET { colonne = { expression | DEFAULT } |
( colonne [, ...] ) = ( { expression | DEFAULT } [, ...] ) } [, ...]
[ FROM liste_from ]
[ WHERE condition ]
[ RETURNING * | expression_sortie [ [ AS ] nom_sortie ] [, ...] ]</code></pre>
                    <ul>
                        <li>
                            <p><span class="html">UPDATE</span> modifie les valeurs des colonnes spécifiées pour toutes les lignes qui satisfont la condition. Seules les colonnes à modifier doivent être mentionnées dans la clause <span class="html">SET</span>; les autres colonnes conservent leur valeur.</p>
                            <p>La clause <span class="html">RETURNING</span> optionnelle fait que <span class="em">UPDATE</span> calcule et renvoie les valeurs basées sur chaque ligne en cours de mise à jour. Toute expression utilisant les colonnes de la table et/ou les colonnes d'autres tables mentionnées dans <span class="em">FROM</span> peut être calculée. La syntaxe de la liste <span class="em">RETURNING</span> est identique à celle de la commande <span class="em">SELECT</span>.</p>
                        </li>
                    </ul>
                    <h3 id="delete_from">DELETE FROM ... :</h3>
<pre><code>DELETE FROM table
[ WHERE condition ]
[ RETURNING * | expression_sortie [ [ AS ] output_name ] [, ...] ]</code></pre>
                    <ul>
                        <li>
                            <p><span class="html">DELETE</span> supprime de la table spécifiée les lignes qui satisfont la clause <span class="em">WHERE</span>. Si la clause <span class="em">WHERE</span> est absente, toutes les lignes de la table sont supprimées. Le résultat est une table valide, mais vide.</p>
                            <p>La clause <span class="html">RETURNING</span> optionnelle fait que <span class="em">DELETE</span> calcule et renvoie les valeurs basées sur chaque ligne en coursde suppression. La syntaxe de la liste <span class="em">RETURNING</span> est identique à celle de la commande <span class="em">SELECT</span>.</p>
                        </li>
                    </ul>
                    <h3 id="select">SELECT :</h3>
                    <p>L'instruction la plus utilisée et la plus riche en SQL est l'instruction <span class="html">SELECT</span> qui permet de consulter les données en affichant celles-ci de façon brute ou y apportant un certain traitement.</p>
<pre><code>SELECT [DISTINCT] *
    | [nom_table.] nom_colonne {,[nom_table . ] nom_colonne...}
    | nom_fonction (* | nom_colonne)
FROM nom_table {, nom_table...}
WHERE nom_condition
GROUP BY nom_colonne {, nom_colonne...}
HAVING nom_condition
ORDER BY nom_colonne {,nom_colonne...} | numero_champ</code></pre>
                    <ul>
                        <li><span class="em">*</span> permet de sélectionner tous les attributs de la table.</li>
                        <li><span class="em">nom_table</span> désigne le nom d'une table.</li>
                        <li><span class="em">DISTINCT</span> permet de ne pas répéter des valeurs identiques, <span class="em">DISTINCT</span> porte sur tous les attributs du <span class="em">SELECT</span>.</li>
                        <li><span class="em">nom_condition</span> se compose généralement d'un nom de colonne , d'un opérateur (<span class="em">=</span>, <span class="em">&lt;</span>, <span class="em">&gt;</span>, <span class="em">&lt;=</span>, <span class="em">&gt;=</span>, <span class="em">&lt;&gt;</span>, <span class="em">IS</span>) et d'une valeur (entier, caractère ou <span class="em">NULL</span>) ou d'un autre nom de colonne.</li>
                        <li><span class="em">nom_colonne</span> est le nom d'une colonne, s'il se trouve derrière la clause <span class="em">SELECT</span>, il doit se trouver également derrière la clause <span class="em">GROUP BY</span> (si cette clause est présente); mais inversement, on peut placer un nom de colonne derrière la clause <span class="em">GROUP BY</span> qui ne se trouve pas derrière la clause <span class="em">SELECT</span>.</li>
                        <li><span class="em">numero_champ</span> est un entier qui désigne la position du <span class="em">nom_colonne</span> dans la liste qui suit la clause <span class="em">SELECT</span>.</li>
                    </ul>
                    <p>Voici quelques exemples qui s'appuient yous sur la table de trois tuple donnée précédemment.</p>
<pre><code>&gt; SELECT* FROM clients;</code></pre>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>num</th>
                                <th>nom</th>
                                <th>prenom</th>
                                <th>adresse</th>
                                <th>cp</th>
                                <th>ville</th>
                                <th>tel</th>
                                <th>numtva</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Dupuis</td>
                                <td>Benoit</td>
                                <td>clos Chapelle aux Champs, 43</td>
                                <td>1200</td>
                                <td>Bruxelles</td>
                                <td>02/764.46.46</td>
                                <td>BE413770425</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Dupuis</td>
                                <td>Luc</td>
                                <td>rue Lambert Fortune, 2</td>
                                <td>1300</td>
                                <td>Wavre</td>
                                <td>010/34.65.67</td>
                                <td>NULL</td>
                            </tr>
                            <tr>
                                <td>18</td>
                                <td>Van Moer</td>
                                <td>Willy</td>
                                <td>rue Sainte Anne, 6</td>
                                <td>1300</td>
                                <td>Wavre</td>
                                <td>NULL</td>
                                <td>NULL</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Le résultat pourrait être présenté dans un autre ordre puisqu'il s'agit d'un ensemble de lignes.</p>
<pre><code>&gt; SELECT num, nom, prenom, tel, cp FROM clients;</code></pre>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>num</th>
                                <th>nom</th>
                                <th>prenom</th>
                                <th>tel</th>
                                <th>cp</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>Dupuis</td>
                                <td>Benoit</td>
                                <td>02/764.46.46</td>
                                <td>1200</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Dupuis</td>
                                <td>Luc</td>
                                <td>010/34.65.67</td>
                                <td>1300</td>
                            </tr>
                            <tr>
                                <td>18</td>
                                <td>Van Moer</td>
                                <td>Willy</td>
                                <td>NULL</td>
                                <td>1300</td>
                            </tr>
                        </tbody>
                    </table>
<pre><code>&gt; SELECT cp FROM clients;</code></pre>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>cp</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1200</td>
                            </tr>
                            <tr>
                                <td>1300</td>
                            </tr>
                            <tr>
                                <td>1300</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>On constate que les lignes identiques du résultat (1300) se répètent lorsque l'on fait <span class="html">SELECT cp FROM clients</span>. Pour éviter cette répétition de valeur identique, il faut employer <span class="em">DISTINCT</span>.</p>
                    <ol type="a">
                        <li>
                            <h4 id="distinct">DISTINCT :</h4>
                            <p>Le mot <span class="em">DISTINCT</span> a pour effet que des lignes identiques du résultat ne sont affichées qu'une seule fois. Pour corriger l'erreur de la ligne précédente, on doit faire <span class="html">SELECT DISTINCT cp FROM clients</span>.</p>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>cp</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1200</td>
                                    </tr>
                                    <tr>
                                        <td>1300</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p><span class="em">DISTINCT</span> porte sur toutes les colonnes du <span class="em">SELECT</span>. Efectivement, dans l'exemple <span class="em">SELECT DISTINCT nom, prenom FROM clients</span>, <span class="em">DISTINCT</span> porte sur le <span class="em">nom</span> et le <span class="em">prenom</span>. Le résultat de cette requête sera :</p>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>nom</th>
                                        <th>prenom</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                    <tr>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        <li>
                            <h4 id="where">WHERE - Les conditions :</h4>
                            <p><span class="em">Les conditions simples</span> ne posent pasde problème particulier. Les signes <span class="em">&lt;&gt;</span>, <span class="em">&lt;=</span> et <span class="em">&gt;=</span> signifient respectivement différent, plus petit ou égal, plus grand ou égal.</p>
                            <p>Les symbolesd'égalité (<span class="em">=</span>) et d'inégalité (<span class="em">&lt;&gt;</span>) portent sur tous les types de données, qu'elles soient numériques ou pas, alors que les symmboles de comparaison (<span class="em">&lt;</span>, <span class="em">&gt;</span>, <span class="em">&lt;=</span>, <span class="em">&gt;=</span>) s'utilisent de préférence sur les données numériques (<span class="em">integer</span>, <span class="em">float</span>, <span class="em">numeric</span>, <span class="em">decimal</span>).</p>
                            <p><span class="em">Les conditions générales</span> qui incluent les opérations <span class="em">AND</span>, <span class="em">OR</span>, <span class="em">NOT</span>, demandent quelques précisions et compléments.</p>
                            <h5 id="operations_logiques">Les opérations logiques :</h5>
                            <ul>
                                <li><span class="html">NOT</span> : si la condition que nous appelerons C a la valeur "VRAI", la condition <span class="em">NOT</span> C aura la valeur "FAUX", et vice-versa.</li>
                                <li><span class="html">AND</span> : C1 <span class="em">AND</span> C2 ne sera vrai que si C1 est vrai et que C2 est également vrai.</li>
                                <li><span class="html">OR</span> : C1 <span class="em">OR</span> C2 sera vrai qu'au moins une des deux conditions C1 ou C2 est vraie.</li>
                            </ul>
                            <p>On remarque que le <span class="em">OR</span> est un "OU inclusif", qui signifie "l'un ou l'autre ou les deux", ... à ne pas confondre avec le "OU exclusif", qui signifie "un et un seul parmi les deux".</p>
                            <h5 id="priorite_operations_parentheses">La priorité des opérations et parenthèses :</h5>
                            <p>Que se passe-t-il dans les situations suivantes :</p>
                            <ol type="a">
                                <li class="em">C1 AND C2 OR C3</li>
                                <li class="em">NOT C1 AND C2</li>
                            </ol>
                            <p>Supposons que C1 et C2 soient FAUX, tandis que C3 a la valeur VRAI. La première condition (a) ci-dessus peut être interprétée de deux façons :</p>
                            <p><span class="em">(C1 AND C2) OR C3</span> ce qui donne VRAI, puisque C3 est VRAI.</p>
                            <p><span class="em">C1 AND (C2 OR C3)</span> ce qui donne FAUX, puisque C1 est FAUX.</p>
                            <p>L'utilisation de parenthèses dans les conditions permet au programmeur de choisir le cas qu'il souhaite. Mais il a aussi le droit de ne pas mettre de parznthèses, ce qui suppose que, dans la définition du langage SQL, on ait spécifié une priorité relative des opérateurs <span class="em">AND</span> et <span class="em">OR</span>, sans quoi l'expression <span class="em">C1 AND C2 OR C3</span> serait ambigüe. La convention choisie par les créateurs de SQL, qui est celle dans la majorité des langages de programmation ou d'interrogation de base de données, est que le <span class="em">AND</span> a priorité sur le <span class="em">OR</span> c'est-à-dire il est plus fort que lui. Cela signifie que la condition doit se lire comme : <span class="em">(C1 AND C2) OR C3</span>.</p>
                            <p>Cette situation est celle de la multiplication par rapport à l'addition (rappel : PEMDAS = Parenthèse, Exposant, Multiplication, Division, Addition, Soustraction) :</p>
                            <p><span class="em">3 * 4 + 6</span> représente <span class="em">(3 * 4) +6</span> et non pas <span class="em">3 * (4 + 6)</span>.</p>

                            <p>La convention donne la priorité au <span class="html">NOT</span> sur le <span class="html">AND</span> (et a fortiori sur le <span class="html">OR</span>), si bien qu'en absence de parenthèses c'est la première des deux interprétations (<span class="em">(NOT C1) AND C2</span> et <span class="em">NOT (C1 AND C2)</span>) qui sera choisie par SQL (et parla plupart des langages).</p>
                            <p><span class="html">LIKE</span> est une condition qui permet d'effectuer des tests sur des chaînes de caractères.</p>
                            <p><span class="em">chaine LIKE motif</span> ou encore <span class="em">chaine NOT LIKE motif</span>.</p>
                            <p>L'expression <span class="html">LIKE</span> renvoie TRUE si la chaîne est ccontenue dans l'ensemble de chaînes représentées par le motif. (L'expression <span class="html">NOT LIKE</span> renvoie <span class="em">FALSE</span> si <span class="html">LIKE</span> renvoie <span class="em">TRUE</span> et vice versa.)</p>
                            <p>Si le motif ne contient ni <span class="html">%</span> ni <span class="html">_</span>, alors il ne représente que la chaîne elle-même; dans ce cas, <span class="html">LIKE</span> agit exactement comme l'opérateur d'égalité.</p>
                            <p><span class="em">_</span> dans un motif correspond à un seul caractère.</p>
                            <p><span class="em">%</span> dans un motif correspond à toutes les chaînes de zéro ou plusieurs caractères.</p>
                            <p>Exemples :</p>
<pre><code>'abc' LIKE 'abc' &gt; true
'abc' LIKE 'a%' &gt; true
'abc' LIKE '_b_' &gt; true
'abc' LIKE 'c' &gt; false
'abc' LIKE 'ABC' &gt; false</code></pre>
                            <p>Remarque : la fonction <span class="html">lower()</span> permet de transformer le contenu du paramètre en minuscules pour permettre une comparaison non sensible à la casse.</p>
<pre><code>'abc' LIKE lower ('ABC') &gt; true</code></pre>
                            <p><span class="html">IS NULL</span> et <span class="html">IS NOT NULL</span> est une condition particulière puisqu'elle permet de tester si la valeur est précisée ou pas. Effectivement, une valeur <span class="html">NULL</span> ne peut jamais vérifier une égalité (<span class="em">=</span>) ou inégalité (<span class="em">!=</span>) ou différence (<span class="em">&lt;</span> ou <span class="em">&gt;</span>), même avec une autre valeur <span class="em">NULL</span>. Pour tester si une valeur est NULL, il faut utiliser le test <span class="em">IS NULL</span>.</p>
                            <p>Par exemple :</p>
<pre><code>SELECT * FROM clients WHERE numtva IS NULL;</code></pre>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>num</th>
                                        <th>nom</th>
                                        <th>prenom</th>
                                        <th>adresse</th>
                                        <th>cp</th>
                                        <th>ville</th>
                                        <th>tel</th>
                                        <th>numtva</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>3</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                        <td>rue Lambert Fortune, 2</td>
                                        <td>1300</td>
                                        <td>Wavre</td>
                                        <td>010/34.65.67</td>
                                        <td>NULL</td>
                                    </tr>
                                    <tr>
                                        <td>18</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                        <td>rue Sainte Anne, 6</td>
                                        <td>1300</td>
                                        <td>Wavre</td>
                                        <td>NULL</td>
                                        <td>NULL</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p>Il faut rester prudent car les valeurs <span class="em">NULL</span> sont automatiquement exclues du résultat. Pour rappel, les valeurs sont sensibles à la casse ! Prenons un exemple :</p>
<pre><code>&gt; SELECT * FROM clients WHERE numtva &gt; 'BE00000000'</code></pre>
                            <p>Le résultat prendra en compte uniquement les clients pour lesquels le numéro de tva a été précisé et le comparera avec la valeur '<span class="em">BE00000000</span>'. Les clients pour lesquels le <span class="em">numtva</span> est <span class="em">NULL</span> ne sont pas comparables donc exclus du résultat.</p>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>num</th>
                                        <th>nom</th>
                                        <th>prenom</th>
                                        <th>adresse</th>
                                        <th>cp</th>
                                        <th>ville</th>
                                        <th>tel</th>
                                        <th>numtva</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                        <td>clos Chappelle aux Champs, 43</td>
                                        <td>1200</td>
                                        <td>Bruxelles</td>
                                        <td>02/764.46.46</td>
                                        <td>BE413770425</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p>Si on désire également considérer ceux pour lesquels le numéro de tva n'est pas précisé, il faut le mentionner explicitement :</p>
<pre><code>&gt; SELECT * FROM clients WHERE numtva &gt; 'BE00000000' OR numtva IS NULL;</code></pre>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>num</th>
                                        <th>nom</th>
                                        <th>prenom</th>
                                        <th>adresse</th>
                                        <th>cp</th>
                                        <th>ville</th>
                                        <th>tel</th>
                                        <th>numtva</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                        <td>clos Chappelle aux Champs, 43</td>
                                        <td>1200</td>
                                        <td>Bruxelles</td>
                                        <td>02/764.46.46</td>
                                        <td>BE413770425</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                        <td>rue Lambert Fortune, 2</td>
                                        <td>1300</td>
                                        <td>Wavre</td>
                                        <td>010/34.65.67</td>
                                        <td>NULL</td>
                                    </tr>
                                    <tr>
                                        <td>18</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                        <td>rue Sainte Anne, 6</td>
                                        <td>1300</td>
                                        <td>Wavre</td>
                                        <td>NULL</td>
                                        <td>NULL</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        <li>
                            <h4 id="order_by">ORDER BY :</h4>
                            <p>Comme il a été dit précédemmment, les tuples d'une table relationnelle n'ont en principe aucun ordre. De même, les résultats affichés par SQL peuvent l'être dans n'importe quel ordre : rien n'est garanti à ce sujet.</p>
                            <p>Cependant, on souhaite souvent que les résultats soient affichés dans un certain ordre : ordre croissant ou décroissant de numéro, de prix, d'âge, ordre alphabétique des noms, ordre chronologique, etc. À cet effet, il lui suffit d'ajouter une clause <span class="html">ORDER BY</span> à la fin de son instruction <span class="html">SELECT</span>.</p>
                            <p>Les lignes du résultat sont alors rangées dans l'ordre de l'attribut indiqué ou de la colonne dont le numéro d'ordre est indiqué. Cet attribut ou cette colonne est appelé "clé de tri". Les lignes sont rangées dans l'ordre croissant (numériquement en alphabétiquement selon le cas) si l'on a indiqué <span class="html">ASC</span>, <span class="html">ASCENDING</span> ou rien de tout, et dans l'ordre décroissant si l'on a indiqué <span class="html">DESC</span> ou <span class="html">DESCENDING</span>.</p>
                            <p>Si un second attribut ou un second numéro de colonne est indiqué, il sert à ordonner entre eux les tiples qui auraient même valeur pour la première clé de tri. Et ainsi de suite s'il y a de nouveau des ex-aequo pour cette deuxième clé de tri.</p>
                            <p>Par exemple, trions les clients par ordre anti alphabétique des prénoms :</p>
<pre><code>SELECT num, nom, prenom FROM clients
ORDER BY clients.prenom DESC;</code></pre>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>num</th>
                                        <th>nom</th>
                                        <th>prenom</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>18</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                    </ol>
                    <h3 id="fonctions_agregees">Les fonctions agrégées :</h3>
                    <ol type="a">
                        <li>
                            <h4 id="usage_fonctions_agregees">L'usage des fonctions agrégées :</h4>
                            <p>Souvent, on a besoin de connaître des valeurs globales qui sont les résultats de comparaisons ou de calculs effectués à partir de valeurs de plusieurs tuples : recherche de maximum, de minimum, de moyenne, de total, de dénombrement.</p>
                            <p>Les fonctions SQL suivantes répondent à ces besoins : <span class="html">max</span>, <span class="html">min</span>, <span class="html">avg</span>, <span class="html">sum</span>, <span class="html">count</span>. Le terme <span class="em">avg</span> est l'abréviation du mot anglais "average" qui signifie "moyenne".</p>
                            <p>Le paramètre placé entre parenthèses après une fonction d'agréagtion peut être remplacé par une expression plus générale, contenant (0,) 1 ou plusieurs attributs.</p>
                        </li>
                        <li>
                            <h4 id="resultat_fonction_agregee">Le résultat de la fonction agrégée :</h4>
                            <p>Remarquons bien que ces requêtes ne produisent chaque fois qu'une seule ligne de résultat.</p>
                            <p>Une requête telle que la suivante n'aurait aucun sens. Elle est d'ailleurs considérée comme une <span class="em">erreur</span> par la plupart des interpréteurs du langage SQL.</p>
<pre><code>SELECT SUM(prix), titre
FRM bd.albums
WHERE serie = 'Tintin';</code></pre>
                        </li>
                        <li>
                            <h4 id="importance_parametre_fonction_agregee">L'importance du paramètre de la fonction agrégée :</h4>
                            <p>Il est important de choisir judicieusement le paramètre de la fonction agrégée. Ce paramètre indique les lignes à prendre en compte dans le calcul.</p>
                            <table class="tableBalises">
                                <tbody>
                                    <tr>
                                        <td class="em">
<pre><code>&gt; SELECT COUNT (*)
FROM bd1.albums;</code></pre>
                                        </td>
                                        <td><span class="em">COUNT (*)</span> : sélection de toutes les lignes.</td>
                                    </tr>
                                    <tr>
                                        <td class="em">
<pre><code>&gt; SELECT COUNT (serie)
FROM bd1.albums;</code></pre>
                                        </td>
                                        <td><span class="em">COUNT (serie)</span> : sélection de toutes les lignes pour lesquelles la série est spécifiée (non NULL).</td>
                                    </tr>
                                    <tr>
                                        <td class="em">
<pre><code>&gt; SELECT COUNT (DISTINCT serie)
FROM bd1.albums;</code></pre>
                                        </td>
                                        <td><span class="em">COUNT (DISINCT serie)</span> : sélection de toutes les séries différentes.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                    </ol>
                    <h3 id="relation_1_a_N">La relation de 1 à N :</h3>
                    <p>Reprenons notre exemple <span class="em">clients</span>.Dans cet exemple utilisé jusqu'ici, on s'occupait d'un type d'informations, à savoir les clients. Une seule table pouvait rassembler les informations utiles à leur sujet.</p>
                    <p>Intéressons-nous à présent à deux types d'objets, liés entre eux, par exemple les clients et leurs commandes.</p>
                    <p>Si on n'avait affaire qu'à des clients occassionnels, c'est-à-dire des clients qui commandent un article au comptoir, reçoivent leur marchandise et la paient puis "disparaissent dans la nature", on pourrait continuer à travailler avec une seule table, celle des "clients+commandes", dont chaque ligne contiendrait :</p>
                    <ul>
                        <li>les informations relatives au client (nom, adresse, etc.)</li>
                        <li>les informations relatives à la commande du client (nom de l'article, quantité, prix, etc.)</li>
                    </ul>
                    <p>Souvent cependant, on traite avec des clients réguliers, dont on mémorise une fois toutes les coordonnées. La méthode à une seule table demanderait de mémoriser le nom et l'adresse d'un client autant de fois qu'il a effectué des commandes. Il est beaucoup plus efficace de ne mémoriser qu'à un seul endroit les informations relatives au client, dans une "table des clients", et d'indiquer dans une autre table, la "table des commandes", les informations relatives aux commandes. Mais il faudra un lien entre les deux tables, car on doit, pour chaque commande, pivroir retrouver le client auquel elle se rapporte, ainsi que les coordonnées de ce client.</p>
                    <p>Le lien entre deux concepts tels que "clients" et "commandes" peut-être mis en évidence dans le diagramme de structure de données qui se présente comme suit :</p>
                    <img src="../images/1_N.PNG" alt="relation 1 à N">
                    <p>Lequel signifie exactement la même chose que les deux phrases suivantes :</p>
                    <ul>
                        <li>chaque client peut avoir (zéro,) un ou plusieurs commandes</li>
                        <li>chaque commande est relative à un seul client</li>
                    </ul>
                    <p>On appelle une "relation de 1 à N" entre la table <span class="em">clients</span> et la table <span class="em">commandes</span>.</p>
                    <ol type="a">
                        <li>
                            <h4 id="cle_etrangere">La clé étrangère :</h4>
                            <p>À présent, une table de commandes s'ajoute à la table des clients. Comme on doit pouvoir retrouver le client de chaque commande, nous allons prévoir, parmi les attributs de la commande, un attribut obligatoire (non NULL) qui est une <span class="em">référence au client</span>.</p>
                            <p>Nous allons à cet effet choisir une valeur qui permet de <span class="em">reconnaître le client de façon unique</span>, sans risque d'ambiguité (même si la table des clients est augmentée par la suite !) : le nom du client ne suffit pas à identifier un client précis, et même son nom et son prénom ensemble pourraient être ambigus (il peut y avoir plusieurs Luc Dupuis !). Mais nous avons heureusement prévu ci-dessus de donner à chaque client un numéro, et nous avons même spécifié que ce numéro était une <span class="em">clé primaire</span>, c'est-à-dire devait absolument être différent d'un client à l'autre : il suffit donc de remettre ce numéro de client dans le tuple relatif à une commande !</p>
                            <p>Cette mention du numéro du client dans la table des commandes constitue une <span class="em">clé étrangère</span> (<span class="html">FOREIGN KEY</span> en anglais). Le simple fait de spécifier cela dans le <span class="html">CREATE TABLE</span> va assurer que, à aucun moment, la table des commandes ne contiendra un tuple dont le numéro de client ne soit pas celui d'un client présent dans la table des clients. Dans le DSD, <span class="em">numcient</span>, la clé étrangère, doit être <span class="em">NOT NULL</span> dans notre cas mai une clé étrangère ne doit pas d'office être <span class="em">NOT NULL</span>.</p>
<pre>CREATE TABLE commandes
(
    numcommande INTEGER PRIMARY KEY,
    jour INTEGER,
    mois INTEGER,
    annee INTEGER,
    numclient INTEGER NOT NULL REFERENCES clients (num),
    article VARCHAR(30),
    quantite INTEGER,
    prixunitaire INTEGER,
);<code></code></pre>
                            <table class="tableBalises">
                                <caption>Voici un exemple de contenu de cette table :</caption>
                                <thead>
                                    <tr>
                                        <th>numcommande</th>
                                        <th>jour</th>
                                        <th>mois</th>
                                        <th>annee</th>
                                        <th>numclient</th>
                                        <th>article</th>
                                        <th>quantite</th>
                                        <th>prixunitaire</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>5</td>
                                        <td>9</td>
                                        <td>2000</td>
                                        <td>1</td>
                                        <td>stylo M3</td>
                                        <td>20</td>
                                        <td>150</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>56</td>
                                        <td>9</td>
                                        <td>2000</td>
                                        <td>18</td>
                                        <td>stylo M3</td>
                                        <td>80</td>
                                        <td>150</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>6</td>
                                        <td>9</td>
                                        <td>2000</td>
                                        <td>18</td>
                                        <td>cartouche</td>
                                        <td>160</td>
                                        <td>20</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>8</td>
                                        <td>9</td>
                                        <td>2000</td>
                                        <td>3</td>
                                        <td>classeurL</td>
                                        <td>10</td>
                                        <td>80</td>
                                    </tr>
                                    <tr>
                                        <td>8</td>
                                        <td>1</td>
                                        <td>10</td>
                                        <td>2000</td>
                                        <td>1</td>
                                        <td>stylo M3</td>
                                        <td>30</td>
                                        <td>150</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        <li>
                            <h4 id="jointure">La jointure :</h4>
                            <p>On peut à présent effectuer des recherches sur l'une ou l'autre des deux tables, ce qui n'est pas neuf, mais également sur les deux tables simultanément. On dit qu'on travaille sur la "<span class="em">jointure</span>" des deux tables.</p>
                            <p>Exemple : je veux connaître pour chaque commande, l'article, la quantité et les nom et prénom du client.</p>
<pre><code>SELECT commandes.article, commandes.quantite, clients.nom, clients.prenom
FROM commandes, clients
WHERE commandes.numclient = clients.num;</code></pre>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>article</th>
                                        <th>quantite</th>
                                        <th>nom</th>
                                        <th>prenom</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>20</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>80</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                    <tr>
                                        <td>cartouche</td>
                                        <td>160</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                    <tr>
                                        <td>classeurL</td>
                                        <td>10</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>30</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p>On aura remarqué que les noms d'attributs sont précédés du nom de la table dont ils sont issus, en vue d'éviter les éventuelles ambiguités (au cas où deux tables auraient des attributs de même nom).</p>
                            <p>Dans le cas présent, il n'y a pas d'ambiguité possible, on aurait aussi écrire :</p>
<pre><code>SELECT article, quantite, nom, prenom
FROM commandes, clients
WHERE numclient = num;</code></pre>
                            <p>Autre exemple : je veux connaître les commandes de septembre 2000 (n°, article, quantité) faites par des clients de Wavre, et pour chacune d'elles, le nom, le prénom et le numéro de téléphone du client qui l'a effectuée.</p>
<pre><code>SELECT commandes.numcommande, commandes.article, commandes.quantite, client.nom, clients.prenom, clients.tel
FROM commandes, clients
WHERE commandes.numclient = clients.num AND commandes.annee = 2000 AND commandes.mois = 9 AND clients.ville = 'Wavre';</code></pre>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>numcommande</th>
                                        <th>article</th>
                                        <th>quantite</th>
                                        <th>nom</th>
                                        <th>prenom</th>
                                        <th>tel</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2</td>
                                        <td>stylo M3</td>
                                        <td>80</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                        <td>NULL</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>cartouche</td>
                                        <td>160</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                        <td>NULL</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>classeurL</td>
                                        <td>10</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                        <td>010/34.65.67</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p>Parmi les conditions qui suivent le mot <span class="em">WHERE</span>, figure la "<span class="em">condition de jointure</span>", qui permet de faire le lien entre un tuple d'une table et un tuple de l'autre, c'est-à-dire, dans notre exemple, entre une commande et son client. Cette condition est celle d'égalité des numéros de client des deux tables : <span class="em">commandes.numclient = clients.num</span>.</p>
                            <p>Plutôt que de répéter les noms des tables, on peut avoir recours aux "<span class="em">alias</span>". Par exemple :</p>
<pre><code>SELECT CO.article, CO.quantite, CL.nom, CL.prenom
FROM commandes CO, clients CL
WHERE CO.numclient = CL.num;</code></pre>
                        </li>
                        <li>
                            <h4 id="produit_cartesien">Le produit cartésien :</h4>
                            <p>En <span class="em">l'absence de la condition de jointure</span>, le système croise chaque tuple de <span class="em">commandes</span> avec chaque tuple de <span class="em">clients</span>, sans tenir compte de cette correspondance.</p>
<pre><code>SELECT article, quantite, nom, prenom
FROM commandes, clients;</code></pre>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>article</th>
                                        <th>quantite</th>
                                        <th>nom</th>
                                        <th>prenom</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>20</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>20</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>20</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>80</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>80</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>80</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                    <tr>
                                        <td>cartouche</td>
                                        <td>160</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                    <tr>
                                        <td>cartouche</td>
                                        <td>160</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                    </tr>
                                    <tr>
                                        <td>cartouche</td>
                                        <td>160</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                    <tr>
                                        <td>classeurL</td>
                                        <td>10</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                    <tr>
                                        <td>classeurL</td>
                                        <td>10</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                    </tr>
                                    <tr>
                                        <td>classeurL</td>
                                        <td>10</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>30</td>
                                        <td>Dupuis</td>
                                        <td>Benoit</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>30</td>
                                        <td>Dupuis</td>
                                        <td>Luc</td>
                                    </tr>
                                    <tr>
                                        <td>stylo M3</td>
                                        <td>30</td>
                                        <td>Van Moer</td>
                                        <td>Willy</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p>Pour comprendre le résultat, il faut se souvenir des règles ensemblistes en mathématique.</p>
                            <p>Puisqu'il y a 3 clients et 5 commandes, le produit cartésien de ces deux ensembles fournit 15lignes en résultat.</p>
                            <p>Effectivement, il faut multiple le nombre de lignes des deux ensembles : 3 clients * 5 commandes = 15 lignes résultantes !</p>
                            <p>Chaque tuple d'une table est mis en lien avec les tuples de l'autre table.</p>
                            <p>Dans le cas présent, ce query n'a aucn intérêt.</p>
                            <p>Mais le produit cartésien peut s'avérer intéressant dans certains cas. Supposons qu'une des clientes se prénomme Cerise et qu'il existe un article intitulé Cerise dans l'assortiment.</p>
                            <p>Que répondez-vous aux deux questions suivantes :</p>
                            <ul>
                                <li>Est-ce que Cerise a commandé des cerises ? (Combien ?)</li>
                                <li>Est-ce qu'il existe un article qui porte le même prénom que celui d'un client ?</li>
                            </ul>
                            <p>La première question est une requête avec jointure.</p>
<pre><code>SELECT quantite
FROM commandes CO, clients CL
WHERE CO.numclient = CL.num AND CL.prenom = 'Cerise' AND CO.article = 'Cerise';</code></pre>
                            <p>Par contre, la réponse à la deuxième question fait intervenir un produit cartésien.</p>
<pre><code>SELECT DISTINCT prenom
FROM clients, commandes
WHERE prenom = article;</code></pre>
                        </li>
                        <li>
                            <h4 id="exemples_supplementaires">Exemples supplémentaires :</h4>
                            <ol>
                                <li>
                                    <p>Je désire connaître le nombre de commandes réalisées pour des clients  de Wavre ainsi que le montant total de celles-ci avec une rédution de 5%.</p>
<pre><code>SELECT COUNT (CO.numcommande), SUM (CO.prixunitaire * CO.quantite) * 0.95
FROM commandes CO, clients CL
WHERE CO.numclient = CL.num AND CL.ville = 'Wavre';</code></pre>
                                    <table class="tableBalises">
                                        <caption>Ça va afficher ceci :</caption>
                                        <thead>
                                            <tr>
                                                <th>count</th>
                                                <th>?Column?</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>3</td>
                                                <td>11780</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <p>Pour mettre un nom aux différentes colonnes, on utilise le mot <span class="html">AS</span>. Ça donnera un truc comme ceci :</p>
<pre><code>SELECT COUNT (CO.numcommande) <span class="em">AS</span> "nombre de commandes", SUM (CO.prixunitaire * CO.quantite) * 0.95 <span class="em">AS</span> "prix total"
FROM commandes CO, clients CL
WHERE CO.numclient = CL.num AND CL.ville = 'Wavre';</code></pre>
                                    <table class="tableBalises">
                                        <caption>Avec le mot <span class="em">AS</span>, ça affichera ceci à la place :</caption>
                                        <thead>
                                            <tr>
                                                <th class="em">nombre de commandes</th>
                                                <th class="em">prix total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>3</td>
                                                <td>11780</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </li>
                                <li>
                                    <p>Je veux connaître le prénom des clients dont le nom est "Dupuis" qui ont commandé un article "classeurL".</p>
<pre><code>SELECT <span class="em">DISTINCT</span> CL.prenom
FROM commandes CO, clients CL
WHERE CO.numclient = CL.num AND CL.nom = 'Dupuis' AND CO.article = 'classeurL';</code></pre>
                                    <p>On met le mot <span class="em">DISTINCT</span> après le <span class="em">SELECT</span> en se posant la question, "<span class="em">Suis-je certain qu'il n'y aura qu'un seul résultat ?</span>" et que la réponse est <span class="em">NON</span>.</p>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <h4 id="transitivite">La transitivité :</h4>
                            <p>Rappel mathématique : si <span class="em">A = B</span> et <span class="em">B = C</span>, alors <span class="em">A = C</span>.</p>
                            <p>Ce principe s'applique également au SQL. Prenons les tables suivates :</p>
                            <img src="../images/transitivite.PNG" alt="transitivité">
                            <p>Un client peut avoir plusieurs commandes et aussi plusieurs adresses de livraison. Les tables adresses_de_livraison et commandes ont la même clé étrangère <span class="em">numclient</span> qui fait référence à la table clients.</p>
                            <p>Essayons de répondre à la requête suivante : quelles sont les commandes qui ont été livrées à l'adresse de livraison dont le numéro (<span class="em">numadresselivraison</span>) est le 5 ?</p>
<pre><code>SELECT DISTINCT CO.numcommande
FROM commandes CO, <span class="em">clients CL</span>, adresses_de_livraison AL
WHERE CO.numclient = <span class="em">CL.num</span> AND AL.numclient = <span class="em">CL.num</span> AND AL.numadresselivraison = 5;</code></pre>
                            <p>La transitivité va nous permettre de simplifier cette requête en n'utilisant plus la table clients :</p>
<pre><code>SELECT DISTINCT CO.numcmmande
FROM commandes CO, adresses_de_livraison AL
WHERE CO.numclient = AL.numclient AND AL.numadresselivraison = 5;</code></pre>
                        </li>
                    </ol>
                    <h3 id="relation_M_a_N">La relation M à N :</h3>
                    <p>Repartons de l'exemple des clients et des commandes. Le lecteur aura peut-être surpris de la façon dont les articles ont été traités jusqu'ici.</p>
                    <ul>
                        <li>Les articles qui sont disponibles mais qui n'ont encore été commandés par personne ne figurent nulle part : comment le système connaîtra-t-il la liste ?</li>
                        <li>Les dénominations des articles pouvant être longues et changeantes, il est inutile de répéter ces informations pour chaque commande d'un article donné.</li>
                    </ul>
                    <p>Nous voici donc amenés à créer une nouvelle table : celle des articles susceptibles d'être commandés (le catalogue des articles).</p>
                    <p>Outre les allègements et autres améliorations déjà mis en évidence, nous pourrions profiter de cette table pour assurer une tenue de stock : il suffira, pour chaque article, de mémoriser sous forme d'attribut la quantité totale en stock. On peut même y ajouter un seuil de recommande, c'est-à-dire la valeur minimale du stock en dessous de laquelle il nous faut nous-mêmes nous réapprovisionner auprès de notre fournisseur. (Exemple : s'il nous reste moins de 100 stylos M3, il est temps que nous en recommandions.)</p>
                    <p>La table des commandes ne contiendra plus les informations relatives à l'article, mais un numéro qui fait référence à un tuple de la table des articles.</p>
                    <p>Voici les nouvelles instructions de création de tables (la table des clients reste identique) :</p>
<pre><code>CREATE TABLE articles
(
    numart INTEGER PRIMARY KEY,
    nomart VARCHAR(30),
    prixunitaire INTEGER,
    stock INTEGER,
    seuil INTEGER,
);

CREATE TABLE commandes
(
    numcommande INTEGER PRIMARY KEY,
    jour INTEGER,
    mois INTEGER,
    annee INTEGER,
    numclient INTEGER NOT NULL REFERENCES clients (num),
    numart INTEGER NOT NULL REFERENCES articles (numart),
    quantite INTEGER,
);</code></pre>
                    <img src="../images/M_N.PNG" alt="relation M à N">
                    <p>Il y a <span class="html">deux relations 1 à N</span> : entre <span class="em">clients</span> et <span class="em">commandes</span> d'une part, et entre <span class="em">articles</span> et <span class="em">commandes</span> d'autrepart. En effet :</p>
                    <ul>
                        <li>
                            <p>entre <span class="em">clients</span> et <span class="em">commandes</span> :</p>
                            <ul>
                                <li>un client peut avoir fait zéro, une ou plusieurs commandes.</li>
                                <li>une commande a été faite par un seul client.</li>
                            </ul>
                        </li>
                        <li>
                            <p>entre <span class="em">articles</span> et <span class="em">commandes</span> :</p>
                            <ul>
                                <li>un article peut avoir fait l'objet de zéro, une ou plusieurs commandes.</li>
                                <li>une commande mentionne un seul article.</li>
                            </ul>
                        </li>
                    </ul>
                    <p>Mais, entre <span class="em">clients</span> et <span class="em">articles</span>, il y a aussi une relation. On l'appelle une "<span class="html">relation M à N</span>" car :</p>
                    <ul>
                        <li>un client peut avoir commandé zéro, un ou plusieurs articles.</li>
                        <li>un article peut avoir été commandé par zéro, un ou plusieurs clients.</li>
                    </ul>
                    <p>Signalons qu'on utilise le mot "article" pour désigner plutôt un "type d'article", ou encore un "élément du catalogue des articles", MAIS pas une pièce précise, pas un "article physique individuel".</p>
                    <p>Les relations M à N ne sont jamais représentées directement dans un diagramme de structure de données, elles le sont toujours par deux relations 1 à N, dirigées vers une troisième entité intermédiaire (<span class="em">commandes</span> dans l'exemple).</p>
                    <p>Le contenu des tables <span class="em">commandes</span> et <span class="em">articles</span> pourraient être :</p>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>numcommande</th>
                                <th>jour</th>
                                <th>mois</th>
                                <th>annee</th>
                                <th>numclient</th>
                                <th>numart</th>
                                <th>quantite</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>5</td>
                                <td>9</td>
                                <td>2000</td>
                                <td>1</td>
                                <td>3</td>
                                <td>20</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>6</td>
                                <td>9</td>
                                <td>2000</td>
                                <td>18</td>
                                <td>3</td>
                                <td>80</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>6</td>
                                <td>9</td>
                                <td>2000</td>
                                <td>18</td>
                                <td>4</td>
                                <td>160</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>8</td>
                                <td>9</td>
                                <td>2000</td>
                                <td>3</td>
                                <td>5</td>
                                <td>10</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>1</td>
                                <td>10</td>
                                <td>2000</td>
                                <td>1</td>
                                <td>3</td>
                                <td>30</td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>numart</th>
                                <th>nomart</th>
                                <th>prixunitaire</th>
                                <th>stock</th>
                                <th>seuil</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>stylo M1</td>
                                <td>100</td>
                                <td>200</td>
                                <td>100</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>stylo M2</td>
                                <td>130</td>
                                <td>125</td>
                                <td>100</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>stylo M3</td>
                                <td>150</td>
                                <td>150</td>
                                <td>100</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>cartouche</td>
                                <td>20</td>
                                <td>950</td>
                                <td>200</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>classeurL</td>
                                <td>80</td>
                                <td>23</td>
                                <td>20</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>classeur XL</td>
                                <td>150</td>
                                <td>12</td>
                                <td>20</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Voici quelques exemples de requêtes qui font appel aux trois tables.</p>
<pre><code>SELECT DISTINCT CL.nom, CL.prenom, CL.num, COM.quantite
FROM clients CL, commandes COM, articles AR
WHERE <span class="em">CL.num = COM.numclient</span>
<span class="em">AND COM.numart = AR.numart</span>
AND CL.ville = 'Wavre'
AND COM.annee = 2000
AND AR.nomart = 'stylo M3';</code></pre>
                    <p>Ce qui signifie que l'on veut connaître les clients de Wavre qui ont commandé en l'an 2000 des stylos M3, et en quelle quantité.</p>
                    <p>Les deux première conditions derrièrele mot <span class="em">conditions de jointures</span>, indispensables au bon fonctionnment de ce query. Le résultat affiché sera :</p>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>nom</th>
                                <th>prenom</th>
                                <th>num</th>
                                <th>quantite</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Van Moer</td>
                                <td>Willy</td>
                                <td>18</td>
                                <td>80</td>
                            </tr>
                        </tbody>
                    </table>
<pre><code>SELECT COUNT (*), SUM (quantite)
FROM clients CL, commandes COM, articles AR
WHERE CL.num = COM.numclient
AND COM.numart = ART.numart
AND CL.nom = 'Dupuis'
AND (AR.prixunitaire &gt; 50 OR COM.quantite &gt; 100);</code></pre>
                    <p>On veut connaître, pour tous les clients qui s'appellent 'Dupuis', le nombre de commandes et le nombre total d'unités commandées, si on se limite aux commandes "importantes" (c'est-à-dire portant sur des articles à plus de 50 cents, ou sur des quantités de plus de 100 unités).</p>
                    <p>Réflexion : les parenthèses de la dernière ligne de cette instruction sont-elles indispensables ? Que passerait-il si on les ôtait ?</p>
                    <h3 id="cle_primaire_concatenee">La clé primaire concaténée :</h3>
                    <p>Jusqu'ici, une commande consistait à ce qu'un client donné commande un article donné en une quantité donnée à une certaine date. Si le même client voulait commander simultanément des stylos et des cartouches, il devait effectuer deux commandes; et si pour chaque commande on édite une facture, il reçoit deux factures ! Cela peut devenir lourd et gênant.</p>
                    <p>Aussi décide-t-on souvent d'appeler "commande" une liste d'articles qu'un client désire obtenir en quantités précises. Chaque commande sera subdivisée en <span class="em">lignes de commande</span> (en référene aux formulaires de commande sur papier ou sur écran, dans lesquels chaque article commandé figure sur une nouvelle ligne).</p>
                    <img src="../images/cle_primaire_concatenee.PNG" alt="clé primaire concaténée">
                    <p>Les tables des commandes et lignes de commandes sont les suivantes (les tables des clients et des articles étant inchangées) :</p>
<pre><code>CREATE TABLE commandes
(
    numcommande INTEGER PRIMARY KEY,
    jour INTEGER,
    mois INTEGER,
    annee INTEGER,
    numclient INTEGER NOT NULL REFERENCES clients (num),
);

CREATE TABLE lignes
(
    numcommande INTEGER NOT NULL REFERENCES commandes (numcommande),
    numligne INTEGER,
    numart INTEGER NOT NULL REFERENCES articles (numart),
    quantite INTEGER,
    prix INTEGER,
    <span class="html">PRIMARY KEY (numcommande, numligne)</span>,
);</code></pre>
                    <p>On constate une nouveauté : la <span class="em">clé primaire</span> des lignes de commande est constituée de la <span class="em">concaténation</span> de deux attributs, car c'est <span class="em">leur combinaison qui est unique</span>.</p>
                    <p>Par exemple : il ne peut pas y avoir deux fois la ligne n°2 à la commande n°324; par contre, les commandes 327 et 328 peuvent avoir toutes deux une ligne n°2.</p>
                    <p>Le diagramme de structure de données est le suivant :</p>
                    <img src="../images/cle_primaire_concatenee_dsd.PNG" alt="DSD de la clé primaire concaténée">
                    <p>Exemples :</p>
                    <p>Si on n'a pas besoin des 4 tables dans certaines requêtes, on n'utilisera que celles qui sont nécessaires.</p>
                    <ol>
                        <li>
                            <p>Quelles sont les lignes de commandes dont la quantité aatteint ou dépasse les 500 unités, et, pour chacune d'elles, donnez le nom du client, le libellé de l'article et la quantité commandée.</p>
<pre><code>SELECT CL.nom, AR.nomart, LI.quantite
FROM clients CL, commandes COM, lignes LI, articles AR
WHERE CL.num = COM.numclient
AND COM.numcommande = LI.numcommande
AND LI.numart = AR.numart
AND LI.quantite &gt;= 500;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les articles qui nous ont été commandés en août ou septembre 2000 et dont le stock actuel est situé en-dessous du seuil de recommande ?</p>
<pre><code>SELECT AR.numart, ART.nomart, AR.stock
FROM commandes COM, lignes LI, articles AR
WHERE COM.numcommande = LI.numcommande
AND LI.numart = AR.numart
AND COM.annee = 2000
AND (COM.mois = 8 OR COM.mois = 9)
AND AR.stock &lt; AR.seuil;</code></pre>
                            <p>Attention, si un article donné a été commandé plusieurs fois ces deux mois, on constatera que la ligne de résultat correspondant à cet article apparaîtra plusieurs fois dans le résultat. Le moyen d'éviter cela est bien sûr d'ajouter le mot-clé <span class="em">DISTINCT</span> après le mot <span class="em">SELECT</span>. L'instruction devient :</p>
<pre><code>SELECT DISTINCT AR.numart, ART.nomart, AR.stock
FROM commandes COM, lignes LI, articles AR
WHERE COM.numcommande = LI.numcommande
AND LI.numart = AR.numart
AND COM.annee = 2000
AND (COM.mois = 8 OR COM.mois = 9)
AND AR.stock &lt; AR.seuil;</code></pre>
                            <p>Remarquons que ce mot <span class="em">DISTINCT</span> porte sur l'ensmeble de la ligne (et pas sur l'arttribut <span class="em">numart</span> qui le suit immédiatement). Cela n'aurait pas de sens de répéter ce mot ailleurs.</p>
                        </li>
                        <li>
                           <p>Quelles sont les villes des clients qui ont commandé des cartouches en septembre 2000 ?</p>
<pre><code>SELECT DISTINCT CL.ville
FROM clients CL, commandes COM, lignes LI, articles AR
WHERE CL.num = COM.numclient
AND COM.numcommande = LI.numcommande
AND LI.numart = AR.numart
AND AR.nomart = 'cartouche'
AND COM.annee = 2000
AND COM.mois = 9;</code></pre>
                        </li>
                    </ol>
                    <p>Autre possibilité, on choisit comme clé primaire de la table <span class="em">ligne</span> la <span class="em">concaténation</span> des deux <span class="em">clés étrangères</span> : <span class="em">numcommande</span> et <span class="em">numart</span>. Le choix d'une telle clé a pour conséquence qu'au sein d'une commande, il ne peut y avoir qu'une seule ligne par article. En d'autres termes, un article ne peut se trouver que dans une seule ligne de commande. Évidemment, ceci est plus contraignant.</p>
                    <p>Le <span class="html">CREATE TABLE</span> ne diffère pas beaucoup de celui déjà présenté :</p>
<pre><code>CREATE TABLE lignes
(
    numcommande INTEGER NOT NULL REFERENCES commandes (numcommande),
    numart INTEGER NOT NULL REFERENCES articles (numart),
    quantite INTEGER,
    prix INTEGER,
    <span class="html">PRIMARY KEY (numcommande, numart)</span>,
);</code></pre>
                    <img src="../images/cle_primaire_concatenee_dsd_2.PNG" alt="DSD de clé concaténée n°2">
                    <h3 id="cle_etrangere_concatenee">La clé étrangère concaténée :</h3>
                    <p>Lorsqu'on fait une jointure avec une clé étrangère concaténée, il faut penser à faire la jointure sur <span class="em">tous</span> les champs qui composent cette clé étrangère.</p>
                    <p>Prenons pour exemple le DSD (limité) suivant :</p>
                    <img src="../images/cle_etrangere_concatenee_dsd_1.PNG" alt="DSD de clé étrangère concaténée n°1">
                    <p>Imaginons des clubs de foot. Dans chaque club de foot, il y a plusieurs équipes, et dans chaque équipe il y a un certian nombre de membres.</p>
                    <p>La FK de la table membres est une FK composite, faisant référence à la PK composite de la table equipes : <span class="em">id_club, num_equipe</span>.</p>
                    <p>Pour afficher tous les membres de l'équipe numéro 5, il faudra écrire la requête suivante :</p>
<pre><code>SELECT m.num_membre, m.nom, m.prenom
FROM membres m, equipes e
WHERE <span class="em">m.id_club = e.id_club</span>
<span class="em">AND m.num_equipe = e.num_equipe</span>
AND e.num_equipe = 5;</code></pre>
                    <h3 id="sous-requete">Sous-requête :</h3>
                    <p>Une sous-requête <span class="em">SELECT</span> à l'intérieur d'une autre. Une sous-requête doit être placée à la suite d'une clause <span class="em">WHERE</span> ou d'une clause <span class="em">HAVING</span> (voir ci-dessous).</p>
                    <p>Le résultat de la sous-requête remplace une valeur ou un groupe de valeurs dans une condition.</p>
<pre><code>SELECT *
FROM table1
WHERE table1.id | IN <span class="html">(SELECT table2.id FROM table2)</span>;
    | NOT IN
    | =
    | NOT =
    | Autres opérateurs &lt;, &gt; ...</code></pre>
                    <p><span class="em">SELECT table2.id FROM table2</span> est la sous-requête. Une sous-requête s'exprime toujours entre parenthèses.</p>
                    <p>Exemples :</p>
                    <p>Quelles sont toutes les commandes de Mr Jean Dupont ?</p>
<pre><code>SELECT numcommande
FROM commandes, clients
WHERE numclient = num
AND nom = 'Dupont'
AND prenom = 'Jean';</code></pre>
                    <p>Ou</p>
<pre><code>SELECT numcommande
FROM commandées
WHERE numclient (SELECT num
FROM clients
WHERE nom = 'Dupont' AND prenom = 'Jean');</code></pre>
                    <p>Dans ce premier exemple, nous avons vu deux manières différentes d'écrire une requête. Dans un tel cas, l'emploi de la sous-requête n'est pas indispensable.</p>
                    <p>Dans l'exemple suivant, nous abordons un cas où l'emploi de la sous-requête est indispensable.</p>
                    <p>Quels sont les articles les plus chers, c'est-à-dire ceux dont le prix est égal au prix le plus élevé ?</p>
<pre><code>SELECT numart, nomart
FROM articles
WHERE prixunitaire = (SELECT MAX (prixunitaire) FROM articles);</code></pre>
                    <h3 id="clauses_supplementaires">Les clauses supplémentaires :</h3>
                    <ol type="a">
                        <li>
                            <h4 id="group_by">GROUP BY :</h4>
                            <p>L'objectif est d'efftuer des opérations de somme, comptage, moyenne, minimum ou maximum sur plusieurs groupes de tuples et non sur l'ensemble des tuples comme nous l'avons vu auparavant. C'est ce que l'on appelle une <span class="em">rupture de séquence</span>.</p>
                            <p>Par exemple, si on désire compter le nombre de lignes de commande :</p>
<pre><code>SELECT numcommande, COUNT (*)
FROM lignes
GROUP BY numcommande;</code></pre>
                            <p>On obtiendra autant de tuples dans le résultat qu'il y a de numéros de commandes différents.</p>
                            <p>Même exemple, mais en affichant la date de la commande.</p>
<pre><code>SELECT lignes.numcommande, annee, mois, jour, COUNT (*)
FROM lignes, commandes
WHERE lignes.numcommande = commandes.numcommande
GROUP BY lignes.numcommande, annee, mois, jour;</code></pre>
                            <p>Le groupement, comme dans le cas précédent, se fera par commande. On groupe ensemble tous les tuples qui ont la même valeur pour les attributs figurant derrière les <span class="html">GROUP BY</span>.</p>
                            <p>Dans le second exemple, l'ajout des attributs annee, mois et jour en fin d'instruction ne change rien au groupement, puisque si le numéro de commande est le même, la date sera forcément la même aussi, mais leur présence est exigée par SQL : en effet, tout attribut digurant hors d'une fonction d'agrégation après le mot <span class="em">SELECT</span> doit aussi figurer derrière les mots <span class="em">GROUP BY</span>.</p>
                            <p>La clause <span class="html">GROUP BY</span> n'a d'intérêt que si l'on utilise <span class="em">au moins une fonction d'agrégation</span>.</p>
                            <p>Autre exemple, on désire afficher le chiffre d'affaires (total de toutes les commandes) de chaque mois de l'année 2001 :</p>
<pre class="taille 60"><code>SELECT mois, SUM(prix * quantite)
FROM commandes, lignes
WHERE annee = 2001 AND commandes.numcommande = lignes.numcommande
GROUP BY mois</code></pre>
                            <p>Même chose, mais pour chaque mois de toutes les années :</p>
<pre class="taille 60"><code>SELECT annee, mois, SUM(prix * quantite)
FROM commandes, lignes
WHERE commandes.numcommande = lignes.numcommande
GROUP BY annee, mois</code></pre>
                            <p>Quel est le montant total payé par chaque client ?</p>
<pre><code>SELECT numclient, SUM (prix * quantite)
FROM commandes, lignes
WHERE commandes.numcommande = lignes.numcommande
GROUP BY numclient;</code></pre>
                            <p>Même chose, mais en indiquant le nom du client :</p>
<pre><code>SELECT CL.num, CL.nom, AVG (prix * quantite)
FROM commandes COM, clients CL, lignes
WHERE COM.numclient = CL.num
AND COM.numcommande = lignes.numcommande
GROUP BY CL.num, CL.nom;</code></pre>
                            <p>On peut aussi écrire, derrière le mot <span class="em">SELECT</span>, des expressions contenant une ou plusieurs fonctions d'agrégation mais il va de soi que celles-ci ne figureront pas dans le <span class="em">GROUP BY</span>.</p>
                        </li>
                        <li>
                            <h4 id="having">HAVING :</h4>
                            <p><span class="html">HAVING</span> permet d'élimiter certains tuples ou groupes de tuples du résultat.</p>
                            <p>La clause <span class="em">HAVING</span> existe en SQL parce qu'il est impossble d'utiliser des fonctions agrégées dans le <span class="em">WHERE</span>. Si une table a été groupée en utilisant la clause <span class="em">GROUP BY</span> mais que seuls certains groupes sont intéressants, la clause <span class="em">HAVING</span> peut être utilisée, comme une clause <span class="em">WHERE</span>, pour éliminer les groupes du résultat.</p>
                            <p>Les expressions de la clause <span class="em">HAVING</span> peuvent référer à la fois aux expressions groupées et aux expressions non groupées.</p>
                            <p>Exemple :</p>
<pre><code>SELECT CL.num, CL.nom, SUM (prix * quantite)
FROM commandes COM, clients CL
WHERE COM.numclient = CL.num
GROUP BY  CL.num, CL.nom
HAVING SUM (prix * quantite) &gt; 10000;</code></pre>
                        </li>
                    </ol>
                    <h3 id="conclusion_partie_1">Conclusion de la partie 1 :</h3>
                    <p>Nous avons maintenant découvert les premières instructions du langage SQL : <span class="em">CREATE TABLE</span>, <span class="em">INSERT INTO</span> et <span class="em">SELECT</span>; dans la partie suivante du cours, nous allons nous pencher sur la manière de concevoir des bases de données. Nous nous attarderons donc à la réalisation des diagrammes de structures de données (DSD).</p>
                    <h3 id="exercices">Exercices :</h3>
                    <h4 id="introduction_exercices">Introduction :</h4>
                    <p>Dans la suite, on présente les exercices SQL cours de BD1. Il vous sera proposé d'effectuer des requêtes (queries) sur une base de données contenant des bandes dessinées.</p>
                    <p>Les séances d'exercices ont pour but de vous apprendre à créer une base de données, à y insérer des informations et ensuite à consulter de façon souple et puissante les informations ainsi stockées.</p>
                    <p>Les exercices se découpent en 4 niveaux progressifs :</p>
                    <ul>
                        <li>Niveau 1 - Les requêtes portent sur une seule table.</li>
                        <li>Niveau 2 - Les requêtes portent sur deux tables.</li>
                        <li>Niveau 3 - Les requêtes portent sur une base de données de quatre tables.</li>
                        <li>Niveau 4 - Les requêtes reposent sur une base de données de quatre tables MAIS les requêtes s'effectuent sur 1, 2, 3 ou 4 tables.</li>
                    </ul>
                    <p>Dans chaque niveau, les queries demandées sont également classés par ordre de difficulté croissante.</p>
                    <p>Le Système de Gestion de Bases de Données (SGBD) utilisé est PostgreSQL (<a href="http://www.postgresql.org/" target="_blank">http://www.postgresql.org/</a>) qui est une base de données open source.</p>
                    <p>Le logiciel permettant d'exécuter les requêtes SQL avec PostgreSQL s'appelle pgAdmin (<a href="http://www.pgadmin.org/" target="_blank">http://www.pgadmin.org/</a>).</p>
                    <p>Il s'agit d'un logiciel qui permet d'exécuter des commandes SQL à travers une interface graphique (Windows) et donc relativement confortable.</p>
                    <p>Afin de réaliser ces exercices, vous disposez de 2 possibilités :</p>
                    <ol>
                        <li>Utiliser pgAdmin et créer vos propres tables dans <span class="em">votre système</span> en utilisant les fichiers SQL disponibles sur Moodle.</li>
                        <li>Utiliser un <span class="em">autre SGBD</span> avec les fichiers SQL à disposition. Attention, ces fichiers sont écrits pour PostgreSQL, il se peut qu'il faille opérer quelques modifications selon le SGBD que vous employez.</li>
                    </ol>
                    <h4 id="niveau_1">Niveau 1 : Base de données à une seule table :</h4>
                    <p>Imaginez une table SQL reprenant une liste de bandes dessinées ! <span class="em">Vous pouvez voir le contenu de cette table dans l'image suivante.</span> Le contenu de la yanle vous permettra de déterminer le type de chaque attribut.</p>
                    <p>Votre table doit au moins contenir les attributs suivants :</p>
                    <ul>
                        <li>ISBN</li>
                        <li>titre</li>
                        <li>série/héros principal</li>
                        <li>scénariste</li>
                        <li>dessinateur</li>
                        <li>coloriste</li>
                        <li>pays</li>
                        <li>prix</li>
                        <li>éditeur</li>
                        <li>année d'édition</li>
                    </ul>
                    <p>L'ISBN (International Standard Book Number) ou numéro international normalisé du livre est un numéro international qui permet d'identifier, de manière unique, chaque livre publié. Il est destiné à simplifier la gestion informatique du livre : bibliothèques, libraires, distributeurs, etc. (Extrait de Wikipédia)</p>
                    <p>Lorsque, dans une requête, on demande les albums sans précision des champs désirés; cela signifie qu'on désire obtenir toutes les colonnes de la table.</p>
                    <p>Un auteur est soit un scénariste, soit un dessinateur, soit un coloriste.</p>
                    <table class="tableBalises">
                        <caption>Le DSD est :</caption>
                        <thead>
                            <tr>
                                <th colspan="2">bd1.albums</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bold">
                                <td>PK</td>
                                <td class="souligne">isbn</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <p>titre NN</p>
                                    <p>serie</p>
                                    <p>scenariste</p>
                                    <p>dessinateur</p>
                                    <p>coloriste</p>
                                    <p>pays</p>
                                    <p>prix NN</p>
                                    <p>editeur NN</p>
                                    <p>annee_edition</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <ol type="a">
                        <li>
                            <p>Écrivez l'instruction <span class="html">CREATE TABLE</span> en vue de la créer sur machine.</p>
<pre><code>CREATE TABLE bd1.albums
(
    isbn char (13) PRIMARY KEY,
    titre character varying (50) NOT NULL,
    serie character varying (20),
    scenariste character varying (20),
    dessinateur character varying (20),
    coloriste character varying (20),
    editeur character varying (20) NOT NULL,
    pays character (1),
    annee_edition integer,
    prix double precision NOT NULL,
);</code></pre>
                        </li>
                        <li>
                            <p>Qu'est-ce que la PK ?</p>
<pre><code>La PK est la clé primaire. Elle est toujours <span class="em">NOT NULL</span> et unique.</code></pre>
                        </li>
                        <li>
                            <p>Remplissez votre table de deux ou tuples (reprenant des bandes dessinées réelles ou imaginaires). Donnez les instructions <span class="html">INSERT INTO</span>.</p>
                            <p class="souligne">Le contenu de la table bd1.albums :</p>
                            <img src="../images/bd1.albums.PNG" alt="">
<pre><code>INSERT INTO bd1.albums (isbn, titre, serie, scenariste, dessinateur, coloriste, éditeur, pays, annee_edition, prix)
VALUES ('2870970559', 'Joyeux Noël, May', NULL, 'Cosey', 'Cosey', 'Cosey', 'Dupuis', 'b', 1998, 7);

INSERT INTO bd1.albums (isbn, titre, serie, scenariste, dessinateur, coloriste, éditeur, pays, annee_edition, prix)
VALUES ('2205030434', 'La fiancée de Lucky Luke', 'Luky Luke', 'Guy Vidal', 'Morris', NULL, Dargaud, 'f', 1985, 5);</code></pre>
                        </li>
                    </ol>
                    <ol>
                        <li>
                            <p>Éccrivez une requête SQL qui permette d'afficher tout le contenu de votre table.</p>
<pre><code>SELECT *
FROM bd1.albums;</code></pre>
                        </li>
                        <li>
                            <p>Donnez, pour chaque album, son isbn, son titre, son scénariste, son dessinateur ainsi que son année d'édition.</p>
<pre><code>SELECT isbn, titre, scenariste, dessinateur, annee_edition
FROM bd1.albums;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums édités par "Dupuis" ?</p>
<pre><code>SELECT *
FROM bd1.albums
WHERE editeur = 'editeur';</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les titres des albums dont le scénariste est "Goscinny" ?</p>
<pre><code>SELECT DISTINCT titre
FROM bd1.albums
WHERE scenariste = 'Goscinny';</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les titres et les éditeurs des albums dont un des auteurs s'appelle "Uderzo" ?</p>
<pre><code>SELECT DISTINCT titre, editeur
FROM bd1.albums
WHERE scenariste = 'Uderzo' OR dessinateur = 'Uderzo' OR coloriste = 'Uderzo';</code></pre>
                        </li>
                        <li>
                          <p>Quels sont les albums pour lesquels le coloriste n'a pas été spécifié ?</p>
<pre><code>SELECT *
FROM bd1.albums
WHERE coloriste IS NULL;</code></pre>  
                        </li>
                        <li>
                            <p>Quels sont les éditeurs qui ont édité des albums en 1978 ?</p>
<pre><code>SELECT DISTINCT editeur
FROM bd1.albums
WHERE annee_edition = 1978;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les couples scénaristes-dessinateurs ayant travaillé pour l'éditeur "Dargaud" ? (Attention: si le nom du dessinateur est le mêm que celui du scénariste, c'est que la même personne a effectué les deux tâches, et on ne parlera donc pas de "couple".)</p>
<pre><code>SELECT DISTINCT scenariste, dessinateur
FROM bd1.albums
WHERE scenariste != dessinateur AND editeur = 'Dargaud';</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums dont le scénariste et le dessinateur sont la même personne, mais ont été mis en couleurs par quelqu'un d'autre ?</p>
<pre><code>SELECT *
FROM bd1.albums
WHERE scenariste = dessinateur AND scenariste != coloriste;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums dont le scénariste, le dessinateur et le coloriste sont la même personne ?</p>
<pre><code>SELECT *
FROM bd1.albums
WHERE scenariste = dessinateur AND scenariste = coloriste;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums qui n'ont qu'un seul auteur ? (Cela recouvre les cas de l'exercice précédent, mais il ne faut pas oublier les tuples pour lesquels un ou deux des trois attributs concernés ont la valeur <span class="em">NULL</span> !)</p>
<pre><code>SELECT *
FROM bd1.albums
WHERE (scenariste IS NOT NULL AND dessinateur IS NULL AND coloriste IS NULL) OR (scenariste IS NULL AND dessinateur IS NOT NULL AND coloriste IS NULL) OR (scenariste IS NULL AND dessinateur ISNULL AND coloriste IS NOT NULL) OR (scenariste = dessinateur AND scenariste = coloriste) OR (scenariste = desinateur AND coloriste IS NULL) OR (scenariste = coloriste AND dessinateur IS NULL) OR (dessinateur = coloriste AND scenariste IS NULL);</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les scénariste dont on a édité, après 1990, des oeuvres qui coûtent moins de 8€ ?</p>
<pre><code>SELECT DISTINCT scenariste
FROM bd1.albums
WHERE annee_edition &gt; 1990 AND prix &lt; 8;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les titres édités en dehors de la décennie 1990-1999, par un éditeur autre que "Casterman", et donc le coloriste est ou bien non spécifié ou bien le même que le dessinateur ?</p>
<pre><code>SELECT DISTINCT titre
FROM bd1.albums
WHERE (annee_edition &lt; 1990 OR annee_edition &gt; 1999) AND editeur != 'Casterman' AND (coloriste IS NULL OR coloriste = dessinateur);</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les titres qui n'ont été édités ni par "Casterman", ni par "Dupuis", et qui ont, comme scénariste, dessinateur et coloriste, trois auteurs distincts ?</p>
<pre><code>SELECT DISTINCT titre
FROM bd1.albums
WHERE editeur != 'Casterman' AND editeur != 'Dupuis' AND scenariste != dessinateur AND scenariste != coloriste AND dessinateur != coloriste;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont tous les albums qui rentrent dans une des catégories suivantes au moins :</p>
                            <ul>
                                <li>albums de la série "Astérix" édité chez "Dargaud".</li>
                                <li>albums de la série "Tintin" édités chez "Casterman" ou chez "Le Lombard".</li>
                                <li>albums sans aucun auteur spécifié.</li>
                            </ul>
<pre><code>SELECT *
FROM bd1.albums
WHERE (serie = 'Astérix' AND editeur = 'Dargaud') OR (serie = 'Tintin' AND (editeur = 'Casterman' OR editeur = 'Le Lombard')) OR (dessinateur IS NULL AND scenariste IS NULL AND coloriste IS NULL);</code></pre>
                        </li>
                        <li>
                            <p>Lister les titres des albums qui contiennent le mot "César".</p>
<pre><code>SELECT DISTINCT titre
FROM bd1.albums
WHERE titre LIKE '%César%';</code></pre>
                        </li>
                        <li>
                            <p>Lister les coloristes dont le nom commence par le mot "de" (peu importe la casse).</p>
<pre><code>SELECT DISTINCT coloriste
FROM bd1.albums
WHERE upper (coloriste) LIKE 'DE%';</code></pre>
                            <h5 id="exercies_clause_order_by">Exercices sur la clause ORDER BY :</h5>
                        </li>
                        <li>
                            <p>Donnez tous les titres de la série "Astérix" et leur année d'édition, en ordre chronologique (cd. année d'édition).</p>
<pre><code>SELECT DISTINCT titre, annee_edition
FROM bd1.albums
WHERE serie = 'Astérix'
ORDER BY annee_edition;</code></pre>
                        </li>
                        <li>
                            <p>Donnez tous les titres des albums de la série "Astérix, en ordre alphabétique des titres.</p>
<pre><code>SELECT DISTINCT titre
FROM bd1.albums
WHERE serie = 'Astérix'
ORDER BY titre;</code></pre>
                        </li>
                        <li>
                            <p>Donnez les albums (isbn, titre, nom d'éditeur et année d'édition) en classant ces données par éditeur, et pour chaque éditeur, par année d'édition.</p>
<pre><code>SELECT isbn, titre, editeur, annee_edition
FROM bd1.albums
ORDER BY editeur, annee_edition;</code></pre>
                        </li>
                        <li>
                            <p>Donnez les titres et les prix des albums édités par "Dupuis", par ordre décroissant de prix.</p>
<pre><code>SELECT DISTINCT titre, prix
FROM bd1.albums
WHERE editeur = 'Dupuis'
ORDER BY prix DESC;</code></pre>
                            <h5 id="exercices_fonctions_agregees">Exercices sur les fonctions agrégées :</h5>
                        </li>
                        <li>
                            <p>Quelle est la plus ancienne année d'édition de la table <span class="em">bd1.albums</span> ?</p>
<pre><code>SELECT MIN (annee_edition)
FROM bd1.albums;</code></pre>
                        </li>
                        <li>
                            <p>Quel est le prix de l'album le plus cher parmi ceux qui ont été dessinés par un autre dessinateur qu'"Uderzo" ?</p>
<pre><code>SELECT MAX (prix)
FROM bd1.albums
WHERE dessinateur != 'Uderzo';</code></pre>
                        </li>
                        <li>
                            <p>Combien y a-t-il d'albums édités chez "Casterman" ?</p>
<pre><code>SELECT COUNT (*)
FROM bd1.albums
WHERE editeur = 'Casterman';</code></pre>
                        </li>
                        <li>
                            <p>Combien d'années séparent l'album le plus ancien de l'album le plus récent ?</p>
<pre><code>SELECT MAX (annee_edition) - MIN (annee_edition)
FROM bd1.albums;</code></pre>
                        </li>
                        <li>
                            <p>Combien devrais-je payer si j'achète 3 exemplaires de chacun des albums édités par "Blake et Mortimer" et si le libraire m'accorde une réduction de 25% ?</p>
<pre><code>SELECT SUM (3 * prix) * 0.75
FROM bd1.albums
WHERE editeur = 'Blake et Mortimer';</code></pre>
                        </li>
                        <li>
                            <p>Les albums de la série "Tintin" ont-ils tous le même prix ? (le query pourrait par exemple renvoyer la valeur 1 si la réponse est oui)</p>
<pre><code>SELECT COUNT (DISTINCT prix)
FROM bd1.albums
WHERE serie = 'Tintin';</code></pre>
                        </li>
                        <li>
                            <p>Combien y a-t-il de séries différentes dans la table <span class="em">bd1.albums</span> ?</p>
<pre><code>SELECT COUNT (DISTINCT serie)
FROM bd1.albums;</code></pre>
                        </li>
                        <li>
                            <p>Combien y a-t-il d'albums pour lesquels la série n'est pas spécifiée ? Peut-on répondre à cette question par un query sans clause <span class="em">WHERE</span> ?</p>
<pre><code>SELECT COUNT (serie)
FROM bd1.albums;</code></pre>
                        </li>
                        <li>
                            <p>Combien y a-t-il d'albums dont un des aureurs au moins s'appelle "Uderzo", et quelles sont les dates d'édition du plus ancien et du plus récent d'entre eux ?</p>
<pre><code>SELECT COUNT (*), MIN (annee_edition), MAX (annee_edition)
FROM bd1.albums
WHERE dessinateur = 'Uderzo' OR scenariste = 'Uderzo' OR coloriste = 'Uderzo';</code></pre>
                        </li>
                        <li>
                            <p>Quel est le prix moten des albums édités par "Dupuis" entre 1990 et 1999 (y compris ces deux années extrêmes) ?</p>
<pre><code>SELECT AVG (prix)
FROM bd1.albums
WHERE editeur = 'Dupuis' AND annee_edition &gt;= 1990 AND annee_edition &lt;= 1999;</code></pre>
                        </li>
                        <li>
                            <p>Si je veux acheter un exemplaire de tous les albums dont le scénariste est"Goscinny" et/ou le dessinateur " est "Uderzo", combien dois-je débourser ?</p>
<pre><code>SELECT SUM (prix)
FROM bd1.albums
WHERE scenariste = 'Goscinny' OR dessinateur = 'Uderzo';</code></pre>
                        </li>
                        <li>
                            <p>Si veux acheter un exemplaire de tous les albums dont le scénariste n'est ni "Goscinny" ni "Uderzo", combien dois-je débourser ?</p>
<pre><code>SELECT SUM (prix)
FROM bd1.albums
WHERE scenariste != 'Goscinny' AND scenariste != 'Uderzo';</code></pre>
                        </li>
                    </ol>
                    <h4 id="niveau_2">Niveau 2 : Base de données à deux tables :</h4>
                    <p>Les queries suivantes seront effectuées à partir d'une base de deux tables : une table des <span class="em">bd2.editeurs</span> et une table des albums édités par chacun d'eux <span class="em">bd2.albums</span>.</p>
                    <p>La structure des données est présentée ci-dessous :</p>
                    <img src="../images/niveau2.PNG" alt="DSD du niveau 2">
                    <p>Dans la table <span class="em">bd2.editeurs</span>, chaque éditeur est identifié par un numéro (<span class="em">num</span>) et contient un nom (qui ne peut pas être <span class="em">NULL</span>), une adresse et un pays.</p>
                    <p>Dans table <span class="em">bd2.albums</span>, le nom de l'éditeur est remplacé par ce numéro. Ce numéro fait ainsi référence à l'éditeur de l'album. Il est le lien entre un album et son éditeur.</p>
                    <ol type="a">
                        <li>
                            <p>Écrivez les deux instructions <span class="html">CREATE TABLE</span>.</p>
<pre><code>CREATE TABLE bd2.editeurs
(
    num INTEGER PRIMARY KEY,
    nom CHARACTER VARYING (20) NOT NULL,
    adresse CHARACTER VARYING (30),
    pays CHARACTER VARYING (1),
);

CREATE TABLE bd2.albums
(
    isbn CHAR (13) PRIMARY KEY,
    titre VARCHAR (50) NOT NULL,
    serie CHARACTER VARYING (20),
    scenariste CHARACTER VARYING (20),
    dessinateur CHARACTER VARYING (20),
    coloriste CHARACTER VARYING (20),
    prix DOUBLE PRECISION NOT NULL,
    nom_editeur INTEGER NOT NULL REFERENCES bd2.editeurs (num),
    annee_edition INTEGER,
);</code></pre>
                        </li>
                        <li>
                            <p>Qu'est-ce que la FK ?</p>
<pre><code>La FK (FOREIGN KEY) est la clé étrangère permet de faire le lien entre deux tables. En logique, elle référencie la PRIMARY KEY de l'autre table.</code></pre>
                        </li>
                        <li>
                            <p>Remplissez vos tables de deux ou trois tuples (reprenant des bandes dessinées réelles ou imaginaires).</p>
                            <p>Donnez les instructions <span class="em">INSERT INTO</span>.</p>
<pre><code>INSERT INTO bd2.editeurs (num, nom, adresse, pays)
VALUES (1, 'Albert René', NLL, 'f');

INSERT INTO bd2.editeurs (num, nom, adresse, pays)
VALUES (2, 'Dargaud', NULL, 'f');

INSERT INTO bd2.albums (isbn, titre, serie, scenariste, dessinateur, coloriste, num_editeur, annee_edition, prix)
VALUES ('2-8709-055-9', 'Joyeux Noël, May', NULL, 'Cosey', 'Cosey', 'Cosey', 4, 1998, 7);

INSERT INTO bd2.albums (isbn, titre, serie, scenariste, dessinateur, coloriste, num_editeur, annee_edition, prix)
VALUES ('2-205-83043-4', 'La fiancée de Lucky Luke', 'Lucky Luke', 'Guy Vidal', 'Morris', NULL, 2, 1985, 5);</code></pre>
                        </li>
                    </ol>
                    <ol>
                       <li>
                        <p>Donnez la liste des albums avec, pour chacun d'eux, l'isbn, le titre, le scénariste, le dessinateur et le numéro de l'éditeur.</p>
<pre><code>SELECT BA.isbn, BA.titre, BA.scenariste, BA.dessinateur, BA.num_editeur
FROM bd2.albums BA;</code></pre>
                       </li>
                       <li>
                            <p>Donnez la liste des albums, avec, pour chacun d'eux, l'isbn, le titre, le scénariste, le dessinateur et le nom de l'éditeur.</p>
<pre><code>SELECT BA.isbn, BA.titre, BE.nom
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num;</code></pre>
                        </li>
                        <li>
                            <p>Donnez la liste des albums dont l'éditeur est belge (isbn, titre et nom de l'éditeur).</p>
<pre><code>SELECT BA.isbn, BA.titre, BE.nom
FROM bd2.albums BA, bd2.editeurs
WHERE BA.num_editeur = BE.num AND BE.pays = 'b';</code></pre>
                        </li>
                        <li>
                            <p>Donnez la liste des albums dont l'éditeur est belge sans la condition de jointure. (isbn, titre et nom de l'éditeur) Que constatez-vous ?</p>
<pre><code>SELECT BA.isbn, BA.titre, BE.nom
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BE.pays = 'b';

On remarque que toute la table est affichée comme aucune jointure, on a un produit cartésien avec les éditeurs belges : 44 albums * 5 éditeurs belges = 220 résultats.</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums de la série "Astérix" qui n'ont pas été édités chez "Dargaud" ?</p>
<pre><code>SELECT BA.*
FROM bd2_albums BA, bd2_editeurs BE
WHERE BA.num_editeur = BE.num AND BA.serie = 'Astérix' AND BE.nom != 'Dargaud';</code></pre>
                        </li>
                        <li>
                            <p>Quels sont tous les éditeurs (num et nom) qui ont été édité en 1999 des livres coûtant au moins 10€ ?</p>
<pre><code>SELECT BE.num, BE.nom
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BA.annee_edition = 1999 AND BA.prix &gt;= 10;</code></pre>
                        </li>
                        <li>
                            <p>Chez quel(s) éditeur(s) (num et nom) "Goscinny" a-t-il des albums (en tant que scénariste, dessinateur ou coloriste) ?</p>
<pre><code>SELECT DISTINCT BE.num, BE.nom
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND (BA.scenariste = 'Goscinny' OR BA.dessinateur = 'Goscinny' OR BA.coloriste = 'Goscinny');</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les éditeurs (num et nom) localisés ailleurs qu'en Belgique ?</p>
<pre><code>SELECT BE.num, BE.nom
FROM bd2.editeurs BE
WHERE BE.pays != 'b';</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums qui ont été édités en Belgique ou en France, et qui ne sont ni des albums de la série "Tintin", ni des albums de la série "Astérix" ?</p>
<pre><code>SELECT DISTINCT BA.*
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND (BE.pays = 'b' OR BE.pays = 'f') AND BA.serie != 'Tintin' AND BA.serie != 'Astérix';</code></pre>
                        </li>
                        <li>
                            <p>Donnez la liste des dessinateurs qui ont édités par "Dupuis". (Donnez-les en ordre alphabétique).</p>
<pre><code>SELECT DISTINCT BA.dessinateur
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BE.nom = 'Dupuis'
ORDER BY BA.dessinateur;</code></pre>
                        </li>
                        <li>
                            <p>Donnez la liste des albums édités par "Dupuis" entre 1990 et 2000 (bornes inclues), en affichant pour chacun son isbn, son titre, son dessinateur et son année d'édition. Triez le tout par dessinateur. Pour chaque dessinateur, les albums doivent être rangés en ordre chronologique.</p>
<pre><code>SELECT BA.isbn, BA.dessinateur, BA.annee_edition
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BE.nom = 'Dupuis' AND BA.annee_edition &gt;= 1990 AND BA.annee_edition &lt;= 2000
ORDER BY BA.dessinateur, BA.annee_edition;</code></pre>
                        </li>
                        <li>
                            <p>Chez quels éditeurs y a-t-il des albums pour lequel aucun auteur n'est fourni ?</p>
<pre><code>SELECT DISTINCT BE.nom
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BA.dessinateur IS NULL AND BA.scenariste IS NULL AND BA.coloriste IS NULL;</code></pre>
                        </li>
                        <li>
                            <p>Y a-t-il des albums pour lesquels le nom de l'éditeur est le même que celui de la série ? Listez les isbn des albums.</p>
<pre><code>SELECT BA.isbn
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BE.nom = BA.serie;</code></pre>
                        </li>
                        <li>
                           <p>Y a-t-il un éditeur qui porte le même nom q'un auteur ?</p>
<pre><code>SELECT BE.nom
FROM bd2.albums, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND (BE.nom = BA.scenariste OR BE.nom = BA.dessinateur OR BE.nom = BA.coloriste);</code></pre> 
                        </li>
                        <li>
                            <p>Combien y a-t-il d'albums édités en Belgique dont le dessinateur et le scénariste sont des personnes différentes ?</p>
<pre><code>SELECT COUNT(BA.*) AS "nombre d'albums"
FROM bd2.editeurs BE, bd2.albums BA
WHERE BE.num = BA.num_editeur AND BA.dessinateur != BA.scenariste AND BE.pays = 'b';</code></pre>
                        </li>
                        <li>
                            <p>Quelle est l'année d'édition la plus ancienne pour les albums édités chez "Casterman" ?</p>
<pre><code>SELECT MIN (BA.annee_edition AS "l'année la plus ancienne"
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BE.nom = 'Casterman';</code></pre>
                        </li>
                        <li>
                            <p>Quelle est l'ancienneté moyenne des albums édités par des éditeurs belges ?</p>
<pre><code>SELECT AVG (BA.annee_edition) AS "ancienneté moyenne"
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BE.pays = 'b';</code></pre>
                        </li>
                        <li>
                            <p>Si je n'ai que 5€ en poche, quelle est l'année d'édition de l'album le plus ancien que je puisse acheter ?</p>
<pre><code>SELECT MIN (BA.annee_edition)
FROM bd2.albums BA
WHERE BA.prix &lt;= 5;</code></pre>
                        </li>
                        <li>
                            <p>Combien d'albums n'ont ni scénariste, ni dessinateur, ni coloriste mentionné ?</p>
<pre><code>SELECT COUNT (BA.*) AS "nombre  d'albums"
FROM bd2.albums BA
WHERE BA.scenariste IS NULL AND BA.dessinateur IS NULL AND BA.coloriste IS NULL;</code></pre>
                        </li>
                        <li>
                            <p>Quel est le prix moyen des albums édités en Belgique ?</p>
<pre><code>SELECT AVG (BA.prix)
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BE.pays = 'b';</code></pre>
                        </li>
                        <li>
                            <p>Combien dois-je débourser pour acheter tous les albums fançais qui coûtent moins de 8€ ? Et combien d'albums achètererai-je ainsi ? Quel sera leur prix moyen ?</p>
<pre><code>SELECT SUM (BA.prix) AS "le montant des albums", COUNT (BA.*) AS "le nombre d'albums", AVG (prix) AS "le prix moyen"
FROM bd2.albums BA, bd2.editeurs BE
WHERE BA.num_editeur = BE.num AND BE.pays = 'f' AND BA.prix &lt; 8;</code></pre>
                        </li>
                        <li>
                            <p>Combien d'année "Franquin" a-t-il écrit ?</p>
<pre><code>SELECT MAX (BA.annee_edition) - MIN (BA.annee_edition) AS "les années de Franquin"
FROM bd2.albums BA
WHERE BA.scenariste = 'Franquin';</code></pre>
                        </li>
                        <li>
                            <p>Oscar a reçu pour son anniversaire l'album "Idées Noires" édité par le "Fluide glacial". Malheureusement, il possède déjà cet album; heureusement, il peut l'échanger contre un autre album du même prix. Contre quels albums peut-il échanger ?</p>
<pre><code>SELECT DISTINCT BA1.*
FROM bd2.albums BA1, bd2.albums BA2, bd2.editeurs BE
WHERE BA2.num_editeur = BE.num AND BA2.titre = 'Idées Noires' AND BE.nom = 'Froid glacial' AND BA1.prix = BA2.prix AND BA1.isbn != BA2.isbn;</code></pre>
                        </li>
                    </ol>
                    <h4 id="niveau_3">Niveau 3 : Base de données à plus de deux tables :</h4>
                    <img src="../images/niveau3.PNG" alt="DSD du niveau 3">
                    <p>Ce schéma est une nouvelle variante de votre base de données permettant une souplesse supplémentaireà propos des auteurs. Jusqu'ici, un album avait <span class="em">exactement trois</span> auteurs (ou moins de trois, si 2 d'entre eux, ou même les trois étaient identiques, ou encore si un ou plusieurs des champs scénariste, dessinateur ou coloriste avaient la valeur <span class="em">NULL</span>).</p>
                    <p>Ceci ne permet pas d'être fidèle à la réalite, car dans certains cas il peut y avoir plusieurs co-dessinateurs, co-scénaristes, ou co-coloristes.</p>
                    <p>De plus, on pourrait vouloir ajouter plus d'informations sur les auteurs : leur adresse courrier et mail, leur n° de téléphone, etc.</p>
                    <p>On vous suggère donc de fournir d'une part la table des albums, d'autre part celle des auteurs, et enfin une troisième table qui réalise la relation M à N entre albums et auteurs. De cette façon, non seulement chaque auteur pourra participer à autant d'albums que l'on veut, mais également chaque album pourra avoir autant d'auteurs que l'on veut.</p>
                    <p>Cette troisième table devra contenir <span class="em">les deux clés étrangères</span> (numéro du livre et numéro de l'auteur), plus un <span class="em">troisième attribut spécifiant le type de rôle joué par cet auteur dans le cadre de ce livre</span> (scénariste, dessinateur, coloriste). Ce 3ème attribut aura la valeur 's', 'c' ou 'd'.</p>
                    <p>Remarquons que de nouveaux attributs pourraient être ajoutés à la table auteurs. Le fait d'avoir créé cette table auteurs nous permet d'ajouter toute une série d'informations concernant chacun des auteurs en ne les précisant qu'une seule fois. Nous apprendrons plus tard que cette structure nous permet ainsi d'éviter la <span class="em">redondance des données</span>.</p>
                    <ol type="a">
                        <li>
                            <p>Écrivez les deux instructions <span class="html">CREATE TABLE</span> des tables <span class="em">auteurs</span> et <span class="em">participations</span>.</p>
<pre><code>CREATE TABLE bd3.editeurs
(
    num INTEGER PRIMARY KEY,
    nom VARCHAR (20) NOT NULL,
    adresse VARCHAR (30),
    pays CHAR (1),
);

CREATE TABLE bd3.albums
(
    isbn CHAR (13) PRIMARY KEY,
    titre VARCHAR (50) NOT NULL,
    serie VARCHAR (20),
    num_editeur INTEGER NOT NULL REFERENCES bd3.editeurs (num),
    annee_edition INTEGER,
    prix DOUBLE PRECISION NOT NULL,
);

CREATE TABLE bd3.auteurs
(
    num INTEGER PRIMARY KEY,
    nom VARCHAR (20) NOT NULL,
    adresse VARCHAR (30),
    e_mail VARCHAR (30),
);

CREATE TABLE bd3.participations
(
    isbn CHAR (13) NOT NULL REFERENCES bd3.albums (isbn),
    num_auteur INTEGER NOT NULL REFERENCES bd3.auteurs (num),
    participe CHAR (1) NOT NULL CHECK (participeIN ('s', 'd', 'c')),
    PRIMARY KEY (isbn, num_auteur, participe),
);</code></pre>
                        </li>
                        <li>
                            <p>Remplissez vos tables <span class="em">auteurs</span> et <span class="em">participations</span>.</p>
<pre><code>INSERT INTO bd3.participations (isbn, num_auteur, participe) VALUES ('2-87097055-9', 14, 's');
INSERT INTO bd3.participations (isbn, num_auteur, participe) VALUES ('2-87097055-9', 14, 'd');
INSERT INTO bd3.participations (isbn, num_auteur, participe) VALUES ('2-87097055-9', 14, 'c');

INSERT INTO bd3.auteurs (num, nom, e_mail) VALUES (3, 'Hergé', 'tintin@hotmail.be');
INSERT INTO bd3.auteurs (num, nom, e_mail, adresse) VALUES (11, 'Van Hamme', 'van_hamme@hotmail.com', 'Bruxelles');</code></pre>
                        </li>
                    </ol>
                    <ol>
                        <li>
                            <p>Quel est le dessinateur de l'album dont le titre est "Astérix chez les Belges" ?</p>
<pre><code>SELECT DISTINCT AU.*
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur AND AL.titre = 'Astérix chez les Belges' AND PA.participe = 'd';</code></pre>
                        </li>
                        <li>
                            <p>Pour quel(s) éditeur(s) a travaillé "Goscinny" ?</p>
<pre><code>SELECT DISTINCT ED.*
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL, bd3.editeurs ED
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur AND ED.num = AL.num_editeur AND AU.nom = 'Goscinny';</code></pre>
                        </li>
                        <li>
                            <p>Quels sont tous les auteurs qui ont travaillé comme dessinateurs et/ou coloristes chez l'éditeur "Dupuis" ?</p>
<pre><code>SELECT DISTINT AU.*
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL, bd3.editeurs ED
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur AND ED.num = AL.num_editeur AND ED.nom = 'Dupuis' AND (PA.participe = 'd' OR PA.participe = 'c');</code></pre>
                        </li>
                        <li>
                            <p>Combien d'auteurs (différentsà a-t-on répertoriés pour l'album "Coke en Stock" ? (Essayez aussi avec d'autres titre, en fonction du contenu de vos tables)</p>
<pre><code>SELECT COUNT (DISTINCT PA.num_auteur)
FROM bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn AND AL.titre = 'Coke en Stock';</code></pre>
                        </li>
                        <li>
                            <p>Donnez les titres et les prix de tous les albums dessinés par "Uderzo" entre 1985 et 1995.</p>
<pre><code>SELECT DISTINCT AL.titre, AL.prix
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur AND AU.nom = 'Uderzo' AND PA.participe = 'd' AND AL.annee_edition &gt;= 1985 AND AL.annee_edition &lt;= 1995;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums édités par "Casterman" pour lesquels on connaît le coloriste ?</p>
<pre><code>SELECT DISTINCT AL.titre
FROM bd3.participations PA, bd3.albums AL, bd3.editeurs ED
WHERE AL.isbn = PA.isbn AND ED.num = AL.num_editeur AND ED.nom = 'Casterman' AND PA.participe = 'c';</code></pre>
                        </li>
                        <li>
                            <p>Quelle est l'année d'édition de l'album le plus récent ayant "Goscinny" parmi ses auteurs ?</p>
<pre><code>SELECT MAX (AL.annee_edition)
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur AND AU.nom = 'Goscinny';</code></pre>
                        </li>
                        <li>
                            <p>Donnez la liste de tous les dessinateurs répertoriés, par ordre alphabétique.</p>
<pre><code>SELECT DISTINCT AU.nom
FROM bd3.auteurs AU, bd3.participations PA
WHERE AU.num = PA.num_auteue AND PA.participe = 'd'
ORDER BY AU.nom;</code></pre>
                        </li>
                        <li>
                            <p>Donnez la liste de tous les dessinateurs répertoriés, par ordre alphabétique, mais en donnant en outre, pour chaque dessinateur, le nom de l'éditeur (ou : les noms des éditeurs) pour qui il a travaillé. Donnez la liste par ordre alphabétique de dessinateur, et, pour chacun d'eux, par ordre alphabétique d'éditeur.</p>
<pre><code>SELECT DISTINCT AU.*, ED.nom
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL, bd3.editeurs ED
WHERE AU.num = PA.num_auteur AND AL.isbn = PA.isbn AND ED.num = AL.num_editeur AND PA.participe = 'd'
ORDER BY AU.nom, ED.nom;</code></pre>
                        </li>
                        <li>
                            <p>Donnez les noms de tous auteurs qui ont collaboré, d'une façon ou d'une autre, à des albums de la série "Astérix avant 1992.</p>
<pre><code>SELECT DISTINCT AU.nom
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AU.num = PA.num_auteur AND AL.isbn = PA.isbn AND AL.serie = 'Astérix' AND AL.annee_edition &lt; 1992;</code></pre>
                        </li>
                        <li>
                            <p>Quels rôles l'auteur "Cosey" a-t-il tenu dans "Zeke raconte des histoires" ?</p>
<pre><code>SELECT DISTINCT PA.particpe
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AU.num = PA.num_auteur AND AL.isbn = PA.isbn AND AU.nom = 'Cosey' AND lower (AL.titre) = 'zeke raconte des histoires';</code></pre>
                        </li>
                        <li>
                            <p>Quels rôles l'auteur "Uderzo" a-t-il tenus dans les albums édités par "Albert René" ?</p>
<pre><code>SELECT DISTINCT PA.participe
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL, bd3.editeurs ED
WHERE AU.num = PA.num_auteur AND AL.isbn = PA.isbn AND ED.num = AL.num_editeur AND lower (AU.nom) = 'uderzo' AND lower (ED.nom) = 'albert rené';</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les auteurs qui ont joué plusieurs rôles (dessinateur, coloriste, ...) dans un même album ?</p>
<pre><code>SELECT DISTINCT PA.num_auteur
FROM bd3.participation PA1, bd3.participations PA2
WHERE PA1.isbn = PA2.isbn AND PA1.num_auteur = PA2.num_auteur AND PA1.participe != PA2.participe;

ou

SELECT DISTINCT PA.isbn, AU.*
FROM bd3.auteurs AU, bd3.participations PA
WHERE AU.num = PA.num_auteur
GROUP BY PA.isbn, AU.num, AU.nom, AU.adresse, AU.e_mail
HAVING COUNT (PA.participe) &gt; 1;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums qui ont été publiés en même temps que l'album dont le titre est "La marque jaune" ?</p>
<pre><code>SELECT DISTINCT AL2.*
FROM bd3.albums AL1, bd3.albums AL2
WHERE AL1.isbn != AL2.isbn AND lower (AL1.titre) = 'la marque jaune' AND AL1.annee_edition = AL2.annee_edition;</code></pre>
                            <h5 id="exercices_clause_group_by">Exercices sur la clause GROUP BY :</h5>
                        </li>
                        <li>
                            <p>Donnez les séries édités chez "Dupuis", et pour chacune d'elles, le nombre d'albums.</p>
<pre><code>SELECT AL.serie, COUNT (AL.isbn)
FROM bd3.albums AL, bd3.editeurs ED
WHERE AL.num_editeur = ED.num AND ED.nom = 'Dupuis' AND AL.serie IS NOT NULL
GROUP BY AL.serie;</code></pre>
                        </li>
                        <li>
                            <p>Quelles sont les dates du plus ancien et du plus récent album de chaque éditeur ?</p>
<pre><code>SELECT ED.num, ED.nom, MIN (AL.annee_edition), MAX (AL.annee_edition)
FROM bd3.albums AL, bd3.editeurs ED
WHERE ED.num = AL.num_editeur
GROUP BY ED.num, ED.nom;</code></pre>
                        </li>
                        <li>
                            <p>Combien y a-t-il d'albums dessinés pour chaque dessinateur ?</p>
<pre><code>SELECT AU.num, AU.nom, COUNT (PA.isbn)
FROM bd3.auteurs AU, bd3.participations PA
WHERE AU.num = PA.num_auteur AND PA.participe = 'd'
GROUP BY AU.num, AU.nom;</code></pre>
                        </li>
                        <li>
                            <p>DOnnez le nombre et le prix moyen des albums par année d'édition. Indiquez bien sûr l'année. Classez-le par ordre chronologique.</p>
<pre><code>SELECT AL.annee_edition, COUNT (AL.isbn), AVG (AL.prix)
FROM bd3.albums AL
ORDER BY AL.annee_edition
GROUP BY AL.annee_edition;</code></pre>
                        </li>
                        <li>
                            <p>Pour chaque éditeur quia édité au moins un album de moins de 10€, affichez son num, son nom, sa nationalité, et le nombre de livres de moins de 10€ qu'il a publiés.</p>
<pre><code>SELECT ED.num, ED.nom, ED.pays, COUNT (AL.isbn)
FROM bd3.albums AL, bd3.editeurs ED
WHERE ED.num = AL.num_editeur AND AL.prix &lt; 10
GROUP BY ED.num, ED.nom, ED.pays;</code></pre>
                        </li>
                        <li>
                            <p>Pour quels éditeurs "Uderzo" a-t-il été dessinateur ? Pour chacun de ces éditeurs, donnez le nombre d'albums dessinés, et le prix du plus cher d'entre eux.</p>
<pre><code>SELECT ED.num, ED.nom, COUNT (AL.isbn), MAX (AL.prix)
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL, bd3.editeurs ED
WHERE AU.num = PA.num_auteur AND AL.isbn = PA.isbn AND ED.num = AL.num_editeur AND PA.participe = 'd' AND AU.nom = 'Uderzo'
GROUP BY ED.num, ED.nom;

ou

SELECT ED.num, ED.nom, COUNT (AL.isbn), MAX (AL.prix)
FROM bd2.albums AL, bd3.editeurs ED
WHERE ED.num = AL.num_editeur AND ED.num IN (SELECT AL2.num_editeur
FROM bd3.auteurs AU2, bd3.participations PA2, bd3.albums AL2
WHERE AU2.num = PA2.num_auteur AND AL2.isbn = PA2.isbn AND PA2.participe = 'd' AND AU.nom = 'Uderzo')
GROUP BY ED.num, ED.nom;</code></pre>
                        </li>
                    </ol>
                    <h4 id="niveau_4">Niveau 4 : Les requêtes sur 1, 2, 3 ou 4 tables mélangées !</h4>
                    <p>Pour ces exercices, on se base sur la même base de données que celle du niveau 3; c'est-à-dire la bd3. Mais les questions sont complètement mixées; elles reposent parfois sur une seule table parfois sur les quatre.</p>
                    <img src="../images/niveau3.PNG" alt="DSD du niveau 3">
                    <p>La grande difficulté de ces exercices est de travailler (référencer dans le FROM) uniquement les tables nécessaires à la résolution de chaque query.</p>
                    <p>Parmi les exercices suivants, certains font appel à des notions qui n'ont pas été abordées au cours. Reprérez-les et éventuellement essayez de formuler la query en recherchant la solutions par vous-mêmes.</p>
                    <p>Vous remarquerez également que certaines queries sont bien plus faciles à résoudre dans les schémas des niveaux 1 (bd1) ou 2 (bd2). Mais, il faut les résoudre dans le schéma du niveau 3, c'est-à-dire <span class="em">bd3.albums</span>, <span class="em">bd3.editeurs</span>, etc. !</p>
                    <ol>
                        <li>
                            <p>Combien y a-t-il d'albums pour chaque série ?</p>
<pre><code>SELECT AL.serie, COUNT (AL.isbn)
FROM bd3.albums AL
WHERE AL.serie IS NOT NULL
GROUP BY AL.serie;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les éditeurs qui ont édité des albums en 1978 ?</p>
<pre><code>SELECT ED.nom
FROM bd3.albums AL, bd3.editeurs ED
WHERE ED.num = AL.num_editeur AND AL.annee_edition = 1978;</code></pre>
                        </li>
                        <li>
                            <p>Combien y a-t-il d'albums par éditeur ?</p>
<pre><code>SELECT ED.nom, COUNT (AL.isbn)
FROM bd3.albums AL, bd3.editeurs ED
WHERE ED.num = AL.num_editeur
GROUP BY ED.nom;</code></pre>
                        </li>
                        <li>
                            <p>Combien y a-t-il d'albums par scénariste ?</p>
<pre><code>SELECT AU.nom, COUNT (AL.isbn)
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur AND PA.participe = 's';</code></pre>
                        </li>
                        <li>
                            <p>Combien y a-t-il d'albums  par auteur ?</p>
<pre><code>SELECT AU.nom, COUNT (DISTINCT AL.isbn)
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur
GROUP BY AU.nom;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums pour lesquels le coriste n'a pas été spécifié ?</p>
<pre><code>SELECT AL.*
FROM bd3.albums AL
WHERE AL.isbn NOT IN (SELECT PA.isbn
FROM bd3.participations
WHERE PA.participe = 'c');</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les scénaristes dont on a édités, après 1990, des albums qui coûtent moins de 8€ ?</p>
<pre><code>SELECT AU.nom
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AU.num = PA.num_auteur AND AL.isbn = PA.isbn AND AL.annee_edition &gt; 1990 AND AL.prix &lt; 8 AND PA.participe = 's';</code></pre>
                        </li>
                        <li>
                            <p>Donnez le nom de la série et le nombre d'albums de chaque série dessinées par "Franquin" ? Cette question peut être formulée autrement : pour tous les albums dont le dessinateur est "Franquin", combien y a-t-il d'albums de chaque série ?</p>
<pre><code>SELECT AL.serie, COUNT (AL.titre)
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur AND AU.nom = 'Franquin' AND PA.participe = 'd' AND AL.serie IS NOT NULL
GROUP BY AL.serie;</code></pre>
                        </li>
                        <li>
                            <p>Donnez le prix moyen des albums par année d'édition, avec bien entendu l'année d'édition.</p>
<pre><code>SELECT AL.annee_edition, AVG (AL.prix)
FROM bd3.albums AL
GROUP BY AL.annee_edition;</code></pre>
                        </li>
                        <li>
                            <p>Par série, combien y a-t-il de scénaristes pour les albums édités en Belgique ?</p>
<pre><code>SELECT AL.serie, COUNT (DISTINCT PA.num_auteur)
FROM bd3.participations PA, bd3.albums AL, bd3.editeurs ED
WHERE PA.isbn = AL.isbn AND ED.num = AL.num_editeur AND PA.particippe = 's' AND ED.pays 'b' AND AL.serie IS NOT NULL
GROUP BY AL.serie;</code></pre>
                        </li>
                        <li>
                            <p>Quelle est l'année d'édition la plus ancienne pour les albums édités chez "Casterman" ?</p>
<pre><code>SELECT MIN (AL.annee_edition)
FROM bd3.albums AL, bd3.editeurs ED
WHERE ED.num = AL.num_editeur AND ED.nom = 'Casterman';</code></pre>
                        </li>
                        <li>
                            <p>Quel est le prix moyen des albums édités en Belgique ?</p>
<pre><code>SELECT AVG (AL.prix)
FROM bd3.albums AL, bd3.editeurs ED
WHERE ED.num = AL.num_editeur AND ED.pays = 'b';</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les albums qui n'ont qu'un seul auteur ?</p>
<pre><code>SELECT AL.*
FROM bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn
GROUP BY AL.*
HAVING COUNT (DISTINCT PA.num_auteur) = 1;</code></pre>
                        </li>
                        <li>
                            <p>Chez quels éditeurs y a-t-il des albums pour lesquels aucun auteur n'est spécifié ?</p>
<pre><code>SELECT ED.nom
FROM bd3.albums AL, bd3.editeurs ED
WHERE ED.num = AL.num_auteur AND AL.isbn NOT IN (SELECT PA.isbn
FROM bd3.participations PA);</code></pre>
                        </li>
                        <li>
                            <p>Quelle est la première année où l'on a édité un album ayant été écrit par un auteur complet, c'est-à-dire où le scénariste, le dessinateur et le coloriste sont la même personne; aucun n'est inconnu, c'est-à-dire absent de la base de données ? Essayez également avec la table <span class="em">bd1.albums</span>.</p>
<pre><code>SELECT MIN (AL.annee_editiion)
FROM bd3.albums AL
WHERE 3 IN (SELECT COUNT (PA.participe)
FROM bd3.participations PA
WHERE PA.isbn = AL.isbn);</code></pre>
                        </li>
                        <li>
                            <p>Quel est le titre du moins cher des albums édités en 1977 ?</p>
<pre><code>SELECT AL.titre
FROM bd3.albums AL
WHERE AL.annee_edition = 1977 AND AL.prix = (SELECT MIN (AL2.prix)
FROM bd3.albums AL2
WHERE AL2.annee_edition = 1977);</code></pre>
                        </li>
                        <li>
                            <p>Y a-t-il des albums différents portant le même titre ? Si oui, quels sont ces titres, et les années d'édition.</p>
<pre><code>SELECT AL1.titre, AL.annee_edition
FROM bd3.albums AL1, bd3.albums AL2
WHERE AL1.isbn != AL2.isbn AND AL1.titre = AL.titre;</code></pre>
                        </li>
                        <li>
                            <p>Quels sont les dessinateurs qui ont travaillé sur des albuls de plusieurs séries ? Essayez également avec la table <span class="em">bd1.albums</span>.</p>
<pre><code>SELECT AU.nom, COUNT (DISTINCT AL.serie)
FROM bd3.auteurs AU, bd3.participations PA, bd3.albums AL
WHERE AL.isbn = PA.isbn AND AU.num = PA.num_auteur AND PA.participe = 'd'
GROUP BY AU.nom
HAVING COUNT (DISTINCT AL.serie) &gt; 1;</code></pre>
                        </li>
                        <li>
                            <p>Donnez, pour chaque album ayant au moins un auteur répertorié, son isbn, son titre et le nombre d'auteurs différents intervenant dans cet album.</p>
<pre><code>SELECT AL.isbn, AL.titre, COUNT (DISTINCT PA.num_auteur)
FROM bd3.albums AL, bd3.participatons PA
WHERE AL.isbn = PA.isbn
GROUP BY AL.isbn, AL.titre;</code></pre>
                        </li>
                    </ol>
                </article>
            <!-- fin de section -->
            </section>
        </main>
        <footer role="contentinfo">
            <div>
                <address>
                    Professeurs :
                    <a class="mail" href="mailto:olivier.choquet@vinci.be">Choquet Olivier</a>
                    <a class="mail" href="mailto:driss.vandenheede.techinfo@gmail.com">Vandenheede Driss</a>
                </address>
            </div>
            <div>
                <p>Si vous détectez une erreur, une faute d'orthographe, n'hésitez pas à envoyer un mail aux adresses juste à côté avec le nom de la page et l'erreur détectée.</p>
            </div>
            <div id="version">
                <p>Syllabus HTML</p>
                <p>Version 5.0</p>
            </div>
        </footer>
        <script src="../pre.js"></script>
    </body>
</html>