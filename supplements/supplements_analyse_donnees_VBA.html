<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Choquet Olivier & Vandenheede Driss">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Analyse des données avec VBA - Suppléments - e-Syllabus HTML5 et CSS3</title>
        <!-- une icône dans la barre du navigateur -->
        <link rel="icon" href="../images/favicon.png" type="image/png">
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <!-- liens d'évitement -->
        <ul class="a11y-nav">
            <li>
                <a href="#container">Passer directement au contenu</a>
            </li>
            <li>
                <a href="#menu">Accéder au menu secondaire de la page</a>
            </li>
            <li>
                <a href="#aside">Accéder aux liens utiles</a>
            </li>
        </ul>
        <!-- bannière et menu -->
        <header role="banner">
            <div class="logoTitle">
                <h1>Cours d'introduction au Web</h1>
                <h2>HTML5 et CSS3</h2>
            </div>
            <nav role="navigation" aria-label="Menu principal de navigation">
                <ul>
                    <li><a href="../index.html">Le cours</a></li>
                    <li><a href="../internet.html">Internet</a></li>
                    <li><a href="../html5.html">HTML5</a></li>
                    <li><a href="../css3.html">CSS3</a></li>
                    <li><a href="../methodologie.html">Méthodologie</a></li>
                    <li><a href="../lexique.html">Lexique</a></li>
                    <li><a href="../supplements.html" class="current">Suppléments</a></li>
                </ul>
            </nav>
        </header>
        <main id="container" role="main" tabindex="-1">
            <div id="menu">
                <nav role="navigation">
                    <ol>
                        <li><a href="../supplements.html">Retour au sommaire</a></li>
                        <li><a href="#introduction">Introduction</a></li>
                        <li><a href="#manipulation_fichiers_VBA">Manipulation des fichiers avec VBA</a></li>
                        <li><a href="#programmation_execution_automatique_traitements_donnees_VBA">Programmation de l'exécution automatique des traitements de données avec VBA</a></li>
                        <li><a href="#gestion_securite_application_VBA">Gestion de la sécurité de l'application VBA</a></li>
                        <li><a href="#analyse_donnees_VBA">Analyse des données avec VBA</a></li>
                        <li><a href="#analyse_series_temporelles">Analyse de séries temporelles</a></li>
                        <li><a href="#analyse_bivariee">L'analyse bivariée</a></li>
                        <li><a href="#realisation_modelisation">Réalisation d'une modélisation</a></li>
                    </ol>
                </nav>
                <!-- aside lié à la page et pas à l'article donc pas à l'intérieur de article -->
                <aside id="aside">
                    <p>Liens utiles :</p>
                    <ul>
                        <li><a href="http://www.w3schools.com/js/default.asp" target="_blank">Tutoriel JavaScript de W3Schools</a></li>
                        <li><a href="http://www.w3.org/" target="_blank">W3C</a></li>
                        <li><a href="http://fr.openclassrooms.com/informatique/cours/apprenez-a-creer-votre-site-web-avec-html5-et-css3" target="_blank">Open Classroom</a></li>
                        <li><a href="http://www.w3.org/TR/html5/" target="_blank">Norme HTML5</a></li>
                        <li><a href="http://www.w3schools.com/" target="_blank">W3Schools</a></li>
                        <li><a href="http://www.alsacreations.com/" target="_blank">Alsa Création</a></li>
                        <li><a href="https://www.youtube.com/c/LeDesignerduWeb/videos">Le Designer du web</a></li>
                    </ul>
                </aside>
            </div>
            <section id="mainSection">
                <article>
                    <h1>Analyse des données avec VBA :</h1>
                </article>
                <article>
                    <h2 id="introduction">Introduction :</h2>
                    <p>Savoir faire du VBA pour enregistrer de petites macros et les modifier, c'est déjà super ! Mais que pensez-vous de pouvoir automatiser toutes les tâches ennuyeuses et récurrentes que vous faites chaque jour pour votre travail ? Vous pourriez par exemple automatiser du reporting, programmer des envois d'e-mails, faire des graphiques, charger une base de données, et pourquoi pas fabriquer un petit logiciel pour votre entreprise ? La seule limite, c'est votre imagination ! Toutes les actions sur Excel peuvent être automatisées.</p>
                    <p>Dans ce cours de VBA, nous allons continuer à approfondir les concepts que nous avons commencé à aborder dans le cours "<a href="./supplements_fondamentaux_VBA.html">Découvrez les fondamentaux du VBA</a>".</p>
                    <p>Nous allons voir dans ce cours comment nous pouvons, dans un premier temps, automatiser entièrement notre reporting, de la compilation à la mise à disposition en passant par la sécurisation de notre code. Nous verrons, dans un deuxième temps, comment ajouter des graphiques et comment les mettre à jour automatiquement. Nous allons également appliquer des tests statistiques sur nos données afin de chercher les corrélations entre nos différentes variables, puis faire des prévisions avec la régression linéaire.</p>
                    <p>Alors, n'attendez plus pour développer le potentiel du VBA dans Excel en suivant ce cours.</p>
                </article>
                <article>
                    <h2 id="manipulation_fichiers_VBA">Manipulez des fichiers avec VBA :</h2>
                    <p>Dans la suite de ce cours, nous allons voir comment nous pouvons utiliser le VBA associé à Excel pour manipuler les fichiers, puis nous nous attarderons plus spécifiquement sur l'automatisation d'actions comme l'exécution des mises à jour ou encore des envois d'e-mails. Nous nous focuserons sur la sécurité dans l'environnement et dans le code.</p>
                    <h3>Interagissez avec les fichiers grâce à VBA :</h3>
                    <p>Vous vous posez sûrement la question suivante : <q>Tu parles de lire, copier, déplacer et lister des fichiers. Mais pourquoi je voudrais déplacer ou créer des dossiers en VBA ? On ne davait pas travailler sur Excel avec ?</q> Vous avez raison, le VBA est majoritairement utilisé dans Excel. Cepdendant, vous pouvez aussi l'utiliser pour <span class="em">manipuler</span> des fichiers. Vous vous demandez peut-être à quel moment cela peut arriver.</p>
                    <p>Imaginons un instant que vous deviez <span class="em">concaténer</span> cinq fichiers dans un un même fichier Excel, il y a plusieurs options possible pour faire cette action plus ou moins difficile :</p>
                    <ul>
                        <li>
                            <p><span class="em">la version manuelle</span> : ouvrir les cinq fichiers et faire un copier-coller de chaque fichier dans un nouveau fichier;</p>
                        </li>
                        <li>
                            <p><span class="em">la version semi-automatique</span> : ouvrir chaque fichier et exécuter une macro qui copie les données et les colle dans un nouveau fichier (automatisation simple en VBA);</p>
                        </li>
                        <li>
                            <p><span class="em">la version automatique</span> : créer un programme qui vient lister les fichiers dans le dossier, qui ouvre tout seul les fichiers, qui copie et colle les données, qui ferme les fichiers et qui enregistre automatiquement le nouveau fichier contenant les données des cinq autres fichiers.</p>
                        </li>
                    </ul>
                    <p>Au début, j'aurais sûrement choisi la première solution, puis maintenant la deuxième ! La troisième vous semble compliquée, non ? Eh bien non justeemnt, nous allons voir que c'est même plutôt facile.</p>
                    <p>Prtons du principe que nous ne connaissons pas le nombre de fichiers que nous devons concaténer.</p>
                    <p>Prenons un peu de recul et décortiquons les différentes actions que nous devons réaliser :</p>
                    <ol>
                        <li>
                            <p>Aller dans le dossier avec le VBA;</p>
                        </li>
                        <li>
                            <p>Lister tous les fichiers que nous avons dans le dossier;</p>
                        </li>
                        <li>
                            <p>Écrire un sous-programme qui va copier les données.</p>
                        </li>
                    </ol>
                    <h3>Listez, créez et déplacez des fichiers avec VBA :</h3>
                    <p>Commençons par voir comment nous pouvons <span class="em">lister les fichiers</span> qui sont présents dans un dossier.</p>
                    <p>Pour ce faire, vous allez utiliser une fonction du VBA qui s'appelle <span class="html">Dir()</span>.</p>
                    <p>Cette fonction permet de lister les différents fichiers d'un dossier automatiquement. Le seul argument dont la fonction a besoin, c'est le chemin du dossier dans lequel se trouvent vos fichiers.</p>
                    <p>Pour trouver le chemin de votre dossier sur votre ordinateur, allez dans le dossier qui contient les fichiers, puis cliquez dans la barre d'adresse.</p>
                    <figure>
                        <img src="../images/exemple_chemin_explorateur_fichier_Windows_VBA.png" alt="">
                        <figcaption>Exemple de chemin dans l'explorateur de fichier Windows</figcaption>
                    </figure>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Le chemin, c'est <span class="html">Ce PC &gt; Storage &gt; P2C1 &gt; Data</span>, mais ce n'est pas exploitable par le VBA. Pour pouvoir le convertir en un chemin exploitable, il faut cliquer dans cette barre d'adresse et vous aurez un chemin exploitable sous la forme : I:\P2C1\Data. Pour finir, il ne faut pas oublier d'ajouter un dernier back slash (barre oblique inversée) avec la combinaison de touches sur votre clavier <kbd>ALT GR</kbd> + <kbd>8 \</kbd> pour Windows ou <kbd>Option</kbd> + <kbd>MAJ</kbd> + <kbd>/</kbd> sur Mac. Pour notre exemple, le chemin final est donc sous la forme : I:\P2C1\Data\.</p>
                    </div>
                    <p>Maintenant que nous avons le chemin du dossier, nous n'avons plus qu'à écrire le code qui va nous permettre de faire la liste.</p>
<pre><code>Sub Liste_fichiers()
    Dim Chemin As String
    Dim Fichier As String
    Dim i As Integer

    '   Initialisation de la variable
    i = 1

    '   Choix du dossier à lister
    Chemin = "D:\Extraction\Data"
    Fichier = Dir(Chemin)

    '   Boucle sur les fichiers xls du répertoire
    Do While Len(Fichier) &gt; 0
        Range("A" & i).Value = Chemin & fichier
        i = i + 1
        Fichier = Dir()
    Loop
End Sub</code></pre>
                    <p>Dans le code ci-desus, nous avons commencé par déclarer trois variables :</p>
                    <ul>
                        <li>
                            <p>"Chemin" : va contenir le chemin vers le dossier;</p>
                        </li>
                        <li>
                            <p>"Fichier" : va contenir le chemin vers le dossier et le nom du fichier;</p>
                        </li>
                        <li>
                            <p>"I" : pour créer notre boucle.</p>
                        </li>
                    </ul>
                    <p>Mais comment fait-on pour connaître le nombre de fichiers qu'il y a dans le dossier ? Avec cette fonction, nous n'avons pas besoin de connaître le nombre de fichiers qu'il y a dans le dossier. La particularité de la fonction <span class="html">Dir</span>, c'est que, chaque fois qu'on appelle, elle s'incrémente automatiquement sur le fichier d'après.</p>
                    <p>Quand elle a fini, elle renovie juste le chiffre 0. C'est pourquoi nous utilisons une boucle <span class="html">Do While</span>, car nous souhaitons boucler sur la fonction tant qu'elle n'est pas égale à 0.</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Vous pouvez essayer ce code chez vous sur n'importe quel dossier et vous obtiendrez quelque chose de similaire à mon exemple.</p>
                    </div>
                    <figure>
                        <img src="../images/exemple_listing_fichiers_fonction_Dir_VBA.png" alt="">
                        <figcaption>Exemple de listing de fichiers avec la fonction Dir</figcaption>
                    </figure>
                    <p>Pour aller un peu plus loin, nous souhaitons maintenant <span class="em">déplacer les fichiers</span> que nous venons de lister dans un dossier qui s'appellera "Fichiers traités".</p>
                    <p>Pour cela, nous utilisons la commande <span class="html">FileSystemObject</span> pour déplacer des fichiers et la commande <span class="html">MkDir</span> pour créer un dossier.</p>
                    <p>La commande <span class="html">MkDir</span> est assez similaire à la commande <span class="html">Dir</span>. Elle ne peut avoir qu'un argument, qui est le chemin que vous souhaitez créer.</p>
                    <p>Dans notre cas, nous allons utiliser ce code :</p>
<pre><code>"I:\P2C1\Data\Fichiers_traités"</code></pre>
                    <p>La fonction <span class="html">MkDir</span> va alors simplement créer le dossier "Fichiers_traités".</p>
                    <div class="important">
                        <img src="../images/important.png" alt="Important" class="float_left">
                        <p>Là encore, il faut faire attention, nous n'avons sûrement pas le même chemin, pour moi, il s'agit de I:\P2C1\. Faites attention à adapter le chemin sur votre ordinateur.</p>
                    </div>
                    <p>Pour finir, déplaçons les fichiers dans ce dossier avec l'objet "<span class="html">FileSystemObject</span>".</p>
                    <p>Pour cela, commençons par déclarer cet objet avec les deux lignes ci-dessous :</p>
<pre><code>Dim FSO As Object
Set FSO = CreateObject("Scripting.FileSystemObject")</code></pre>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Nous déclarons ici une nouvelle variable qui s'appelle "<span class="html">FSO</span>" (pour <span class="html">F</span>ile<span class="html">S</span>ystem<span class="html">O</span>bject). Nous pourrions lui donner un autre nom, mais il est plus simple de lui donner le nom de son objet. Puis nous utilisons la commande <span class="html">Set</span> qui permet d'affecter un objet à la variable objet "Scripting.FileSystemObject".</p>
                    </div>
                    <p>Nous allons pouvoir maintenat utiliser plusieurs méthodes et propriétés sur cet objet.</p>
                    <p>Dans les méthodes intéressantes, nous avons par exemple :</p>
                    <ul>
                        <li>
                            <p>CopyFile ou CopyFolder : copier un fichier ou un dossier à un emplacement;</p>
                        </li>
                        <li>
                            <p>DeleteFile ou DeleteFolder : supprimer un fichier ou un dossier;</p>
                        </li>
                        <li>
                            <p>FileExists ou FolderExists : tester l'existence d'un fichier ou d'un dossier;</p>
                        </li>
                        <li>
                            <p>MoveFile ou MoveFolder : déplacer un fichier ou un dossier.</p>
                        </li>
                    </ul>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Vous pouvez aller consulter sur le <a href="https://learn.microsoft.com/fr-fr/office/vba/language/reference/user-interface-help/filesystemobject-object" target="_blank">site de Microsoft la liste de toutes les méthodes ou propriétés de cet objet</a>.</p>
                    </div>
                    <p>Nous n'avons plus qu'à utiliser cet objet pour déclacer nos fichiers avec la ligne de code :</p>
<pre><code>FSO.MoveFile "I:\P2C1\Data\Reporting 2023S01.xlsx", "I:\P2C1\Data\Fichiers_traités\Reporting 2023S01.xlsx"</code></pre>
                    <p>Nous utilisons la fonction <span class="html">FSO.MoveFile</span>. Nous donnons comme premier argument le chemin du fichier à déplacer, puis en second argument, le nouvel emplacement.</p>
                    <p>Dans ce cas, nous avons <span class="em">déplacé</span> les fichiers un par un, mais nous pourrions être moins restrictifs en lui demandant de déplacer tous les fichiers avec un nom similaire, avec la même extension ou encore l'intégralité d'un dossier.</p>
                    <p>Pour aller plus loin, voici le code pour déplacer tous les fichiers avec un nom similaire :</p>
<pre><code>FSO.MoveFile "I:\P2C1\Data\Reporting*.xlsx", "I:\P2C1\Data\Fichiers_traités\"</code></pre>
                    <p>Nous avons utilisé l'étoile "*" pour lui spécifier que nous souhaitons qu'il déplace tous les fichiers du dossier qui commencent par "Reporting".</p>
                    <h3>Automatisez le traitement des données de plusieurs fichiers :</h3>
                    <p>Maintenant, vous savez lister des fichiers, créer des dossiers et déplacer des fichiers. Il ne reste plus qu'à rajouter le traiteemnt à appliquer.</p>
                    <p>Nous allons donc modifier notre programme pour :</p>
                    <ul>
                        <li>
                            <p>ouvrir les fichiers;</p>
                        </li>
                        <li>
                            <p>faire le nettoyage des données dans un sous-programme;</p>
                        </li>
                        <li>
                            <p>copier les données;</p>
                        </li>
                        <li>
                            <p>coller les données</p>
                        </li>
                        <li>
                            <p>fermer le fichier.</p>
                        </li>
                    </ul>
                    <p>Je vous montre tout cela dans le code ci-dessous :</p>
<pre><code>Sub Liste_fichiers()

Dim Chemin As String
Dim Fichier As String
Dim i As Integer
Dim j As Integer
Dim FSO As Object
Set FSO = CreateObject("Scripting.FileSystemObject")
Dim fichier_reporting As String
Dim fichier_a_rajouter As String
Dim cell_max As Integer

fichier_reporting = ActiveWorkbook.Name

'/////////////////////////////////////////////////////////
'////////// BOUCLE POUR LE LISTING DES FICHIERS \\\\\\\\\\
'\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

'Initialisation de la variable
i = 1

'Changement de feuille Excel
Sheets("Reporting").Select

'Choix du dossier à lister
Chemon = "D:\Extraction\Données\"
Fichier = Dir(Chemin)

'Boucle sur les fichiers du répertoire.
Do While Len(Fichier) &gt; 0
    Range("A" & i).Value = Chemin & Fichier
    i = i + 1
    Fichier = Dir()
Loop

'Création du dossier
MkDir("D:\Extraction\Données\Fichiers_traités\")

'/////////////////////////////////////////////
'////////// traitement des fichiers \\\\\\\\\\
'\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

For j = 1 To (i - 1)
    'Sélection de la feuille
    Sheets("Reporting").Select
    'Récupération du lien du fichier à compiler
    Fichier = Range("A" & j).Value
    'Ouverture du fichier
    Workbooks.Open Filename:=Fichier
    'Récupération du nom du fichier
    fichier_a_rajouter = ActiveWorkbook.Name
    'Sous-programme de traitement des données
    'traitement_reporting

    'Suppression des colonnes inutiles
    Columns("A:G").Select
    Selection.Delete Shift:=xlToLeft
    Columns("X:AF").Select
    Section.Delete Shift:=xlToLeft
    'Changement du format
    Columns("W:W").Select
    Selection.NumberFormat = "#,##0.0"
    'Suppression des .0 dans le code postal
    Columns("N:N").Select
    Selection.Replace What:=".0", Replacement:="", LookAt:=xlPart, _
        SearchOrder:=xlByRows, MatchCase:=False, SrarchFormat:=False,
        ReplaceFormat:=False
    'Copie des données
    Range("A2:AU1000").Select
    Selection.Copy
    
    'Changement de fichier
    Windows(fichier_reporting).Activate
    'Sélection de la feuille
    Sheets("Data").Select
    'Recherche de la dernière cellule vide pour coller nos données
    If j &gt; 1 Then
    Range("A2").Select
    Else
    Range("A1").Select
    End If
    Selection.End(xlDown).Select
    cell_max = ActiveCell.Row
    Range("A" & (cell_max + 1)).Select
    'Collage des données
    ActiveSheet.Paste
    'Retour sur le fichier
    Workbooks(fichier_a_rajouter).Activate
    'Fermeture du fichier
    ActiveWorkbook.Save
    ActiveWorkbook.Close

    'Déplacement du fichier traité
    FSO.MoveFile Fichier, Chemin & "Fichiers_traités\"
    'Rajoute d'une indication dans le fichier pour valider que le traitement est OK
    Sheets("Reporting").Select
    Range("B" & j).Select
    ActiveCell.FormulaR1C1 = "Fichier OK"
Next j

End Sub</code></pre>
                    <p>Comme vous avez pu le voir dans le code ci-dessus, nous avons dû faire des modifications supplémentaires dans le code initial.</p>
                    <p>Le fait d'ajouter de <span class="em">l'automatisation</span> nous oblige par exemple à trouver la dernière ligne qui est remplie.</p>
                    <p>Vous avez pu également voir que j'utilise beaucoup le code avec des Sheets("name").Select" ou encore "Range("A1").Select". Ce code n'est pas obligatoire du tout et vous verrez prochainement comment nous pouvons nous en passer.</p>
                    <p>Je trouve qu'utiliser ce type de code au départ permet d'être plus visuel dans le mode pas à pas du VBE. Le fait de réaliser des "Select" de fichier, de feuille ou encore de cellule nous permet de voir ce que notre code va faire. Il est ainsi plus facile de suivre le déroulé de notre code.</p>
                    <p>Dans un second temps, ou dès que vous serez à l'aise, vous pourrez optimiser votre code en supprimant ce genre d'étape qui ralentit le code.</p>
                </article>
                <article>
                    <h2 id="programmation_execution_automatique_traitements_donnees_VBA">Programmez l'exécution automatique de vos traitements de données avec VBA :</h2>
                    <p>Vous venez de voir comment commencer à automatiser un reporting.</p>
                    <p>Pour le moment, cette automatisation nécessite toujours l'intervention d'une personne physique qui va lancer la macro. Dans la suite de ce cours, nous allons voir comment tout cela peut se faire de façon automatique pendant que vous êtes en train de prendre votre café !</p>
                    <h3>Automatisez l'exécution de vos scripts :</h3>
                    <p>Pour continuer à pousser l'automatisation plus loin, nous allons utiliser des fonctions qui permettent de s'exécuter en fonction de certains événements.</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Un <span class="em">événement</span> est une action que le VBE attend pour déclencher du code. Imaginons que, chaque fois que vous ajoutez une feuille, vous souhaitez faire une mise en page spécifique ou alors demander quelque chose à l'utilisateur. Vous pouvez faire cela avec les événements.</p>
                    </div>
                    <figure>
                        <img src="../images/fenetre_projets_differents_modules_VBE.png" alt="">
                        <figcaption>Fenêtre des projets avec les différents modules dans le VBE</figcaption>
                    </figure>
                    <p>Jusqu'à maintenant, vos macros étaient dans les modules, mais vous pouvez également les insérer dans des <span class="em">feuilles</span> ou dans "<span class="em">ThisWorkbook</span>".</p>
                    <p>Mais pour quoi faire ? À quoi cela sert-il de rajouter de la complexité ? Les événements sont définis dans le VBE et nous ne pouvons pas en créer. Nous allons donc utiliser les événements qui sont mis à votre disposition dans le VBE. Certains sont <span class="em">associés à la feuille (événement Worksheet)</span> comme :</p>
                    <ul>
                        <li>
                            <p>BeforeDoubleClick;</p>
                        </li>
                        <li>
                            <p>Calculate;</p>
                        </li>
                        <li>
                            <p>Activate;</p>
                        </li>
                        <li>
                            <p>SelectionChange;</p>
                        </li>
                        <li>
                            <p>FollowHyperlink.</p>
                        </li>
                    </ul>
                    <p>D'autres sont <span class="em">associés au classeur (événement Workbook)</span>, par exemple :</p>
                    <ul>
                        <li>
                            <p>NewSheet;</p>
                        </li>
                        <li>
                            <p>Open;</p>
                        </li>
                        <li>
                            <p>BeforeClose;</p>
                        </li>
                        <li>
                            <p>BeforePrint;</p>
                        </li>
                        <li>
                            <p>BeforeSave;</p>
                        </li>
                        <li>
                            <p>SheetActivate;</p>
                        </li>
                        <li>
                            <p>WindowsActivate.</p>
                        </li>
                    </ul>
                    <p>Pour voir les différents événements, il faut déjà choisir si ce sera un événement lié à une feuille ou au classeur. Dans notre cas, il sera lié à l'ouverture du classeur Excel.</p>
                    <figure>
                        <img src="../images/utilisation_module_ThisWorkBook_evenements_VBA.png" alt="">
                        <figcaption>Utilisation du module "ThisWorkBook" pour les événements</figcaption>
                    </figure>
                    <p>Vous allez donc :</p>
                    <ul>
                        <li>
                            <p>aller dans "ThisWorkBook";</p>
                        </li>
                        <li>
                            <p>cliquer sur "Général";</p>
                        </li>
                        <li>
                            <p>choisir "Workbook" dans la liste;</p>
                        </li>
                        <li>
                            <p>aller encore à droite pour choisir "Open".</p>
                        </li>
                    </ul>
                    <p>Vous devez normalement obtenir un résultat similaire :</p>
                    <figure>
                        <img src="../images/exemple_sous-programme_evenement_Workbook_Open_VBA.png" alt="">
                        <figcaption>Exemple de sous-programme qui se lance avec l'événement "Workbook_Open"</figcaption>
                    </figure>
                    <p>Le VBE vous a automatiquement créé une nouvelle fonction avec différentes variables.</p>
                    <p>Je crois que vous avez compris : nous allons ici lancer automatiquement notre programme à l'ouverture du fichier Excel ? Tout à fait ! Cela va donner un code très simple :</p>
<pre><code>Private Sub Workbook_BeforeSave(ByVal SaveAsUI as Boolean, Cancel As Boolean)

'Code à mettre ici

End Sub</code></pre>
                    <h3>Automatisez la mise à jour de vos données :</h3>
                    <p>Nous allons maintenant <span class="em">modifier</span> notre code pour qu'il se lance automatiquement à l'ouverture. Nous allons également en profiter pour ajouter un petit reporting. Cema va nous permettre de connaître le statut de la mise à jour (vu qu'elle va se faire toute seule, il nous faut bien un indicateur), en regardant la colonne "État" qui pourra prendre la valeur "Fait", si le reporting a déjà été fait.</p>
                    <p>Avant de lancer le reporting, j'ai rajouté <span class="em">une table de paramétrage</span> sur le fichier Excel pour le mois de mai 2023 :</p>
                    <figure>
                        <img src="../images/ajout_table_parametrage_Excel.png" alt="">
                        <figcaption>Ajout d'une table de paramétrage dans le fichier Excel</figcaption>
                    </figure>
                    <p>Cette table va permettre au code de venir chercher quel jour nous sommes et de voir si, ce jour-là, nous souhaitons mettre à jour le reporting en utilisant la colonne E "Statut du reporting". Si c'est "Oui", alors nous lançons le reporting, sinon nous ne faisons rien.</p>
                    <p>Nous allons également utiliser la colonne G pour donner l'état de la mise à jour. Le programme écrit "Fait" dans cette colonne les jours où il a été lancé.</p>
                    <p>Je vous montre tout cela dans le code suivant :</p>
<pre><code>Private Sub Workbook_Open()

Dim jour As Date
Dim statut As String
Dim etat As String
Dim num_ligne As Integer

jour = Date

'Ouverture du fichier
'Workbooks.Open Filename:="D:\C1P3\reporting.xlsb"

'Recherche du jour
Sheets("Reporting").Select
Range("D3:D40").Select
Selection.Find(What:=jour, After:=ActiveCell, LookIn:=xlFormulas _
    , LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
    MatchCase:=False, SearchFormat:=False).Activate

'Récupération des paramétrages des cellules
num_ligne = ActiveCell.Row
statut = Range("E" & num_ligne).Value
etat = Range("G" & num_ligne).Value

'Test de lancement du sous-programme
If (statut = "Oui" And etat = "") Then
    Liste_fichiers
    Range("G" & num_ligne).Select
    ActiveCell.FormulaR1C1 = "Fait"
End If

End Sub</code></pre>
                    <p>Ah oui, effectivement, ce n'est pas mal tout ça; mais au final, vous devez toujours lancer le fichier moi-même avant d'aller prendre votre café, c'est dommage ! Effectivement, si nous nous arrêtons là, nous devons le lancer nous-mêmes et nous n'allons pas gagner tant de temps que cela.</p>
                    <p>Pour terminer cette automatisation, nous allons utiliser le <span class="em">planificateur de tâches de Windows</span>. Cet outil Windows permet de paramétrer une tâche à une heure bien précise de la journée et d'y associer une action. Dans notre cas, cela sera l'ouverture de notre fichier de reporting.</p>
                    <p>Dans le planificateur de tâches de Windows, dans l'onglet "Actions", on va "créer une tâche de base" avec le nom "Lancement reporting" par exemple.</p>
                    <p>Nous allons ensuite la paramétrer. Donc, on souhaite la lancer tous les jours. Puis, nous allons choisir un horaire (par exemple, 09:00).</p>
                    <p>L'action que nous souhaitons faire, c'est lancer un programme et on lui donne le lien de notre programme, on clique sur "Suivant", on confirme les informations, à savoir le nom ("Lancement reporting") et le déclencheur (tous les jours à 9h) et on clique sur "Terminer".</p>
                    <p>Maintenant qu'on vient de créer cette action, nous allons aller voir où elle est paramétrée. Dans la liste des tâches actives en dessous, je vais aller chercher mon action qui s'appelle "Lancement reporting" et je peux double-cliquer dessus.</p>
                    <p>Quand je double-clique dessus, je tombe sur les déclencheurs, les actions, c'est ce qu'on a paramétré tout à l'heure.</p>
                    <p>Dans le volet de droite, je vais simuler une exécution pour le lancer et le tester. C'est ce que nous allons faire. Je vais cliquer sur "Exécuter" et simuler que je suis aujourd'hui à 9h pour voir si la macro s'exécute parfaitement.</p>
                    <p>Et voilà ! Vous pouvez maintenant aller boire votre café directement en arrivant au bureau. Votre reporting se fera tout seul à 9h !</p>
                    <h3>Automatisez l'envoi de rapports par e-mail :</h3>
                    <p>Finalement, devant la machine à café à 9h, vous vous demandez si votre script a vraiment fonctionné. Et s'il y avait une erreur, un problème ? Vous ne pourrez le savoir qu'au moment où vous allez retourner devant votre ordinateur et consulter le statut de la mise à jour dans le fichier reporting.</p>
                    <p>C'est pourquoi nous allons pousser l'automatisation encore un peu plus loin.</p>
                    <p>Encore plus automatiser, c'est possible ?! Nous allons maintenant nous <span class="em">envoyer un e-mail automatiquement</span> afin d'avoir le statut de cette mise à jour directement sur notre téléphone.</p>
                    <p>Pour cela, il vous suffit d'instancier un nouvel objet "Outlook" avec le code :</p>
<pre><code>Dim outlook As Object
Set outlook = CreateObject("Outlook.Application")</code></pre>
                    <p>Paramétre ensuite l'objet "Outlook" avec la méthode "<span class="html">CreateItem</span>" qui a besoin de différents paramètres :</p>
                    <ul>
                        <li>
                            <p>Subject : le sujet de l'e-mail;</p>
                        </li>
                        <li>
                            <p>To : l'adresse ou les adresses e-mail auxquelles envoyer le fichier;</p>
                        </li>
                        <li>
                            <p>Body : le corps du message (on peut utiliser également HTMLBody pour pouvoir personnaliser un peu le texte);</p>
                        </li>
                        <li>
                            <p>Display : si vous souhaitez voir l'e-mail avant de l'envoyer;</p>
                        </li>
                        <li>
                            <p>Send : qui permey d'envoyer l'e-mail;</p>
                        </li>
                        <li>
                            <p>Add (chemin de la pièce jointe) : pour ajouter une pièce jointe à l'e-mail.</p>
                        </li>
                    </ul>
<pre><code>'À mettre dans Thisworksheet
Private Sub Workbook_Open()

Dim jour As Date
Dim statut As String
Dim etat As String
Dim num_ligne As Integer
Dim outlook As Object
Dim Resultat As String

Set outlook = CreateObject("Outlook.Application")

jour = Date

'Ouverture du fichier
'Workbooks.Open Filename:="D:\C1P3\reporting.xlsb"

'Recherche du jour
Sheets("Reporting").Select
Range("D3:D40").Select
Selection.Find(What:=jour, After:=ActiveCell, LookIn:=xlFormulas _
    , LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
    MatchCase:=False, SearchFormat:=False).Activate

'Récupération des paramétrages des cellules
num_ligne = ActiveCell.Row
statut = Range("E" & num_ligne).Value
etat = Range("G" & num_ligne).Value

'Teste si on doit lancer le sous-programme
If (statut = "Oui" And etat = "") Then
    Liste_fichiers
    Range("G" & num_ligne).Select
    ActiveCell.FormulaR1C1 = "Fait"
End If

'Créer une phrase à envoyer par email
If Range("G" & num_ligne).Value = "Fait" Then
    Resultat = "La mise à jour est passée correctement en date du : " & jour
Else
    Resultat = "Problème avec la mise à jour du : " & jour
End If

'Creation et envoi de l'email automatiquement
With outlook.CreateItem(alMailitem)
    .Subject = "Reporting - " & jour
    .To = "driss.vandenheede.techinfo@gmail.com"
    .Body = Resultat
    .send
End With

End Sub</code></pre>
                    <p>Comme vous pouvez le voir, je n'ai pas fait de changement dans les autres sous-programmes. Nous modifions seulement le programme principal pour ajouter des fonctionnalités : au départ, lancer une mise à jour, puis faire un petit reporting et, pour finir, envoyer ce reporting par e-mail.</p>
                    <p>Bien sûr, nous pouvons ajouter encore des options et des fonctionnalités en utilisant les différentes propriétés des objets. Dans notre cas, nous allons nous arrêter à un simple e-mail. <a href="https://learn.microsoft.com/fr-fr/office/vba/api/outlook.application.createitem" target="_blank">Voici un lien vers le site de Microsoft pour conna^tre les autres possibilités.</a></p>
                </article>
                <article>
                    <h2 id="gestion_securite_application_VBA">Gérez la sécurité de votre application VBA :</h2>
                    <p>Vous avez vu précédemment comment automatiser le reporting en utilisant différents outils comme les événements ou encore les autres logiciels de la suite Office de Microsoft.</p>
                    <p>Maintenant, nous allons mettre l'accent sur la <span class="em">sécurité</span> autour de votre environnement de développement et vous montrer comment vous pouvez mieux sécuriser l'exécution d'une macro.</p>
                    <h3>Sécurisez votre code :</h3>
                    <p>Comme vous avez déjà pu le voir avec les fichiers Excel, chaque fichier possède une <span class="em">extension</span>. Pour Excel, les quatre principaux formats sont .xls, .xlsb, .xlsx et .xlsm.</p>
                    <p>L'extension a une réelle importance pour votre code en VBA, car, en fonction de cette dernière, le code associé à votre macro sera stocké ou non dans votre fichier.</p>
                    <p>Si vous venez d'écrire une macro dans votre fichier Excel et que vous souhaitez l'enregistrer en .xlsx, un message d'erreur va apparaître.</p>
                    <figure>
                        <img src="../images/message_erreur_Excel_enregistrer_fichier_code_xlsx_VBA.png" alt="">
                        <figcaption>Message d'erreur d'Excel quand on souhaite enregistrer un fichier contenant du code en .xlsx</figcaption>
                    </figure>
                    <p>Excel vous signale que la fonctionnalité "<span class="em">Projet VB</span>" ne peut pas être enregistrée, car l'extension .xlsx ne peut pas contenir de code VBA. Cette restriction permet de vous protéger de l'exécution de macros à l'ouverture par exemple.</p>
                    <p>Comme nous l'avons vu précédemment, vous pouvez exécuter du code sans que l'utilisateur le voie (lorsque vous avez utilisé l'événment "Open" par exemple).</p>
                    <p>Une personne mal intentionnée pourrait par exemple dérober des fichiers ou des données et se les envoyer par e-mail, sans que vous puissiez vous en rendre compte, juste en ouvrant un fichier Excel.</p>
                    <p>Pour pallier ce type de problème, Microsoft a créé une extension (<span class="em">.xlsx</span>) qui ne peut pas contenir de code.</p>
                    <p>Pour les extensions .xls, .xlsb ou .xlsm, le code que vous avez écrit est directement enregistré dans le fichier avec vos données.</p>
                    <p>Mais alors, si un jour vous supprimez mon fichier, vous allez aussi perdre votre code ? Eh oui, bonne remarque, c'est bien le problème. Votre code étant à l'intérieur de votre fichier, n'importe qui peut le modifier ou l'exécuter. Si vous perdez votre fichier, vous perdez également votre code. Il est donc important de pouvoir le sécuriser et de le sauvegarder régulièrement.</p>
                    <p>Si votre code est inclus à l'intérieur du fichier, je vous encourage vivement à faire <span class="em">des sauvegardes</span> des différents modules dans des fichiers externes (Bloc-notes, Word, OneNote, site internet, etc.). Vous pourrez donc avoir une copie du code et le restaurer.</p>
                    <p>Parfois, on ne souhaite pas que le code soit directement dans le fichier. Par exemple, on ne veut pas que d'autres personnes puissent lancer le code VBA. Pour ce faire, vous pouvez utiliser par exemple un fichier qui s'appelle "<span class="em">Personal</span>". Ce nouveau fichier Excel ne va contenir que du code (vous ne pourrez pas y insérer de données).</p>
                    <p>Pour faire apparaître le fichier "Personal", il vous suffit de lancer l'enregistrement d'une macro (onglet "Développeur" ou "Affichage"), puis d'enregistrer une nouvelle macro.</p>
                    <p>Dans la partie "Enregistrer la macro dans", choisissez "Classeur de macros personnelles", puis cliquez sur "OK".</p>
                    <p>Votre classeur de macros personnelles est maintenant créé ! Si vous retournez dans le VBE, vous pouvez voir dans la fenêtre des projets un nouveau fichier Excel qui s'appelle "<span class="em">PERSONAL.XLSB</span>".</p>
                    <figure>
                        <img src="../images/fenetre_projets_VBE_fichier_PERSONAL_XLSB.png" alt="">
                        <figcaption>Fenêtre des projets dans le VBE avec le fichier "PERSONAL.XLSB"</figcaption>
                    </figure>
                    <p>Vous pouvez maintenant stocer votre code dans les différents modules de ce fichier. Votre code pourra alors s'exécuter sur les différents fichiers, mais il ne sera jamais stocké directement dans vos fichiers de reporting par exemple.</p>
                    <p>Quand vous allez quitter Excel après votre première macro dans ce fichier, Excel vous demandera si vous souhaitez enregistrer les modifications dans votre classeur de macros personnelles. Il faudra bien sûr cliquer sur "enregistrer".</p>
                    <p>Le fait de stocker vos macros dans ce fichier empêche que des utilisateurs modifient ou exécutent votre code. Mais, souvenez-vous que cela n'empêche pas de perdre votre code. Tous vos scripts VBA étant dans ce fichier, cela devient plus simple de les sauvegarder. En effet, vous pouvez retrouver sur l'ordinateur le fichier "PERSONALXLSB". Généralement, il se trouve dans : C:\Users\"le nom de votre ordinateur"\AppData\Roaming\Microsoft\Excel\XLSTART.</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>le dossier "AppData" est souvent un dossier masqué par Windows. Pour afficher les dossiers cachés, vous pouvez consulter <a href="https://support.microsoft.com/fr-fr/windows/afficher-les-fichiers-cach%C3%A9s-0320fe58-0117-fd59-6851-9b7f9840fdb2#:~:text=Cliquez%20sur%20le%20bouton%20D%C3%A9marrer,cach%C3%A9s%2C%20puis%20cliquez%20sur%20OK" target="_blank">la procédure en fonction de votre version de Windows sur le site de Microsoft</a>.</p>
                    </div>
                    <p>Si vous avez stocké toutes vos macros dans ce classeur, vous pouvez maintenant sauvegarder ce fichier pour mettre en sécurité l'intégralité de vos macros. De même, si un jour vous changez d'ordinateur, ce fichier peut simplement être déplacé sur le nouvel ordinateur pour avoir accès à toutes les macros facilement et rapidement.</p>
                    <h3>Maîtrisez les options avancées de sécurité :</h3>
                    <p>Parfois, les ordinateurs sont paramétrés pour ne pas lancer les macros. Vous avez dans ce cas un message d'Excel qui vous indique que toutes les macros ont été désactivées.</p>
                    <p>Pour changer cela, il faut :</p>
                    <ul>
                        <li>
                            <p>cliquer sur l'icône d'Office (en haut à gauche de la fenêtre);</p>
                        </li>
                        <li>
                            <p>aller dans "Options";</p>
                        </li>
                        <li>
                            <p>sélectionner "Centre de gestion de la confidentialité";</p>
                        </li>
                        <li>
                            <p>cliquer sur "Paramètres du centre de gestion de la confidentialité" dans la fenêtre de droite.</p>
                        </li>
                    </ul>
                    <p>Dans cette nouvelle fenêtre, cliquez sur "<span class="em">Paramètres des macros</span>". Vous avez ensuite quatre choix possibles :</p>
                    <ol>
                        <li>
                            <p>"Désactiver tous les macros sans notification" : vous n'aurez alors pas le message pour activer les macros à l'ouverture d'Excel.</p>
                        </li>
                        <li>
                            <p>"Désactiver toutes les macros avec notification" : c'est un choix intéressant si vous développez souvent des macros. Cela permet d'aller la praticité et la sécurité.</p>
                        </li>
                        <li>
                            <p>"Désactiver toutes les macros à l'exception des macros signées numériquement".</p>
                            <div class="information">
                                <img src="../images/information.png" alt="Information" class="float_left">
                                <p>Nous allons revenir en détails sur cette option qui est très pratique.</p>
                            </div>
                        </li>
                        <li>
                            <p>"Activer toutes les macros" : cela n'est pas recommandé par Excel et je ne vous le conseille pas non plus. N'importe quel code VBA pourrait se lancer à l'ouverture d'Excel.</p>
                        </li>
                    </ol>
                    <p>Aussi, j'apprécie tout particulièrement la possibilité de <span class="em">signer</span> une macro, mais qu'est-ce que cela signifie ? En pratique, la vraie signature numérique requiert de passer par un organisme qui atteste que votre macro vous appartient et qu'elle est donc sûre. Pour une petite macro sur votre ordinateur, vous n'avez pas beosin dqu'un organisme externe authentifie votre code.</p>
                    <p>Pour simplifier cette procédure, Microsoft met à disposition un outil qui vous permet de signer vous-même une macro : <span class="html">Selfcert</span>.</p>
                    <p>Pour ce faire, allez chercher cet outil. De mon côté, il se trouve dans C:\Program Files\Microsoft Office\root\Office16.</p>
                    <p>Vous pouvez ensuite lancer l'application qui s'appelle "SELFCERT.EXE".</p>
                   <figure>
                    <img src="../images/fenetre_creation_certificat_Selfcert_VBA.png" alt="">
                    <figcaption>Fenêtre de création d'un certificat avec Selfcert</figcaption>
                   </figure>
                   <p>Donnez un nom à votre certificat : "reporting", par exemple. Puis cliquez sur "OK", le message suivant apparaît : "Création réussie d'un certificat pour reporting".</p>
                   <p>Retournez maintenant dans le VBE pour affecter ce certificat à votre code :</p>
                   <ul>
                        <li>
                            <p>cliquez dans la fenêtre des projets sur le fichier Excel qui contient le code VBA;</p>
                        </li>
                        <li>
                            <P>allez dans "Outils", puis "Signature électronique";</P>
                        </li>
                        <li>
                            <p>cliquez sur "Choisir";</p>
                        </li>
                        <li>
                            <p>choisissez le certificat que vous venez de créer;</p>
                        </li>
                        <li>
                            <p>validez votre choix en cliquant sur "OK".</p>
                        </li>
                    </ul>
                    <figure>
                        <img src="../images/exemple_attribution_certificat_VBA.png" alt="">
                        <figcaption>Exemple d'attribution d'un certificat</figcaption>
                    </figure>
                    <p>Maintenant, il ne vous reste plus qu'à changer le paramétrage d'exécution des macros dans les options d'Excel pour le passer en "Désactiver toutes les macros à l'exception des macros signées numériquement". Si tout s'est bien passé, votre macro doit maintenant s'exécuter, sans faire apparaître de message particulier.</p>
                    <h3>Sécurisez l'utilisation de vos données par les utilisateurs :</h3>
                    <p>Pour finir, voyons comment nous pouvons <span class="em">protéger le code</span>. Dans un premier temps, vous pouvez rajouter un mot de passe pour ouvir le VBE.</p>
                    <p>Rien de plus simple :</p>
                    <ul>
                        <li>
                            <p>faites un clic droit sur votre classeur dans la fenêtre des projets du VBE;</p>
                        </li>
                        <li>
                            <p>cliquez sur "<span class="em">Propriétés de VBAProject</span>";</p>
                        </li>
                        <li>
                            <p>cliquez sur l'onglet "Protection de cette nouvelle fenêtre";</p>
                        </li>
                        <li>
                            <p>ajoutez un mot de passe pour pouvoir afficher le code.</p>
                        </li>
                    </ul>
                    <div class="important">
                        <img src="../images/important.png" alt="Important" class="float_left">
                        <p>Cetains mots de passe sont plus faciles à "casser" que d'autres. Il ne faut pas perdre de vue que celui-là est plus difficile et il faudra être un utilisateur averti pour passer outre. Je vous conseille donc de bien retenir ce mot de passe !</p>
                    </div>
                    <p>Vous avez maintenant un code qui est protégé et qui ne peut pas être modifié. Cependant, ce code peut toujours être exécuté par n'importe quel utilisateur à l'ouverture d'Excel. Or, nous souhaitons le rendre exécutable seulement par nous-même.</p>
                    <p>Vous pouvez pour cela ajouter une condition dans le code qui va permettre de savoir quel est l'ordinateur qui essaye de lancer le code.</p>
                    <p>Nous allons utiliser le code "<span class="em">Username</span>".</p>
                    <p>Il faudra seulement définir une nouvelle variable et ajouter à cette variable le "Username" :</p>
<pre><code>dim nom_utilisateur as String
nom_utilisateur = Environ("USERNAME")</code></pre>
                    <p>La variable "nom_utilisateur" contient donc maintenant le nom de la session de votre ordinateur, dans mon cas "Driss Vandenheede".</p>
                    <p>Je n'ai plus qu'à mettre un "If" au début de mon code pour qu'il s'exécute seulement si le "Username" = "Driss Vandenheede".</p>
<pre><code>Private Sub Workbook_Open()

Dim jour As Date
Dim statut As String
Dim etat As String
Dim num_ligne As Integer
Dim outlook As Object
Dim Resultat As String
Dim nom_utilisateur As String

nom_utilisateur = Environ("USERNAME")

If nom_utilisateur = "Driss Vandenheede" Then

    Set outlook = CreateObject("Outlook.Application")

    jour = Date

    'Ouverture du fichier
    'Workbooks.Open Filename:="D:\C1P3\reporting.xlsb"

    'Recherche du jour
    Sheets("Reporting").Select
    Range("D3:D40").Select
    Selection.Find(What:=jour, After:=ActiveCell, LookIn:=xlFormulas _
        , LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
        MatchCase:=False, SearchFormat:=False).Activate

    'Récupération des paramétrages des cellules
    num_ligne = ActiveCell.Row
    statut = Range("E" & num_ligne).Value
    etat = Range("G" & num_ligne).Value

    'Teste si on doit lancer le sous-programme
    If (statut = "Oui" And etat = "") Then
        Liste_fichiers
        Range("G" & num_ligne).Select
        ActiveCell.FormulaR1C1 = "Fait"
    End If

    'Créer une phrase à envoyer par email
    If Range("G" & num_ligne).Value = "Fait" Then
        Resultat = "La mise à jour est passée correctement en date du : " & jour
    Else
        Resultat = "Problème avec la mise à jour du : " & jour
    End If

    'Creation et envoi de l'email automatiquement
    With outlook.CreateItem(alMailitem)
        .Subject = "Reporting - " & jour
        .To = "driss.vandenheede.techinfo@gmail.com"
        .Body = Resultat
        .send
    End With
End If

End Sub</code></pre>
                </article>
                <article>
                    <h2 id="analyse_donnees_VBA">Analysez vos données avec VBA :</h2>
                    <p>Précédemment, vous avez vu comment mettre en place un <span class="em">reporting automatisé</span> et comment vous pouvez interagir avec d'autres logiciels de la suite Office. Pour fininir, nous avons fait un point sur la sécurité de nos macros et nous avons vu comment il faut les sauvegarder.</p>
                    <p>Dans la suite, nous vons proposons d'aller plus loin dans l'analyse et le reporting. Maintenant que vous savez comment concaténer des fichiers, nous allons les analyser. Dans un premier temps, nous allons réaliser des <span class="em">analyses descriptives</span> et nous passerons du temps sur les <span class="em">séries temporelles</span>. Puis, dans un second temps, nous allons nous attarder sur les <span class="em">analyses bivariées</span> et <span class="em">multivariées</span> avec les tests statistiques (Pearson, Khi2 ou encore ANOVA) ainsi que sur les <span class="em">modélisations</span> comme la régression linéaire.</p>
                    <p>Commençons par apprendre à faire une analyse descriptive de vos données. Une fois que votre fichier de données est consolidé, il va vous falloir le comprendre pour pouvoir l'analyser.</p>
                    <p>Posez-vous alors deux questions :</p>
                    <ul>
                        <li>
                            <p>Quelles données mon fichier contient-il exactement ?</p>
                        </li>
                        <li>
                            <p>Est-ce que les données sont justes ?</p>
                        </li>
                    </ul>
                    <p>Mais ce sont nos données, donc nous les connaissons déjà, non ? Et puis elles viennent de notre entreprise, donc c'est forcément bon. Concernant votre premier point, effectivement, si cela fait plusieurs mois ou années que vous êtes dans la même entreprise, vous êtes peut-être très à l'aise avec les données. Mais un jour, vous aurez certainement à ajouter de nouvelles données, comment allez-vous faire pour les comprendre ? C'est pour cela que nous faisons de l'analyse descriptive sur nos données.</p>
                    <p>Pour votre second point, qui est de dire que vos données sont justes, nous n'en savons rien du tout. En effet, vos données sont peut-être bonnes aujourd'hui, mais qui vous dit que cela sera toujours le cas demain ? Et s'il y avait eu un bug dans le chargement de la base de données, une erreur de saisie, des modifications des scripts sur la base de données, etc. ?</p>
                    <p>Il est préférable de toujours partir du principe que les données ne sont pas "justes". Je veux dire par là que vos données contiennent potentiellement des erreurs (peu importe la source de l'erreur).</p>
                    <p>Demain, c'est vous qui allez mettre à disposition des données agrégées ou présenter une anamyse s'appuyant sur les données que vous avez extraites. Que va-t-il se passer si vos données sont fausses ?</p>
                    <p>Effectivement, ce n'est pas de tout repos l'analyse de données ! C'est une routine qu'il faut mettre en place quand nous recevons des données. Et vous avez déjà vu comment mettre en place ce type de routine précédemment. Nous allons simplement étoffer cette analyse.</p>
                    <p>Gardez en têye que, en analyse de données, il est nécessaire de vous rassurer sur vos données en mettant en place des <span class="em">routines</span> qui vous permettent de comprendre et de trouver des erreurs potentielles. C'est justement ce que nous allons voir ensemble dans la suite de ce cours avec les <span class="em">variables numériques et catégorielles</span> !</p>
                    <h3>Décrivez un fichier de données :</h3>
                    <p>Pour commencer, nous allons maintenant décrire un fichier (connaître le nombre de colonnes et de lignes par exemple) et tester l'unicité de la clé du fichier (c'est la clé qui ne doit pas contenir de doublon).</p>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>Valeurs recherchées</th>
                                <th>Formule à utiliser dans Excel</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Le nombre total de lignes</td>
                                <td>=LIGNES(A1:A4844)</td>
                            </tr>
                            <tr>
                                <td>Le nombre total de colonnes</td>
                                <td>=COLONNES(A1:U1)</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Nous pouvons également faire la même chose, mais directement en VBA, sans passer par les formules Excel :</p>
<pre><code>Sub test_doublons()

Dim rng As Range
Dim cell As Range
Dim dict As Object
Dim doublons As Range

Set rng = Range("A2:A4844")
Set dict = CreateObject("Scripting.Dictionary")

'   Teste les doubles pour chaque cellule dans la range
For Each cell In rng
    If dict.Exists(cell.Value) Then
        If doublons Is Nothing Then
            Set doublons = cell
        Else
            Set doublons = Union(doublons, cell)
        End If
    Else
        dict.Add cell.Value, 1
    End If
Next cell

'   MsgBox pour l'utilisateur
If Not doublons Is Nothing Then
    '   Sélectionne les cellules en doublon dans la range
    doublons.Select
    MsgBox "Doublons trouvés dans la place " & rng.Address & "."
Else
    MsgBox "Aucun doublon trouvé dans la page " & rng.Address & "."
End If

End Sub</code></pre>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>L'objet <span class="html">Scripting.Dictionry</span> permet d'instancier une petite base de données afin de stocker des éléments. Dans notre cas, nous allons ajouter à notre dictionnaire toutes les valeurs uniques que nous allons trouver dans la sélection que nous avons faite (de A2 à A4844 en utilisant le <span class="html">For Each</span> pour balayer l'intégralité des valeurs).</p>
                    </div>
                    <p>Comme vous avez pu le remarquer, je n'ai pas testé l'unicité de la clé avec une formule Excel, car celle-ci n'existe pas. Nous pouvons cependant utiliser la fonction "Supprimer les doublons" de l'onglet "Données" dans Excel. Le problème de cette fonction, c'est qu'elle supprime directement les doublons sans nous les montrer, mais cela peut être une autre solution.</p>
                    <h3>Analysez des variables numériques :</h3>
                    <p>Faisons maintenant l'<span class="em">analyse descriptive</span> de nos données sur des variables numériques (analyses quantitatives).</p>
                    <p>Comment ça, analyses quantitatives ? La notion de "quantitatives" fait seulement référence à des données numériques qui sont statistiquement intéressantes à analyser. Nous allons donc parler de <span class="em">données discrètes ou continues</span>.</p>
                    <p>Une donnée discrète, c'est une donée timide ? Je vais vous donner une définition des deux mots, cela sera plus facile à comprendre.</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Les <span class="em">données discrètes</span> sont des nombres entiers finis (il est possible de compter les éléments), comme les notes des clients sur votre page Google ou le nombre d'enfants par famille. Il y a un nombre fini de valeurs possibles (votre entreprise ne peut être notée que de 0 à 5 par exemple).</p>
                        <p>Une <span class="em">donnée continue</span>, c'est exactemnt l'inverse, les données peuvent prendre n'importe quelle valeur possible. On retrouve par exemple la taille, le poids, les ventes, les stocks, etc.</p>
                    </div>
                    <p>C'est important de bien comprendre ce point, car en fonction des valeurs nous n'allons pas regarder la même chose.</p>
                    <p>Imaginons par exemple que nous regardons une colonne et qu'il y a dedans les valeurs :</p>
                    <p>2; 1; 2; 1; 1; 2; 2; 2,36; 2; 1; 0.</p>
                    <p>Si je vous dis maintenant que cette colonne contient un nombre d'enfants, qu'en pensez-vous ? Est-ce que cette colonne est juste ?</p>
                    <p>Le nombre d'enfants étant une donnée discrète, on ne s'attend pas à avoir un nombre à virgule, c'est donc qu'il y a une erreur dans cette colonne.</p>
                    <p>Commençons par définir ce que nous souhaitons connaître sur vos valeurs :</p>
                    <ul>
                        <li>
                            <p>le nombre de valeurs non vides;</p>
                        </li>
                        <li>
                            <p>le nombre de valeurs vides;</p>
                            <li>
                                <p>le nombre de valeurs à 0;</p>
                            </li>
                            <li>
                                <p>la valeur minimum;</p>
                            </li>
                            <li>
                                <p>la valeur maximum;</p>
                            </li>
                            <li>
                                <p>la valeur moyenne;</p>
                            </li>
                            <li>
                                <p>la valeur médiane.</p>
                            </li>
                        </li>
                    </ul>
                    <p>Il existe deux méthodes principales pour faire cela : soit on utilise des formules dans Excel, soit on vient utiliser des formules en VBA.</p>
                    <p>Nous allons commencer par Excel, je vais utiliser des formules dans la colonne R, qui contient le nombre de lots. Je vais simplement appliquer des formules sur une plage de données, elles vont me renvoyer directement les valeurs que je cherche.</p>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>Valeurs recherchées</th>
                                <th>Formule à utiliser dans Excel</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Le nombre de valeurs non vides</td>
                                <td>=NBVAL(Paris!$R2:$R4844)</td>
                            </tr>
                            <tr>
                                <td>Le nombre de valeurs vides</td>
                                <td>=NB.SI(Paris!$R2:$R4844;"")</td>
                            </tr>
                            <tr>
                                <td>Le nombre de valeurs à 0</td>
                                <td>=NB.SI(Paris!$R2:$R4844;0)</td>
                            </tr>
                            <tr>
                                <td>La valeur minimum</td>
                                <td>=MIN(Paris!$R2:$R4844)</td>
                            </tr>
                            <tr>
                                <td>La valeur maximum</td>
                                <td>=MAX(Paris!$R2:$R4844)</td>
                            </tr>
                            <tr>
                                <td>La valeur moyenne</td>
                                <td>=MOYENNE(Paris!$R2:$R4844)</td>
                            </tr>
                            <tr>
                                <td>La valeur médiane</td>
                                <td>=MEDIANE(Paris!$R2:$R4844)</td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Comme vous le voyez, c'est assez simple de le faire dans Excel avec des formules qui existent déjà.</p>
                    <figure>
                        <img src="../images/exemple_reporting_colonne_nombre_lot_formules_Excel.png" alt="">
                        <figcaption>Exemple de reporting sur la colonne nombre de lot en utilisant les formules d'Excel</figcaption>
                    </figure>
                    <p>Pour automatiser cela, vous pouvez soit demander à votre code d'écrire les formules automatiquement, comme nous l'avons fait à la main, soit de calculer lui-même ces différentes valeurs directement dans le code, puis de le stocker dans une variable :</p>
<pre><code>Sub indicateurs()

Dim nbre_nonvide As Integer
Dim nbre_vide As Double
Dim nbre_0 As Integer
Dim min As String
Dim max As Integer
Dim moyenne As String
Dim mediane As Integer
Dim test As String

nbre_nonvide = WorksheetFunction.CountA(Range("R2:R4844"))
nbre_vide = WorksheetFunction.CountBlank(Range("R2:R4844"))
min = WorksheetFunction.min(Range("R2:R4844"))
max = WorksheetFunction.max(Range("R2:R4844"))
moyenne = WorksheetFunction.Average(Range("R2:R4844"))
mediane = WorksheetFunction.Median(Range("R2:R4844"))

nbre_0 = 0
For i = 2 To 4844

    If Range("R" & i).Value = "0" Then
        nbre_0 = nbre_0 + 1
    End If

Next i

End Sub</code></pre>
                    <p>Souvent en VBA, il y a des fonctions assez similaires à celles d'Excel, comme le minimum, le maximum, la médiane, etc. Par contre, certaines méthodes d'objet n'existent pas en VBA, et c'est le cas ici du nombre de 0 que nous souhaitons compter.</p>
                    <p>Pour ce faire, j'ai juste ajouté un "For" avec un "If" qui vient incrémenter la variable "nbre_0". Nous aurions également pu créer un sous-programme pour pouvoir l'appeler, si nous devions l'utiliser souvent.</p>
                    <p>Dans la Méthodologie d'analyse, que ce soient des valeurs discrètes ou continues, il n'y a pas vraiment de changement analytique. Si nous connaissons les données, nous pouvons aussi, pour des valeurs discètes, regarder les valeurs uniques de la colonne. Cela peut nous permettre d'en apprendre un peu plus sur nos données. Nous allons aborder cette méthodologie dans le prochain paragraphe qui est justement dédié à cette technique avec les variables catégorielles.</p>
                    <h3>Analysez des variables catégorielles :</h3>
                    <p>Nous allons continuer avec les variables catégorielles.</p>
                    <p>Une variable catégorielle, cela ressemble à quoi</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Une variable catégorielle (ou qualitative), c'est une variable qui sert à catégoriser les données en fonction de certains critères. On retrouve par exemple la forme, la couleur, le type, la situation familiale, le sexe, etc.</p>
                    </div>
                    <p>Pour ce type d'analyse, c'est un peu plus simple, car nous allons chercher à avoir principalement deux informations :</p>
                    <ul>
                        <li>
                            <p>le nombre de valeurs uniques (et la liste des valeurs uniques potentiellement);</p>
                        </li>
                        <li>
                            <p>le mode (la valeur la plus représentée).</p>
                        </li>
                    </ul>
                    <p>Pour les valeurs uniques, nous allons utiliser la formule Excel <span class="html">UNIQUE</span> (=UNIQUE(Paris!$S$2:$S$4844)) et, pour le mode, la formule <span class="html">MODE</span> (=MODE(Paris!$S$2:$S$4844)) sur la colonne "Type Local".</p>
                    <div class="important">
                        <img src="../images/important.png" alt="Important" class="float_left">
                        <p>La fonction <span class="html">UNIQUE</span> fonctionne seulement avec Office 365, les versions précédentes ne prennent pas en charge cette formule.</p>
                    </div>
                    <p>Nous aurions également pu utiliser la fonction de suppression des doublons dans Excel, puis compter le nombre de valeurs uniques (et nous aurions également obtenu la liste).</p>
                    <p>Nous pouvons faire la même chose directement en VBA avec le code suivant :</p>
<pre><code>Sub indicateurs_quanti()
Dim mode As String
Dim plage As Range
Dim cellule As Range
Dim test As String

mode = WorksheetFunction.mode(Range("R2:R4844"))

'   Utilisation de l'objet dictionary
Dim valeursUniques As Object
Dim valeurs Uniques = CreateObject("Scripting.Dictionary")

'   Teste chaque cellule pour trouver toutes les valeurs possibles
For Each cellule In Range("S2:S4844")
    valeursUniques(cellule.Value) = Empty
Next cellule

'   MsgBox des valeurs uniques
For Each valeurUnique In valeursUniques.keys
    MsgBox (valeurUnique)
Next valeurUnique

End Sub<code></pre>
                    <h3>Identifiez des anomalies dans un fichier :</h3>
                    <p>Vous venez de voir comment réaliser une analyse descriptive de vos données. Cela vous donne une meilleure connaissance des données, mais est-ce qu'il y a des anomalies dans vos données</p>
                    <p>Vous pensez que non, vu qu'on a réalisé l'analyse descriptive et qu'elle n'a rien trouvé. Effectivement, nous n'avons rien vu de spécial avec cette analyse, mais cela ne veut pas dire qu'il n'y a pas de problèmes. Par exemple, si nous prenons la colonne "Département", nous pouvons rapidement voir avec l'analyse descriptive que certaines cellules sont manquantes. Vous devez alors vous demander à ce stade, si c'est important dans votre analyse et si vous êtes en mesure de les corriger ?</p>
                    <p>Dans le cas de la colonne "Département", nous pouvons seulement utiliser la formule <span class="html">GAUCHE</span> d'Excel (ou LEFT en anglais), qui va récupérer les deux premiers caractères de gauche du code postal pour compléter les données (dans Excel : =GAUCHE(J49;2)).</p>
                    <p>Si vous aviez plusieurs fois cette erreir dans vos données, vous pourriez alors venir tester chaque cellule et, pour chaque cellule vide, la remplir avec cette formule ou une formulaire en VBA.</p>
<pre><code>Sub valeurs_manquantes_departement()

Dim ligne_max As String
Range("A1").Select
Range(Selection, Selection.End(xlDown)).Select
ligne_max = ActiveCell.Row

'   Teste toutes les cellules
For i = 1 To 4484
    If Range("L" & i) = "" Then
        Range("L" & i).Select
        '   Écriture avec la méthode VBA
        ActiveCell.FormulaR1C1 = Left(Range("J" & i).Value, 2)
        '   Écriture avec la fonction Excel
        ActiveCell.FormulaR1C1 = "=LEFT(RC[-2],2)"
    End If
Next i

End Sub</code></pre>
                    <p>Comme vous le voyez dans l'exemple, chaque colonne va demander un code spécifique en fonction des données de la correction que vous souhaitez réaliser. Dans ce premier cas, nous avons une solution simple avec le code postal. Parfois, il n'y a pas vraiment de solution, comme lorsque vous avez des valeurs foncières vides. Il est difficile de les remplir, car il manque trop d'informations pour "fabriquer" le prix du logement.</p>
                    <p>Cela peut prendre un peu de temps au début de créer le code pour le nettoyage, mais cela va voir faire gagner beaucoup de temps par la suite quand vous n'aurez plus à le faire manuellement.</p>
                    <p>Nous allons maintenant nous concentrer sur les valeurs aberrantes ou atypiques.</p>
                    <p>C'est quoi des valeurs aberrantes ? C'est une très bonne question ! À partir de quand une valeur est-elle aberrante ? Si je vous dit qu'il y a un appartement vendu à Paris pour 750000€, est-ce une valeur aberrante ?</p>
                    <p>Regardons ensemble le résultat de l'analyse numérique ci-dessous :</p>
                    <figure>
                        <img src="../images/resultat_analyse_numerique_VBA.png" alt="">
                        <figcaption>Résultat de l'analyse numérique</figcaption>
                    </figure>
                    <p>En regardant notre tableau, nous pouvons nous dire qu'un appartement à 750000, ce n'est pas une valeur aberrante pour Paris, car la moyenne est à 614440€ et la médiane à 445000€. Nous sommes, certes, au-dessus, mais cela reste largement acceptable (+22% par rapport à la moyenne).</p>
                    <p>Si nous prenons maintenant une valeur de 3,5 millions d'euros. Est-ce une valeur aberrante ?</p>
                    <p>Aucune idée, si ça se trouve, il y a plein d'appartements à ce prix-là, et puis avec un maximum à 9 millions d'euros... On pense que non, ce n'est pas aberrant. Nous puvons effectivement réfléchir comme cela, mais nous pouvons également nous tourner du côté des mathématiques, car il y a des techniques toutes prêtes qui vont nous aider !</p>
                    <p>Une des méthodes les plus utilisées est la méthode de l'<span class="em">écart interquartile</span>.</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Vous vous souvenez de la médiane ? C'est la valeur au-dessous de laquelle se trouvent la moitié des valeurs.</p>
                        <p>Un <span class="em">quartile</span>, c'est la même chose, mais avec la proportion d'un quart. Il existe 3 quartiles, notés <span class="em">Q<sub>1</sub></span> (premier quartile), <span class="em">Q<sub>2</sub></span> (deuxième quartile) et <span class="em">Q<sub>3</sub></span> (troisième quartile). Ainsi :</p>
                        <ul>
                            <li>
                                <p>1/4 des valeurs se trouvent en dessous de <span class="em">Q<sub>1</sub></span> et 3/4 au-dessus;</p>
                            </li>
                            <li>
                                <p>2/4 se trouvent en dessous de <span class="em">Q<sub>2</sub></span>, et 2/4 au-dessus (<span class="em">Q<sub>2</sub></span> est la médiane !);</p>
                            </li>
                            <li>
                                <p>3/4 se trouvent en dessous de <span class="em">Q<sub>3</sub></span>, et 1/4 au-dessus.</p>
                            </li>
                        </ul>
                        <p>La généralisation de ce concept s'appelle le <span class="em">quantile d'ordre &alpha;</span>. Ainsi, la médiane est le quantile d'ordre 0,5, Q<sub>1</sub> le quantile d'ordre 0,25, Q<sub>3</sub> le quantile d'ordre 0,75. Il y a également les <span class="em">déciles</span> (quantiles d'ordre 0.1, 0.2, etc.), ou les <span class="em">centiles</span>, aussi appelés percentiles (quantiles d'ordre 0.01, 0.02, etc.).</p>
                        <p>L'écart interquartile est la différence entre le 3e quartile et le 1er quartile :</p>
                        <p class="em">IQ = Q<sub>3</sub> - Q<sub>1</sub></p>
                    </div>
                    <p>Pour faire simple, cette méthode permet de calculer un palier bas et un palier haut. Nous allons estimer que si nos valeurs sont en dessous ou au-dessus des paliers, alors nous pouvons les considérer comme des valeurs aberrantes. Le terme "bornes" peut aussi être utilisé pour nommer les paliers.</p>
                    <p>Pour ce faire, nous devons commencer par calculer l'IQ. C'est l'écart interquartile, qui est donc la différence entre le quartile 3 et le quartile 1 :</p>
                    <p>IQ = Q<sub>3</sub> - Q<sub>1</sub></p>
                    <p>Puis pour trouver nos bornes, nous allons :</p>
                    <ul>
                        <li>
                            <p>chercher le 1er quartile;</p>
                        </li>
                        <li>
                            <p>lui soustraire 1,5 * l'IQ pour la borne basse;</p>
                        </li>
                        <li>
                            <p>ajouter 1,5 * l'IQ au 3e quartile pour la borne haute.</p>
                        </li>
                    </ul>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Voici la formule :</p>
                        <ul>
                            <li>
                                <p>Palier bas : Q<sub>1</sub> - 1.5 * l'IQ</p>
                            </li>
                            <li>
                                <p>Palier haut : Q<sub>3</sub> + 1.5 * l'IQ</p>
                            </li>
                        </ul>
                    </div>
                    <p>Dans notre cas, nous allons tout faire en utilisant le VBA, mais vous pouvez également le faire avec Excel en utilisant la formule quartile.</p>
<pre><code>Sub ecart_interquartile()

Dim Q1 As Double
Dim Q3 As Double
Dim IQ As Double
Dim borne_basse As Double
Dim borne_haute As Double

Q1 = WorksheetFunction.Quartile(Range("E2;E4844"), 1)
Q3 = WorksheetFunction.Quartile(Range("E2;E4844"), 3)
IQ = Q3 - Q1

borne_basse = Round(Q1 - (1.5 * IQ), 0)
borne_haute = Round(Q3 + (1.5 * IQ), 0)

If borne_basse &lt; 0 Then
    borne_basse : 0
    MsgBox ("attention borne basse inférieure à 0")
    Range("$B$1:$V$5000").AutoFIlter Field:=4, Criterial:="&gt;" & borne_haute, _blank
        Operator:=xlAnd
    test = "&gt;" & borne_haute
End If

End Sub</code></pre>
                    <p>Dans notre cas, la borne basse est négative. Vu qu'elle est négative, j'ai préféré la mettre à 0 et faire un filtre seulement sur les valeurs hautes dans le tableau. Les différentes bornes se calculent toutes seules. Et, en plus, le code filtre automatiquement votre tableau sur les valeurs dites "aberrantes". L'utilisateur pourra par la suite modifier, supprimer ou garder les valeurs qui ne sont peut-être pas des erreurs (surtout dans l'immobilier). Pour réduire les données, vous pourriez faire le calcul de la surface, puis refaire les bornes sur le prix du mètre carré qui sera plus juste.</p>
                    <p>Vous pouvez également changer les bornes et dire que ce n'est pas 1,5 fois l'IQ, mais 2 fois ou 3 fois, en fonction de votre domaine et de vos données. Il faut adapter l'analyse à votre milieur professionnel.</p>
                </article>
                <article>
                    <h2 id="analyse_series_temporelles">Analysez des séries temporelles :</h2>
                    <p>Vous avez vu précédemment comment réaliser une analyse descriptive de vos données. Ce type d'analyse permet de comprendre les données avant de réaliser d'autres types d'analyses.</p>
                    <p>Comme nous avons des dates dans nos données, nous pouvons réaliser une analyse temporelle, qui va se décomposer en <span class="em">série temporelle</span> et en <span class="em">moyenne mobile</span>. Pour finir, nous utiliserons la feuille de prévision d'Excel pour prédire des valeurs.</p>
                    <h3>Appréhendez la spécificité des séries temporelles :</h3>
                    <p>Les séries temporelles sont monnaie courante dans les différentes analyses que vous allez faire. Pour faire une analyse temporelle, vous aurez besoin d'une variable de temps.</p>
                    <p>C'est facile, on va utiliser des dates ! Effectivement, nous allons souvent utiliser des dates, mais surtout toutes les déclinaisons des dates. Cette variable temporelle va pouvoir prendre plusieurs formes par exemple :</p>
                    <ul>
                        <li>
                            <p>des secondes;</p>
                        </li>
                        <li>
                            <p>des minutes;</p>
                        </li>
                        <li>
                            <p>des jours;</p>
                        </li>
                        <li>
                            <p>des semaines;</p>
                        </li>
                        <li>
                            <p>des mois;</p>
                        </li>
                        <li>
                            <p>des années;</p>
                        </li>
                        <li>
                            <p>etc.</p>
                        </li>
                    </ul>
                    <p>Vous pouvez également ajouter d'autres formes de variables temporelles, telles que les numéros des semaines, les jours de la semaine ou encore des plages horaires. Il y a assez peu de limites à la variable temporelle que vous allez prendre.</p>
                    <p>Certaines entreprises utilisent les clôtures des comptes, qui peuvent arriver le 30 avril, comme variables temporelles. Ce n'est pas un trimestre, ce n'est pas un semestre, c'est juste une période définie par l'entreprise, qui va aller du 1er au 30 avril de l'année suivante. Cette période est une variable temporelle pour l'entreprise.</p>
                    <p>La majorité du temps, vous allez vous retrouver avec des variables sous la forme de dates ou de timestamp (ou horodatage en français).</p>
                    <div class="information">
                        <img src="../images/information.png" alt="information" class="float_left">
                        <p>Le timestamp est un système temporel qui s'écrit comme cela : 1686167081. Ce timestamp par exemple donne la date du 07-06-2023 à 21h44 et 41 secondes. Ce chiffre de 1686147081 est le nombre de secondes depuis la date du 1er janvier 1970 à 00h00 et 00 seconde. Si on ajoute 1686167081 secondes à cette date, on tombe sur le 07-06-2023 à 21h44 et 41 secondes.</p>
                    </div>
                    <p>Souvent, vous allez devoir modifier votre fichier pour calculer les semaines, les mois ou encore les jours.</p>
                    <p>Dans notre cas, j'ai ajouté une formule Excel dans la colonne "mois (=MOIS("votre date")) et dans la colonne "semaine" (=NO.SEMAINE("votre date"),11).</p>
                    <figure>
                        <img src="../images/ajout_colonnes_mois_semaine_Excel.png" alt="">
                        <figcaption>Ajout des colonnes mois et semaine dans Excel</figcaption>
                    </figure>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Bien sûr, dans le cadre de l'automatisation de votre fichier d'analyse, vous auriez pu faire cela en VBA. Je vous laisse le faire si vous le souhaitez.</p>
                    </div>
                    <p>La particularité des données temporelles, c'est quelles s'apprécient dans un <span class="em">certain ordre</span>. Si vous regardez l'évolution des ventes du mois de janvier, vous soihaitez commencer par le 1er janvier, puis le 2 janvier, puis le 3 janvier, etc.</p>
                    <p>Il faut donc que vos données soient initialement triées afin que vous puissiez voir leur évolution dans le temps. Contrairement aux autres données, si celles-ci ne sont pas triées, elles ne sont pas vraiment exploitables. Contrairement aux autres données, si celles-ci ne sont pas triées, elles ne sont pas vraiment exploitables, car ce que nous recherchons dans ce genre d'analyse, c'est <span class="em">l'évolution dans le temps</span> des données.</p>
                    <p>Maintenant que nous avons transformé nos données temporelles, nous allons pouvoir les exploiter plus facilement.</p>
                    <p>Pour commencer, nous allons faire un premier graphique à partir d'un <span class="em">tableau croisé dynamique</span> (TCD pour les intimes). L'avantage du TCD, c'est qu'il permet d'agréger les données par jour.</p>
                    <p>En effet, si nous regardons nos données, nous allons nous apercevoir que pour le 2 janvier, nous avons eu 20 ventes. Nous, nous souhaitons n'avoir qu'une seule donnée pour ce jour-là et pas 20 données. Nous pouvons alors choisir la façon de les agréger en utilisant par exemple une somme, une moyenne, un minimum, une médiane, le nombre de transactions, etc. Dans notre cas, nous allons choisir dans un premier temps de regarder la moyenne des valeurs foncières par jour. Je vous explique ci-dessous comment faire un TCD en affichant les jours et la moyenne des valeurs foncières.</p>
                    <p>Pour ce faire, nous allons commencer par sélectionner l'ensemble du data set, puis nous allons aller dans "Insertion", cliquer sur "Tableau croisé dynamique" et faire "OK" pour le pmettre dans une nouvelle feuille de calcul.</p>
                    <p>Dans cette nouvelle feuille, nous allons créer notre TCD en utilisant les dates de mutation que nous souhaitons voir.</p>
                    <p>On va ensuite utiliser la valeur foncière que nous allons paramétrer pour afficher la moyenne.</p>
                    <p>Nous allons ensuite ouvrir l'ensemble de notre TCD afin d'avoir toutes les valeurs, puis je vais venir supprimer la partie jour parce que je voudrais avoir, en lecture directe, la vraie date.</p>
                    <p>À partir de là, on voit qu'on a un TCD qui contient l'ensemble de nos données moyennes de vente par jour à Paris.</p>
                    <p>Il nous reste simplement à venir cliquer sur "Graphique croisé dynamique", puis à choisir une courbe et faire "OK".</p>
                    <p>On se retrouve maintenant avec un graphique croisé dynamique qui a été généré en quelques clics par nous-mêmes, puis on a juste besoin de potentiellement écrire un morceau de code, si un jour, on venait à changer les valeurs, pour mettre à jour notre TCD.</p>
                    <p>Donc, ça vous montre une première série temporelle avec les jours, auxquels nous avons ajouté les mois afin de mieux découper l'analyse.</p>
                    <p>Nous pouvons voir que cette moyenne oscille le plus souvent entre 40000€ et 800000€. Nous notons égalemnt de gros pics à 1,4 million et des minimums autour des 100000 à 200000€. Ce graphique nous montre les transactions moyennes sur Paris par jour :</p>
                    <figure>
                        <img src="../images/analyse_temporelle_moyenne_valeurs_foncieres_jour_Excel.png" alt="">
                        <figcaption>Analyse temporelle de la moyenne des valeurs foncières par jour dans Excel</figcaption>
                    </figure>
                    <p>Nous pouvons retirer la notion de jour pour avoir un graphique plus lisible avec seulement la valeur foncière moyenne par mois.</p>
                    <figure>
                        <img src="../images/analyse_temporelle_moyenne_valeurs_foncieres_mois_Excel.png" alt="">
                        <figcaption>Analyse temporelle de la moyenne des valeurs foncières par mois dans Excel</figcaption>
                    </figure>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Les deux graphiques utilisent les mêmes données, à savoir la moyenne des valeurs foncières. Dans un cas, cela nous permet de voir les variations qu'il peut y avoir avec le premier graphique, alors que le deuxième, plus simple, nous permet de mieux comprendre les tendances.</p>
                    </div>
                    <h3>Maîtrisez le concept de moyenne mobile :</h3>
                    <p>Nous avons vu précedemment comment faire une analyse temporelle. Cependant, il arrive parfois que cette analyse ne soit pas suffisante pour comprendre facilement nos données.</p>
                    <p>Nous allons reprendre notre exemple, mais, cette fois, à la pla place de la moyenne des valeurs foncières par jour, nous allons mettre le nombre total de transactions par jour.</p>
                    <figure>
                        <img src="../images/repretation_nombre_actes_achat_jour_Paris_Excel.png" alt="">
                        <figcaption>Représentation du nombre d'actes d'achat par jour à Paris</figcaption>
                    </figure>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Contrairement au premier graphique, celui-là est plus compliqué à comprendre. On peut dire que dans le graphique nos valeurs vont de 20 à 80 avec des maximums à plus de 100 et des minimums proches de 0. Il n'y a pas de tendance claire qui se dégage de ce graphique.</p>
                    </div>
                    <p>Nous observons cependant qu'un <span class="em">pattern</span> revient tout le temps : un chiffre proche de 0, puis cela remonte doucement pour atteindre un maximum et cela redescend. Cette forme se répète de façon plus ou moins intense tout au long de notre graphique.</p>
                    <p>En regardant de plus près, nous voyons que les minimums tombent toujours les samedis, et il n'y a pas de données les dimanches. Si nous mettons un peu de contexte, nous savons que les notaires sont les plus souvent fermés le samedi ou ouverts le samedi matin, cela est donc logique qu'il y ait un peu de transactions. De même, tous les notaires sont fermés le dimanche, c'est ainsi normal que nous n'ayons pas de transactions.</p>
                    <p>Ajoutons à présent le numéro des semaines dans une nouvelle colonne avec la formule <span class="html">JOURSEM</span> (=JOURSEM("votre date"), "choix début"). Cette fonction permet de renvoyer le numéro du premier de la semaine. Ce premier jour est paramétrable avec le deuxième argument dans la formule. De mon côté, j'ai choisi le numéro 2 qui permet de renvoyer un 1 pour le lundi, un 2 pour le mardi, etc.</p>
                    <figure>
                        <img src="../images/ajout_colonne_jour_semaine_Excel.png" alt="">
                        <figcaption>Ajout de la colonne "Jour_semaine" dans Excel</figcaption>
                    </figure>
                    <p>Nous allons mainteant refaire le graphique, toujours à l'aide de notre TCD, mais cette fois en affichant seulemnt les numéros des semaines et les jours de la semaine.</p>
                    <figure>
                        <img src="../images/repretation_nombre_actes_achat_semaine_numero_jour_semaine_Excel.png" alt="">
                        <figcaption>Représentation du nombre d'actes d'achat par semaine et numéro du jour de la semaine</figcaption>
                    </figure>
                    <p>Nous voyons très bien dans ce cas qu'il y a une saisonnalité dans nos données, car le schéma se répète chaque semaine.</p>
                    <p>Ce n'est pas mal cet exemple, mais vous ne savez pas vraiment où on veut en venir. Nous y arrivons, je peux vous demander maintenant de me dire ce que vous pensez de cette courbe et quelle est sa tendance, mais, personnellement, j'ai du mal visuellement à savoir ce qu'il se passe.</p>
                    <p>Il existe une méthode pour lisser les courbes qui s'appelle la <span class="em">moyenne mobile</span>. Je vous laisse me suivre dans les explications ci-dessous pour la création de cette moyenne :</p>
                    <p>Pour commencer, on va toujours récupérer notre dataset classique dans lequel nous allons toujours créer un TCD.</p>
                    <p>Cette fois, nous allons utiliser les semaines et les jours de la semaine en lignes et utiliser la clé que nous allons passer en nombres afin de visualiser dans le TCD, ici, le nombre de transactions qui ont été faites par jour de la semaine et donc par semaine.</p>
                    <p>Je vais mettre ce graphique croisé dynamique en courbe. Ce que j'observe de loin, c'est que ma courbe a l'air d'avoir une certaine forme qui se répète un petit peu tout le temps.</p>
                    <p>Pour essayer de voir ça d'un détail, je vais venir filtrer sur des mois. Je vais prendre par exemple deux mois en particulier, on va prendre janvier et février. Là, c'est assez flagrant, on voit facilement que notre courbe commencer par augmenter sur les premiers jours de la semaine et vient s'écraser sur le sixième jour de la semaine.</p>
                    <p>Le problème, c'est que cette courbe, à la lecture, elle est difficile de savoir si je suis en train d'augmenter le nombre de ventes ou si je reste stable.</p>
                    <p>Pour essayer de mieux comprendre ça, on utilise des moyennes mobiles. Pour créer une moyenne mobile, on vient "Ajouter une courbe de tendance" et on vient cliquer sur "Moyenne mobile", ici.</p>
                    <p>On voit qu'on a une période. La période qu'on doit paramétrer ici correspond à la périodicité de notre phénomène. Comme c'est tous les six jours, on va mettre la périodicité à la valeur "6".</p>
                    <p>Et qu'est-ce que nous avons ? QUand on met une période à 6, on voit que notre courbe se lisse énormément.</p>
                    <p>On a donc une saisonnalité sur notre jeu de données, une forme qui revient tout le temps, tous les six jours.</p>
                    <p>Dans notre exemple, nous avons fait une moyenne mobile visuelle sur un graphique. Nous aurions également pu fabriquer nous-mêmes cette moyenne mobile avec la formule <span class="html">MOYENNE</span>. Chaque jour, vous allez faire la moyenne des six derniers jours. Alors, vous allez me demander pourquoi nous ne faisons pas la moyenne des sept derniers jours, vu que c'est une récurrence sur chaque semaine. Car il n'y a pas de données pour le dimanche, la ligne n'existe pas, donc je ne peux pas compter ce jour-là.</p>
                    <h3>Effectuez une prévision temporelle dans Excel :</h3>
                    <p>Maintenant que nous avons analysé en détail notre série temporelle, nous souhaitons faire une <span class="em">modélisation</span>. Nous désirons faire une <span class="em">prévision</span> sur les trois prochains mois du nombre de transactions qu'il va y avoir à Paris.</p>
                    <p>Pour cela, nous allons utiliser les mêmes données, à savoir, le nombre de transactions par jour. Il y a dans Excel un module de prévision directement intégré, que vous pouvez retrouver en allant dans "Données", puis en cliquant sur "Feuille de prévision". Je vous laisse me rejoindre les explications suivantes pour que nous paramétrions ensemble cette prévision :</p>
                    <p>Pour ce faire, on va commencer par remodeler nos données en faisant un TCD. Nous allons utiliser la date, avec la vraie date cette fois, puis nous allons compter le nombre de clés. À l'écran sera affiché un TCD contenant d'une part les date et de l'autre le nombre de clés.</p>
                    <p>On crée le graphique croisé dynamique et là, on voit le nombre de ventes par jour sur notre graphique avec pas mal de ventes sur les deux premiers mois de l'année, moins de ventes au mois de mars et une reprise du nombre de ventes.</p>
                    <p>Ce qu'on veut faire, c'est prédire ce qui va se passer potentiellement après. Nous allons choisir toutes nos données, sans le total général, puis on va dans "Données", "Feuille de prévision".</p>
                    <p>On vot que nous avons notre prévision qui a été faite en rouge sur le côté droit de la feuille.</p>
                    <p>Nous, on veut une fin de prévision au 31/07/2023, un début de prévision bien au 01/07, un intervalle de confiance à 95%, le caractère saisonnier, je préfère le maintenir à bien 7 mais moi-même, la plage de chronologie et la plage de valeur sont les bonnes plages, ce sont les plages A et B et on clique sur "Créer".</p>
                    <p>On voit maintenant qu'on a notre graphique avec la prévision qui a été faite du nombre de transactions qu'on pourrait théoriquement venir faire sur le mois de juillet.</p>
                    <p>On va vouloir maintenant lancer automatiquement ce genre d'analyse. On va repasser dans notre code et dans notre code, on a la fonction <span class="html">CreateForecastSheet</span>, on va venir lui spécifier les feuilles.</p>
<pre><code>Sub prevision()

ActiveWorkbook.CreateForecastSheet Timeline:Sheets("Feuil5").Range( _
    "A4:A159"), Values:=Sheets("Feuil5").Range("B4:B159"), ForecastEnd _
    :="31/07/2023", ConfInt:=0.95, Seasonality=7; ChartType:= _
    xlForecastChartTypeLine, Aggregation:=xlForecastChartTypeLine, _
    DataCompletion:=xlForecastDataCompletionInterpolate, ShowStatsTable:=False

End Sub</code></pre>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>La prévision n'est pas parfaite. Cela reste une prévision simple dans Excel sur des données qui ne varient pas énormément.</p>
                    </div>
                    <figure>
                        <img src="../images/prevision_nombre_transactions_mois_juillet_Excel.png" alt="">
                        <figcaption>Prévision du nombre de transactions pour le mois de juillet</figcaption>
                    </figure>
                    <p>Nous pouvons également lancer l'outil de simulation directement en VBA en utilisnt "Workbook.CreateForeCastSheet" avec les différents paramètres de cette fonction.</p>
<pre><code>ActiveWorkbook.CreateForecastSheet Timeline:Sheets("P2C2 graph").Range( _
    "A490:A645"), Values:=Sheets("P2C2 graph").Range("B490:B645"), ForecastEnd _
    :="30/09/2023", ConfInt:=0.95, Seasonality=7; ChartType:= _
    xlForecastChartTypeLine, Aggregation:=xlForecastAggregationAverage, _
    DataCompletion:=xlForecastDataCompletionInterpolate, ShowStatsTable:=False</code></pre>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p><a href="https://learn.microsoft.com/fr-fr/office/vba/api/excel.workbook.createforecastsheet" target="_blank">Voici un lien vers le site de Microsoft avec les différents paramètres de la fonction "CreateForecastSheet".</a></p>
                    </div>
                </article>
                <article>
                    <h2 id="analyse_bivariee">Réalisez une anlayse bivariée :</h2>
                    <p>Vous venez de voir comment comprendre et analyser une série temporelle.</p>
                    <p>Cherchons à présent à comprendre comment analyser :</p>
                    <ul>
                        <li>
                            <p>deux variables numériques;</p>
                        </li>
                        <li>
                            <p>une variable numérique avec une variable catégorielle;</p>
                        </li>
                        <li>
                            <p>deux variables catégorielles.</p>
                        </li>
                    </ul>
                    <p>Pour chaque anamyse, nous allons voir comment trouver la meilleure visualisation, et surtout comment nous pouvons réaliser un test statistique sur les données.</p>
                    <p>Un test statistique, mais pourquoi doit-on faire cela ? Pour plusieurs raisons, premièrement, car <span class="em">nous ne pouvons nous limiter à une seule analyse graphique</span> pour prendre une décision. Ensuite, il est toujours bien de pouvori <span class="em">confirmer une hypothèse</span> sur la base de notre test statistique.</p>
                    <h3>Analysez deux variables numériques :</h3>
                    <p>Comemnçons par les tests numériques. Quand nous parlons de test numérique, nous parlons de test sur deux variables <span class="Em">quantitatives</span>.</p>
                    <p>Pour ce test, nous allons nous intéresser au lien de dépendance entre les deux variables quantitatives :</p>
                    <ul>
                        <li>
                            <p>le nombre de pièces dans un appartement;</p>
                        </li>
                        <li>
                            <p>le prix des appartements au mètre carré.</p>
                        </li>
                    </ul>
                    <p>Transformons tout d'abord nos données pour créer un tableau exploitable. Pour ce faire, nous allons refaire un TCD avec en ligne la variable "Nombre de pièces principales" et en valeur la "Moyenne de la surface Carrez au mètre carré".</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p><a href="https://www.nexity.fr/guide-immobilier/conseils-achat/definir-son-projet/surface-privative-loi-carrez#:~:text=Le%20calcul%20de%20surface%20loi,m%20sont%20prises%20en%20compte." target="_blank">Si vous vous demander ce qu'est la surface Carrez, vous pouvez consulter ce site d'une agence immobilière.</a></p>
                    </div>
                    <p>Dans cette analyse, nous allons supprimer les valeurs extrêmes qui n'ont pas vraiment de sens, avec le nombre de pièces à 0 ainsi que le nombre de pièces égal à 10, car cela correspond à une surface Carrez de 15 m² (ce qui fait de petites pièces).</p>
                    <figure>
                        <img src="../images/TCD_affichant_moyenne_surface_Carrez_nombre_pieces_Excel.png" alt="">
                        <figcaption>TCD affichant la moyenne de la surface Carrez par nombre de pièces.</figcaption>
                    </figure>
                    <p>Maintenant que nous avons nos données, nous allons créer un nuage de points pour les visualiser plus facilement.</p>
                    <figure>
                        <img src="../images/nuage_points_montrant_moyenne_surface_Carrez_nombre_pieces_Excel.png" alt="">
                        <figcaption>Nuage de points montrant la moyenne de la surface Carrez par nombre de pièces</figcaption>
                    </figure>
                    <p>Comme nous pouvons le voir sur ce graphique, tous les points ont l'air d'être assez logiques, en suivant une courbe que nous pourrions tracer entre tous les points; c'est la courbe en pointillé que j'ai ajoutée. C'est une courbe de tendance linéaire que nous pouvons directement ajouter à notre graphique. Au lieu d'insérer une courbe de moyenne mobile comme précédemment, nous ajoutons plutôt une courbe linéaire.</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Cette courbe de tendance essaye de passer au maximum par tous les points ou au plus près de tous les points pour réduire au maximum l'écart entre les points.</p>
                    </div>
                    <p>Visuellement, nous pouvons supposer qu'il y a une <span class="em">corrélation entre les deux variables</span>. En effet, la surface moyenne augmente bien proportionnellement au nombre de pièces. Mais à quel point cette corrélation est-elle forte ? C'est exactement ce que nous souhaitons savoir.</p>
                    <p>Pour connaître la valeur de la corrélation, nous allons utiliser <span class="em">le test statistique de Pearson</span>. Ce test va nous donner la force de la corrélation entre les deux variables, sous la forme du coefficient de corrélation de Pearson. Le résultat de ce test peut aller de -1 jusqu'à 1 en passant bien sûr par le 0 :</p>
                    <ul>
                        <li>
                            <p>plus le chiffre est proche de 0 et moins il y a une corrélation;</p>
                        </li>
                        <li>
                            <p>plus le chiffre s'approche de 1 ou de -1 et plus la corrélation est forte.</p>
                        </li>
                    </ul>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>Il n'y a pas de consensus clair, mais nous pouvons dire qu'un coefficient de -0,5 ou +0,5 est une corrélation moyenne et, à partir de -0,75 ou +0,75, la corrélation est forte.</p>
                    </div>
                    <p>Je vous explique la réalisation du test et l'interprétation du résultat : le test de Pearson permet donc de confirmer ce que nous avions supposé visuellement. Nous avons fait ici ce test dans Excel, mais nous pouvons également le faire en VBA avec le code suivant, avec toujours "WorksheetFunction.Pearson" :</p>
<pre><code>Sub test_pearson()

Dim test_pearson As Single

test_pearson = WorksheetFunction.Pearson(Range("A4:A12"), Range("B4:B12"))
MsgBox ("le coefficient de Pearson est de : " & test_pearson)

End Sub</code></pre>
                    <h3>Analysez une variable catégorielle et une variable numérique :</h3>
                    <p>Vous comprenez maintenant l'importance d'un test statistique, il va vous permettre de <span class="em">confirmer une corrélation ou une hypothèse</span>. En fonction des variables, nous allons avoir des tests différents. Lançons-nous donc dans la réalisation d'un test statistique entre une variable numérique (quantitative) et une variable catégorielle (qualitative).</p>
                    <p>Pour ce faire, analysons la différence entre deux moyennes. Dans notre cas, nous allons faire l'analyse de la moyenne du prix des appartements et de celle des maisons. Ce test s'appelle le <span class="em">test t de Student</span>. Il permet de mesurer s'il y a une égalité entre les moyennes.</p>
                    <p>Pour commencer à faire ce test, nous avons besoin de modeler nos données afin d'avoir deux colonnes :</p>
                    <ul>
                        <li>
                            <p>une colonne avec le prix des appartements;</p>
                        </li>
                        <li>
                            <p>une colonne avec le prix des maisons.</p>
                        </li>
                    </ul>
                    <p>Je vous laisse choisir la technique que vous préférez : utiliser des filtres ou encore faire deux TCD différents. Pour ma part, j'ai fait des filtres et j'ai collé les données sur une nouvelle feuille :</p>
                    <figure>
                        <img src="../images/donnees_maisons_appartements_colonnes_differentes_Excel.png" alt="">
                        <figcaption>Données des maisons et appartements dans deux colonnes différentes</figcaption>
                    </figure>
                    <p>Mais pourquoi faut-il faire cela en fait ? Étant donné que nous souhaitons analyser les moyennes des deux jeux de données (appartement et maison), nous devons les séparer pour en faire deux variables qui ne sont pas dans le même groupe.</p>
                    <p>Avant de continuer, nous avons besoin de faire un point sur un nouvel indicateur que nous allons suivre : la <span class="em">variance</span>.</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>La variance, c'est une mesure de dispersion (c'est le carré de l'écart type). Pour faire très simple, nous pouvons dire que cela mesure la dispersion autour de la moyenne.</p>
                    </div>
                    <p>Le test t de Student a deux versions possibles :</p>
                    <ul>
                        <li>
                            <p>une version pour les variances égales;</p>
                        </li>
                        <li>
                            <p>une autre version pour les variances différentes.</p>
                        </li>
                    </ul>
                    <p>Dans notre cas, nous ne savons pas si les variances sont égales ou non pour le moment. C'est pourquoi nous allons réaliser un <span class="em">test préliminaire</span> pour comprendre nos jeux de données, il s'appelle le <span class="em">test f de Fisher</span>. Ce test a pour but de nous dire si les variances entre les deux de données sont égales ou non.</p>
                    <p>Pour réaliser ce test, ainsi que le test de Student associé, je vous propose de me suivre dans les explications suivantes.</p>
                    <p>Dans un premier temps, on va commencer par transformer nos données. Pour transformer nos données, comme d'habitude, nous allons utiliser un TCD dans lequel nous allons mettre les ID, puis les prix des maisons, et nous allons utilser le type local pour pouvoir splitter appartements ou maisons.</p>
                    <p>Dans un cas, je commence par copier tous mes appartements dans une nouvelle feuille. Puis je vais faire la même chose avec les maisons.Je vais garder tous les appartements et les maisons qui ont bien des prix (c'est-à-dire pas de valeurs vides).</p>
                    <p>Je vais maintenant faire un premier test de Fisher qui va me permettre de voir s'il y a une égalité ou non entre mes variances.</p>
                    <p>Pour faire ce test, ce sera le test F de Fisher, donc F.test, qui me demande les deux matrices de prix.</p>
                    <p>Plus mon résultat de mon test est proche de zéro, plus je peux rejeter l'hypothèse d'égalité des variances.</p>
                    <p>Donc, je peux conclure qu'il n'y a pas d'égalité entre mes deux variances.</p>
                    <p>Je vais maintenant passer au test de Student, avec toujours la même chose. La formule est <span class="em">=T.TEST</span> avec comme premiers arguments les deux matrices de prix. Je choisis une distribution unilatérale dans mon cas. Et le type, ça va être, est-ce que mes deux variances sont égales ? Donc, non, elles ne sont pas égales. Je vais prendre variances inégales à deux exemples.</p>
                    <p>Je vois que ce test est également très petit, très inférieur à 0,05. Donc, on peut rejeter le fait que nos moyennes soient égales et le test est très robuste vu que ce résultat de4,43 * 10<sup>-102</sup> est très, très inférieur à notre intervalle de confiance de 0,05. Il y a donc très peu de chance que ce soit aléatoire d'avoir ce résultat.</p>
                    <p>Le résultat de nos moyennes entre nos maisons et nos appartements sont bien des résultats différents entre les deux.</p>
                    <p>Vous savez mainteant comment faire un test statistique pour savoir si les deux moyennes (et variances) sont égales ou non.</p>
                    <figure>
                        <img src="../images/utilisation_tests_Student_Fisher_Excel.png" alt="">
                        <figcaption>L'utilisation des tests de Student et de Fisher</figcaption>
                    </figure>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p><a href="https://s3.eu-west-1.amazonaws.com/course.oc-static.com/courses/8017296/L%E2%80%99utilisation+des+tests+de+Student+et+de+Fisher.rtf" target="_blank">Description alternative de l'illustration sur l'utilisation des tests de Student et de Fisher.</a></p>
                    </div>
                    <h3>Analysez deux variables catégorielles :</h3>
                    <p>Nous avons vu ensemble comment nous pouvons analyser deux variables quantitatives, puis une variable quantitative et une variable qualitative. Il nous reste maintenant un dernier test pour deux variables quantitatives, c'est le test du khi2.</p>
                    <p>Pour réaliser ce test, nous allons analyser la variable "Nature de la mutation" et la variable "Type de bien" (qui peut avoir comme valeur "maison" ou "appartement"). Concernant la variable "nature de la mutation", elle peut avoir comme valeur "Échange", "Vente" et "Adjudication" (cente aux enchères).</p>
                    <p>Nous voulons savoir s'il y a une relation entre les deux variables. Nous allons faire <span class="em">un test du Khi2</span>. Pour commencer, nous devons faire ce qui s'appelle un <span class="em">tableau de contingence</span> avec les valeurs. Pour ce faire, vous devez faire un TCD avec le type de bien en ligne et la nature de mutation en colonne. Comme valeur, nous allons compter le nombre de clés.</p>
                    <figure>
                        <img src="../images/TCD_nombre_type_bien_fonction_natire_mutation_Excel.png" alt="">
                        <figcaption>TCD avec le nombre du type de bien en fonction de la nature de la mutation</figcaption>
                    </figure>
                    <div class="information">
                        <img src="../images/information.png" alt="" class="float_left">
                        <p>Excel n'étant pas spécialisé dans les tests statistiques, nous allons devoir passer par des étapes intermédiaires pour faire ce calcul.</p>
                    </div>
                    <p>Je vous laisse me suivre dans les explications suivantes pour voir la procédure et le résultat :</p>
                    <p>Nous allons voir ensemeble comment faire un test du khi2 dans Excel. Pour rappel, le test du khi2 vise à comprendre s'il y a une dépendance ou une indépendance entre nos variables. Dans notre cas, nous allons regarder les variables type local et nature mutation et essayer de comprendre s'il y a un lien de dépendance ou d'indépendance entre ces deux variables.</p>
                    <p>Pour commencer, nous allons toujours créer un TCD, dans lequel nous allons mettre notre nature mutation en colonne, notre type local en ligne et nous allons mettre le nombre de ventes. Nous avons donc un TCD qui nous donne le nombre, par exemple de ventes d'appartements ou de maisons, d'échanges et d'Adjudications.</p>
                    <p>Nous allons copier toutes ces informations, car nous allons devoir faire des modifications pour avoir les effectifs ovservés et les effectifs théoriques et ensuite appliquer notre test du khi2.</p>
                    <p>Les tests du khi2 dans Excel ne se font pas aussi facilement que les autres tests, il y a de la manipulation à faire avant.</p>
                    <p>Je copie donc mon tableau, je viens le coller en valeur et donc je vais venir dire ici que ça, c'est la partie Observé. Je nettpie mon tableau et donc ça, c'est le réel, c'est ce qui s'est réellement passé et ce que je vois dans mes données.</p>
                    <p>Je copie encore une fois tout ce tableau que je vais mettre en dessous et là, ça va être la partie Théorie.</p>
                    <p>Dans la partie Théorie, je supprime toutes mes valeurs et je viens calculer théoriquement ce que j'aurais dû avoir en pourcentage comme Adjudications, échanges et ventes.</p>
                    <p>Pour ce faire, ça, c'est un premier calcul assez simple, je prends les adjudications, que je divise par le nombre total que je bloque, et je vois rapidement que j'ai 6% d'adjudications, 4% d'échanges, 90% de ventes.</p>
                    <p>Moi, ce que je vais vouloir calculer maintenant, c'est, théoriquement, combien j'aurais dû avoir de ventes, par exemple, pour avoir ce chiffre-là.</p>
                    <p>Je vais venir calculer encore une fois en fonction de mon tableau que je viens de faire, de mes 6%, je vais venir multiplier par mon total général.</p>
                    <p>Qu'est-ce que je vois ici ? Je vois que, théoriquement, j'aurais dû avoir 277 adjudications quand, en réalité, j'en ai eu 280.</p>
                    <p>Je vais bloquertoutes ces formules et je vais passer cette formule juste à côté. Je vois que pareil, théoriquement, j'aurais dû avoir 176 échanges en théorie et 3949 ventes, quand j'en ai eu, par exemple, 3943.</p>
                    <p>Je vais faire la même chose en dessous en changeant légèrement ma formule.</p>
                    <p>Et voilà la théorie. Normalement, si tout va bien, la somme de tout ça doit toujours égal à 4844. Donc je vérifie, je vois que j'ai exacteemnt la même somme, mais j'ai des écarts entre les observations et la théorie.</p>
                    <p>Maintenant, je vais appliquer mes tests de khi2. Le premier test que je vais faire, c'est le test de comparaison entre les observations et la théorie. Donc ça sera un test qui va s'appeler <span class="html">=TEST.KHIDEUX</span> et donc je lui donne ma plage réelle de données et je lui donne ma plage attendue théorique. Là, j'obtiens un chiffre de 0,53. Je vais venir réutiliser ce chiffre dans un autre test statistique.</p>
                    <p>Donc, avant de faire ça, je vais calculer le degré de liberté. Le dégré de liberté est un calcul qui dit que c'est le nombre de colonnes, donc à savoir 3, vu que j'ai adjudications, échanges et ventes, moins 1, multiplié par le nombre de lignes, donc dans mon cas c'est 2, j'ai appartement et maison, fois 1. Et donc je tombe sur un degré de liberté de 2.</p>
                    <p>Maintenant, je viens calculer la valeur de mon khi2 avec la formule qui s'appelle <span class="html">=KHIDEUX.INVERSE</span>. Elle me demande la probabilité, qui est ce que j'ai calculé, 0.53, et le degré de lieberté que j'ai calculé. Et là, j'ai ma valeur de khi2.</p>
                    <p>La valeur de mon khi2, je vais la comparer à la valeur critique de mon khi2 à 5%, qui est, toujours la même chose, mon khi2 avec ma probabilité de 0.05 et avec mon degré de liberté. Je vois que ma valeur critique est de 5,99.</p>
                    <p>Je peux donc maintenant regarder les probabilités et me dire que si la valeur de mon khi, donc 1.25, est supérieure à ma valeur critique, 5.99, alors mes deux variables sont dépendantes. Si ce n'est pas le cas, alors mes deux variables sont bien indépendantes. C'est que je peux voir ici, c'est-à-dire que ma valeur de khi2 est inférieure à ma valeur critique à 5%. Donc je valide l'hypothèse H0 qui dit que les deux variables sont donc indépendantes.</p>
                    <p>Nous en avons enfin fini avec les tests statistiques de chaque type de variable.</p>
                    <p>Ah cool, ce n'était pas si compliqué en fait et il n'y a que trois tests ! Hum... Je vous arrête tout de suite sur ce dernier point, il n'y a pas que trois tests, bien au contraire. Il y a beaucoup d'autres tests statistiques ! C'est ce que nous allons brièvement voir.</p>
                    <h3>Allez plus loin grâce aux tests statistiques :</h3>
                    <p>Dans ce paragraphe, opubliez la vision d'Excel pour les tests statistiques. En effet, Excel n'est pas l'outil parfait pour faire des tests, même si certains tests sont désormais natifs dans l'outil. Le plus souvent, pour faire des tests statistiques, on a tendance à utiliser des logiciels dédiées à la statistique comme R ou encore Python. Si nous souhaitez pas utiliser un langage de programmation, vous pouvez utiliser une <span class="em">extension (payante) d'Excel</span> qui s'appelle <span class="em">XLSTAT</span>. Elle permet de réaliser une plus grande variété de tests avec une interface plus travaillée.</p>
                    <p>Mais pourquoi devez-vous faire d'autres tests ? Car, en réalité, il existe de nombreuses autres solutions à tous les tests. Si nous reprenons notre premier exemple, nous avons testé la corrélation de Pearson entre deux variables quantitatives. Mais ce test de corrélation peut se faire seulement avec des données qui suivent une loi normale.</p>
                    <div class="information">
                        <img src="../images/information.png" alt="Information" class="float_left">
                        <p>C'est la différence entre un test paramétrique (données qui suivent une loi normale) et non paramétrique (données qui ne suivent pas une loi normale).</p>
                    </div>
                    <p>Dans notre exemple, Pearson, c'est le test paramétrique, alors que Spearman est le test non paramétrique.</p>
                    <p>Pourquoi ne pas en avoir parlé avant ? Simplement car Excel ne permet pas de faire le test de Spearman, il est seulement possible d'utiliser le test de Pearson.</p>
                    <p>Voici la liste des tests statistiques qui sont intéressants à connaître si vous avez envie de vous former :</p>
                    <table class="tableBalises">
                        <thead>
                            <tr>
                                <th>Type de test</th>
                                <th>Version paramétrique</th>
                                <th>Version non paramétrique</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Test de corrélation entre deux variables quantitatives</td>
                                <td>Pearson</td>
                                <td>Spearman</td>
                            </tr>
                            <tr>
                                <td>Test d'association entre deux variables qualitatives</td>
                                <td>Khi2 avec tableau de contingence</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Comparer deux variances</td>
                                <td>Test f de Fisher</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Comparer deux moyennes</td>
                                <td>Test t de Student</td>
                                <td>Mann-Whitney</td>
                            </tr>
                            <tr>
                                <td>Comparer plusieurs moyennes</td>
                                <td>ANOVA</td>
                                <td>Kruskal-Wallis</td>
                            </tr>
                            <tr>
                                <td>Test de normalité</td>
                                <td>Shapiro-Wilk</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                    <p>Toutes les versions paramétriques des tests ci-dessus sont disponibles dans Excel (avec quelques variations comme le test de normalité).</p>
                </article>
                <article>
                    <h2 id="realisation_modelisation">Réalisez une modélisation :</h2>
                    <p>Nous allons voir maintenant comment nous pouvons utiliser la <span class="em">régression linéaire</span> pour faire des prévisions ou encore pour trouver des valeurs manquantes. Pour commencer, explorons les <span class="em">valeurs atypiques</span> de notre jeu de données avec la technique de l'<span class="em">@cart interquartile</span>.</p>
                    <h3>Effectuez des modélisations performantes :</h3>
                    <p>Nous allons faire une régression linéaire afin de <span class="em">prédire la valeur</span> d'un bien en fonction des mètres carrés des appartements pour Paris.</p>
                    <p>Commençons donc par extraire tous les appartements avec leurs valeurs foncières et les surfaces Carrez en faisant un filtre sur Paris.</p>
                    <figure>
                        <img src="../images/extraction_DB_appartements_valeurs_foncieres_surface_Carrez_Paris_Excel.png" alt="">
                        <figcaption>Extraction de la base de données de tous les appartements avec les valeurs foncières et la surface Carrez pour Paris</figcaption>
                    </figure>
                    <p>Nous avons donc un tableau de 4401 lignes. Créez un graphique sous forme de nuage de points afin de visualiser toutes les données.</p>
                    <figure>
                        <img src="../images/nuage_points_valeurs_foncieres_surface_Carrez_Paris_Excel.png" alt="">
                        <figcaption>Nuage de points sur les valeurs foncières par la surface Carrez à Paris</figcaption>
                    </figure>
                    <p>Comme nous pouvons le voir psur le graphique, il y a une grosse concentration des données à gauche, puis quelques points se baladent un peu partout sur notre nuage de points.</p>
                    <p>En calculant notre coefficient de Pearson (avec la formule Pearson), nous constatons un coefficient de 0,63. Il y a donc une corrélation postive entre le prix et la surface.</p>
                    <p>Le problème, c'est que les modèles n'aiment pas vraiment les valeurs dites aberrantes ou atypiques.</p>
                    <p>Prenons par exemple le cas de notre point tout en bas à droite du graphique. Nous pouvons voir que c'est un appartement qui fait 9 m² Carrez pour un prix de 9 millions d'euros. Pour nous représenter ce chiffre, nous pouvons essayer de calculer le prix au mètre carré pour ce bien. Il est de 1 million d'euros. Sans être un spécialiste, nous pouvons facilement nous dire que ce n'est pas vraiment le prix moyen dans la capitale française.</p>
                    <p>Ok, vous voyez où on veut en venir, mais vous n'êtes pas un spécialiste de l'immobilier parisien et vous n'avez pas envie de me questionner sur tous les appartements. Je suis complètement d'accord avec vous, et c'est pour cela qu'il existe plusieurs techniques pour trouver des valeurs aberrantes ou atypiques. Dans notre cas, nous allons utiliser l'écart interquartile, que nous avons vu précédemment dans ce cours.</p>
                    <p>Voici le code pour la colonne "Valeur foncière" :</p>
<pre><code>Sub ecart_interquartile()

Dim Q1 As Double
Dim Q3 As Double
Dim IQ As Double
Dim borne_basse As Double
Dim borne_haute As Double

Q1 = WorksheetFunction.Quartile(Range("B2:B4402"), 1)
Q3 = WorksheetFunction.Quartile(Range("B2:B4402"), 3)
IQ = Q3 - Q1

borne_basse = Round(Q1 - (1.5 * IQ), 0)
borne_haute = Round(Q3 + (1.5 * IQ), 0)

If borne_basse &lt; O Then
    borne_basse = 0
    MsgBox ("attention borne basse inférieure à 0")
    Range("$A$1:$C$4845").AutoFilter Field:=1, Criteria1:="&gt;" & borne_haute, _Operator:=xlAnd
    test = "&gt;" & borne_haute
End If

End Sub</code></pre>
                    <p>Nous voyons qu'il y a 137 valeurs qui sont considérées comme des valeurs aberrantes, nous allons les supprimer pour améliorer notre modélisation.</p>
                    <p>Je vous laisse faire la même chose pour la colonne "Surface Carrez", en supprimant également les données : normalement 11 valeurs.</p>
                    
                </article>
            <!-- fin de section -->
            </section>
        </main>
        <footer role="contentinfo">
            <div>
                <address>
                    Professeurs :
                    <a class="mail" href="mailto:olivier.choquet@vinci.be">Choquet Olivier</a>
                    <a class="mail" href="mailto:driss.vandenheede.techinfo@gmail.com">Vandenheede Driss</a>
                </address>
            </div>
            <div>
                <p>Si vous détectez une erreur, une faute d'orthographe, n'hésitez pas à envoyer un mail aux adresses juste à côté avec le nom de la page et l'erreur détectée.</p>
            </div>
            <div id="version">
                <p>Syllabus HTML</p>
                <p>Version 5.0</p>
            </div>
        </footer>
        <script src="../pre.js"></script>
    </body>
</html>