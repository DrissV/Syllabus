<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Choquet Olivier & Vandenheede Driss">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PHP, MVC et Laravel - Suppléments - e-Syllabus HTML5 et CSS3</title>
        <!-- une icône dans la barre du navigateur -->
        <link rel="icon" href="../images/favicon.png" type="image/png">
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <!-- liens d'évitement -->
        <ul class="a11y-nav">
            <li>
                <a href="#container">Passer directement au contenu</a>
            </li>
            <li>
                <a href="#menu">Accéder au menu secondaire de la page</a>
            </li>
            <li>
                <a href="#aside">Accéder aux liens utiles</a>
            </li>
        </ul>
        <!-- bannière et menu -->
        <header role="banner">
            <div class="logoTitle">
                <h1>Cours d'introduction au Web</h1>
                <h2>HTML5 et CSS3</h2>
            </div>
            <nav role="navigation" aria-label="Menu principal de navigation">
                <ul>
                    <li><a href="../index.html">Le cours</a></li>
                    <li><a href="../internet.html">Internet</a></li>
                    <li><a href="../html5.html">HTML5</a></li>
                    <li><a href="../css3.html">CSS3</a></li>
                    <li><a href="../methodologie.html">Méthodologie</a></li>
                    <li><a href="../lexique.html">Lexique</a></li>
                    <li><a href="../supplements.html" class="current">Suppléments</a></li>
                </ul>
            </nav>
        </header>
        <main id="container" role="main" tabindex="-1">
            <div id="menu">
                <!-- aside lié à la page et pas à l'article donc pas à l'intérieur de article -->
                <aside id="aside">
                    <p>Liens utiles :</p>
                    <ul>
                        <li><a href="http://www.w3.org/" target="_blank">W3C</a></li>
                        <li><a href="http://fr.openclassrooms.com/informatique/cours/apprenez-a-creer-votre-site-web-avec-html5-et-css3" target="_blank">Open Classroom</a></li>
                        <li><a href="http://www.w3.org/TR/html5/" target="_blank">Norme HTML5</a></li>
                        <li><a href="http://www.w3schools.com/" target="_blank">W3Schools</a></li>
                        <li><a href="http://www.alsacreations.com/" target="_blank">Alsa Création</a></li>
                        <li><a href="https://www.youtube.com/c/LeDesignerduWeb/videos">Le Designer du web</a></li>
                        <li><a href="supplements_symfony_laravel.html">Symfony et Laravel</a></li>
                    </ul>
                </aside>
                <nav role="navigation">
                    <ol>
                        <li><a href="../supplements.html">Retour au sommaire</a></li>
                        <li><a href="#intro_php">Introduction à PHP</a></li>
                        <li><a href="#template_HTML_PHP">Template HTML et PHP</a></li>
                        <li><a href="#elements_syntaxe_php">Éléments de syntaxe PHP</a></li>
                        <li><a href="#variables_php">Variables PHP</a></li>
                        <li><a href="#operateurs_php">Opérateurs PHP</a></li>
                        <li><a href="#tableaux_php">Tableaux PHP</a></li>
                        <li><a href="#structures_controle_repetitives_php">Structures conditionnelles et boucles PHP</a></li>
                        <li><a href="#inclusion_fichier_php">Inclusion de fichier PHP</a></li>
                        <li><a href="#fonctions_php">Fonctions PHP</a></li>
                        <li><a href="#classes_php">Classes PHP</a></li>
                        <li><a href="#expressions_regulieres_php">Expressions régulières en PHP</a></li>
                        <li><a href="#intro_mvc">Introduction à MVC</a></li>
                        <li><a href="#upload_fichiers">Upload de fichiers en PHP</a></li>
                        <li><a href="#dans_application_web_mvc">MVC en théorie</a></li>
                        <li><a href="#pratique_mvc_php">MVC en pratique avec PHP</a></li>
                        <li><a href="#frameworks_mvc">Frameworks MVC</a></li>
                        <li><a href="#phpmailer_mailjet">PHPMailer et Mailjet</a></li>
                        <li><a href="#intro_laravel">Introduction à Laravel</a></li>
                        <li><a href="#espaces_nom_laravel">Namespaces de Laravel</a></li>
                        <li><a href="#gestion_routes_laravel">Routes Laravel</a></li>
                        <li><a href="#gestion_controleurs_laravel">Contrôleurs Laravel</a></li>
                        <li><a href="#gestion_modeles_laravel">Modèles Laravel</a></li>
                        <li><a href="#gestion_vues_laravel">Vues Blade Laravel</a></li>
                        <li><a href="#exemple_concret_laravel">Exemple concret Laravel</a></li>
                    </ol>
                </nav>
            </div>
            <section id="mainSection">
                <article>
                    <h1>PHP, MVC et Laravel :</h1>
                </article>
                <article id="php">
                    <h2>Langage PHP :</h2>
                    <p><span class="em">PHP</span> est un langage de programmation par scripts principalement utilisé pour produire des pages Web dynamiques.</p>
                    <h3 id="intro_php">Indroduction au PHP :</h3>
                    <p>PHP, à l'origine "<span class="em">Personal Home Page</span>" mais depuis renommé en "<a href="https://www.php.net/manual/en/preface.php" class="em" target="_blank">PHP : Hypertext Preprocessor</a>" est un langage de scripts. Il est multi-usage, mais une de ses utilités principales est la possibilité d'intégrer des scripts PHP au sein de templates HTML afin de produire facilement des pages Web de façon dynamique.</p>
                    <p>Contrairement à JavaScript, où les pages Web sont <span class="em">modifiées</span> de façon dynamique du côté du client (c'est-à-dire du navigateur Internet de l'utilisateur), PHP permet de <span class="em">générer</span> des pages Web du côté du serveur. Le script PHP sera exécuté au niveau du serveur lors d'une requête HTTP, et c'est la page créée à l'issue de cette exécution qui est envoyée au client en réponse à sa requête.</p>
                    <h3 id="template_HTML_PHP">Template HTML et PHP :</h3>
                    <p>Un fichier PHP est un fichier texte, qui peut contenir de l'hypertexte de façon similaire à un fichier HTML.</p>
                    <p>Cependant, en outre, il peut contenir du code PHP, placé au sein de balises <span class="html">&lt;?php</span> (ouvrante) et <span class="html">?&gt;</span> (fermante). Lorsque le serveur charge la page, le code situé entre ces balises est exécuté, et ses valeurs de retours (s'il y en a) sont insérées dans la page à l'endroit où la balise PHP était placée.</p>
                    <p>Prenons par exemple le template suivant :</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;test&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;?php echo "Bonjour le monde ! &lt;br&gt;"; ?&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
                    <p>Une fois que le serveur charge cette page, le code PHP est exécuté. L'instruction <span class="html">echo</span> indique que le texte qui suit est inséré dans la page, et il s'agit de la seule instruction ici. Par conséquent, une fois le chargement terminé, le fichier HTML suivant est généré :</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;test&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        Bonjour le monde ! &lt;br&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
                    <p>Notez qu'il est aussi possible d'écrire un fichier PHP qui ne contient que du code PHP, sans HTML autour. Dans ces cas-là, il faut quand même ouvrir la balise <span class="html">&lt;?php</span>, mais on peut omettre la balise fermante <span class="html">?&gt;</span>.</p>
                    <h3 id="elements_syntaxe_php">Éléments de syntaxe PHP :</h3>
                    <p>La syntaxe de PHP est inspirée de langages tels que C, C++ et Java; vous pourrez sans doute la prendre en main sans trop de difficulté. Nous verrons ici les particularités du langage les plus utiles, mais nous vous encourageons comme toujours de consulter la documentation du langage pour plus d'informations : <a href="https://www.php.net/docs.php" target="_blank">https://www.php.net/docs.php</a>.</p>
                    <p>Notons pour commencer qu'à l'instar de Java, toute instruction en PHP se termine par un point-virgule.</p>
                    <h4 id="variables_php">Variables :</h4>
                    <p>PHP est un langage non typé, à l'instar de JavaScript. Cela signifie que le type des variables n'est pas déclaré lorsqu'une variable est créé. En outre, PHP offre certaines fonctionnalités par rapport aux variables qui permettront de rendre la génération des pages dynamiques particulièrement pratique.</p>
                    <p>PHP offre trois niveaux de visibilité pour ses variables :</p>
                    <ul>
                        <li>Les variables <span class="em">locales</span> sont visibles uniquement dans le bloc de code où elles sont déclarées. Le nom d'une variable locale commence par le symbole <span class="html">$</span>, par exemple <span class="html">$var</span>.</li>
                        <li>Les variables <span class="em">globales</span> sont visibles partout dans le code. Celles-ci peuvent être définies de deux façons : soit avec le mot-clé <span class="html">global</span>, par exemple <span class="html">global $var</span>, soit en l'ajoutant au tableau <span class="html">$GLOBALS</span> via <span class="html">$GLOBALS['var']</span>.</li>
                        <li>
                            <p>Les variables <span class="em">superglobales</span> sont des variables visibles partout dans le code, déjà prédéfinies par PHP, avec des rôles bien définis. Il s'agit également de tableaux, qui pourront recevoir des champs nommés. On notera en particulier :</p>
                            <ul>
                                <li>La variable <span class="html">$_GET</span>, qui contient les données passées au serveur durant une requête HTTP GET.</li>
                                <li>La variable <span class="html">$_POST</span>, qui contient les données passées au serveur durant une requête HTTP POST.</li>
                                <li>La variable <span class="html">$_FILES</span>, qui contient les fichiers passés par une requête HTTP POST.</li>
                                <li>Les cookies <span class="html">$_COOKIE</span> qui permet d'accéder aux cookies HTTP.</li>
                                <li>La variable de requête <span class="html">$_REQUEST</span>, qui combine par défaut <span class="html">$_GET</span>, <span class="html">$_POST</span> et <span class="html">$_COOKIE</span>.</li>
                                <li>La variable de session <span class="html">$_SESSION</span> qui persistent durant une session utilisateur donnée.</li>
                                <li>La variable d'environnement <span class="html">$_ENV</span> contient les informations de l'environnement dans lequel le programme s'exécute.</li>
                            </ul>
                            <p>Notons aussi que <span class="html">$GLOBALS</span> est en fait une variable superglobale qui reprend les variables globales définies dans le programme.</p>
                        </li>
                    </ul>
                    <p>Les variables superglobales, en particuliers, sont celles qui vont nous permettre de créer des pages. Par exemple, lors de l'envoi d'un formulaire HTML :</p>
<pre><code>&lt;form action="login.php" method="POST"&gt;
    &lt;input type="text" name="login" placeholder="Login"&gt;
    &lt;input type="submit" value="Se connecter"&gt;
&lt;/form&gt;</code></pre>
                    <p>L'action de la balise <span class="html">&lt;form&gt;</span> dicte l'URL qui est demandée au serveur. Dans ce cas-ci, il s'agit d'un fichier PHP; le serveur va alors exécuter le script contenu dans ce fichier :</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;Login&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;?php
            $login = $_POST['login'];
            echo "Bienvenue $login";
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
                    <p>La variable superglobale <span class="html">$_POST</span> récupère automatiquement les informations passées par le formulaire.</p>
                    <h5 id="controle_variables_php">Contrôle des variables :</h5>
                    <p>Il est possible d'effectuer des vérifications sur les variables :</p>
                    <ul>
                        <li>Vérification de l'existence : via la fonction <span class="html">isset()</span>.</li>
                        <li>
                            <p>Vérification de la vacuité (si la variable est vide) : via la fonction <span class="html">empty()</span>.</p>
                            <ul>
                                <li>Une variable peut <span class="em">exister</span> mais être <span class="em">vide</span> : par exemple un champ laissé vide dans un formulaire !</li>
                            </ul>
                        </li>
                        <li>Destruction manuelle de variable : via la méthode <span class="html">unset()</span>.</li>
                    </ul>
                    <h5 id="operateur$_variables_dyamiques">Opérateur $ et variables dynamiques :</h5>
                    <p>En dehors de la déclaration d'une variable, $ est un opérateur qui permet de retourner la valeur contenue dans la variable dont le nom est renseigné juste après le symbole $. Par exemple, dans <span class="em">login.php</span> ci-dessus, dans l'expression <span class="html">"Bienvenue $login"</span>; l'opérateur <span class="em">$login</span> est évalué en premier, et la valeur contenue dans cette variable est concaténée à la chaîne adjacente.</p>
                    <p>Un usage particulier de cette capacité en PHP est l'emploi de <span class="em">variables dynamiques</span> : si on souhaite à accéder à une variable dont le nom est lui-même contenu dans une autre variable, on pourra se servir de cet opérateur pour procéder rapidement :</p>
<pre><code>&lt;?php
    // appel d'une variable dynamique
    // affectation
    $cours = "AIN";
    $varx = "cours";
    // appel de la variable dynamique
    echo $$varx; # équivaut à echo $cours;
?&gt;</code></pre>
                    <h4 id="constantes_php">Constantes :</h4>
                    <p>La définition d'une constante se fait via la fonction <span class="html">define(name, value)</span>. Par exemple :</p>
<pre><code>&lt;?php
    define("WEB", "http://www.heb.be/esi");
    echo "Site internet : " . WEB . "&lt;br&gt;";
    // ou encore
    echo "Site internet : " . constant('WEB') . "&lt;br&gt;";
?&gt;</code></pre>
                    <p>Notez que l'accès la valeur de la constante se fait en notant son nom, <span class="em">sans</span> le précéder par l'opérateur $.</p>
                    <p>PHP possède en outre quelques constantes prédéfinies :</p>
                    <ul>
                        <li><span class="html">__FILE__</span> : nom du fichier actuellement exécuté.</li>
                        <li><span class="html">__LINE__</span> : n° de la ligne actuellement exécutée.</li>
                        <li><span class="html">PHP_VERSION</span> : chaîne de caractères donnant la version de PHP utilisée.</li>
                        <li><span class="html">PHP_OS</span> : nom du système d'exploitation.</li>
                    </ul>
                    <p>Pour rappel, le langage PHP est case sensitive. Pour déboguer, la fonction <span class="html">var_dump</span> affiche les informations détaillées d'une variable.</p>
                    <h4 id="operateurs_php">Opérateurs :</h4>
                    <p>Les opérateurs de PHP sont, pour la plupart, similaires à ceux que vous aurez rencontrés dans d'autreslangages comme Java. On notera par exemple :</p>
                    <ul>
                        <li>Les opérateurs arithmétiques (<span class="html">+</span>, <span class="html">-</span>, <span class="html">*</span>, <span class="html">/</span>, <span class="html">%</span>).</li>
                        <li>Les opérateurs d'incrémentation et de décrémentation (<span class="html">++</span> et <span class="html">--</span>).</li>
                        <li>L'opérateur d'assignation ($a <span class="html">=</span> 42;).</li>
                        <li>Les opérateurs de comparaison (<span class="html">==</span>, <span class="html">!=</span>, <span class="html">&gt;</span>, <span class="html">&gt;=</span>, <span class="html">&lt;</span>, <span class="html">&lt;=</span>).</li>
                        <li>Les opérateurs logiques (ET : <span class="html">&&</span> ou <span class="html">and</span>, OU : <span class="html">||</span> ou <span class="html">or</span>). Notez que la version texte de ces opérateurs a une priorité moindre.</li>
                        <li>L'opérateur de concaténation de chaînes, <span class="em">attention</span>, est différent de Java : il s'écrit avec <span class="html">.</span>. Par exemple : <span class="html">$a . $b</span> concatène les chaînes de caractères contenues dans les variables <span class="html">$a</span> et <span class="html">$b</span>.</li>
                        <li>L'accès à un caractère dans une chaîne de caractères se fait via les crochets, par exemple <span class="html">$str[0]</span> renvoie le premier caractère de la chaîne contenue dans <span class="html">$str</span>.</li>
                    </ul>
                    <p>L'instruction <span class="html">echo</span>, déjà mentionnée, place ce qui suit (typiquement une chaîne de caractères) dans la page HTML générée à la fin de l'exécution du script. La fonction <span class="html">print()</span> existe aussi, et effectue la même opération, mais renvoie également une valeur de retour (1 en cas de réussite), et peut donc être appelée au sein d'une expression.</p>
                    <h4 id="tableaux_php">Tableaux :</h4>
                    <p>Les tableaux en PHP combinent deux types de tableaux :</p>
                    <ul>
                        <li>Les tableaux <span class="em">scalaires</span>, où les éléments sont associés à des indices (nombres entiers).</li>
                        <li>Les tableaux <span class="em">associatifs</span>, où les éléments sont associés à des clés (typiquement des chaînes de caractères).</li>
                    </ul>
                    <p>Ces deux types être combinés au sein d'un même tableau. On notera en particulier que les variables superglobales sont toutes des tableaux.</p>
<pre><code>&lt;?php
    // tableau scalaire à une dimension (vecteur)
    $heb = array("esi", "isti", "defré");
    // tableau scalaire à deux dimensions (matrice)
    $mat[0][1] = 16;

    // tableau associatif à une dimension (vecteur)
    $tab["quatrieme"] = "ghi";
    // tableau associatif à plusieurs dimensions
    $user["admin"]["nom"] = "Simpson";
    $user["admin"]["prenom"] = "Bart";

    $mat[1]["nom"] = "Manfroid"; // combinaison d'indices associatif et numérique
?&gt;</code></pre>
                    <h4 id="structures_controle_repetitives_php">Structures de contrôle et répétitives :</h4>
                    <p>De même, les structures de contrôle et les boucles sont similaires à celles de Java :</p>
                    <ul>
                        <li>
                            <p>La condition <span class="html">if</span> :</p>
<pre><code>&lt;?php
    $a = 34;
    $b = 136;
    if ($a == $b) {
        echo "&lt;p&gt;\$a ($a) est égal à \$b ($b)";
        $c = 23;
    } elseif ($a &lt; $b) {
        echo "&lt;p&gt;\$a ($a) est plus petit que \$b ($b)";
    } else {
     echo "&lt;p&gt;\$a ($a) est plus grand que \$b ($b)";   
    }
?&gt;</code></pre>
                        </li>
                        <li>
                            <p>L'alternative à choix multiples <span class="html">switch</span> :</p>
<pre><code>&lt;?php
    $i = 2;
    switch ($i) {
        case 0:
            print '$i = 0';
            break;
        case 1:
            print '$i = 1';
            break;
        case 2:
            print '$i = 2';
            break;
        default:
            print '$i est très étrange';
    }
?&gt;</code></pre>
                        </li>
                        <li>
                            <p>La boucle "pour" <span class="html">for</span> :</p>
<pre><code>&lt;?php
    for ($i = 0; $i != 10; $i++) {
        print $i;
    }
?&gt;</code></pre>
                        </li>
                        <li>
                            <p>La boucle "pour chaque" <span class="html">foreach</span> :</p>
<pre><code>&lt;?php
    $arr = array(1, 2, 3, 4);
    foreach ($arr as &$value) {
        $value *= 2;
    }
?&gt;</code></pre>
                        </li>
                        <li>
                            <p>La boucle "tant que" <span class="html">while</span> :</p>
<pre><code>&lt;?php
    $i = 0;
    while ($i != 10) {
        print $i . "&lt;br&gt;";
        $i++;
    }
?&gt;</code></pre>
                        </li>
                        <li>
                            <p>La boucle "pour" <span class="html">faire - tant que</span> :</p>
<pre><code>&lt;?php
    $i = 0;
    do {
        print $i . "&lt;br&gt;";
    } while ($i != 0);
?&gt;</code></pre>
                        </li>
                    </ul>
                    <p>Certaines instructions permettent d'influencer le déroulement de conditions ou de boucles :</p>
                    <ul>
                        <li>L'instruction <span class="html">break;</span> permet de sortir d'une condition ou d'une boucle.</li>
                        <li>L'instruction <span class="html">continue;</span> permet de continuer.</li>
                    </ul>
                    <h4 id="inclusion_fichier_php">Inclusion d'un fichier :</h4>
                    <p>Les instructions PHP <span class="html">include</span> et <span class="html">require</span> vont nous permettre toutes deux d'inclurde des fichiers de code (ou plus exactement le contenu de ces fichiers) à l'intérieur d'autres fichiers de code.</p>
                    <p>Ces deux instructions sont très puissantes et vont s'avérer extrêmement utiles lors de la création d'un site web.</p>
                    <p>En effet, imaginons que vous vouliez créer un site personnel ou un site comme celui-ci. Sur votre site, il y a de fortes chances que l'en-tête, le menu et le pied de page soient identiques pour toutes les pages.</p>
                    <p>Jusqu'à présent, en HTML, nous étions obligé de réécrire le même code correspondant à l'en-tête, au menu et au pied de page sur chacune des pages de notre site.</p>
                    <p>Cela, en plus de ne pas être optimisé d'un point de vue performance, nous fait perdre beaucoup de temps et va poser de sérieux problèmes le jour où l'on souhaite modifier le texte dans notre pied de page par exemple pour tout notre site.</p>
                    <p>Plutôt que de réécrire tout le code relatif à ces différentes parties sur chacune de nospages, pourquoi ne pas plutôt enregistrer le code de notre menu dans un fichier séparé que l'on appellera par exemple <span class="em">menu.php</span>, et faire de même pour le code relatif à notre en-tête et à notre pied de page puis ensuite inclure directement ces fichiers sur chacune de nos pages ?</p>
                    <p>Nous allons pouvoir faire cela grâce aux instructions <span class="html">include</span> et <span class="html">require</span>.</p>
                    <p>Ainsi, nous n'avons plus qu'à écrire le code relatid à notre menu une bonne fois pour toutes et à l'inclure dans chaque page par exemple. Cela représente une considérable simplification pour la mainteance de notre code puisque nous n'avons qu'à modifier le code de notre menu dans le fichier <span class="em">menu.php</span> plutôt que de le modifier dans toutes les pages si nous avions copié-collé le code du menu dans chaque page.</p>
                    <p>Notez déjà que pour inclure un fichier dans un autre fichier, il faudra préciser son emplacement par rapport au fichier qui contient l'instruction <span class="html">include</span> ou <span class="html">require</span> de la même façon qu'on pourrait le faire pour faire un lien en HTML ou pour inclure une image en HTML.</p>
                    <p class="em">La seule et unique différence entre les instructions <span class="html">include</span> et <span class="html">require</span> va se situer dans la réponse du PHP dans le cas où le fichier ne peut pas être inclus pour une quelconque raison (fichier introuvable, indisponible, etc.).</p>
                    <p>Dans ce cas-là, si l'inclusion a été tentée avec <span class="html">include</span>, le PHP renverra un simple avertissement et le reste du script s'exécutera quand même tandis que si la même chose se produit avec <span class="html">require</span>, une erreur fatale sera retournée par PHP et l'exécution du script s'arrêtera immédiatement.</p>
                    <p>L'instuction <span class="html">require</span> est donc plus "stricte" que <span class="html">include</span>.</p>
                    <p>La différence entre les instructions <span class="html">include</span> et <span class="html">require</span> et leurs variantes <span class="html">include_once</span> et <span class="html">require_once</span> est qu'on va pouvoir inclure plusieurs fois un même fichier fichier avec <span class="html">include</span> et <span class="html">require</span> tandis qu'en utilisant <span class="html">include_once</span> et <span class="html">require_once</span> cela ne sera pas possible : un même fichier ne pourra être inclus qu'une seule fois dans un autre fichier.</p>
                    <p>Par exemple :</p>
<pre><code>&lt;?php
    $files = array('prem.php', 'deux.php', 'trois.php');
    for ($i = 0; $i &lt; count($files); $i++) {
        include $files[$i];
    }
?&gt;</code></pre>
                    <p>Ce fichier va charger et exécuter le contenu des fichiers <span class="em">prem.php</span>, <span class="em">deux.php</span> et <span class="em">trois.php</span>. Notez qu'en particulier, cela signifie que tous les <span class="em">echo</span> effectués dans ces fichiers seront appliqués, et toutes les définitions de fonctions ou classes dans ces fichiers seront désormais accessibles.</p>
                    <h4 id="fonctions_php">Fonctions :</h4>
                    <p>La définition et l'appel de fonctions utilise une syntaxe similaire à celle de JavaScript : le mot-clé <span class="html">function</span> permet de définir une nouvelle fonction, et l'appel se fait via le nom de la fonction suivi de parenthèses (contenant éventuellement les arguments de la fonction).</p>
<pre><code>&lt;?php
    // DÉFINITIONS DES Fonctions
    function entete($titre) {
        echo "&lt;html lang='fr'&gt;
                &lt;head&gt;
                    &lt;title&gt;$titre&lt;/title&gt;
                &lt;/head&gt;
                &lt;body&gt;";
    }

    function pied_de_page() {
        echo "&lt;hr&gt;
            &lt;/body&gt;
        &lt;/html&gt;";
    }

    // APPELS
    entete("inroduction à PHP");
    echo "&lt;h1&gt;Utilisation de fonctions&lt;/h1&gt;";
    pied_de_page();
?&gt;</code></pre>
                    <p>L'instruction <span class="html">return</span> permet de renvoyer une valeur de retour. Si on souhaite renvoyer plusieurs valeurs, on passera par un tableau. Par exemple :</p>
<pre><code>&lt;?php
    function addition ($nb1,$nb2) {
        $res = $nb1 + $nb2;
        return $res;
    }

    functin add_mult ($nb1, $nb2) {
        $res1 = $nb1 + $nb2;
        $res2 = $nb1 * $nb2;
        return array($res1, $res2);
    }

    $resultat = addition(8, 6);
    echo "la somme vaut : " . $resultat;

    $resultats = add_mult(8, 6);
    echo "la somme vaut : " . $resultats[0] . "&lt;br&gt;";
    echo "le produit vaut : " . $resultats[1] . "&lt;br&gt;";
?&gt;</code></pre>
                    <p>Il est aussi possible de renseigner des valeurs par défaut aux paramètres de vos fonctions. Faites attention à placer les arguments possédant des valeurs par défaut à la fin de vos en-têtes de fonction !</p>
<pre><code>&lt;?php
    // FONCTIONS avec valeurs par défaut  pour les arguments
    function entete($titre, $bgcolor = "red") {
        echo "&lt;html lang='fr'&gt;
                &lt;head&gt;
                    &lt;title&gt;$titre&lt;/title&gt;
                &lt;/head&gt;
                &lt;body bgcolor='$bgcolor'&gt;";
    }

    function pied_de_page($email = "info@he2b.be") {
        echo "&lt;hr&gt;Courriel : $email
            &lt;/body&gt;
        &lt;/html&gt;";
    }

    // APPELS
    entete("inroduction à PHP");
    echo "&lt;h1&gt;Utilisation de fonctions&lt;/h1&gt;";
    pied_de_page();
?&gt;</code></pre>
                    <h4 id="classes_php">Classes :</h4>
                    <p>PHP est un langage orienté objet : il est donc possible d'y définir des classes.</p>
                    <p>Les attributs sont définis comme des variables locales au sein d'une classe, et les méthodes comme des fonctions au sein de la classe également.</p>
<pre><code>&lt;?php
    class Dossier {
        // Attributs
        var $nom = null;
        var $fichiers = array();
        // Méthodes
        function Dossier ($valeur) {
            $this-&gt;nom = $valeur;
        }

        function ajouter_fichier ($nom_fichier) {
            $this-&gt;fichiers[] = $nom_fichier;
        }
    }
?&gt;</code></pre>
                    <p>Le constructeur de classe se note comme toute autre fonction, mais a pour nom le nom de la classe ou peut être utilisé par la fonction magique <span class="html">__construct()</span>. Notez aussi l'utilisation du mot-clé <span class="html">$this</span> pour faire référence à l'objet lui-même au sein de fonction, et de l'opérateur flèche <span class="html">-&gt;</span> pour accéder à un attribut ou appeler une méthode sur l'objet.</p>
                    <p>Pour créer un objet, on procèdera comme suit :</p>
<pre><code>&lt;?php
    $dossier = new Dossier("maison");
    $dossier-&gt;ajouter_fichier("cuisine");
?&gt;</code></pre>
                    <h3 id="fonctions_utiles_php">Quelques fonctions utiles :</h3>
                    <h4 id="manipulation_string">Manipulation de chaînes de caractères :</h4>
                    <p>Documentation complète : <a href="https://www.php.net/manual/fr/book.strings.php" target="_blank">https://www.php.net/manual/fr/book.strings.php</a>.</p>
                    <ul>
                        <li><span class="html">strlen(string)</span> : fournit la longueur de la chaîne.</li>
                        <li>
                            <p>Gestion de la casse :</p>
                            <ul>
                                <li><span class="html">strtolower(string)</span> : met les caractères en minuscule.</li>
                                <li><span class="html">strtoupper(string)</span> : met les caractères en majuscule.</li>
                                <li><span class="html">ucfirst(string)</span> : met le premier caractère en majuscule.</li>
                            </ul>
                        </li>
                        <li>
                            <p>Gestion des sous-chaînes :</p>
                            <ul>
                                <li><span class="html">substr(string, start, length)</span> : extrait une prtie d'une chaîne de caractères.</li>
                                <li><span class="html">substr_count(source, pattern)</span> : compte le nombre d'occurences de la sous-chaîne <span class="html">pattern</span> dans la chaîne <span class="html">source</span>.</li>
                                <li><span class="html">strrchr(string, pattern)</span> : extrait la fin de la chaîne <span class="html">string</span>, à partir de la dernière occurence de la sous-chaîne <span class="html">pattern</span>.</li>
                                <li><span class="html">str_replace(pattern, replacement, source)</span> : remplace toutes les occurences de "<span class="html">pattern</span>" trouvées dans la "<span class="html">source</span>" par la chaîne "<span class="html">replacement</span>.</li>
                                <li><span class="html">trim(string)</span> : retourne une string sans les espaces blancs (<span class="html">"\n"</span>, <span class="html">"\r"</span>, <span class="html">"\t"</span>, <span class="html">"\v"</span>, <span class="html">"\0"</span>, <span class="html">" "</span>) en début et en fin de chaîne.</li>
                                <li><span class="html">ltrim(string)</span> : retourne une string sans les espaces blancs de début de chaîne.</li>
                                <li><span class="html">rtrim(string)</span> : retourne une string sans les espaces blancs de fin de chaîne.</li>
                                <li><span class="html">explode(separator, string)</span> : scinde une chaîne sur base d'un séparateur et retourne un tableau contenant les éléments résultant de la division.</li>
                                <li><span class="html">implode(join, array)</span> :  retourne une chaîne formée par la concaténation des chaînes présentes dans <span class="html">array</span>, spéarées par la sous-chaîne présente dans <span class="html">join</span>.</li>
                                <li><span class="html">split(pattern, join)</span> : scinde une chaîne aux occurences de la sous-chaîne <span class="html">patern</span> et renvoie un tableau contenant les chaînes ainsi formées.</li>
                            </ul>
                        </li>
                        <li>
                            <p>Suppression de texte indésirable :</p>
                            <ul>
                                <li><span class="html">strip_tags(string [, allowable_tages])</span> : supprime les balises HTML et PHP dans une chaîne.</li>
                                <li><span class="html">stripslashes(string)</span> : supprime les caractères \ dans une chaîne de caractères.</li>
                            </ul>
                        </li>
                        <li>
                            <p>Encodage pour URL :</p>
                            <ul>
                                <li><span class="html">urlencode(string)</span> : convertit une chaîne selon les règles d'encodage d'URL.</li>
                                <li><span class="html">rawurlencode(string)</span> : convertit une chaîne en URL selon la norme IETF [RFC1738] (espace en "%20" au lieu de "+", utile lors d'utilisation d'URL avec le protocole FTP par exemple).</li>
                                <li><span class="html">urldecode(string)</span> : décode une chaîne selon les règles d'encodage d'URL.</li>
                                <li><span class="html">htmlspecialchars(string)</span> : convertit les caractères spéciaux("&", "&quot;", "&lt;", "&gt;") en équivalent HTML ("&amp;amp;", "&amp;quot;", "&amp;lt;", "&amp;gt;").</li>
                            </ul>
                        </li>
                        <li>
                            <p>Encodage pour HTML :</p>
                            <ul>
                                <li><span class="html">nl2br(string)</span> : convertit à la ligne en retour de chariot HTML (&lt;br&gt;).</li>
                                <li><span class="html">htmlentities(string)</span> : convertit les caractères significatifs en HTML.</li>
                            </ul>
                        </li>
                    </ul>
                    <h4 id="manipulation_tableaux_php">Manipulation de tableaux :</h4>
                    <p>Document complète : <a href="https://www.php.net/manual/fr/book.array.php" target="_blank">https://www.php.net/manual/fr/book.array.php</a>.</p>
                    <ul>
                        <li><span class="html">array_walk($var, fct)</span> : applique la fonction <span class="html">fct</span> à chaque élément du tableau <span class="html">$var</span>.</li>
                        <li><span class="html">list(var1, var2, ...)</span> : permet d'assigner une série de variables à partir d'un tableau : <span class="html">$info = list($drink, $color, $power);</span>.</li>
                        <li><span class="html">each(array)</span> : retourne chaque paire clé/valeur d'un tableau d'assignation.</li>
                        <li><span class="html">sizeof(array)</span> : retourne le nombre d'éléments du tableau.</li>
                        <li><span class="html">is_array(var)</span> : teste si une variable est de type tableau.</li>
                    </ul>
                    <h4 id="manipulation_repertoires_fichiers_php">Manipulation de répertoires et de fichiers :</h4>
                    <p>Documentation complète : <a href="https://www.php.net/manual/fr/refs.fileprocess.file.php" target="_blank">https://www.php.net/manual/fr/refs.fileprocess.file.php</a>.</p>
                    <ul>
                        <li>
                            <p>Navigation :</p>
                            <ul>
                                <li><span class="html">opendir(dir)</span> : ouvre un répertoire et récupère un pointeur.</li>
                                <li><span class="html">readdir(dir_handle)</span> : retourne le nom de fichier suivant dans le répertoire pointé par <span class="html">dir_handle</span> (obtenu via <span class="html">opendir</span>).</li>
                                <li><span class="html">rewinddir(dir_handle)</span> : se remplace au début du répertoire <span class="html">dir_handle</span>.</li>
                                <li><span class="html">closedir(dir_handle)</span> : ferme le répertoire.</li>
                                <li><span class="html">is_dir(filename)</span> : vérifie si la cible est un répertoire.</li>
                                <li><span class="html">chdir()</span> : change le dossier courant de PHP.</li>
                            </ul>
                        </li>
                        <li>
                            <p>Manipulation de fichier :</p>
                            <ul>
                                <li><span class="html">copy("anc_fich", "nouv_fich")</span> : copier un fichier.</li>
                                <li><span class="html">unlink(filename)</span> : supprimer le fichier.</li>
                                <li><span class="html">filesize(filename)</span> : retourner la taille d'un fichier en octets.</li>
                                <li><span class="html">file_exists(filename)</span> : teste si un fichier existe.</li>
                                <li><span class="html">tempnam(dir, prefix)</span> : crée un fichier et lui donne un nom unique.</li>
                                <li><span class="html">flock(file_hanfle, operation_type)</span> : permet un verrou sur un fichier en cas d'accès concurrents.</li>
                            </ul>
                        </li>
                        <li>
                            <p>Ouverture et modification de fichier :</p>
                            <ul>
                                <li><span class="html">fopen(filename, mode)</span> : ouvre un fichier et retourne  un pointeur sur ce fichier.</li>
                                <li><span class="html">fclose(file_handle)</span> : ferme le pointeur sur le fichier ouvert.</li>
                                <li><span class="html">fwrite(file_handle, string[, length])</span> : écrit dans un fichier.</li>
                                <li><span class="html">fread(file_handle, length)</span> : lit un fichier.</li>
                                <li><span class="html">fgets(file_handle, length)</span> : lit la ligne courante d'un fichier.</li>
                                <li><span class="html">file(filename)</span> : renvoie le contenu d'un fichier sous forme d'un tableau.</li>
                                <li><span class="html">readfile(filename)</span> : récupère le contenu d'un fichier et l'envoie sur la sortie standard.</li>
                                <li><span class="html">feof(file_handle)</span> : teste si la fin du fichier a été atteinte.</li>
                                <li><span class="html">topfile()</span> : crée un fichier temporaire et l'ouvre en mode écriture.</li>
                            </ul>
                        </li>
                    </ul>
                    <h4 id="expressions_regulieres_php">Expressions régulières :</h4>
                    <p>Documentation complète : <a href="https://www.php.net/manual/fr/book.regex.php" target="_blank">https://www.php.net/manual/fr/book.regex.php</a>.</p>
                    <p>Les expressions régulières permettent de représenter une catégorie de chaînes de caractères qui correspondent toutes au même modèle, afin de faire des manipulations plus possées.</p>
                    <ul>
                        <li><span class="html">ereg(pattern, string[, regs])</span> : cherche le modèle <span class="html">pattern</span> dans la chaîne et place éventuellementle résultat de recherche dans le tableau <span class="html">regs</span>.</li>
                        <li><span class="html">eregi(pattern, string[, regs])</span> : idem, mais insensible à la casse.</li>
                        <li><span class="html">ereg_replace(pattern, replacement, string)</span> : cherche le modèle <span class="html">pattern</span> dans la chaîne et les remplace par <span class="html">replacement</span>.</li>
                        <li><span class="html">eregi_replace(pattern, replacement, string)</span> : idem, mais insensible à la casse.</li>
                    </ul>
                    <p>Pour avoir la présentation du cours de PHP en PowerPoint, vous les obtenir en cliquant sur les liens ci-dessous :</p>
                    <p><a href="../files/4-PHP.pptx">PHP</a></p>
                    <p><a href="../files/5-Les_formulaires_PHP.pptx">Les formulaires PHP (PowerPoint)</a></p>
                    <p><a href="../files/6-Cookies_et_Sessions_PHP.pptx">Cookies et Sessions (PowerPoint)</a></p>
                    <p><a href="../files/7-PHP-PDO.ppt">PHP PDO (PowerPoint)</a></p>
                    <p><a href="../files/8-PHP-systeme-de-fichiers.ppt">PHP - Système de fichiers (PowerPoint)</a></p>
                </article>
                <article>
                    <h2 id="upload_fichiers">Upload de fichiers en PHP :</h2>
                    <h3>Introduction :</h3>
                    <p>Toutes les fonctions WEB d'upload de fichiers sont potentiellement vulnérables. L'expérience nous montre que régulièrement ces fonctions ne sont pas corresctement sécurisées, particulièrement dans certains espaces d'administration ou les développeurs sont plus laxistes avec la sécurité.</p>
                    <p>Ces failles sont pourtant très dangereuses et systématiquement testées par les attaquants désireux de prendre le contrôle du site Internet cible.</p>
                    <p>Dans cet article, nous aborderons plusieurs exemples de vulnérabilités afin de comprendre comment un auditeur ou pirate pourra les contourner, puis nous terminerons par un exemple de code propre et sécurisé.</p>
                    <p>Les risques liés aux failles d'upload sont :</p>
                    <ul>
                        <li>
                            <p>Upload d'une backdoor (porte dérobée).</p>
                        </li>
                        <li>
                            <p>Écrasement de fichiers.</p>
                        </li>
                    </ul>
                    <h3>L'upload de fichiers :</h3>
                    <p>Voici un exemple de code HTML et PHP d'upload de fichiers sans restrictions pour que les néophytes comprennent le principe. Notez qu'il faudra les droits en écriture pour que l'on puisse importer des fichiers dans le dossier "images".</p>
                    <p>Pour télécharger des fichiers sur le serveur, il vous faut un formulaire munis d'un champ de type file. Vous devez rajouter l'attribut <span class="html">enctype</span> ayant pour valeur : "<span class="html">multipart/form-data</span>", ce qui veut dire que votre formulaire va pouvoir transférer des données de type binaire.</p>
<pre><code>&lt;!-- Le type d'encodage des données enctype doit être spécifié --&gt;
&lt;form enctype="multipart/form-data" action="URL à préciser" method="post"&gt;
    &lt;!-- MAX_FILE_SIZE doit précéder le champ input de type file --&gt;
    &lt;input type="hidden" name="MAX_FILE_SIZE" value="1000000"&gt;
    &lt;label&gt;Votre fichier :&lt;/label&gt;
    &lt;!-- Le name est à bien définir, il détermine l'indice dans le tableau associatif $_FILES --&gt;
    &lt;input type="file" name="mon_fichier"&gt;&lt;br&gt;
    &lt;input type="submit" value="Envoyer"&gt;
&lt;/form&gt;</code></pre>
                    <p>Pour récupérer votre, fichier, vous avez à votre disposition le tableau superglobal <span class="html">$_FILES</span> qui aura plusieurs entrées :</p>
                    <ul>
                        <li>
                            <p><span class="html">$_FILES['mon_fichier']['tmp_name']</span> : le nom temporaire du fihcier sur le serveur.</p>
                        </li>
                        <li>
                            <p><span class="html">$_FILES['mon_fichier']['name']</span> : le nom original du fichier sur la machine cliente.</p>
                        </li>
                        <li>
                            <p><span class="html">$_FILES['mon_fichier']['type']</span> : le type MIME du fichier.</p>
                        </li>
                        <li>
                            <p><span class="html">$_FILES['mon_fichier']['size']</span> : la taille du fichier.</p>
                        </li>
                    </ul>
                    <p>Avant de vouloir sauvegarder le fichier téléchargé il faut vérifier son envoi.</p>
                    <h3>Gestion des erreurs d'envoi :</h3>
                    <p>Les restrictions côté client sont les plus facile à contourner, on peut les trouver en HTML ou en JavaScript.</p>
                    <p>Vous pouvez gérer les erreurs de chargement avec <span class="html">$_FILES['mon_fichier']['error']</span> :</p>
<pre><code>&lt;?php

    if ($_FILES['nom_fichier']['error']) {
        switch ($_FILES['nom_fichier']['error']) {
            case 1 : // UPLOAD_ERR_INI_SIZE
                echo "Le fichier dépasse la limite autorisée par le serveur (fichier php.ini) !";
                break;
            case 2 : // UPLOAD_ERR_FORM_SIZE
                echo "Le fichier dépasse la limite autorisée dans le formulaire HTML !";
                break;
            case 3 : // UPLOAD_ERR_PARTIAL
                echo "L'envoi du fichier a été interrompu pendant le transfert !";
                break;
            case 4 : // UPLOAD_ERR_NO_FILE
                echo "Le fichier que vous avez envoyé a une taille nulle !";
                break;
        }
    }  else {
        // $_FILES['nom_fichier']['error'] vaut 0 soit UPLOAD_ERR_OK
        // ce qui signifie qu'il n'y a eu aucune erreur
    }

?&gt;</code></pre>
                    <p>Explication :</p>
                    <ul>
                        <li>
                            <p>La première erreur "<span class="html">UPLOAD_ERR_INI_SIZE</span>" concerne la taille maximum autorisé par votre serveur, cette dépend donc de votre hébergement.</p>
                        </li>
                        <li>
                            <p>La deuxième erreur "<span class="html">UPLOAD_ERR_FORM_SIZE</span>" concerne la valeur maximum autorisée par le forumaire, elle est définie par le champs de type <span class="em">hidden</span> dont le nom doit impérativemnt avoir pour valeur <span class="html">MAX_FILE_SIZE</span>. La taille est définie par l'attribut "<span class="em">value</span>".</p>
<pre><code>&lt;input type="hidden" name="MAX_FILE_SIZE" value="1000000"&gt;</code></pre>
                            <p>Le champs caché doit être appelé avec le champs de type <span class="em">file</span>.</p>
                            <p>Note : l'attribut <span class="em">value</span> est exprimée en octets.</p>
                        </li>
                        <li>
                            <p>La troisième erreur "<span class="html">UPLOAD_ERR_PARTIAL</span>" se produit si le transfert est interrompu et que le fichier est partiellement téléchargé.</p>
                        </li>
                        <li>
                            <p>La dernière erreur "<span class="html">UPLOAD_ERR_NO_FILE</span>" concerne le transfert d'un fichier vide.</p>
                        </li>
                    </ul>
                    <p>Pour contourner les protections côté client il y a plusieurs méthodes possible. Par exemple, nous pouvons enregistrer le formulaire sur notre machine, supprimer les protections, mettre l'adresse du site et le chemin de la page PHP dans les champs "action" de "form" créant ainsi notre formulaire sans les rections. Il nous restera plus qu'à l'utiliser.</p>
                    <p>On peut également vérifier par exemple l'extension du fichier ou encore même le mime-type avec <span class="html">getimagesize()</span>.</p>
                    <p>Par exemple, le code suivant prend en considération le type de contenu du fichier et n'autorise que le contenu de type image/png.</p>
<pre><code>&lt;?php

    if (isset($_FILES['mon_fichier'])) {
        $dir = './images/';
        $file = $dir . basename($_FILES['mon_fichier']['name']);

        if ($_FILES['mon_fichier']['type'] != 'image/png') {
            print 'Erreur ! Seul les png sont autorisés.';
            exit;
        }

        if (file_exists($file)) {
            print 'Erreur ! Fichier existant.';
            exit;
        }

        if (move_uploaded_file($_FILES['mon_fichier']['tmp_name'], $file)) {
            print "Fichier uploadé : &lt;a href='" . $file . "'&gt;ici&lt;/a&gt;";
        } else {
            print 'Erreur ! Fichier non uploadé.';
        }
    }

?&gt;</code></pre>
                    <p>Donc, si l'on envoie un fichier PHP, nous verrons un message d'erreur. Alors que si l'on envoie un fichier PNG, il sera correctement uploadé. La faille dans cette protection est que le type de contenu est envoyé depuis le client. Par conséquent, si nous modifions le type de contenu de notre fichier PHP, celui-ci sera uploadé.</p>
                    <p>On peut aussi vérifier que l'extension du fichier uploadé soit parmi les extensions valides. Dans le code suivant, les extensions valides sont : .jpg, .gif et .png.</p>
<pre><code>&lt;?php

    if (isset($_FILES['mon_fichier'])) {
        $dir = './images/';
        $file = $dir . basename($_FILES['mon_fichier']['name']);
        $whitelist = array('.jpg', '.gif', '.png');

        if (!in_array($_FILES['mon_fichier']['name'], $whitelist, true)) {
            print 'Erreur ! seul les images sont aurorisées.';
            exit;
        }

        if (file_exists($file)) {
            print 'Erreur ! Fichier existant.';
            exit;
        }

        if (move_uploaded_file($_FILES['mon_fichier']['tmp_name'], $file)) {
            print "Fichier uploadé : &lt;a href='" . $file . "'&gt;ici&lt;/a&gt;";
        } else {
            print 'Erreur ! Fichier non uploadé.';
        }
    }

?&gt;</code></pre>
                    <p>Cette fois-ci, la faille ne vient pas que de notre script, celui se contente de vérifier les extensions et, si elles correspondent avec celles de la white list, le fichier est autorisé.</p>
                    <p>Il arrive que la configuration d'Apache avec l'utilisation d'un code comme celui ci-dessus provoque une faille de sécurité. Quand Apache est configuré pour exécuter un script il y a deux façons de le configurer : en utilisant <span class="html">AddHandler</span> ou <span class="html">AddType</span>. Dans les deux cas, si la configuration suivante (mime.conf) est utilisée, l'image sera interprésentée.</p>
<pre><code><span class="em">AddHandler application/x-httpd-php .gif</span>
Ou
<span class="em">AddType application/w-httpd-php .gif</span></code></pre>
                    <p>Ce congenre de configuration d'Apache est utilisé plus fréquemment que l'on pourrait le penser, on peut les trouver par exemple dans la cas de figure où un code PHP génère dynamiquement un grpahique. Il ne reste qu'à modifier l'extension de notre fichier <span class="em">test.php</span> en <span class="em">test.gif</span> et le tour est joué.</p>
                    <p>Dans la même catégorie, si le serveur Apache utilise la configuration ci-dessous nous sommes en présence d'une autre faille.</p>
<pre><code>AddHandlerapplication/x-httpd-php.php</code></pre>
                    <p>Le problème est que tous les fichiers ayant dans leurs noms "<span class="em">.php</span>" seront interprétés par PHP, aussi bien <span class="em">test.php</span> que <span class="em">test.php.gif</span>.</p>
                    <p>Cette fois, en renommant notre <span class="em">test.php</span> en <span class="em">test.php.gif</span>, notre fichier passera le script de restriction des extensions et sera interprété avec succès.</p>
                    <p>La fonction <span class="html">getimagesize()</span> détermine la taille de l'image fournie et en retourner les dimensions, elle peut également retourner plus d'informations comme le type de fichier.</p>
                    <p>Utilisons un script qui vérifie le type de l'image avec cette fonction et n'autorise que les JPG.</p>
<pre><code>&lt;?php

    if (isset($_FILES['mon_fichier'])) {
        $dir = './images/';
        $file = $dir . basename($_FILES['mon_fichier']['name']);
        $imageinfo = getimagesize($_FILES['mon_fichier']['tmp_name']);

        if ($imageinfo['mime'] != 'image/jpeg') {
            print 'Erreur ! seul les JPG sont autorisés.';
            exit;
        }

        if (file_exists($file)) {
            print 'Erreur ! Fichier existant.';
            exit;
        }

        if (move_uploaded_file($_FILES['mon_fichier']['tmp_name'], $file)) {
            print "Fichier uploadé : &lt;a href='" . $file . "'&gt;ici&lt;/a&gt;";
        } else {
            print 'Erreur ! Fichier non uploadé.';
        }
    }

?&gt;</code></pre>
                    <p>Il ne suffira pas de changer le <span class="html">content-type</span> comme on l'a vu précédemment, car cette fonction travaille directement sur le fichier uploadé dans le dossier temporaire.</p>
                    <p>Il va falloir ruser un peu et lui fournir une vraie image pour qu'il passe le filte, cette image aura l'extension <span class="em">.php</span> pour que Apache demande à PHP de l'interpréter qu'il y a it du code PHP dedans.</p>
                    <p>Une autre façon de sécuriser l'envoi de fichiers est de mettre un <span class="em">.htaccess</span> dans le répertoire d'upload qui interdit les extensions de fihciers black listées et n'autorise que les extensionde fichiers images white listées.</p>
                    <p>Pour notre démonstration, nous utiliserons le <span class="em">.htaccess</span> ci-dessous dans le répertoire images.</p>
<pre><code>Options -Indexes
Options -ExecCGI
AddHandlercgi-script .php .php3 .php4 .phtml .pl .py .jsp .asp .htm
.shtml .sh .cgi
&lt;Files ^(*.jpeg|*.jpg|*.png|*.gif)&gt;
orderdeny,allow
deny from all
&lt;/Files&gt;</code></pre>
                    <p>Ainsi que ce script d'upload.</p>
<pre><code>&lt;?php
    if (isset($_FILES["image"])) {
        $dir = './images/';
        $file = $dir . basename($_FILES['mon_fichier']['name']);
        
        if (move_uploaded_file($_FILES['mon_fichier']['tmp_name'], $file)) {
            print "Fichier upload : &lt;a href='" . $file . "'&gt;ici</a>";
        } else {
            print "Erreur! Fichier non upload";
        }
    }
?&gt;</code></pre>
                    <p>Nous remarquons qu'il n'y a plus la vérification qui permet de déterminer si un fichier du même nom que celui à uploader existe déjà. La faille réside dans ce manque de vérification. Il devient alors possible d'envoyer un fichier <span class="em">.htaccess</span> qui va écraser celui déjà présent.</p>
                    <p>Donc, en créant un .htaccess vierge et l'uploadant celui-ci écrasera l'ancien, supprimant les restrictions. Il est maintenant possible d'exécuter du PHP dans le répertoire images.</p>
                    <p>Dans le cas où le transfert n'échoue pas, vous pouvez envisager de sauvegarder le fichier.</p>
                    <h3>Sauvegarder le fichier :</h3>
                    <p>Lors de l'envoi d'un fichier, son nom est mémoriser temporairement dans "<span class="html">$_FILES['mon_fichier']['tmp_name']</span>" et sera automatiquement détruit à la fin de l'exécution du script.</p>
                    <p>La fonction <span class="html">move_uploaded_file()</span> est utilisée pour le sauvegarder à un emplacement définitif.</p>
<pre><code>&lt;?php

    $nom = $_FILES['mon_fichier']['tmp_name'];
    $nom_destination = './images/725.jpg';
    move_uploaded_file($nom, $nom_destination);

?&gt;</code></pre>
                    <p>La fonction accepte deux paramètres, le premier est le nom temporaire du fichier et le deuxième est son emplacement sur votre serveur. Dans cet exemple, le fichier est renommé "<span class="em">725.jpg</span>" et placé dans le répertoire "<span class="em">./image</span>".</p>
                    <p>Le code complet avec la gestion des erreurs serait donc ceci :</p>
<pre><code>&lt;?php

    if ($_FILES['nom_fichier']['error']) {
        switch ($_FILES['nom_fichier']['error']) {
            case 1 : // UPLOAD_ERR_INI_SIZE
                echo "Le fichier dépasse la limite autorisée par le serveur (fichier php.ini) !";
                break;
            case 2 : // UPLOAD_ERR_FORM_SIZE
                echo "Le fichier dépasse la limite autorisée dans le formulaire HTML !";
                break;
            case 3 : // UPLOAD_ERR_PARTIAL
                echo "L'envoi du fichier a été interrompu pendant le transfert !";
                break;
            case 4 : // UPLOAD_ERR_NO_FILE
                echo "Le fichier que vous avez envoyé a une taille nulle !";
                break;
        }
    }  else {
        // $_FILES['nom_fichier']['error'] vaut 0 soit UPLOAD_ERR_OK
        // ce qui signifie qu'il n'y a eu aucune erreur
        $nom = $_FILES['mon_fichier']['tmp_name'];
        $nom_destination = './images/725.jpg';
        move_uploaded_file($nom, $nom_destination);
    }

?&gt;</code></pre>
                    <p>Si vous voulez ignorer la gestion des erreurs lors d'un transfert, vous pouvez utiliser la fonction <span class="html">is_uploaded_file()</span> qui indique si le fichier a été téléchargé par HTTP POST.</p>
<pre><code>&lt;?php

    if (is_uploaded_file($_FILES['userfile']['tmp_name'])) {
        $nom = $_FILES['mon_fichier']['tmp_name'];
        $nom_destination = './images/725.jpg';
        move_uploaded_file($nom, $nom_destination);
    } else {
        echo "Attaque possible par téléchargement de fichier : ";
        echo "Nom du fichier : '" . $_FILES['userfile']['tmp_name'] . "'.";
    }

?&gt;</code></pre>
                    <p>Cette méthode ne fournit cependant aucune information sur le type d'erreur.</p>
                    <h3>Contre-mesure :</h3>
                    <p>Voici quelques conseils qui vous permettront de sécuriser ces failles :</p>
                    <ul>
                        <li>
                            <p>Ne jamais se fier à ce que peut envoyer le client.</p>
                        </li>
                        <li>
                            <p>Vérifier la configuration d'Adaphe afin d'agir en conséquence.</p>
                        </li>
                        <li>
                            <p>Ne pas placer le <span class="html">.htaccess</span> dans le répertoir d'upload.</p>
                        </li>
                        <li>
                            <p>Ne pas permettre l'écrasement de fichiers.</p>
                        </li>
                        <li>
                            <p>Générer un nom aléatoire pour le fichier uploadé et enregistrer le nom dans une base de données.</p>
                        </li>
                        <li>
                            <p>Ne pas permettre de l'<span class="html">index of</span> (la liste de tous les fichiers et répertoires) du répertoire d'upload.</p>
                        </li>
                        <li>
                            <p>Assigner les bonnes permissions au répertoire.</p>
                        </li>
                        <li>
                            <p>Vérifier le <span class="em">mime-type</span> avec <span class="em">getimagesize()</span> et l'extension du fichier.</p>
                        </li>
                    </ul>
                    <h3>Conclusion :</h3>
                    <p>Vous avez pu constater que de mauvaises implémentations de sécurité d'upload de fichiers permettent l'exécution de code. Dans le cadre d'un audit ou d'une attaque, une backdoor aurait pu être envoyée. Il est vraiment vital pour la sécurité des données que cette fonctionnalité soit correctement protégée.</p>
                </article>
                <article id="mvc">
                    <h2>Architecture MVC pour une application Web :</h2>
                    <p>Nous allons voir comment appliquer les principes de l'architecture <span class="html">MVC (Modèle - Vue - Contrôleur)</span> au développement d'une application Web.</p>
                    <p>Pourquoi doit-on architecturer le site ?</p>
                    <ul>
                        <li>Pour ne pas avoir tout le code PHP, HTML et CSS dans un seul fichier.</li>
                        <li>Pour ne pas avoir de redondance (par exemple : un menu écrit une seule fois ou encore un accès sécurisé écrit une seule fois).</li>
                        <li>Pour ne pas avoir de dépendance (par exemple : un changement de style ou de base de données).</li>
                    </ul>
                    <h3 id="intro_mvc">Rappel : Architecture MVC :</h3>
                    <p>L'<a target="_blank" href="https://fr.wikipedia.org/wiki/Mod%E8le-vue-contr%F4leur" class="em">architecture Modèle - Vue - Contrôleur</a> (MVC) est un patron d'architecture logicielle adapté aux logiciels utilisant des interfaces graphiques, y compris des applications Web. Cette architecture divise l'application en trois composants. L'architecture MVC repose sur le principe de <span class="em">responsabilité unique</span> : chaque élémént de l'application possède un rôle unique et précis.</p>
                    <ul>
                        <li>Le <span class="html">Modèle</span> représente les données <span class="em">métier</span> de l'application, à savoir les données proppres au système que l'application modélise (par opposition aux données propres à l'implémentation).</li>
                        <li>La <span class="html">Vue</span> contient la présentation de l'interface graphique. Les traitements et accès aux données de la DB sont du code NON admis dans une vue.</li>
                        <li>Le <span class="html">Contrôleur</span> implémete la logique de traitement des actions effectuées par l'utilisateur.</li>
                    </ul>
                    <div>
                        <img src="../images/500px-MVC-Process.svg.png" alt="" class="float_right">
                        <p>Le fonctionnement d'une application MVC passe par une boucle d'exécution :</p>
                        <ul>
                            <li>L'utilisateur interagit avec le programme via le contrôleur.</li>
                            <li>Le contrôleur détermine quelle action est demandée par le contrôleur, et la transmet au modèle.</li>
                            <li>Le modèle effectue cette action en suivant la logique des données métier.</li>
                            <li>Une fois modifié, le contrôleur informe la vue de se mettre à jour afin de représenter le nouvel état des données.</li>
                            <li>La vue affiche les nouvelles informations, permettant à l'utilisateur d'effectuer une nouvelle action.</li>
                        </ul>
                    </div>
                    <h3 id="dans_application_web_mvc">Dans une application Web :</h3>
                    <p>Lorsqu'on développe une application classique, les données métier pourraient se trouver par exemple dans des fichiers sur l'ordinateur où l'application tourne, et l'interface graphique pourrait se reposer sur un moteur de rendu au choix.</p>
                    <p>Toutefois, lors de développement d'une application Web, des contraintes supplémentaires s'ajoutent. L'application tourne en effet maintenant sur un serveyr distant, accédé via le réseau Internet, et l'interface graphique sera généralement lilurée au navigateur Internet de l'utilisateur.</p>
                    <h4 id="modele_theorie">Modèle :</h4>
                    <p>Les donées métier doivent être stockées sur le serveur distant : pour cela, une base de données persistante est un outils que vous connaissez bien, et qui est parfaitement approprié dans ce but.</p>
                    <p>Notre application serveur devra donc être capable de faire l'interface avec cette base de données (en lecture et potentiellement en écriture), et implémenter la logique métier du modèle, c'est-à-dire les règles régissant toute interactio et opération ayant lieu au sein du modèle. Dans ce but, une architecture orienté objet est un exemple d'implémentation très appropriée ; chaque classe d'un modèle orienté objet peut traduire une classe de la base de données, reprenant les données métier ainsi que l'implémentation des opérations sous la forme de méthodes.</p>
                    <h4 id="vue_theorie">Vue :</h4>
                    <p>La vue représente les informations qui seront transmises par l'application à l'utilisateur. Dans le cas d'une application Web, il s'agit donc d'envoyer une réponse aux requêtes de l'utilisateur via HTTP.</p>
                    <p>La vue de l'application aura donc pour tâche de générer des pages Web, par exemple au format HTML (agrémenté de feuilles de style CSS et scripts JavaScript éventuelsà répondant à la requête de l'utilisateur.</p>
                    <h4 id="controleur_theorie">Contrôleur :</h4>
                    <p>Les interactions de l'utilisateur avec le serveur d'une application Web se font toujours par l'intermédiaire d'une requête au serveur (à priori via HTTP).</p>
                    <p>Par conséquent, le rôle du contrôleur d'une application Web est de traduire une requête. C'est ce qu'on appelle un <span class="html">Router</span> : il fait le lien entre une adresse URL appelée avec une méthode HTTP (GET, POST, etc.) et les manipulation de modèle à effectuer et/ou la vue à afficher en réponse.</p>
                    <h3 id="pratique_implementation_mvc_php">En pratique : implémentation MVC en PHP :</h3>
                    <p>Pour savoir si on est sur un serveur ou en local, on peut faire le test suivant :</p>
<pre><code>&lt;?php
    $ips_local = array('127.0.0.1', '::1');
    if (in_array($_SERVER['REMOTE_ADDR'], $ips_local)) {
        echo 'Je suis en local !';
    } else {
        echo 'Je suis sur un serveur !';
    }

?&gt;</code></pre>
                    <h4 id="modele_pratique">Modèle :</h4>
                    <p>PHP possède plusieurs librairies permettant d'interragir avec des bases de données persistantes. Nous montrerons ici <a href="https://www.w3schools.com/php/php_mysql_connect.asp" target="_blank">PDO</a>, qui a l'avantage de permettre des interactions avec de nombreux schémas de bases de données différents.</p>
                    <p>Il faudra s'assurer que PDO est installé dans votre exécutable avant de vous en servir (les versions récentes de WAMP ou XAMPP (pour Mac OS) l'incluent normalement par défaut). Une fois cela fait, vous pouvez créer un objet de la classe PDO comme suit (en supposant que la base de données utilise un schéma MySQL) :</p>
<pre><code>&lt;?php

    $servername = 'localhost';
    $dbname = 'myDB';
    $username = 'username';
    $password = 'password';

    try {
        # Ne jamais écrire d'espace dans une string de connexion
        // vérifier que la base de données, les tables et les champs soient bien tous en UTF8 : interclassement utf8_general_ci
        $conn = new PDO("mysql:host=$servername;dbname=$dbname;charset=utf8", $username, $password);
        $conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    } catch(PDOException $e) {
        // Gestion d'erreur avec $e-&gt;getMessage(); pour voir le message.
    }
    
?&gt;</code></pre>
                    <p>Une fois l'objet <span class="html">$conn</span> créé, sa méthode <a href="https://www.php.net/manual/en/pdo.query.php" class="html" target="_blank">query($sql)</a> permet de transmettre une requête contenie dans la variable à la base de données. Le résultat de cette méthode, de type <a href="https://www.php.net/manual/en/class.pdostatement.php" class="em" target="_blank">PDOStatement</a>. On peut alors parcourir les résultats de celle-ci, par exemple via la méthode <span class="html">PDOStatement::fetchAll()</span>, qui renvoie une matrice mixte contenant les données demandées.</p>
                    <p>De même, pour une requête qui met à jour les données de la base de données (INSERT, UPDATE, DELETE), la méthode <a href="https://www.php.net/manual/en/pdo.exec.php" class="html" target="_blank">PDO::exec($sql)</a> permet de transmettre la requête à la base de données. Cette méthode renvoie comme valeur le nombre de rangs modifiés dans la base de données.</p>
                    <p>Comme expliqué dans la section précédente, il conviendra de créer des classes représentant chaque objet du modèle. Ces classes se chargent de générer et d'exécuter les requêtes à la base de données nécessités par la logique métier du modèle. Il sera souvent pratique de créer une classe abstraite <span class="html">Model</span> (comme la création de l'objet PDO), et de laisser vos classes de modèles hériter de cette classe afin de factoriser votre code.</p>
                    <h4 id="vue_pratique">Vue :</h4>
                    <p>Comme nous l'avons vu au chapitre précédent, PHP est un langage très approprié pour générer des pages HTML de façon dynamique. On notera toutefois une règle de bonne pratique pour structurer une application plus complexe : l'utilisation de gabarits.</p>
                    <p>Un gabarit est un fichier PHP qui définit la structure d'une page HTML, avec des emplacements prévu pour insérer directement les valeurs de certaines variables. Par exemple, un fichier <span class="html">template.php</span> comme ci-dessous :</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
    &lt;/head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;&lt;?= $title; ?&gt;&lt;/title&gt;
        &lt;link rel="stylesheet" href="style.css"&gt;
        &lt;script src="script.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;header&gt;Website header&lt;/header&gt;
        &lt;nav&gt;Website nav&lt;/nav&gt;
        &lt;main&gt;
            &lt;h2&gt;&lt;?= $pagetitle; ?&gt;&lt;/h2&gt;
            &lt;?= $pagetext; ?&gt;
        &lt;/main&gt;
        &lt;footer&gt;Website footer&lt;/footer&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
                    <p>Note : la syntaxe <span class="html">&lt;?= $title; ?&gt;</span> est un raccourci pour <span class="html">&lt;?php echo $title; ?&gt;</span>.</p>
                    <p>Nos autres fichiers PHP peuvent alors donner les valeurs aux variables placées dans ce template, puis d'inclure le gabarit (<span class="em">template</span> en anglais) pour générer immédiatement la page HTML avec la structure voulue. Pour rappel : l'inclusion en PHP via <span class="html">require</span> ajoute tout code HTML dans la page générée. Par exemple :</p>
<pre><code>&lt;?php
    $title = "Ma page";
    $pagetitle = "Bienvenue sur ma page";
    $pagetext = "&lt;p&gt;Texte de la page&lt;/p&gt;";

    require "template.php";
?&gt;</code></pre>
                    <p>Procéder avec cette structure de factoriser lecode autant que possible :</p>
                    <ul>
                        <li>La définition de la structure de la page est faite dans des fichiers gabarits, alors que la transmission des données modèle est faite dans d'autres fichiers de vue.</li>
                        <li>La structure de la page est définie (à priori) à un seul endroit.</li>
                        <li>Les éléments communs ne sont définis qu'une fois (pas de code redondant).</li>
                    </ul>
                    <p>Pour des contenus de taille conséquente, il conviendra d'utiliser les fonctions de buffer <a href="https://www.php.net/manual/en/function.ob-start.php" class="html" target="_blank">ob_start()</a> et <a href="https://www.php.net/manual/en/function.ob-get-clean.php" class="html" target="_blank">ob_get_clean()</a>. Ces fonctions permettent d'ouvrir un buffer dans lequel vous pouvez placer du code HTML incluant des balises PHP. Par exemple :</p>
<pre><code>&lt;?php obstart(); ?&gt;
&lt;h1&gt;Tous les messages&lt;/h1&gt;
&lt;table class="messages"&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;Date&lt;/th&gt;
            &lt;th&gt;Auteur&lt;/th&gt;
            &lt;th&gt;Titre&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        &lt;?php foreach ($allMessages as $row) : ?&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;?= $row["msg_date"]; ?&gt;&lt;/td&gt;
                &lt;td&gt;&lt;?= $row["name"]; ?&gt;&lt;/td&gt;
                &lt;td&gt;&lt;?= $row["title"]; ?&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;?php endforeach; ?&gt;
    &lt;/tbody&gt;
&lt;/table&gt;
&lt;php $content = ob_get_clean(); ?&gt;</code></pre>
                    <p>À l'exécution de ce code, la variable <span class="html">$content</span> contiendra tout le code HTML situé entre l'appel aux fonctions de buffer; en outre, le contenu de la table HTML aura été généré de façon itérative avec le contenu du tableau <span class="html">$allMessages</span>.</p>
                    <h4 id="controleur_pratique">Contrôleur :</h4>
                    <p>On pourrait, en guise de router, se contenter de créer un fichier PHP pour chaque URL qu'on estime être valide, et appeler au sein de ce fichier PHP la vue qui correspond. Toutefois, on recontrerait vite un problème d'échelle lorsque notre application grandit en taille, et cette méthode laisserait l'accès aux autres fichiers PHP qui constituent l'application, ce qui n'est à priori pas désirable.</p>
                    <p>Sur un serveur Apache comme celui créé par XAMPP, le fichier <span class="html">.htaccess</span>, placé à la racine des fichiers du serveur, permet de réécrire les URL demandées par des requêtes HTTP. Grâce à cela, nous pouvons rediriger toutes les requêtes vers un fichier PHP unique (typiquement nommé <span class="em">index.php</span>). Par exemple, pour transformer toute URL de type <span class="em">xxx/yyy</span> en <span class="em">index.php?action=xxx&id=yyy</span>.</p>
<pre><code># Réécrit une URL de type xxx/yyy/zzz
# en index.php?action=yyy&id=zzz
RewriteEngine on
RewriteRule ^([a-zA-Z)*)/?([a-zA-Z]*)?/?$ index.php?action=$1&id=$2 [NC, L]</code></pre>
                    <p>Ce fichier emploie une expression régulière pour réécrire l'URL demandée.</p>
                    <p>Dès lors, un Router peut être défini :</p>
<pre><code>&lt;?php
    require "ControllerActions.php";
    function routeRequest() {
        $action = $_GET["action"];
        try {
            if (function_exists($action)) {
                $action();
            } else {
                // Error
            }
        } catch (Exception $e) {
            // Error
        }
    }
?&gt;</code></pre>
                    <p><span class="em">index.php</span> peut simplement faire appel à ce Router :</p>
<pre><code>&lt;?php
    require "Router.php";
    routeRequest();
?&gt;</code></pre>
                    <p>Ajoutons une page au site revient à ajouter un cas dans la fonction de route, et ajouter une méthode d'action, définiesici dans le fichier <span class="em">ControllerActions.php</span> (que nous avons pas montré pour cet exemple-ci). Ces actions, faisant aussi partie du contrôleur, font appel au modèle pour récupérer les données utiles ou effectuer les modifications voulues, puis affichent la vue nécessaire pour la réponse via un <span class="html">require</span>. Elles peuvent également lire les autres paramètres reçues durant la requête HTTP (ou créés par <span class="html">.htaccess</span>.</p>
                    <p>Dans des cas plus complexes, il peut être utile de définir le Router comme une classe qui comprend cette fonction de routing ainsi que des fonctions anexes, par souci de factorisation.</p>
                    <h3 id="frameworks_mvc">Des frameworks pour se simplifier la vie... :</h3>
                    <p>Dans la pratique, de nombreux frameworks existent afin de créer des applications Web dotées d'une architecture MVC. Ces frameworks fournissent des librairies de classes et fonctions implémentnt déjà de nombreuses fonctionnalités de base communes à toute aplication Web (router, accès à la base de données, gestion de gabarits, ...). Ces frameworks reposent aussi chacun sur des langages de programmation différents, permettant aux développeurs de choisir les outils qui leur conviennent le mieux.</p>
                    <p>Notons par exemple <a href="https://www.google.com/search?client=safari&rls=en&q=laravel&ie=UTF-8&oe=UTF-8" target="_blank">Laravel</a> et <a href="https://symfony.com/" target="_blank">Symfony</a> (PHP), <a href="https://rubyonrails.org/" target="_blank">Ruby on Rails</a> (Ruby), <a href="https://www.djangoproject.com/" target="_blank">Django</a> (Python), <a href="https://dotnet.microsoft.com/apps/aspnet" target="_blank">ASP.NET</a> (C#.NET - Microsoft), <a href="https://github.com/balderdashy/sails" target="_blank">Sails.js</a> (Node.js, une librairie JavaScript permettant de faire tourner un serveur Web en JavaScript).</p>
                    <p>Ces frameworks sont cités à titre informatif, et cette liste n'est pas exhaustive; il s'agit ici simplement d'un survol de technologies existantes.</p>
                    <h2 id="phpmailer_mailjet">PHPMailer et Mailjet :</h2>
                    <p>PHPMailer est une librairie PHP bien connue dans le monde PHP pour envoyer des emails d'une façon simple et facile à partir d'un site Web PHP et qui remplace la fonction <html>mail()</html> de PHP.</p>
                    <h3 id="installation_phpmailer">Installation :</h3>
                    <p>Pour utiliser PHPMailer, vous pouvez télécharger la librairie sous forme de .zip en suivant le lien : <a href="https://github.com/PHPMailer/PHPMailer" target="_blank">https://github.com/PHPMailer/PHPMailer</a></p>
                    <p>Créez un dossier "librairies" dans le répertoire "controllers" de votre site Web et collez-y PHPMailer-master dézippé :</p>
                    <img src="../images/dezippage_phpmailer_master.PNG" alt="">
                    <h3 id="programmation_phpmailer">Programmation :</h3>
                    <p>Dans ce qui suit, nous allons vous montrer le code à écrire pour envoyer des emails à partir d'un serveur SMTP d'un service de mailing en ligne <a href="https://fr.mailjet.com/" target="_blank">https://fr.mailjet.com/</a>.</p>
                    <p>Mailjet est un service en ligne d'envois et de suivis de mails et jour le rôle de serveur SMTP. Ce type de service de mailing permet de suivre plus tard des campagnes de mails.</p>
                    <p>Ouvrez un compte gratuit sur <a href="https://fr.mailjet.com/" target="_blank">https://fr.mailjet.com/</a> avec votre adresse @student.vinci.be.</p>
                    <p>Notez vos informations d'identidentification : La Clé API publique (nom d'utilisateur SMTP) et la Clé API secrète (mot de passe SMTP), présenté dans :</p>
                    <img src="../images/rest_api.PNG" alt="REST API">
                    <ol>
                        <li>
                            <p>Dans le contrôleur adéquat, ajoutez les <span class="em">require_once</span> suivants :</p>
<pre><code>require_once(LIBRAIRIES_PATH . 'PHPMailer-master/src/PHPMailer.php');
require_once(LIBRAIRIES_PATH . 'PHPMailer-master/src/SMTP.php);
require_once(LIBRAIRIES_PATH . 'PHPMailer-master/src/Exception.php');</code></pre>
                        </li>
                        <li>
                            <p>Dans <span class="em">ContactController.php</span>, modifiez la méthode <span class="em">run</span> à l'aide du code ci-dessous. Il faut bien sûr préciser vos informations d'identidentification à certains endroits :</p>
<pre><code>// Le namespace de PHPMailer est PHPMailer\PHPMailer;
$mail = new PHPMailer\PHPMailer\PHPMailer(true); // Passing `true` enables exceptions

try {
    // Server setings
    $mail-&gt;SMTPDebug = 0; // Disable verbose debug output (2 pour activer)
    $mail-&gt;isSMTP(); // Set mailer to use SMTP
    $mail-&gt;Host = 'in-v3-mailjet.com'; // Specify main SMTP server
    $mail-&gt;SMTPAuth = true; // Enable SMTP authentification
    $mail-&gt;Username = 'la Clé API publique (nom d'utilisateur SMTP)'; // SMTP username
    $mail-&gt;Password = 'la Clé API secrète (mot de passe SMTP)'; // SMTP password
    $mail-&gt;SMTPSecure = 'tls'; // Enable TLS encryption, 'ssl' also accepted
    $mail-&gt;Port = 587; // TCP port to connect to

    // Recipients
    $mail-&gt;setForm(' ...@student.vinci.be', 'My Mailjet Mailer');
    $mail-&gt;addAddress(' ...@student.vinci.be', 'Votre nom'); // Add a recipient
    $mail-&gt;addReplyTo(htmlspecialchars($_POST['email']), 'Mailer');
    // $mail-&gt;addCC('cc@example.com');
    // $mail-&gt;addBCC('bcc@example.com');

    // Attachments
    // $mail-&gt;addAttachment('/var/tmp/file/tar.gz'); // Add attachments
    // $mail-&gt;addAttachment('/tmp/image.jpg', 'new.jpg'); // Optional name

    // Content
    $mail-&gt;isHTML(true); // Set email format to HTML
    $mail->Subject = 'Mail du site des bonnes nouvelles';
    $mail->Body = htmlspecialchars($_POST['message']);

    $mail-&gt;send();
    $notification = 'Vos informations ont été transmises avec succès.';
} catch (Exception $e) {
    $notification = 'Vos informations n\'ont pas été transmises. ' . 'Mailer Error : ' . $mail->ErrorInfo;
}</code></pre>
                            <p>Remarque : dans le code de PHPMailer, l'adresse email d'envoi (<span class="em">FROM</span>) doit être celle de votre inscription chez <a href="https://fr.mailjet.com/">https://fr.mailjet.com/</a>.</p>
                            <p>Vous pouvez mettre l'adresse du formulaire clienten adresse <span class="em">REPLY-TO</span>.</p>
                        </li>
                    </ol>
                </article>
                <article id="laravel">
                    <h2 id="intro_laravel">Introduction à Laravel :</h2>
                    <p>Laravel est un framework Web open source qui respecte l'architecture MVC. Il nous fournit des librairies permettant de faire l'abstraction de la mécanique de base du MVC, et de laisser les développeurs Web se concentrer sur la logique de l'application Web à créer.</p>
                    <h2 id="gestionnaire_projet_laravel">Un gestionnaire de projet :</h2>
                    <p>Avant de pouvoir utiliser <a href="https://laravel.com/" class="html" target="_blank">Laravel</a>, nous aurons besoin d'un gestionnaire de projet qui permettra de traiter les dépendances nécesssaires à l'exécution d'un tel projet.</p>
                    <p>En PHP, le gestionnaire le plus utilisé est <a href="chrome-extension://mhjfbmdgcfjbbpaeojofohoefgiehjai/index.html" class="html" target="_blank">Composer</a>, une application en ligne de commandes multi-plateforme.</p>
                    <h3 id="gestion_dependances_laravel">Gestion de dépendances :</h3>
                    <p>Une fois Composer installé, tout projet qui dispose des fichiers <span class="html">composer.json</span> et <span class="html">composer.lock</span> à sa racine pourra utiliser Composer. Ces fichiers vont encoder les différentes dépendances présentes dans le projet. Dans la majorité des cas, ils ne sont pas édités manuellement, mais sont générés par le programme Composer lui-même.</p>
                    <p>Une dépendance peut être ajoutée à un projet via la commande <span class="html">composer require</span>. Les fichiers de la librairie invoquée sont alors installés dans le dossier <span class="html">vendor</span> à la racine du projet.</p>
                    <p>Puisque ces fichiers sont externes au projet, il est recommandé de ne <span class="em">pas</span> les inclure dans un gestionnaire de version comme Git, et donc d'ajouter <span class="em">vendor</span> à <span class="html">.gitignore</span>.</p>
                    <p>Si le projet doit être installé à un nouvel emplacement (par exemple une nouvelle machine après un clone de dépôt Git), il suffira d'utiliser la commande <span class="html">composer install</span> et les dépendances seront automatiquement chargées à nouveau dans le dossier <span class="em">vendor</span>.</p>
                    <h3 id="espaces_nom_laravel">Espaces de nom :</h3>
                    <p>Puisque Composer permet d'inclure de nombreuses librairies de code au sein d'un même projet, il offre en outre un mécanisme permettant de faire référence à ces différentes librairies de façon transparente, sans prendre connaissance de l'emplacement physique des fichiers concernés (ce qui serait nécessaire avec <span class="html">require</span> de PHP). Ce mécanisme sont les <span class="html">namespaces</span> ("espaces de nom").</p>
                    <p>Pour déclarer qu'un fichier se place dans un espace de nom, il suffit de le déclarer au début du script PHP via l'instruction <span class="html">namespace</span>.</p>
<pre><code>&lt;?php
    namespace WEBR34\Controller;

    class MyController {
        static function someControllerFunction() {
            // ...
        }
    }
?&gt;</code></pre>
                    <p>Pour ensuite faire l'import d'une ressource à un autre endroit dans le projet, l'instruction <span class="html">use</span> sera employée.</p>
<pre><code>&lt;?php
    namespace WEBR34\Model;

    use WEBR34\Controller\MyController;

    class MyModel {
        function someFunction() {
            MyController::someControllerFunction();
        }
    }
?&gt;</code></pre>
                    <p>À noter : la syntaxe des espaces de nom utilise souvent des standards de nomenclature. Le plus populaire (et celui employé par Laravel) est <a href="https://getcomposer.org/doc/04-schema.md#psr-4" target="_blank">psr-4</a>.</p>
                    <h2 id="framework_laravel">Le framework Laravel :</h2>
                    <h3 id="installation_demarrage_laravel">Installation et démarrage :</h3>
                    <p>Un projet Laravel peut être créé via Composer via la commande :<span class="html">composer create-project --prefer-dist laravel/laravel nomDuProjet</span>. L'option <span class="em">`--prefer-dist`</span> est une option de la commande <span class="em">`composer create-project`</span> qui spécifie à Composer de télécharger les dépendances sous forme d'archives compressées (distributions) plutôt que de les cloner depuis un dépôt Git. Cela peut accélérer le processus de téléchargementet d'installation des dépendances, car il évite le processus de clonage de chaque dépôt Git, surtout lorsque les dépendances sont volumineuses.</p>
                    <p>Cette commande crée un répertoire <span class="em">nomDuProjet</span> qui servira de racine au projet Laravel. Une arborescence de fichier est automatiquementcréée pour vous, ainsi que des fichiers pré-remplis permettant de faire tourner une version minimale d'une application web utilisant Laravel. Notamment, vous pouvez noter que les fichiers de Composer (<span class="em">composer.json</span> et <span class="em">composer.lock</span>) sont présents.</p>
                    <p>Un projet Laravel est organisé de manière structurée pour sépare les différentes responsabilités et faciliter le développement et la maintenance. Voici un aperçu des différents dossiers d'un projet Laravel et leur utilisation :</p>
                    <dl>
                        <dt>app/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">app/</span>` contient le coeur de votre application. Il est subdivisé en plusieurs sous-dossiers :</p>
                            <ul>
                                <li>
                                    <p>`<span class="em">Console/</span>` : Contient les commandes artisan personnalisées.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">Exceptions/</span>` : Contient les exceptions personnalisées et les gestionnaires d'exception.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">Http/</span>` : Contient les contrôleurs (dossier `<span class="em">Controllers/</span>`) de l'application, les middlewares (dossier ]`<span class="em">Middleware/</span>`) qui peuvent être appliqués aux routes ou aux groupes de routes et les requêtes (form requests) (dossier `<span class="em">Requests/</span>` contenant les classes de validation des requêtes HTTP).</p>
                                </li>
                                <li>
                                    <p>`<span class="em">Models/</span>` : Contient les modèles de l'application.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">Providers/</span>` : Contient les fournisseurs de services (service providers) qui configurent les différentes parties de l'application.</p>
                                </li>
                            </ul>
                        </dd>
                        <dt>bootstrap/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">bootstrap/</span>` contient le fichier `<span class="em">app.php</span>`, qui initialise le framework. Le sous-dossier `<span class="em">cache/</span>` contient les fichiers générés pour optimiser les performances, comme les fichiers de cache des configurations et des services.</p>
                        </dd>
                        <dt>config/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">config/</span>` contient les fichiers de configuration de l'application. Chaque fichier correspond à une partie différente de la configuration, comme `<span class="em">app.php</span>`, `<span class="em">database.php</span>`, `<span class="em">mail.php</span>`, etc.</p>
                        </dd>
                        <dt>database/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">database</span>` contient tout ce qui est lié à la base de donénes :</p>
                            <ul>
                                <li>
                                    <p>`<span class="em">factories/</span>` : Contient les classes de définition de modèle d'usine.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">migrations/</span>` : Contient les fichiers de migration de base de données.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">seeders/</span>` : Contient les fichiers de seeding de base de données.</p>
                                </li>
                            </ul>
                        </dd>
                        <dt>public/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">public/</span>` contient le fichier `<span class="em">index.php</span>`, qui est le point d'entrée de toutes les requêtes web. Il contient également les actifs web accessibles publiquement, comme les images, les fichiers JavaScript et CSS.</p>
                        </dd>
                        <dt>resources/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">resources/</span>` contient les vues (dossier `<span class="em">views/</span>` contenant les fichiers de vue Blade), les fichiers de langue (dossier `<span class="em">lang/</span>` contenant les fichiers de traduction) et les assets non compilés (dossiers `<span class="em">js/</span>`, `<span class="em">css/</span>`, `<span class="em">sass/</span>`) pour les compilateurs comme Laravel Mix.</p>
                        </dd>
                        <dt>routes/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">routes/</span>` contient les fichiers de définition des routes :</p>
                            <ul>
                                <li>
                                    <p>`<span class="em">web.php</span>` : Contient les routes web.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">api.php</span>` : Contient les routes API.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">console.php</span>` : Contient les définitions de commandes console.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">channels.php</span>` : Contient les routes de diffusion pour les notifications et les événements.</p>
                                </li>
                            </ul>
                        </dd>
                        <dt>storage/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">storage/</span>` contient les fichiers générés par l'application :</p>
                            <ul>
                                <li>
                                    <p>`<span class="em">app/</span>` : Contient les fichiers générés par l'application.</p>
                                </li>
                                <li>
                                    <p>`<span class="em">framework/</span>` : Contient les fichiers générés par le framework (cache, sessions, views compilées).</p>
                                </li>
                                <li>
                                    <p>`<span class="em">logs/</span>` : Contient les fichiers de log de l'application.</p>
                                </li>
                            </ul>
                        </dd>
                        <dt>tests/ :</dt>
                        <dd>
                            <p>Le dossier `<span class="em">tests/</span>` contient les unitaires (dossier `<span class="em">Unit/</span>`) et fonctionnels (dossier `<span class="em">Feature/</span>` contenant les tests d'intégration) de l'application.</p>
                        </dd>
                        <dt>vendor/ :</dt>
                        <dd>Le dossier`<span class="em">vendor/</span>` contient les dépendances de l'application installées via Composer. Il ne faut pas modifier directement ce dossier.</dd>
                        <dt>.env :</dt>
                        <dd>
                            <p>Le fichier `<span class="em">.env</span>` contient les variables d'environnement spécifiques à votre configuration locale, comme les paramètres de base de données, les clés API, etc.</p>
                        </dd>
                        <dt>composer.json :</dt>
                        <dd>
                            <p>Le fichier `<span class="em">composer.json</span>` contient les informations de configuration pour Composer, y compris les dépendances du projet.</p>
                        </dd>
                        <dt>artisan :</dt>
                        <dd>
                            <p>Le fichier `<span class="em">artisan</span>` est l'outil de ligne de commande de Laravel. Il permet d'exécuter différentes commandes pour faciliter le développement.</p>
                        </dd>
                    </dl>
                    <p>Exemple d'arborescence :</p>
<pre><code>├── app/
│   ├── Console/
│   ├── Exceptions/
│   ├── Http/
│   │   ├── Controllers/
│   │   ├── Middleware/
│   │   ├── Requests/
│   ├── Models/
│   ├── Providers/
├── bootstrap/
│   ├── cache/
├── config/
├── database/
│   ├── factories/
│   ├── migrations/
│   ├── seeders/
├── public/
├── resources/
│   ├── js/
│   ├── css/
│   ├── sass/
│   ├── lang/
│   ├── views/
├── routes/
├── storage/
│   ├── app/
│   ├── framework/
│   ├── logs/
├── tests/
│   ├── Feature/
│   ├── Unit/
├── vendor/
├── .env
├── artisan
├── composer.json</code></pre>
                    <p>Cette structure permet de bien organiser le code et de suivre les meilleures pratiques en manière de développement web avec Laravel.</p>
                    <h4 id="demarrage_serveur_tests_laravel">Démarrage en serveur de tests :</h4>
                    <p>Pour faire tourner l'application, un script PHP exécutable en console <span class="html">artisan</span> nous sera utile : la commande <span class="html">php artisan serve</span> permettra de lancer un <span class="em">serveur de tests</span>, accessible à l'adresse <a href="http://localhost:8000/" class="html" target="_blank">http://localhost:8000/</a> par défaut. Ce serveur nous permettra d'éviter de devoir configurer un serveur Apache; le terminal affiche alors aussi un log des interactions avec ce serveur de test.</p>
                    <p>Si l'installation a réussi avec succès, en vous rendant à l'adresse renseignée par <span class="em">artisan</span>, vous arriverez à une page d'accueil pré-définie par Laravel.</p>
                    <h4 id="deploiement_serveur_reel_laravel">Déploiement sur serveur réel :</h4>
                    <p>Le dossier <span class="em">public</span> contenant les fichiers directement accessibles à un utilisateur du site.</p>
                    <p>Ce dossier contient par défaut un fichier <span class="em">index.php</span> servant de <span class="em">Font Controller</span> ("contrôleur de façade") qui fera les appels au reste du code.</p>
                    <p>Un site déployé de façon professionnelle configurera donc un serveur (par exemple Apache) pour servir uniquement le répertoire <span class="em">public</span>, et ainsi s'assurer que le reste du code du site n'est pas accessible depuis l'extérieur.</p>
                    <h3 id="gestion_routes_laravel">Gestion des routes :</h3>
                    <p>Le dossier <span class="em">routes</span> contient des scripts de <a href="https://laravel.com/docs/9.x/routing" target="_blank">routing</a> de Laravel, permettant de définir les URLs qui sont accessibles dans notre application.</p>
                    <p>Plusieurs scripts sont définis par défaut, permettant de gérer différents types de routes. Ici, nous nous intéresserons principalement à <span class="html">web.php</span>, qui définit les routes accessibles depuis une application Web, et <span class="html">api.php</span>, qui définit les routes accessibles notamment par des requêtes AJAX.</p>
                    <p>Ces routes sont définies en Laravel via la classe <span class="html">Route</span>, qui contient des méthodes statiques correspondant à chaque méthode HTTP. Par exemple, la route définie par défaut est <span class="html">Route::get('/', view('welcome'));</span>.</p>
                    <p>Cette instruction dit que quand l'URL à la racine du site est appelée avec une requête HTTP GET, appelera la vue (nous verrons plus tard comment celles-ci sont définies) <span class="em">welcome</span>.</p>
                    <p>Ajouter une route revient à appeler une des méthodes de <span class="em">Route</span> pour mettre en lien une URL et une exécution de code.</p>
                    <p>Par exemple, pour définir une route accessible via la méthode HTTP GET, nous écrirons :</p>
                    <p class="html">Route::get("URL", function)-&gt;name('name');</p>
                    <p>Où <span class="em">"URL"</span> est un chemin absolu à partir du nom de domaine du site, <span class="em">function</span> est la fonction de contrôleur appelé par cette route.</p>
                    <p>Le router offre aussi la possibilité de <span class="em">nommer</span> chaque route, qui offre une couche d'abstraction lors de l'écriture des liens au sein de l'application. En effet, au lieu d'écrire un lien vers une URL spécifique, l'URL sera générée de façon dynamique à partir du nom de la route, permettant facilment de créer des liens paramétriques, ou de déplacer des routes sans devoir modifier les liens qui pointent vers cette page. Ces liens sont construits via la méthode <span class="html">route('name')</span> ou <span class="html">route('name', $params)</span> si la route reçoit des paramètres (dont nous discuterons plus loin).</p>
                    <p>Les routes d'API dans <span class="em">api.php</span> fonctionnent de façon analogue, à un détail prêt : leurs URL sont définies à partir du chemin racine <span class="html">/api/</span>, afin de les différencier des routes Web.</p>
                    <p>Pour lister la liste des routes présentes dans le projet, on peut utiliser la commande <span class="html">php artisan route:list</span>.</p>
                    <h3 id="gestion_controleurs_laravel">Gestion des contrôleurs :</h3>
                    <p>Le dossier <span class="html">app/Http/Controllers</span> contient les contrôleurs de Laravel utilisé par les requête HTTP. Ces classes ont pour rôles de valider les données transmises par l'utilisateur (si approprié, ensuite d'aller récupérer et/ou modifier des informations tirées du modèle, puis d'appeler la vue correspondante. Par exemple :</p>
<pre><code>&lt;?php
    namespace App\Http\Controllers;
    use \App\Models\User;

    class UserCtrl extends Controller {
        public function allUsers() {
            $allUsers = User::all();
            return view('home', ['users' =&gt; $allUsers]);
        }

        public function getUser($id) {
            $oneUser = User::find($id);
            return view('profile', ['user' =&gt; $oneUser]);
        }
    }
?&gt;</code></pre>
                    <p>Ce contrôleur appelle le modèle pour récupérer tous les billets de blog existants, puis passe ces billets à une vue <span class="html">vueAccueil</span> via la méthode <span class="em">view()</span> définie par Laravel.</p>
                    <p>Pour appeler cette méthode depuis notre <span class="em">Router</span>, on utilisera la notation suivante :</p>
                    <p class="html">Route::get('/users', [UserCtrl::class, 'allUsers'])-&gt;name('users');</p>
                    <p>Le deuxième paramètre est ici un tableau, reprenant dans son premier élément la classe du contrôleur utilisé, puis le nom d'une méthode statique de ce contrôleur à appeler. En outre, le <span class="em">Router</span> peut passer des paramètres directement à la fonction appelée :</p>
                    <p class="html">Route::get('/users/{id}', [UserCtrl::class, 'getUser'])-&gt;name('user');</p>
                    <p>Ici {id} est noté comme un paramètre dans la route. Par exemple, si une requête est faite à l'URL <span class="em">users/12</span>, le Router appellera la méthode <span class="em">getUser</span> avec un paramètre nommé <span class="em">$id</span> de valeur <span class="em">12</span>.</p>
                    <p>Le script <span class="em">artisan</span> fournit une commande permettant de générer facilement un nouveau contrôleur : <span class="html">php artisan make:controller</span>.</p>
                    <h4 id="controleurs_autres_pages_web">Des contrôleurs autres que pour les pages Web :</h4>
                    <p>La classe <span class="html">Illuminate\Http\Response</span> est l'objet renvoyé à l'utilisateur par touterequête HTP envoyée au serveur (c'est notamment l'objet renvoyé par <span class="html">view()</span>). Si on souhaite envoyer autre chose qu'une vue HTML, on peut manuellement configurer cette réponse.</p>
                    <p>Par exemple : <span class="html">return response('Hello World', 200)-&gt;header('Content-Type', 'text/plain');</span> renvoie une réponse contenant "Hello World" avec un statut 200 et un header signalant que le type est du texte brut.</p>
                    <p>Nous utiliserons principalement cet objet lorsque l'on cherche à écrire des APIs, en particulier des méthodes répondant à des requêtes AJAX. On peut par exemple créer une réponse de type JSON, et lui passer un tableau PHP (qui sont, on s'en souvient, compatible avec l'encodage JSON) :</p>
<pre><code>&lt;?php
    return response()-&gt;json([
        'nom' =&gt; 'Nonyme',
        'prénom' =&gt; =&gt; 'Albert',
    ]);
?&gt;</code></pre>
                    <p>Notons aussi que les objets qui héritent du <span class="em">Model Eloquent</span> (ainsi que les collections d'objets) peuvent être automatiquement convertis en réponse JSON. On pourra par exemple définir au sein d'un contrôleur :</p>
<pre><code>&lt;?php
    class UserCtrl extends Controller {
        public function getUser($id) {
            $oneUser = User::find($id);
            return $oneUser;
        }
    }
?&gt;</code></pre>
                    <p>L'objet User est converti en objet JSON, et seuls ses attributs tirés de la base de données sont transmis, les autres attributs (tirés de <span class="em">Model</span>) sont cachés par le processus, assurant une protection des données.</p>
                    <h3 id="gestion_modeles_laravel">Gestion des modèles :</h3>
                    <p>Le dossier <span class="em">app/Models</span> contient les classes de modèle de Laravel. Il s'agit de classes PHP, et il est donc possible de leur ajouter des attributs et méthodes si c'est nécessaire au fonctionnement de l'application Web.</p>
                    <p>La classe <a href="https://laravel.com/docs/9.x/eloquent" target="_blank">Model</a>, présente dans le namespace <span class="html">Illuminate\Database\Eloquent</span>, implémentant des méthodes d'interfaçage avec une base de données. Cela permet de traduire facilement une ligne d'une table de base de données en objet PHP. Des méthodes statiques sont aussi fournies pour effecter des requêtes à la base de données directementvia des appels de fonction, sans devoir écrire des requêtes SQL.</p>
                    <p>Le script <span class="em">artisan</span> fournit une commande permettant de générer facilement une nouvelle classe de modèle <span class="html">php artisan make:model &lt;nom&gt;</span>.</p>
                    <p>Pour rappel, le modèle est la représenation des données et des règles de la base de données dans votre application Laravel.</p>
                    <h4 id="interactions_db_laravel">Interactions avec la base de données :</h4>
                    <p>Le fichier <span class="html">.env</span> contenu à la racine du projet contient les <span class="em">variables d'environnement</span> du projet, y compris les informations de connexion à la base de données à laquelle le serveur est lié :</p>
<pre><code>DB_CONNECTION=mysql
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel
DB_USERNAME=root
DB_PASSWORD=</code></pre>
                    <p>Si vous utilisez MAMP, vous risquez d'btenir l'erreur de migration suivante.</p>
<pre><code>SQLSTATE[HY000] [2002] No such file or directory (SQL: select * from information_schema.tables where table_schema = laravel_db and table_name = migrations and table_type = 'BASE TABLE')</code></pre>
                    <p>Collez la ligne suivante juste après la configuration de la base de données dans le fichier <span class="em">.env</span>.</p>
<pre><code>DB_HOST=localhost;unix_socket=/Applications/MAMP/tmp/mysql/mysql.sock</code></pre>
                    <p>Ces variables incluent le moteur de base de données, le serveur sur lequel elle se trouve, le port via lequel il est possible d'y accéder, ainsi que le nom de la base de données sur le serveur et les droits d'accès (nom d'utilisateur et mot de passe). Il sera approprié de mettre ces données à jour dès la mise en place de l'application.</p>
                    <p>Les migrations Laravel sont un moyen de versionner et de gérer la structure de votre base de données. Elles permettent de définir et de modifier les tables et les colonnes de votre base de données de manière programmatique et traçable.</p>
                    <p>Premièrement, qu'est-ce qu'une migration ? Une migration est donc un fichier PHP contenant des instructions pour créer, modifier ou supprimer des tables et des colonnes dans votre base de données. Les migrations permettent de sychroniser les changements dans la base de données avec le code source de votre application, facilitant ainsi le déploiement et le travail en équipe.</p>
                    <p>Pour créer une nouvelle migration, vous utilisez la commande `<span class="html">make:migration</span>`. Par convention, le nom de la migration doit décrire l'action qu'elle réalise. Par exemple, pour créer la table "Users", on utilise la commande suivante :</p>
<pre><code>php artisan make:migration create_users_table</code></pre>
                    <p>Cela crée un fichier de mogration dans le répertoire `<span class="em">database/migrations</span>` avec une structure de base.</p>
                    <p>Voici un exemple de fichier de migration généré :</p>
<pre><code>&lt;?php

    namespace Database\Migrations;

    use Illuminate\Database\Migrations\Migration;
    use Illuminate\Database\Schema\Blueprint;
    use Illuminate\Support\Facades\Schema;

    class CreateUsersTable extends Migration
    {
        /**
        * Exécute les migrations.
        *
        * @return void
        */
        public function up()
        {
            Schema::create('users', function (Blueprint $table) {
                $table-&gt;id();
                $table-&gt;string('name');
                $table-&gt;string('email')-&gt;unique();
                $table-&gt;timestamp('email_verified_at')-&gt;nullable();
                $table-&gt;string('password');
                $table-&gt;rememberToken();
                $table-&gt;timestamps();
            });
        }

        /**
        * Annuler les migrations.
        *
        * @return void
        */
        public function down()
        {
            Schema::dropIfExists('users');
        }
    }

?&gt;</code></pre>
                    <ul>
                        <li>
                            <p><span class="html">up()</span> : Cette méthode est utilisée pour définir les modifications à appliquer à la base de données lors de l'exécution de la migration.</p>
                        </li>
                        <li>
                            <p><span class="html">down()</span> : Cette méthode est utilisée pour définir les actions à exécuter pour annuler la migration.</p>
                        </li>
                    </ul>
                    <p>Pour appliquer les migrations et mettre à jour la base de données, utilisez la commande `<span class="html">migrate</span>` :</p>
<pre><code>php artisan migrate</code></pre>
                    <p>Pour annuler la dernière série de mogrations, utilisez la commande `<span class="html">migrate:rollback</span>` :</p>
<pre><code>php artisan migrate:rollback</code></pre>
                    <p>Pour annuler toutes les migrations et les réexécuter, utilisez la commande `<span class="html">migrate:reset</span>` suivie de `<span class="html">migrate</span>` :</p>
<pre><code>php artisan migrate:reset
php artisan migrate</code></pre>
                    <p>Pour annuler toutes les migrations et les réexécuter en une seule commande, utilisez `<span class="html">migrate:refresh</span>` :</p>
<pre><code>php artisan migrate:refresh</code></pre>
                    <p>Pour actualiser les migrations et exécuter les seeders, ajoutez l'option `<span class="html">--seed</span>` :</p>
<pre><code>php artisan migrate:refresh --seed</code></pre>
                    <p>Pour supprimer toutes les tables de la base de données et exécuter toutes les migrations à partir de zéro, utilisez `<span class="html">migrate:fresh</span>` :</p>
<pre><code>php artisan migrate:fresh</code></pre>
                    <p>Pour exécuter les seeders après avoir recréé toutes les tables, ajoutez l'option `<span class="html">--seed</span>` :</p>
<pre><code>php artisan migrate:fresh --seed</code></pre>
                    <p>Pour voir une liste de toutes les migrations, utilisez la commande `<span class="html">migrate:status</span>` :</p>
<pre><code>php artisan migrate:status</code></pre>
                    <p>En conclusion, les migrations Laravel sont un outil puissant pour gérer la structure de votre base de données de manière versionnée et contrôlée. En utilisant les commandes artisan appropriées, vous pouvez créer, modifier, et supprimer des tables et des colonnes avec facilité, tout en gardant un historique clair des changements appaortés.</p>
                    <p>Les seeders dans Laravel sont utilisés pour insérer des données initiales ou de test dans la base de données. Ils permettent de peupler les tables avec des données prédéfinies, ce qui est particulièrement utile pour le développement et les tests.</p>
                    <p>Pour créer un seeder, utilisez la commande `<span class="html">make:seeder</span>`. Par convention, le nom du seeder doit réfléter la table ou les données qu'il va peupler.</p>
<pre><code>php artisan make:seeder UsersTableSeeder</code></pre>
                    <p>Cette commande crée un fichier de seeder dans le répertoire `<span class="em">database/seeders</span>`.</p>
                    <p>Voici un exemple de fichier de seeder généré :</p>
<pre><code>&lt;?php

    namespace Database\Seeders;

    use Illuminate\Database\Seeder;
    use Illuminate\Support\Facades\DB;
    use Illuminate\Support\Facades\Hash;
    use Illuminate\Suppory\Str;

    class UsersTableSeeder extends Seeder
    {
        /**
        * Exécute le seeder.
        *
        * @return void
        */
        public function run()
        {
            Db::table('users')-&gt;([
                'name' =&gt; Str::random(10),
                'email' =&gt; Str::random(10) . '@example.com',
                'password' =&gt; Hash::make('password')
            ]);
        }
    }

?&gt;</code></pre>
                    <p>Pour exécuter un seeder spécifique, utilisez la commande `<span class="html">db:seed</span>` avec l'option `<span class="html">--class</span>` pour spécifier le seeder à exécuter :</p>
<pre><code>php artisan db:seed --class=UsersTableSeeder</code></pre>
                    <p>Pour exécuter tous les seefers définis dans `<span class="em">DatabaseSeeder</span>`, utilisez la commande `<span class="html">db:seed</span>` :</p>
<pre><code>php artisan db:seed</code></pre>
                    <p>Le fichier `<span class="em">DatabaseSeeder</span>` (situé dans `<span class="em">database/seeders/DatabaseSeeder.php</span>` est utilisé pour appeler d'autres seeders. Vous pouvez le modifier pour inclure les seeders que vous souhaitez exécuter.</p>
                    <p>Exemple :</p>
<pre><code>&lt;?php

    namespace Database\Seeders;

    use Illuminate\Database\Seeder;

    class DatabaseSeeder extends SearchOrder
    {
        /**
        * Exécute les seeders.
        *
        * @return void
        */
        public function run()
        {
            $this-&gt;call([
                UsersTableSeeder::class,
                PostsTableSeeder::class,
            ]);
        }
    }

?&gt;</code></pre>
                    <p>Laravel fournit des factories pour générer facilement des modèles de données factices. Vous pouvez les utiliser dans vos seeders pour insérer des données de manière plus réaliste.</p>
                    <p>Pour créer une factory, utilisez la commande `<span class="html">make:factory</span>` :</p>
<pre><code>php artisan make:factory UserFactory --model=User</code></pre>
                    <p>Cette commande crée un fichier de factory dans le répertoire `<span class="em">database/factories</span>`.
                    <p>Voici un exemple de définition de factory pour le modèle `<span class="em">User</span>` :</p>
<pre><code>&lt;?php

    namespace Database\Factories;

    use App\Models\User;
    use Illuminate\Database\Eloquent\Factories\Factory;
    use Illuminate\Support\Str

    class UserFactory extends Factory
    {
        /**
        * Le nom du modèle correspondant.
        *
        * @var string
        */
        protected $model = User::class;

        /**
        * Définir l'état par défaut du modèle.
        *
        * @return array
        */
        public function definition()
        {
            return [
                'name' =&gt; $this-&gt;faker-&gt;name,
                'email' =&gt; $this-&gt;fake-&gt;unique()-&gt;safeEmail,
                'email_verified_at' =&gt; now(),
                'password' =&gt; bcrypt('password'), // ou Hash::make('password')
                'remember_token' =égt; Str:random(10),
            ];
        }
    }

?&gt;</code></pre>
                    <p>Voici comment utiliser la factory dans un seeder pour insérer plusieurs utilisateurs :</p>
<pre><code>&lt;?php

    namespace Database\Seeders;

    use Illuminate\Database\Seeder;
    use App\Models\User;

    class UsersTableSeeder extends Seeder
    {
        /**
        * Exécute le seeder.
        *
        * @return void
        */
        public function run()
        {
            User::factory()-&gt;count(50)-&gt;create();
        }
    }

?&gt;</code></pre>
                    <p>Une fois la base de données configurée, les classes héritant de <span class="em">Model</span> possèdent des méthodes permettant la mise en lien automatique avec les tables de la base de données. Par défaut :</p>
                    <ul>
                        <li>Une classe correspond à une table ayant le même nom, au pluriel : la classe <span class="em">User</span> correspond à la table <span class="em">Users</span>.</li>
                        <li>Sa clé primaire est la colonne <span class="em">id</span>.</li>
                        <li>Deux colonnes <span class="em">created_at</span> et <span class="em">updated_at</span> existent dans la table pour gérer l'historique des créations et modifications d'éléments.</li>
                    </ul>
                    <p>Ces comportements peuvent être modifiés en redéfinissant des attributs dans la classe de modèle voulue.</p>
                    <p>Une fois ces réglages effectués, des méthodes statiques ghéritées de <span class="em">Model</span> permettent d'effectuer des requêtes à la base de données pour récupérer ou modifier des objets.</p>
                    <p>Par exemple : <span class="html">User::all()</span> retourne une <span class="em">Collection</span> (classe définie par Laravel itérable) reprenant tous les objets de la table <span class="em">Users</span>.</p>
                    <p>Par contre, <span class="html">User::find(1)</span> retourne un seul <span class="em">User</span> dont la clé primaire est <span class="em">1</span>.</p>
                    <p>Une requête plus complexe peut être écrite en chaînant différentes méthodes, comme par exemple : <span class="html">User::where('attribut', 'valeur')-&gt;orderBy('name')-&gt;take(10)-&gt;get();</span>.</p>
                    <p>Les méthodes <span class="html">where</span>, <span class="html">orderBy</span> et <span class="html">take</span> préparent une requête avec différents filtres (similaires à ceux de SQL), et <span class="html">get</span> exécute la requête et renvoie le résultat.</p>
                    <p>S'il est nécessaire d'exécuter une requête plus complexe, la librairie DB de Laravel offre desméthodes pour envoyer des requêtes directement au serveur. Par exemple :</p>
<pre><code>&lt;?php
    use \Illuminate\Support\Facades\DB;

    // Requête select
    $result = DB::select("SELECT name FROM todos;");

    // Requête insert
    // ? permet de placer des valeurs dans la requête de façon sécurisée
    DB::insert("INSERT INTO todos (name, description) VALUES (?, ?);", ['acheter du lait', 'aucune description']);
?&gt;</code></pre>
                    <p>La méthode <span class="html">DB::select()</span> retourne par défaut des objets anonymes PHP (utilisant la classe <span class="html">stdClass</span>). Les noms de colonnes en SQL deviennent donc des attributs d'objets PHP.</p>
                    <p>Il est cependant préférable d'utiliser les méthodes des classes de modèle si possible, puisqu'elles ajoutent une couche de sécurité et donnent automatiquement aux objets récupérés le type de la classe demandée, alors que <span class="html">DB::select</span> et ses analogues renvoient des objets anonymes, limitant leur manipulation.</p>
                    <h3 id="gestion_vues_laravel">Gestion des vues :</h3>
                    <p>Le dossier <span class="html">ressources/views</span> contient les différentes <a href="https://laravel.com/docs/9.x/views" target="_blank">vues</a> de l'application. Celles-ci sont appelées facilement avec la fonction <span class="html">view</span> (accessible partout dans un projet Laravel sans besoin d'imports), comme déjà mentionné.</p>
                    <p>Ces vues peuvent être des fichiers HTML ou des scripts PHP utilisant Blade, un moteur de rendu utilisant PHP.</p>
                    <p>Quant aux <span class="em">feuilles de style CSS</span> et <span class="em">scripts JavaScript</span>, ainsi que tout autre fichier (comme des images) chargés directement sur les pages du site, ils seront placés dans le dossier public. Leur URL sera définie comme le chemin à partir du dossier public.</p>
                    <h4 id="generation_vues_blade_laravel">Génération de vues : Blade :</h4>
                    <p>Les vues au format HTML sontentièrement statiques : cela peut s'avérer utile pour certaines pages d'un site Web, mais très souvent, on souhaitera ajouter des données sur la page qui changent à chaque affichage.</p>
                    <p>S'il est possible de définir une vue comme un simple fichier PHP créant une page HTML, on utilisera très souvent le <span class="em">moteur de templates</span> de Laravel : Blade. Les vues utilisant Blade doivent toutes être nommées avec un nom se terminant par <span class="em">.blade.php</span>; elles sont appelées au sein de Laravel avec la fonction <span class="html">view</span>, de la même que les vues normales. Par conséquent, <span class="em">view("vueAccueil");</span> peut à la fois faire référence au fichier <span class="em">vueAccueil.php</span> ou au fichier <span class="em">vueAccueil.blade.php</span>; attention à ne pas causer des conflits !</p>
                    <p>La fonction <span class="em">view</span> permet aussi de passer des variables à une vue via un tableau associatif :</p>
                    <p class="html">return view('todo', ['todos' =&gt; $todos]);</p>
                    <p>Cela créera une variable <span class="em">$todos</span> qui pourra être manipulée dans la vue.</p>
                    <p>Ces variables sont passées au sein d'un tableau associatif. Attention : ce sont les noms des clés de ce tableau qui sont ensuite employées au sein de la vue pour faire référence aux variables !</p>
                    <p>Blade permet de transformer nos vues en se rapprochant du code HTML autant que possible, en laissant au contrôleur le soin de gérer la logique de traitement. De façon générale, un template Blade est du code HTML, avec des doubles accolades pour insérer du code PHP. Par exemple, <span class="html">{{$todos}}</span> insère le contenu de la variable <span class="html">$nom</span> (c'est-à-dire la valeur correspondant à la clé "nom" dans le tableau des variables passé à la vue). Les instructions de contrôle de PHP sont quant à elles appelées via des annotions précédées d'un arobase @.</p>
                    <p>Par exemple :</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;TODO&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;À faire...&lt;/h1&gt;
        @if (count($todos) === 0)
            &lt;p&gt;Rien pour le moment ;)&lt;/p&gt;
        @else
            &lt;ul&gt;
                @foreach ($todos as $todo)
                    &lt;li&gt;{{$todo}}&lt;/li&gt;
                @endforeach
            &lt;/ul&gt;
        @endif
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
                    <h4 id="gabarits_blade_laravel">Gabarits et Blade :</h4>
                    <p>Blade permet aussi de spéarer une vue en plusieurs modules, afin de ne pas devoir réécrire plusieurs fois du code HTML sur plusieurs pages.</p>
                    <p>En tant que moteur de rendu, Blade simplifie en outre grandement l'utilisation d'un <span class="em">gabarit</span> (un fichier Blade reprenant du code HTML lacunaire) en utilisant un système d'héritage. Notre template est une vue comme les autres, possédant des appels à l'instruction @yield('nom') au sein de sa structure :</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;link rel="stylesheet" href="/style.css"&gt;
        &lt;title&gt;@yield('title')&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="global"&gt;
            &lt;div id="contenu"&gt;
                @yield('content')
            &lt;/div&gt; &lt;!-- #contenu --&gt;
        &lt;/div&gt; &lt;!-- #global --&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
                    <p>Ensuite, on peut définir une ou plusieurs vues qui héritent de celle-ci avec l'instruction <span class="html">@extends</span>. Le contenu des sections marquées par un <span class="html">@yield</span> est alors renseigné via l'instruction <span class="html">@section</span> (et éventuellement <span class="html">@endsection</span>).</p>
<pre><code>@extends('template')
@section('title', 'TODO')
@section('content')
    &lt;h1&gt;À faire...&lt;/h1&gt;
    @if (count($todos) === 0)
        &lt;p&gt;Rien pour le moment ;)&lt;/p&gt;
    @else
        &lt;ul&gt;
            @foreach ($todos as $todo)
                &lt;li&gt;{{$todo}}&lt;/li&gt;
            @endforeach
        &lt;/ul&gt;
    @endif
@endsection
</code></pre>
                    <p>On peut utiliser Laravel Miw pour gérer les assets. Laravel Mix fournit uen API propre et expressive pour définir les étapes de construction de Webpack pour vos assets. Vous pouvez l'utiliser pour compiler et gérer vos fichiers CSS et JavaScript</p>
                    <p>Laravel Mix est déjà inclus dans un nouveau projet Laravel. Vous pouvons l'installer en exécutant :</p>
<pre><code>npm install</code></pre>
                    <p>Pour compiler vos assets, on doit faire :</p>
<pre><code>npm run dev</code></pre>
                    <p>Ça a permet de créer les dossiers ainsi que les fichiers suivants : `<span class="em">public/css/app.css</span>` et `<span class="em">public/js/app.js</span>`.</p>
                    <p>Pour une version de production optimisée, exécutez :</p>
<pre><code>npm run production</code></pre>
                    <p>On peut également utiliser du SASS au lieu du CSS en modifiant le fichier `<span class="em">webpack.mix.js</span>` se trouvant à la racine du projet aevc le contenu suivant :</p>
<pre><code>mix.js('resources/js/app.js', 'public/js')
    .sass('resources/scss/app.scss', 'public/css', [
        //
    ]);</code></pre>
                    <p>Pour cela, il faut avant tout vérifier que le fichier `<span class="em">resources/scss/app.scss</span>` existe, sinon on le crée avec, par exemple, le contenu suivant :</p>
<pre><code>$bg : #bcbcbc;

body {
    background-color: $bg;
}</code></pre>
                    <p>On peut donc relancer la commande `<span class="html">npm run dev</span>` pour recompiler ou alors utiliser la commande `<span class="html">npm run watch</span>` qui le fait automatiquement lorsque l'on modifie dans le dossier `<span class="em">resources/</span>`.</p>
                    <p>Comme j'ai fait appel à SASS, il va faire la commande suivante et il nous demandera de relancer la commande `<span class="html">npm run watch</span>` :</p>
<pre><code>nom install sass-loader@^11.0.1 sass resolve-url-loader@^3.1.2 --save-dev --legacy-peer-deps</code></pre>
                    <p>Une fois les fichiers CSS et JS compilés, on peut les utiliser dans notre vue Blade en utilisant la fonction `<span class="html">asset()</span>` et en plaçant les lignes suivantes au bon endroit :</p>
<pre><code>&lt;!-- dans la balise &lt;head&gt; --&gt;
&lt;link rel="stylesheet" href="{{ asset('css/app.css') }}"&gt;
&lt;!-- avant la fermeture de la balise &lt;body&gt; --&gt;
&lt;script src="{{ asset('css/app.js') }}"&gt;&lt;/script&gt;</code></pre>
                    <p>Laravel 9 a introduit le support pour Vite, qui est une alternative moderne à Webpack pour la gestion des assets.</p>
                    <p>On configure Vite dans le fichier `<span class="em">vite.config.js</span>` à la racine de votre projet.</p>
                    <p>Pour compiler vos assets, on fait toujours un `<span class="html">npm run dev</span>` et pour la version de production optimisée, on utilise `<span class="html">npm run build</span>`.</p>
                    <p>Voici les directives Blade spécifiques à Vite pour inclure les assets :</p>
<pre><code>@vite('resources/css/app.css')</code></pre>
<pre><code>@vite('resources/js/app.js')</code></pre>
                    <p>En suivant ces étapes, vous pouvez efficacement gérer et inclure vos fichiers CSS et JavaScript dans vos vues Blade Laravel, que vous utilisez Laravel Mix ou Vite pour la gestion des assets.</p>
                    <h2>Ajouter un élément dans la base de données via un formulaire :</h2>
                    <p>Pour ajouter un tuple supplémentaire dans la table "Posts" de la base de données via un formulaire, on peut ajouter une nouvelle route pour afficher la page contenant le formulaire d'ajout :</p>
<pre><code>Route::get('/posts/create', [PostController::class, 'create'])-&gt;name('posts.create');</code></pre>
                    <p>Voici le contenu de notre fichier Blade :</p>
<pre><code>@extends('layouts.app')

@section('content')
    &lt;h1&gt;Créer un nouveau post&lt;/h1&gt;

    &lt;form method="POST" action="#"&gt;
        @csrf
        &lt;label for="title"&gt;Titre&lt;/label&gt;
        &lt;input type="text" name="title" id="title"&gt;
        &lt;label for="content"&gt;Contenu&lt;/label&gt;
        &lt;textarea name="content" id="content" cols="30" rows="10"&gt;&lt;/textarea&gt;
        &lt;button type="submit"&gt;Créer&lt;/button&gt;
    &lt;/form&gt;
@endsection</code></pre>
                    <p>Maintenant qu'on clique sur le bouton, ça doit se lancer dans une nouvelle route en "POST" qu'on va créer maintenant :</p>
<pre><code>Route::post('/posts/create', [PostController::class, 'store'])-&gt;name('posts.store');</code></pre>
                    <p>Ensuite, dans le formulaire, on modifie l'attribut <span class="html">action</span> comme ceci :</p>
<pre><code>&lt;form method="POST" action="{{ route('posts.store') }}&gt;</code></pre>
                    <p>Enfin, on va créer cette fonction <span class="em">store</span> dans le PostController :</p>
<pre><code>public function store(Request $request)
{
    $post = new Post();
    $post-&gt;title = $request-&gt;title;
    $post-&gt;content = $request-&gt;content;
    $post-&gt;save();
}</code></pre>
                    <p>Mais la manière la plus optimisée de faire est la suivante :</p>
<pre><code>public function store(Request $request)
{
    Post::create([
        'title' =&gt; $request-&gt;title,
        'content' =&gt; $request-&gt;content
    ]);
}</code></pre>
                    <p>S'il y a une erreur, il faut rajouter ou modifier la variable <span class="html">$fillable</span> dans le fichier "Model" avec les champs correspondants :</p>
<pre><code>protected $fillable = ['title', 'content'];</code></pre>
                    <p>Pour récupérer la liste des posts classés par ordre alphabétique des titres, on peut utiliser la fonction <span class="html">orderBy</span> d'Eloquent comme ceci :</p>
<pre><code>$posts = Post::orderBy('title')-&gt;get();</code></pre>
                    <p>Pour mettre à jour un post, on peut utiliser la fonction <span class="html">update()</span> comme cela :</p>
<pre><code>$post = Post::find(1);
$post-&gt;update([
    'title' =&gt; 'Titre édité'
]);</code></pre>
                    <p>Pour supprimer un post, comme son nom l'indique, on va utiliser la méthode <span class="html">delete()</span> comme ça :</p>
<pre><code>$post = Post::find(12);
$post-&gt;delete();</code></pre>
                    <h2 id="exemple_concret_laravel">Un exemple concret :</h2>
                    <p>Nous allons monter ici la réalisation d'une application basique implémentant un blog, inspiré de "Évoluer vers une architecture MVC en PHP" de Baptiste Pesquet, par l'intermédiaire de M. Codutti et N. Richard.</p>
                    <p>Ce blog possède la base de données suivante, nommée <span class="em">monblog</span> sur le serveur de base de données :</p>
                    <img src="../images/exemple_concret_laravel.PNG" alt="exemple concret de Laravel">
                    <p>On souhaiterait avoir une page d'accueil affichant la liste des billets, et une page de détails d'un billet.</p>
                    <h3>Configuration de la DB :</h3>
                    <p>Une fois le projet créé, il faudra configurer les variables d'environnement, en particulier :</p>
                    <p class="html">DB_DATABASE=monblog</p>
                    <h3>Mise en place du modèle :</h3>
                    <p>La seule classe de modèle dont nous avons besoin représente les billets de blog. Créons donc une classe :</p>
                    <p class="html">php artisan make:model Post</p>
                    <p>La base de données ne respecte pas les conventions de nomenclature de Laravel. Par conséquent, il faudra définir les paramètres de cette classe afin de la relier à la table voulue :</p>
<pre><code>&lt;?php
    
    namespace App\Models;

    use Illuminate\Database\Eloquent\Factories\HasFactory;
    use Illuminate\Database\Eloquent\Model;

    class Post extends Model {
        protected $table = "t_billet";
        proteted $primaryKey = "bil_id";
        public $timestamps = false;
    }
?&gt;</code></pre>
                    <p>Notre classe est maintenant prête à interfacer avec la base de données.</p>
                    <h3>Préparation du garbarit de vue :</h3>
                    <p>Pour commencer, nous allons immédiatement nous munir d'un gabarit qui gèrera la structure communes aux pages de notre blog :</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="fr"&gt;
    &lt;head&gt;
        &lt;meta charset="UTF-8"&gt;
        &lt;title&gt;@yield('title')&lt;/title&gt;
        &lt;link rel="stylesheet" href="{{asset('styles/myblog.css')}}"&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;header&gt;
            &lt;h1&gt;
                &lt;a href="{{route('post.all')}}"&gt;
                    Bienvenue sur mon blog !
                &lt;/a&gt;
            &lt;/h1&gt;
        &lt;/header&gt;
        &lt;main&gt;
            @yield('content')
        &lt;/main&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
                    <p>Avec le fichier <span class="em">myblog.css</span> placé dans le dossier <span class="em">public/styles</span> pour qu'il soit accessible à l'utilisateur.</p>
                    <p>Nous pouvons maintenant créer des vues qui utilisent ce gabarit. Il est donc temps de créer ces pages une par une, avec les routes et contrôleurs associés.</p>
                    <h3>Page d'accueil :</h3>
                    <p>Sur la page d'accueil, nous afficherons le titre de chaque billet, ainsi que sa date de publication. Pour cela, il nous faut une route, une méthodede contrôleur, et une vue.</p>
                    <p>Ajoutons donc à <span class="html">routes/web.php</span> : <span class="em">Route::get('/blog', [BlogCtrl::class, 'allPosts'])-&gt;name('post.all');</span></p>
                    <p>Crérons ensuite un contrôleur <span class="em">BlogCtrl</span> via <span class="html">php artisan make:controller BlogCtrl</span>.</p>
                    <p>Et donnons-lui la méthode <span class="em">allPosts</span> :</p>
<pre><code>&lt;?php
    namespace App\Http\Controllers;
    use App\Models\Post;
    use Illuminate\Http\Request;

    class BlogCtrl extends Controller {
        public function allPosts() {
            $allPosts = Post::all();
            return view('bloghome', ['posts' =&gt; $allPosts]);
        }
    }
?&gt;</code></pre>
                    <p>Enfin, créeons la vue <span class="em">bloghome.blade.php</span> :</p>
<pre><code>@extends('template')
@section('title', 'Mon blog')
@section('content')
    @if (count($posts) &gt; 0)
        &lt;ul&gt;
            @foreach ($posts as $post)
                &lt;li&gt;{{$post-&gt;BIL_TITRE}} : {{$post-&gt;BIL_DATE}}&lt;/li&gt;
            @endforeach
        &lt;/ul&gt;
@endsection</code></pre>
                    <h3>Page de détails :</h3>
                    <p>La page de détails affiche l'entièreté d'un seul billet. Puisqu'il faut que chaque billet ait son URL propre, nous devrons définir une route paramétrique :</p>
                    <p class="html">Route::get('/blog/{id}', [BlogCtrl::class, 'postDetails'])-&gt;name('post.show');</p>
                    <p>Puisque nous traitons des mêmes données, nous pouvons modifier notre contrôleur existant <span class="em">BlogCtrl</span>, et lui ajouter une méthode <span class="em">postDetails</span>.</p>
<pre><code>&lt;?php

    /*...*/
    class BlogCtrl extends Controller {
        /*...*/
        public function postDetails($id) {
            $post = Post::find($id);
            return view('postdetails', ['post' =&gt; $post]);
        }
    }
?&gt;</code></pre>
                    <p>Enfin, la vue <span class="em">postdetails</span> :</p>
<pre><code>@extends('template')
@section('title', $post-&gt;BIL_TITRE)
@section('content')
    &lt;h2&gt;{{$post-&gt;BIL_TITRE}}&lt;/h2&gt;
    &lt;p&gt;{{$post-&gt;BIL_CONTENU}}&lt;/p&gt;
    &lt;p class="timestamp"&gt;{{$post-&gt;BIL_DATE}}&lt;/p&gt;
@endsection</code></pre>
                    <p>Un lien vers la page d'accueil est déjà présent dans le gabarit. Pour naviguer vers les pages de détails, retournons dans la vue <span class="em">bloghome</span>, et ajoutons un lien sur le titre de chaque billet :</p>
                    <p class="html">&lt;a href="{{route('post.show', ['id' =&gt; $post-&gt;BIL_ID])}}"&gt;{{$post-&gt;BIL_TITRE}}&lt;/a&gt;</p>
                    <h2 id="plus_fonctionnalites">Plus de fonctionnalités :</h2>
                    <p>Le blog est maintenant fonctionnel ! Il est maintenant possible de le lancer via <span class="html">php artisan serve</span>, et de consulter la liste des billets de blog et chacun de ces billets dans son entièreté.</p>
                    <p>Nous vous laisserons compléter ce blog en guise d'exercice en utilisant le reste des données présentes dans la base de données. En particulier, il faut :</p>
                    <ul>
                        <li>
                            <p>Ajouter une classe représentant les commentaires, et créer une relation (utilisez la relation "One-to-Many") entre cette classe et notre classe <span class="em">Post</span>.</p>
                        </li>
                        <li>
                            <p>Ajouter les commentaires d'un billet sur la page des détails de celui-ci.</p>
                        </li>
                        <li>
                            <p>Ajouter le nombre de commentaires sur un billet à côté de son entrée sur la page d'accueil.</p>
                        </li>
                        <li>
                            <p>Ajouter deux APIs, l'une permettant de récupérer tous les billets de blog,l'autre récupérant uniquement les détails d'un billet.</p>
                        </li>
                        <li>
                            <p>Ajouter une API permettant de créer un nouveau billet. On ne se souciera pas ici des problèmes d'authentification.</p>
                        </li>
                        <li>
                            <p>Ajouter une API permettant de commenter un billet.</p>
                        </li>
                    </ul>
                    <h2 id="et_apres">Et après :</h2>
                    <p>Laravel n'est qu'un seul framework web MVC. Il peut sembler imposer de se familiariser avec de nombreuses notions, mais une fois la prise en main effectuée, il simplifie grandement le travail du développeur Web, car il n'est dès lors plus nécessaire que de se soucier des manipulations propres à l'application, en laissant Laravel se charger des interactions de plus bas niveau.</p>
                    <p>Laravel inclut aussi des outils de développement et de débuggage, et bien plus que les bases que nous avons abordées ici. Comme toujours, vous êtes vivement encouragé.e.s de pousser plus loin votre recherche.</p>
                    <h2>Foreign Key Constraints :</h2>
                    <p>Pour créer une clé étrangère dans notre migration, on utilise les lignes suivantes pour qu'il y a une relation "OneToMany" entre la table "Posts" et la table "Comments" :</p>
<pre><code>$table-&gt;unsignedBigInteger('post_id');
$table-&gt;foreign('post_id')-&gt;reference('id')-&gt;on('posts');</code></pre>
                    <p>Depuis Laravel 7, on peut remplacer les deux ligens précédentes par la ligne ci-dessous :</p>
<pre><code>$table-&gt;foreignId('post_id')-&gt;contrained();</code></pre>
                    <p>Dans le modèle "Post", on aura une nouvelle fonction dont voici le contenu :</p>
<pre><code>public function comments()
{
    return $this-&gt;hasMany(Comment::class);
}</code></pre>
                    <p>Enfin, dans le modèle "Comment", on aura la nouvelle fonction suivante :</p>
<pre><code>public function post()
{
    return $this-&gt;belongsTo(Post::class);
}</code></pre>
                    <p>Pour itérer sur les commentaires d'un post et d'afficher un message s'il y en a aucun, on va utiliser le <span class="html">@forelse</span> de Blade comme ceci :</p>
<pre><code>@forelse($post-&gt;comments as $comment)
    &lt;div&gt;{{ $comment-&gt;content }} | crée le {{ $comment-&gt;created_at-&gt;format('d/m/Y') }}&lt;/div&gt;
@empty
    &lt;div&gt;Aucun commentaire pour ce post.&lt;/div&gt;
@endforelse</code></pre>
                </article>
            <!-- fin de section -->
            </section>
        </main>
        <footer role="contentinfo">
            <div>
                <address>
                    Professeurs :
                    <a class="mail" href="mailto:olivier.choquet@vinci.be">Choquet Olivier</a>
                    <a class="mail" href="mailto:driss.vandenheede.techinfo@gmail.com">Vandenheede Driss</a>
                </address>
            </div>
            <div>
                <p>Si vous détectez une erreur, une faute d'orthographe, n'hésitez pas à envoyer un mail aux adresses juste à côté avec le nom de la page et l'erreur détectée.</p>
            </div>
            <div id="version">
                <p>Syllabus HTML</p>
                <p>Version 5.0</p>
            </div>
        </footer>
        <script src="../pre.js"></script>
    </body>
</html>