<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Choquet Olivier & Vandenheede Driss">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin Unix - Suppléments - e-Syllabus HTML5 et CSS3</title>
        <!-- une icône dans la barre du navigateur -->
        <link rel="icon" href="../images/favicon.png" type="image/png">
        <link rel="stylesheet" href="../style.css">
    </head>

    <body>
        <!-- liens d'évitement -->
        <ul class="a11y-nav">
            <li>
                <a href="#container">Passer directement au contenu</a>
            </li>
            <li>
                <a href="#menu">Accéder au menu secondaire de la page</a>
            </li>
            <li>
                <a href="#aside">Accéder aux liens utiles</a>
            </li>
        </ul>
        <!-- bannière et menu -->
        <header role="banner">
            <div class="logoTitle">
                <h1>Cours d'introduction au Web</h1>
                <h2>HTML5 et CSS3</h2>
            </div>
            <nav role="navigation" aria-label="Menu principal de navigation">
                <ul>
                    <li><a href="../index.html">Le cours</a></li>
                    <li><a href="../internet.html">Internet</a></li>
                    <li><a href="../html5.html">HTML5</a></li>
                    <li><a href="../css3.html">CSS3</a></li>
                    <li><a href="../methodologie.html">Méthodologie</a></li>
                    <li><a href="../lexique.html">Lexique</a></li>
                    <li><a href="../supplements.html" class="current">Suppléments</a></li>
                </ul>
            </nav>
        </header>
        <main id="container" role="main" tabindex="-1">
            <div id="menu">
                <nav role="navigation">
                    <ol>
                        <li><a href="../supplements.html">Retour au sommaire</a></li>
                        <li><a href="#virtualbox">VirtualBox</a></li>
                        <li><a href="#resolution_problemes">Résolution des problèmes</a></li>
                        <li><a href="#apt">APT</a></li>
                        <li><a href="#ssh">SSH</a></li>
                        <li><a href="#gestion_utilisateurs">Gestion des utilisateurs</a></li>
                        <li><a href="#apache">Apache</a></li>
                        <li><a href="#mysql">MySQL</a></li>
                        <li><a href="#cron">Cron</a></li>
                        <li><a href="#seance_1">Séance 1</a></li>
                        <li><a href="#seance_2">Séance 2</a></li>
                        <li><a href="#nfs">NFS</a></li>
                    </ol>
                </nav>
                <!-- aside lié à la page et pas à l'article donc pas à l'intérieur de article -->
                <aside id="aside">
                    <p>Liens utiles :</p>
                    <ul>
                        <li><a href="https://www.youtube.com/c/LeDesignerduWeb/videos">Le Designer du web</a></li>
                    </ul>
                </aside>
            </div>
            <section id="mainSection">
                <article>
                    <h1>Admin Unix :</h1>
                </article>
                <article>
                    <h2 id="virtualbox">Fiche 1 : VirtualBox :</h2>
                    <h3>Introduction :</h3>
                    <p>Pour ce cours, nous utiliserons des machines virtuelles avec la distribution Linux Debian. L'image utilisée sera <span class="em">debian-8.5.0-amd64-netinst</span> récupérable sur Moodle.</p>
                    <p>Vous disposez à l'Institut d'une machine virtuelle de la sorte, mais vous pouvez également installer cette image dans <span class="em">VirtualBox</span> si vous voulez travailler sur votre machine.</p>
                    <p>Les administrateurs systèmes connaissent bien les avantages de la virtualisation dans leur travail quotidien. Les avantages principaux sont la création rapide d'un environnement de test similaire à la production ainsi que la possibilité de réaliser des <span class="em">instantanéés (snapshot)</span> avant toute modification. Cette dernière possibilité permet un retour en arrière aisé en cas de souci.</p>
                    <h3>Installation de Debian 8.5 sous VirtualBox :</h3>
                    <ol>
                        <li>
                            <p>Installer VirtualBox.</p>
                        </li>
                        <li>
                            <p>Créer une nouvelle machine virtuelle Linux 64 bits que vous nommerez Debian 8.5.</p>
                        </li>
                        <li>
                            <p>Laissez les options proposées par défaut de VirtualBox.</p>
                        </li>
                        <li>
                            <p>Configurez le stockage dans VirtualBox pour que le périphérique CD vers l'image ISO <span class="em">debian-8.5.0-amd64-netinst</span> (disponible sur Moodle &#8594; Ressources).</p>
                        </li>
                        <li>
                            <p>Lancez votre machine virtuelle et laissez vous guider par l'installeur Debian.</p>
                            <ol>
                                <li>
                                    <p>Langue : Français, Pays : Belgique, Clavier : Belge</p>
                                </li>
                                <li>
                                    <p>Nom de machine : "cequevousvoulez"</p>
                                </li>
                                <li>
                                    <p>Ne mettez pas de domaine !</p>
                                </li>
                                <li>
                                    <p>Mot de passe root : ipl</p>
                                </li>
                                <li>
                                    <p>Créez un compte utilisateur "votreprenom".</p>
                                </li>
                                <li>
                                    <p>Partitionnement : utiliser le disque entier, tout dans une seule partition.</p>
                                </li>
                                <li>
                                    <p>Site miroir : ftp.be.debian.org</p>
                                </li>
                                <li>
                                    <p class="em">N'installez aucun logiciel (décochez tout), aucun environnement de bureau, pas de serveur SSH, pas même les utilitaires du système !</p>
                                </li>
                                <li>
                                    <p>Installez GRUB à l'endroit proposé (/dev/sda).</p>
                                </li>
                                <li>
                                    <p>Installez les additions invités :</p>
<pre><code>apt-get install build-essential dkms gcc linux-headers-`uname -r`</code></pre>
                                    <p>Dans VirtualBox &#8594; périphériques &#8594; insérer le CD d'additions invité.</p>
<pre><code>mount /dev/cdrom</code></pre>
<pre><code>mkdir /tmp/vboxadd</code></pre>
<pre><code>cp -r /media/cdrom0/* /tmp/vboxadd/</code></pre>
<pre><code>cd /tmp/vboxadd/</code></pre>
<pre><code>./VBoxLinuxAdditions.run</code></pre>
                                </li>
                                <li>
                                    <p>Installez le protocole telnet :</p>
<pre><code>apt-get install telnetd</code></pre>
                                </li>
                            </ol>
                        </li>
                    </ol>
                    <h3>Accès à la machine virtuelle depuis votre machine :</h3>
                    <p>Au niveau réseau, votre machine virtuelle Debian est configurée en NAT (cette notion sera abordée au cours de Laboratoire des réseaux). Via cette configuration, vous ne pouvez âs âr défaut accéder depuis votre machine <span class="em">(machine hôte)</span> à la machine virtuelle Debian <span class="em">(machine invitée)</span>. Il est cependant utile de pouvoir accéder à votre machine invitée via le réseau afin de tester les différents services que vous installerez (Serveur Web, SSH, ...). Pour cela, il faut simplement configurer la redirection de port du NAT. L'idée est la suivante : faire correspondre un numéro de port de la machine hôte à un port de la machine invitée. Toutes les requêtes adressées alors sur le port de la machine hôte sont redirigées vers le port de la machine invitée.</p>
                    <p>Un exemple :</p>
                    <img src="../images/reseau_machine_virtuelle.png" alt="">
                    <h3>Environnement de test (pour les sujets) :</h3>
                    <p>Il est souvent utile de reproduire en virtuel un environnement proche de la réalité. Celui-ci implique souvent le recours à plusieurs machines virtuelles. Exemple : pour tester un partage Samba présent sur un serveur Linux, il est utile d'avoir une machine virtuelle "client Windows".</p>
                    <p>Comment faire alors pour que ces deux machines virtuelles invitées communiquent entre elles ?</p>
                    <p>VirtualBox propose une solution simple : le host-only networking ou réseau privé d'hôte. En ajoutant une carte réseau configurée sur ce mode réseau, les machines virtuelles invitées pourront communiquer entre elles sans perturbation pour le "véritable" réseau physique connecté à la machine hôte. Il faudra cependant définir un réseau et des adresses IPs pour les machines virtuelles hôtes.</p>
                </article>
                <article>
                    <h2 id="resolutiion_problemes">Fiche 2 : Résolution des problèmes :</h2>
                    <h3>Outils pour l'administrateur système :</h3>
                    <p>Ce paragraphe est très important. Un administrateur système sera tôt ou tard conforté à des problèmes variés. Celui-ci doit donc disposer d'outils et de méthodes pour résoudre ces problèmes. Voici quelques pistes à ce sujet :</p>
                    <h4>Consulter la documentation :</h4>
                    <p>Vous trouverez beaucoup d'information sur Internet. Préférez évidemment la documentation se rapprochant le plus de votre distribution et version de distribution Linux. N'oubliez pas les pages man. Il existe également des pages "info" accessibles via le logiciel/paquet "pinfo".</p>
                    <p>Chaque paquet dispose d'une documentation spécifique qui est installée dans /usr/share/doc/"paquet". Si celle-ci est trop importante, le paquet est souvent accompagné d'un "paquet-doc" qu'il convient d'installer.</p>
                    <p>Sous les systèmes Debian, les logiciels sont le plus souvent instakkés dans /usr/share/"nomlogiciel" tandis que les fichiers de configuration se trouve dans /etc/"nomlogiciel".</p>
                    <h4>Consultez les logs :</h4>
                    <p>En cas de souci, la plupart des logiciels peuvent générés des logs qui sont stockés le plus souvent dans /var/log/"nomlogicieloupaquet".</p>
                    <p>Les distributions Linux actuelles utilisent le système d'initialisation "systemd". C'est celui-ci qui démarrera vos services/démons (apache par exemple). Il est donc utile de consulter les informations que systemd peut vous donner. Le journal de systemd peut être consulté via :</p>
<pre><code>journalctl -xf</code></pre>
                    <h4>Réseau :</h4>
                    <p>Beaucoup de services/démons sont accessibles à distance et tournent donc sur un port réseau. Il est donc utile d'avoir un inventaire des services "réseaux" qui tournent sur votre machine. La commande <span class="html">netstat</span> permet de réaliser ceci.</p>
<pre><code>netstat -taupe</code></pre>
                    <p>Le fichier /etc/services permet également de vous montrer les ports déjà pré-réservés par le système.</p>
                </article>
                <article>
                    <h2 id="apt">Fiche 3 : APT - Gestion des packages :</h2>
                    <p>Toutes les distributions Linux d'un système de gestion des packages permettant l'installation facile de logiciels et services. Ce système de gestion de packages résout en outre les problèmes de dépendances.</p>
                    <h3>Fonctionnement :</h3>
                    <p>Nous ne donnerons ici qu'un résumé du fonctionnement de l'outil APT, celui-ci étant abordé par le cours théorique. Différents dépôts contenant des paquets Debian (<span class="em">.deb</span>) c'est-à-dire des logiciels (<span class="em">/etc/apt/sources.list</span>) permettant de renseigner les dépôts à utiliser. Il suffit ensuite de mettre à jour depuis les dépôts (mise à jour du cache local) et de demander l'installation du logiciel à APT. L'outil installera automatiquement les dépendances nécessaires pour le logiciel demandé.</p>
                    <h3>Backports :</h3>
                    <p>La distribution Debian mise sur la stabilité et il est donc courant de ne pas avoir les dernières de logiciels. Cependant, si nous avons absolument besoin d'une version plus récente d'un logiciel, le dépôt Backports peut aider. Ce dépôt contient des paquets pour la version "testing" de Debian et sont donc plus récents mais moins stables.</p>
                    <p>La dernière solution reste une installation manuelle mais il faut alors savoir que les mises à jour ne se feront pas via un simple "<span class="html">apt-get upgrade</span>" !</p>
                    <p>Pour ajouter les backports, ajoutez cette ligne à <span class="em">/etc/apt/sources/list</span> :</p>
<pre><code>deb http://ftp.debian.org/debian-backports main</code></pre>
                    <h3>Utilisation :</h3>
                    <h4>Mettre à jour depuis les dépôts :</h4>
<pre><code>apt-get update</code></pre>
                    <h4>Installer un logiciel / supprimer un logiciel :</h4>
<pre><code>apt-get install &lt;paquet1&gt; &lt;paquet2&gt; ...
apt-get remove &lt;paquet1&gt; &lt;paquet2&gt; ...</code></pre>
                    <h4>Rechercher un logiciel :</h4>
<pre><code>apt-cache search &lt;word&gt;</code></pre>
                    <h4>Mettre à jour le système :</h4>
<pre><code>apt-get upgrade</code></pre>
                    <h3>Sécurité :</h3>
                    <p>Les mises à jour des distributions Linux sont plus souvent assurées par l'outil APT. La prmeière règle en terme de sécurité informatique étant de garder un système le plus à jour possible, APT est un outil important pour se prémunir contre des attaques éventuelles.</p>
                    <p>L'administratioon système doit donc réaliser les mises à jour de son système régulièrement et en particulier les mises à jour de sécurité (correction de bogues, correction de failles, ...). Debian distingue ces mises à jour des autres (voir <span class="em">/etc/apt.sources.list</span>), il est donc facile d'appliquer uniquement ces mises à jour.</p>
                    <p>Il est évidemment possible d'automatiser l'application des mises à jour via des outils tel que Cron.</p>
                    <p>Il existe même un paquet pour installer automatiquement et quotidiennement les mises à jour de sécurité.</p>
<pre><code>apt-get install unattended-upgrades apt-listchanges</code></pre>
                </article>
                <article>
                    <h2 id="ssh">Fiche 4 : SSH :</h2>
                    <p>Les systèmes Linux actuels sont le plus souvent gérés en ligne de commande (pas d'interface graphique) et à distance. Pour ce faire, on utilisait telnet mais ce protocole a le plus gros inconvénient de ne rien crypter. Une simple écoute réseau permet alors de récupérer le mot de passe root. SSH est venu remplacer telnet.</p>
                    <h3>Fonctionnement :</h3>
                    <p>Nous ne donnerons ici qu'un résumé du fonctionnement du protocole SSH, celui-ci étant abordé par le cours théorique. Le protocole SSH effectue un échange des clés de chiffrement avant d'utiliser cces dernières pour crypter toutes les communications entre le client et le serveur. Le port 22 est le port par défaut utilisé par SSH.</p>
                    <p>SSH est un service qui est initialisé/démarré par systemd.</p>
                    <h3>Installation :</h3>
<pre><code>apt-get install ssh</code></pre>
                    <h3>Configuration :</h3>
                    <p>Le fichier de configuration client est <span class="em">/etc/ssh/ssh_config</span>.</p>
                    <p>Le fichier de configuration serveur est <span class="em">/etc/ssh/sshd_config</span>.</p>
                    <p>Par défaut, SSH est installé pour permettre une authentification par login et mot de passe pour tous les utilisateurs présents sur le serveur (y compris root).</p>
                    <p>Après avoir effectué une modification dans un fichier de configuration, il faut redémarrer le service pour que les modifications soient prises en compte.</p>
<pre><code>/etc/init.d/ssh restart
OU
service ssh restart
OU
systemctl restart ssh</code></pre>
                    <h3>Utilisation :</h3>
                    <p>Le client SSH a besoin des informations suivantes : un nom de machine ou une adresse IP, un login et un mot de passe. On peut remplacer l'authentification par login/mdp par une clé.</p>
                    <p>Comme client SSH, vous connaissez sans doute déjà le client SSH Windows par excellence : Putty.</p>
                    <p>Sous Linux :</p>
<pre><code>ssh nomutilisateur@nommachineOUadresseIP</code></pre>
                    <h3>Sécurité :</h3>
                    <p>Il est possible de configurer le serveur SSH pour interdire l'usage du compte root pour les connexions SSH. L'option "PermitRootLogin" doit être positionnée à "No" dans le fichier de configuration du serveur SSH.</p>
                    <p>Il est égalementy possible de restreindre l'utilisation que depuis certaines machines et qu'avec certains utilisateurs.</p>
<pre><code>AllowUsers olivier@192.168.1.*
AllowUsers admin bob</code></pre>
                    <p>Ici, les utilisateurs admin et bob sont uniquement autorisés et l'utilisateur olivier depuis le sous-réseau 192.168.1.0/24.</p>
                    <h3>Copie de fichiers :</h3>
                    <p>Il est à noter que dès que vous avez accès à SSH, vous pouvez copier des fichiers entre votre machine hôte et invitée via SCP/SFTP. Ceci peut se faire avec le logiciel WinSCP (Windows) ou Cyberduck (Mac).</p>
                </article>
                <article>
                    <h2 id="gestion_utilisateurs">Gestion des utilisateurs :</h2>
                    <h3>adduser-deluser-addgroup-delgroup :</h3>
                    <p>Ces commandes sont suffisamment explicites. Consulter la documentation à ce sujet pour connaître les options intéressantes. Il esy à noter que AddUser crée un profil pour l'utilisateur basé sur un squelette situé dans <span class="em">/etc/skel</span>. Par défaut, la home directory créée par adduser est accessible en lecture à tout le monde (voir <span class="em">/etc/adduser.conf</span>). Attention, ceci peut ne pas correspondre à votre politique de confidentialité.</p>
                    <h3>SU :</h3>
                    <p>Cette commande permet de changer d'utilisateur. Sans argument, cela permet de devenir root.</p>
<pre><code>su admin</code></pre>
                    <h3>SUDO :</h3>
                    <p>La commande <span class="html">sudo</span> a pour objectif de permettre à des utilisateurs d'exécuter des commandes en tant que superutilisateur.</p>
                    <h4>Fonctionnement :</h4>
                    <p>Pour qu'un utilisateur puisse exécuter une commande avec "<span class="html">sudo</span>", il doit faire partie du groupe sudo.</p>
                    <h4>Installation :</h4>
<pre><code>apt-get install sudo</code></pre>
                    <h4>Configuration :</h4>
                    <p>Par défaut, un utilisateur ajouté au groupe sudo possède les mêmes privilèges que root. On peut cependant changer ce comportement dans le fichier de configuration <span class="em">/etc/sudoers</span>. On peut par exemple faire en sorte qu'un utilisateur ne puisse exécuter que certaines commandes.</p>
                    <p>Le fichier <span class="em">/etc/sudoers</span> s'édite via la commande particulière visudo.</p>
<pre><code>sudo visudo</code></pre>
                    <h4>Utilisation :</h4>
                    <p>Pour ajouter un utilisateur au groupe sudo :</p>
<pre><code>adduser toto sudo</code></pre>
                    <p>Pour vérifier l'appartenance d'un utilisateur au groupe sudo :</p>
<pre><code>groups</code></pre>
                    <p>Pour permettre à un utilisateur d'exécuter une commande privilégiée ("root"). Ajoutez une ligne dans le fichier <span class="em">/etc/sudoers</span>.</p>
<pre><code>user_name ALL=NOPASSWD: /usr/bin/apt-get install</code></pre>
                    <h3>Passwd :</h3>
                    <p>Il est possible de verrouiller ou de désactiver le compte root. Verrouiller le compte root empêche simplement de pouvoir se connecter directement avec le compte root tandis que la désactivation le rend totalement inutilisable.</p>
                    <p>Pour verrouiller le compte root :</p>
<pre><code>sudo passwd -l root</code></pre>
                    <p>Pour désactiver le compte root :</p>
<pre><code>sudo usermod --expiredate 1 root</code></pre>
                    <p>On peut cependant encore utiliser le compte root via :</p>
<pre><code>sudo -s</code></pre>
                    <h3>Sécurité :</h3>
                    <h4>SUDO :</h4>
                    <p>Les avantages du SUDO sont les suivants :</p>
                    <ol>
                        <li>
                            <p>Permettre à des utilisateurs d'exécuter une commande en tant que superutilisateur sans devoir le mot de passe de root.</p>
                        </li>
                        <li>
                            <p>Travailler en mode non privilégié et n'utiliser le mode privilégié que quand cela est nécessaire. Ceci réduit le risque de commettre des dommages pour les systèmes.</p>
                        </li>
                        <li>
                            <p>Contrôler et enregistrer qui fait quoi (SUDO enregistre toutes les commandes <span class="html">sudo</span> effectuées dans <span class="em">/var/log/auth.log</span>).</p>
                        </li>
                        <li>
                            <p>Renforcer la sécurité. En désactivant le compte root et en le remplaçant par un compte "sudo" un attaquant ne connaîtra pas lemot de passe mais également le nom du compte !</p>
                        </li>
                    </ol>
                    <h4>Politique de sécurité des mots de passe :</h4>
                    <p>Il est important d'avoir des mots de passe assez solides et de s'assurer qu'ils ne pourront pas être facilement "crackés". Les systèmes Linux ont une sécurité de mot de passe pare défaut pour les utilisateurs normaux. Les mots de passe doivent avoir une longueur de 6 caractères minimum. Ceci peut s'avérer assez faible comme sécurité.</p>
                    <p>Cette politique de sécurité peut être améliorée notamment ceci :</p>
                    <ol>
                        <li>
                            <p>Imposer un minimum de 8 caractères pour les mots de passe.</p>
                        </li>
                        <li>
                            <p>N'autoriser que x essais pour le mot de passe.</p>
                        </li>
                        <li>
                            <p>Imposer un nombre minimum de caractères différents lors du changement de mot de passe.</p>
                        </li>
                        <li>
                            <p>Fixer une durée de vie minimale et maximale du mot de passe (adduser).</p>
                        </li>
                    </ol>
                    <p>La politique de sécurité se gère au moyen du module PAM (Pluggable Authentication Module) sous Linux. Pour améliorer la politique de sécurité, on peut installer le paquet suivant :</p>
<pre><code>apt-get install libpam-cracklib</code></pre>
                    <p>Ensuite, dans le fichier de configuration de PAM : <span class="em">/etc/pam.d/common-password</span>.</p>
<pre><code>password requisite pam_cracklib.so retry=3 minlen=8 difok=3</code></pre>
                    <ol>
                        <li>
                            <p><span class="em">retry</span> &#8594; nombre de tentatives autorisées.</p>
                        </li>
                        <li>
                            <p><span class="em">minlen</span> &#8594; nombre de caractères pour le mot de passe.</p>
                        </li>
                        <li>
                            <p><span class="em">difok</span> &#8594; nombre de caractères différents entre ancien et nouveau mot de passe.</p>
                        </li>
                    </ol>
                </article>
                <article>
                    <h2 id="apache">Fiche 6 : Apache :</h2>
                    <p>Apache reste un Serveur Web incontournable. Nous allons voir ici comment l'installer et le configurer pour un environnement de production.</p>
                    <h3>Fonctionnement :</h3>
                    <p>Le principe de fonctionnement d'Apache2 repose sur l'utilisation de modules. En effet, il suffit d'installer et/ou d'activer des modules suivant nos besoins. Il existe un module pour PHP, pour activer SSL, pour une authentification LDAP, ...</p>
                    <p>Apache2 est un service qui est initialisé/démarré par systemd. Pour redémarrer le service :</p>
<pre><code>/etc/init.d/apache2 restart
OU
service apache2 restart
OU
systemctl restart apache2</code></pre>
                    <p>En production, un serveur Apache s'occupe de servir plusieurs sites Web et/ou de serveur HTTP frontal. Ces deux points seront abordés ci-dessous.</p>
                    <h3>Installation :</h3>
<pre><code>apt-get install apache2 apache2-doc</code></pre>
                    <p>L'installation crée un compte et un groupe <span class="em">www-data</span>. Apache2 focntionne par défaut sur ce compte et groupe pour des raisons de sécurité et tourne sur le port 80. Un site de base (page HTML) est placée dans <span class="em">/var/www</span> ce qui permet de tester directement Apache2 après son installation : http://adresseip. Il est à noter que si vous voulez tester Apache sur un serveur ne disposant pas d'interface graphique (et donc pas de navigateur classique), vous pouvez installer lynx qui est un navigateur en mode texte (c'est moche mais cela permet de tester !).</p>
                    <h3>Configuration :</h3>
                    <h4>Modules :</h4>
                    <p>Apache dispose de nombreux modules. Nous n'en ferons pas l'inventaire ici. Nous nous contenterons d'en citer 3, très utilisés : <span class="em">rewrite (frameworks MVC)</span>, <span class="em">proxy_http</span>, <span class="em">ssl</span>.</p>
                    <p>Pour activer un module, il suffit d'utiliser la commande "<span class="html">a2enmod</span>" (apache2 enable module). Il existe la commande réciproque "<span class="html">a2dismod</span>". N'oubliez pas de redémarrer le service apache2 après activation du module.</p>
<pre><code>a2enmod &lt;&lt;module&gt;&gt;</code></pre>
                    <h4>Configuration PHP :</h4>
                    <p>Apache peut être configuré pour servor des pages PHP. Il suffit d'installer PHP ainsi que le module PHP pour apache et de redémarer le service apache2.</p>
<pre><code>apt-get install php5 php5-mysql libapache2-mod-php5</code></pre>
                    <p>Attention, au moment où j'ai eu ce cours à l'école, on était à la version 5 de PHP. Donc, vous devrez peut-être modifier la commande ci-dessus en remplaçant la version 5 par la version actuelle de PHP.</p>
                    <h4>Virtualhosts :</h4>
                    <p>Les virtualhosts permettent de déployer plusieurs sites Web sur un même serveur (même adresse IP). La distinction se fait en général sur le nom du site, Apache doit en effet savoir suivant l'url quel site il doit présenter.</p>
                    <p>L'ajouter d'un vhost se fait en créant un fichier dans <span class="em">/etc/apache2/sites-available/"monsite.conf"</span> et puis d'y insérer :</p>
<pre><code>&lt;VirtualHost *:80&gt;
    ServerName monsite.be

    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/htdocs/monsite
    ErrorLog ${APACHE_LOG_DIR}/monsite_error.log
    CustomLog ${APACHE_LOG_DIR}/monsite_access.log combined

    &lt;Directory /var/www/htdocs/monsite&gt;
    Require all granted
    AllowOverride All
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
                    <h5>Directives :</h5>
                    <p>La directive "ServerName" est nécessaire pour qu'Apache fasse une distinction sur le nom du site. Toute URL comportant "monsite.be" utilisera ce vhost.</p>
                    <p>La directive "ServerAdmin" permet de préciser le responsable du site.</p>
                    <p>La directive "DocumentRoot" permet de préciser l'endroit où se trouve l'arborescence du site.</p>
                    <p>Les directives "ErrorLog" et "CustomLog" permettent de préciser où les logs seront stockés.</p>
                    <p>On peut ensuite apliquer des règles/restrictions sur le site via la directive "Directory". Ici, on autorise tout le monde à voir le site "Require all granted" et on autorise les utilisateurs à redéfnir ces règles "AllowOverride All". Ceeci permet par exemple de définir des .htaccess.</p>
                    <p>La directive "Require" peut autoriser ou interdire des adresses IPs, des utilisateurs, ...</p>
                    <p>Exemples :</p>
<pre><code># n'autoriser l'accès au site que depuis localhost
require ip localhost
# accès uniquement au site pour l'utilisateur admin
# pas de redéfinition possible (pas de .htaccess)
AllowOverride None</code></pre>
                    <p>Pour activer le vhost, il suffit d'utiliser la commande "<span class="html">a2ensite</span>" (apache2 enable site). Il existe la commande réciproque "<span class="html">a2dissite</span>". Ne pas oublier de redémarrer le service apache2 après activation.</p>
<pre><code>a2ensite monsite</code></pre>
                    <h4>Reverse proxy :</h4>
                    <p>Un proxy inverse est un serveur frontal, c'est-à-dire un serveur exposé sur Internet et par lequel toutes les requêtes passeront. Ce serveur ne traitera pas le requêtes mais se contentera de les rediriger vers d'autres serveurs internes à l'entreprise. Les intérêts de ce mécanisme sont multiples. Vu qu'il n'y a qu'un seul point d'accès, la sécurité est plus facile à gérer. Cela permet également de mettre en oeuvre du "load balancing" entre des serveurs internes. C'est également un moyen simple de rendre disponible un serveur interne sur le Web (pas besoin de configuration réseau).</p>
                    <p>Pour mettre en place un reverse proxy, il faut activer le modime apache "proxy_http" et "proxy".</p>
<pre><code>a2enmod proxy proxy_http</code></pre>
                    <p>Ensuite, dans le fichier VirtualHost :</p>
<pre><code>&lt;VirtualHost *:80&gt;
    ServerName siteReverseProxy

    ServerAdmin webmaster@localhost

    ProxyPass / http://www.example.com/
    ProxyPassReverse / http:/www.example.com
    
    ErrorLog ${APACHE_LOG_DIR}/siteReverse_error.log
    CustomLog ${APACHE_LOG_DIR}/siteReverse_access.log combined
&lt;/VirtualHost&gt;</code></pre>
                    <h3>Sécurité :</h3>
                    <p>Un serveur Web doit être sécurisé en particulier les échanges entre le client et le serveur doivent être cryptés. Ceci se fait aisément grâce au paquet openssl. Le port par défaut pour les communications HTTPS est le 443.</p>
                    <h4>Installation :</h4>
<pre><code>apt-get install openssl
a2enmod ssl
systemctl restart apache2</code></pre>
                    <h4>Création d'un certificat auto-signé :</h4>
                    <p>La commande openssl permet de ccréer un certificat ainsi qu'une clé associée à ce certificat.</p>
<pre><code>openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache.crt</code></pre>
                    <p>Ici, la clé et le certificat seront déposés dans le répertoire <span class="em">/etc/apache2/ssl</span> créé au préalable.</p>
                    <p>Le VirtualHost sera modifié de la sorte :</p>
<pre><code>&lt;VirtualHost *:443&gt;
    ServerName monsite.be

    ServerAdmin webmaster@localhost
    DocumentRoot /var/ww/htdocs/monsite
    ErrorLog ${APACHE_LOG_DIR}/monsite_error.log
    CustomLog ${APACHE_LOG_DIR}/monsite_access.log combined

    SSLEngine on
    SSLCertificateKeyFile /etc/apache2/server.key

    &lt;Directory /var/www/htdocs/monsite&gt;
    Require all granted
    AllowOverride All
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
                    <h4>Let's encrypt :</h4>
                    <p>Let's encrypt est une autorité de certification libre, gratuite et automatisée. Ceci permet d'obtenir un certificat valide pour son site Web sans trop d'effort. Cependant, la machine servant le site Web doit être "publiquement" accessible ainsi que le nom du domaine. Cela veut dire qu'en test ce procédé n'est pas applicable.</p>
                    <p><a href="https://letsencrypt.org/" target="_blank">https://letsencrypt.org/</a></p>
                </article>
                <article>
                    <h2 id="mysql">Fiche 7 : MySQL :</h2>
                    <h3>MySQL :</h3>
<pre><code>apt-get install mysql-server mysql-client</code></pre>
                    <p>Il faudra donner un mot de passe sûr au compte root de MySQL.</p>
<pre><code>mysql -u utilisateur -p base_exportee &lt; base_exportee.sql</code></pre>
                    <p>Injecter un fichier SQL.</p>
                    <h3>PHPMyAdmin :</h3>
<pre><code>apt-get install phpmyadmin</code></pre>
                    <p>Testez ensuite phpmyadmin &#8594; <a href="http://adresseip/phpmyadmin" target="_blank">http://adresseip/phpmyadmin</a>.</p>
                </article>
                <article>
                    <h2 id="cron">Fiche 8 : Planification de tâches :</h2>
                    <p>Un administrateur système a régulièrement besoin d'outils pour exécuter des tâches récurrentes (mises à jour quotidiennes, backup quotidien, ...). Différents outils existe sous Linux pour réaliser ceci.</p>
                    <h3>Cron :</h3>
                    <p>Cron est un démon capable d'exécuter des tâches planifiées et récurrentes. Chaque utilisateur possède une "crontab", c'est-à-dire une table reprenant les commandes que l'utilisateur souhaite exécuter et à quel moement.</p>
                    <h4>Utilisation :</h4>
                    <p>Pour édier sa propre crontab :</p>
<pre><code>crontab -e</code></pre>
                    <p>Le format de la crontab est le suivant :</p>
<pre><code>#Format
#min heure jourDuMosis mois jourSemaine commande</code></pre>
                    <p><span class="em">*</span> peut être utilisé à la place d'une valeur iniquée qu'il s'agit de toutes les valeurs.</p>
                    <p>Des raccourcis fréquemment utilisés existent pour les cinq premières colonnes :</p>
                    <ol>
                        <li>
                            <p>@yearly</p>
                        </li>
                        <li>
                            <p>@monthly</p>
                        </li>
                        <li>
                            <p>@weekly</p>
                        </li>
                        <li>
                            <p>@ldaily</p>
                        </li>
                        <li>
                            <p>@bhourly</p>
                        </li>
                        <li>
                            <p>@reboot</p>
                        </li>
                    </ol>
                    <p>La sortie standard et d'erreurs de la commande utilisée dans la crontab peut être redirigée et envoyée vers un fichier de log.</p>
<pre><code>@reboot apt-get update &gt;&gt; /var/log/update.log</code></pre>
                    <p>Il est à noter qeue si la machine n'est pas allumée au moment où la tâche a été planifiée, celle-ci ne sera jamais exécutée.</p>
                    <h3>AT :</h3>
                    <p>La commande <span class="html">at</span> permet l'exécution d'une commande à un moment ultérieur. Celle-ci sera exécutée dès que l'horloge atteindra l'heure donnée. Si la machine n'est pas en ligne à ce moment, la commande sera réalisée dès que celle-ci sera en ligne.</p>
<pre><code>at 10:00 2017-12-31 apt-get update</code></pre>
                </article>
                <article>
                    <h2 id="seance_1">Séance 1 :</h2>
                    <h3>Préliminaires :</h3>
                    <p>Pour ce cours, vous pouvez utiliser VirtualBox pour créer votre propre machine virtuelle Debian 8.5 ou utiliser la machine virtuelle Debian 8.5 de l'école. Si vous voulez utiliser VirtualBox, référez-vous à la fiche 1.</p>
                    <h3>Exercice 1 :</h3>
                    <ol>
                        <li>
                            <p>Faites un instantané (si vous travaillez sur votre machine).</p>
                            <img src="../images/instantane_machine_virtuelle.png" alt="">
                        </li>
                        <li>
                            <p>Connectez-vous à votre serveur (machine virtuelle Debian) via le protocole telnet avec l'aide de Putty et avec votre nom d'utilisateur (lambin &#8594; azerty ou compte créé lors de l'installation &#8594; "votreprenom").</p>
                            <ol>
                                <li>
                                    <p>Vous ne pourrez pas vous connecter avec le compte root.</p>
                                </li>
                                <li>
                                    <p>Une fois connecté &#8594; passez en root (mdp: azerty).</p>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>Afin d'optimiser le temps de téléchargement des paquets, adaptez la configuration de l'outil APT pour qu'il utilise le site miroir qu'il utilise le site miroir ftp.belnet.be.</p>
                            <ol>
                                <li>
                                    <p>Le dépôt des mises à jour de sécurité (security.debian.org) ne doit pas être changé.</p>
<pre><code>/etc/sources.list
remplacer ftp.be.debian.org par ftp.belnet.be</code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>Mettez à jour votre système.</p>
<pre><code>apt-get update &amp;&amp; apt-get upgrade</code></pre>
                        </li>
                        <li>
                            <p>Mettez en place les mises à jour de sécurité automatiques.</p>
<pre><code>apt-get install unattended-upgrades apt-listchanges</code></pre>
                        </li>
                        <li>
                            <p>Installez Vim et Midnight Commander sur votre serveur.</p>
<pre><code>apt-get install vim mc</code></pre>
                        </li>
                        <li>
                            <p>Installez SSH sur votre serveur.</p>
<pre><code>apt-get install ssh</code></pre>
                        </li>
                        <li>
                            <p>Connectez-vous à votre serveur via SSH.</p>
                        </li>
                        <li>
                            <p>Faites un instantané (si vous travaillez sur votre machine).</p>
                        </li>
                        <li>
                            <p>Supprimez l'usage des connexions telnet.</p>
                            <ol>
                                <li>
                                    <p>Comment faire et comment s'en assurer ?</p>
<pre><code>apt-get remove telnetd
# pour s'assurer que le service telnet a bien été suprimé et ne tourne plus
netstat -taupe</code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>Créez trois comptes utilisateurs : admin, ip et superuser. (Lisez bien les exigences ci-dessous avant de vous lancer et notez les mots de passe que vous employez pour ces comptes !!!).</p>
                            <ol>
                                <li>
                                    <p>Définissez une politique de sécurité des mots de passe et appliquez-la.</p>
                                </li>
                                <li>
                                    <p>Les profils des utilisateurs (home directories) sont privés (politique de confidentialité).</p>
<pre><code>Voir DIR_MODE /etc/adduser.conf &#8594; privé &#8594; 0700</code></pre>
                                </li>
                                <li>
                                    <p>Tous les utilisateurs créés devront avoir automatiquement le fichier CharteUtilisation.txt (récupérable sur Moodle) dans leur home directory.</p>
<pre><code>Tout fichier placé dans /etc/skel sera copié dans la home directory de l'utilisateur lors de l'appel à adduser.</code></pre>
                                </li>
                                <li>
                                    <p>Proposez une configuration par défaut pour vim (set number, ...) ou nano pour tous les utilisateurs que vous créez.</p>
<pre><code>Placer un fichier .vimrc dans /etc/skel contenant par exemple set number</code></pre>
                                </li>
                                <li>
                                    <p>Quelle est la différence entre "adduser" et "useradd" ? Quelle commande fau-il préconiser ?</p>
<pre><code>adduser appelle useradd mais propose des services en plus (voir ci-dessus et /etc/adduser.conf). adduser est donc une surcouche de useradd.</code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>Faites en sorte que seul le compte admin et superuser puisse se connecter en SSH.</p>
<pre><code>/etc/ssh/sshd_config
AllowUsers admin superuser</code></pre>
                        </li>
                        <li>
                            <p>Faites un instantané (si vous travaillez sur votre machine).</p>
                        </li>
                        <li>
                            <p>Faites en sorte que le compte admin soit le nouveau compte administrateur (le nouveau "root").</p>
<pre><code>apt-get install sudo
# ajouter le compte admin au groupe sudo
adduser admin sudo</code></pre>
                        </li>
                        <li>
                            <p>Verouillez le compte root.</p>
<pre><code>sudo passwd -l root</code></pre>
                        </li>
                        <li>
                            <p>Créez deux comptes : getuser1 et getuser2 qui pourront uniquement ajouter des utilisateurs.</p>
<pre><code>/etc/sudoers
# getusers est un groupe dans lequel aura été placé getuser1 et getuser2
%getusers ALL=NOPASSWD: /usr/sbin/adduser</code></pre>
                        </li>
                        <li>
                            <p>Lisez cet article : <a href="http://www.bbc.com/news/technology-40875534" target="_blank">http://www.bbc.com/news/technology-40875534</a></p>
                        </li>
                        <li>
                            <p>Créez un script interactif qui permettra de créer un utilisateur de type "getuser" ou "normal". Le script demandera également s'il faut un accès SSH. Ce script doit faciliter l'application de votre politique de sécurité des mots de passe ainsi que votre politique de confidentialité des profils utilisateurs (ceux-ci doivent être privés).</p>
                        </li>
                        <li>
                            <p>Bonus : Créez un script pour contrôler l'activité du compte admin.</p>
                            <ol>
                                <li>
                                    <p>Commencez par réfléchir à ce qu'il est utile de contrôler !</p>
                                </li>
                            </ol>
                        </li>
                    </ol>
                </article>
                <article>
                    <h2 id="seance_2">Séance 2 :</h2>
                    <h3>Préliminaires :</h3>
                    <p>Pour ce cours, vous pouvez utiliser VirtualBox pour créer votre propre machine virtuelle Debian 8.5 ou utiliser la machine virtuelle Debian 8.5 de l'école. Si vous voulez utiliser VirtualBox, référez-vous à la fiche 1.</p>
                    <h3>Exercice 1 : Apache début :</h3>
                    <p>Nous allons créer un serveur LAMP (Linux Apache MySQL PHP) de production avec deux sites Web. Le site <a href="http://sitehtml/" target="_blank">http://sitehtml/</a> renverra vers une page HTML contenant "coucou" et <a href="http://sitePHP/" target="_blank">http://sitePHP/</a> renverra vers le site des bonnes nouvelles. Vous trouverez ce site dans les ressources sur Moodle.</p>
                    <ol>
                        <li>
                            <p>Installez un serveur apache2.</p>
<pre><code>apt-get install apache2 apache2-doc</code></pre>
                        </li>
                        <li>
                            <p>Configurez apache2 que <a href="http://sitehtml/" target="_blank">http://sitehtml/</a> renvoie vers une page HTML contenant "coucou".</p>
                            <ol>
                                <li>
                                    <p>Gardez à l'esprit que toute URL va être envoyée à un serveur DNS pour traduction ! <a href="http://sitehtml/" target="_blank">http://sitehtml/</a> doit renvoyer l'adresse IP de votre serveur. Comment réaliser cela sans toucher à la configuration DNS ? Rappelez-vous du processus de résolution des noms DNS !</p>
<pre><code>#/etc/apache2/sites-available/siteHTML.conf
&lt;VirtualHost *:80&gt;
    ServerName siteHTML
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/siteHTML
    ErrorLog ${APACHE_LOG_DIR}/monsite_error.log
    CustomLog ${APACHE_LOG_DIR}/monsite_access.log combined
    &lt;Directory /var/www/siteHTML&gt;
        Require all granted
        AllowOverride All
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
<pre><code>a2ensite siteHTML</code></pre>
<pre><code>/etc/hosts
127.0.0.1 siteHTML</code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>Installer Lynx (un navigateur Web en mode texte).</p>
<pre><code>apt-get install lynx</code></pre>
                        </li>
                        <li>
                            <p>Tester le site HTML sur votre machine Debian avec Lynx.</p>
<pre><code>lynx siteHTML</code></pre>
                        </li>
                        <li>
                            <p>Tester ensuite sur votre machine hôte (si vous travaillez avec VirtualBox).</p>
<pre><code># rediriger le port 8080 vers 80 dans VBOX
Firefox &#8594; http://siteHTML:8080</code></pre>
                        </li>
                        <li>
                            <p>Configurez apache2 pour <a href="http://sitePHP/" target="_blank">http://sitePHP/</a> que renvoie vers le site des bonnes nouvelles de Mr Collinet.</p>
                            <ol>
                                <li>
                                    <p>Vous trouverez sur Moodle un zip avec le site et fichier sql permettant de créer la base de données.</p>
<pre><code>Copie des fichiers du site + fichier SQL &#8594; SCP &#8594; WinSCP, CyberDuck</code></pre>
                                </li>
                                <li>
                                    <p>Installez MySQL et PHPMyAdmin !</p>
<pre><code>apt-get install mysql-server phpmyadmin</code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>BONUS : Faites en sorte que le site PHP soit le site par défaut c'est-à-dire que <a href="http://localhost/" target="_blank">http://localhost/</a> poointe vers le site PHP. Faites une recherche sur Internet.</p>
                        </li>
                    </ol>
                    <h3>Exercice 2 : jetty/apache reverse proxy :</h3>
                    <ol>
                        <li>
                            <p>Créez un utilisateur jetty.</p>
                        </li>
                        <li>
                            <p>Copiez dans la home directory de jetty les fichiers du  siteJetty.</p>
                            <ol>
                                <li>
                                    <p>Attention l'utilisateur jetty doit avoir des droits suffisants sur ces fichiers !</p>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>Mettez en place un reverse &#8594; les requêtes pour "siteJetty" seront envoyées sur <a href="http://localhost:8080/" target="_blank">http://localhost:8080/</a>.</p>
<pre><code>a2enmod proxy proxy_http</code></pre>
<pre><code>&lt;VirtualHost*:80&gt;
    ServerName siteJetty
    ServerAdmin webmaster@localhost
    ProxyPass / http://localhost:8080/
    ProxyPassReverse / http://localhost:8080/
    ErrorLog ${APACHE_LOG_DIR}/monsite_error.log
    CustomLog ${APACHE_LOG_DIR}/monsite_access combined
&lt;/VirtualHost&gt;</code></pre>
                        </li>
                        <li>
                            <p>Installez Java 8. Ajoutez les backports dans APT pour pouvoir installer Java 8.</p>
<pre><code>de http://ftp.debian.org/debian jessie-backports main
apt-get update
apt-get install openjdk-8-jdk -t jessie-backports</code></pre>
                            <p>Remarquez l'utilisation du "<span class="html">-t jessie-backports</span>" pour installer des paquets "backports".</p>
                        </li>
                        <li>
                            <p>Tester l'installation (dans la home directory de jetty) :</p>
                            <ol>
                                <li>
                                    <p>Lancez <span class="html">java -jar NoDbRunTest.jar &</span> (le <span class="html">&</span> pour une exécution en arrière plan et conserver l'accès à la ligne de commande).</p>
                                </li>
                                <li>
<pre><code>lynx siteJetty</code></pre>
                                </li>
                                <li>
                                    <p>Comprenez bien le mécanisme. On lance via "<span class="html">java -jar NoDbRunTest.jar</span>" un serveur Jetty qui tourne par défaut sur le port 8080 et dans lequel le site est installé. On accède au site Jetty via Apache configuré en reverse proxy (Apache redirige les requêtes <a href="http://siteJetty/" target="_blank">http://siteJetty/</a> vers <a href="http://localhost:8080" target="_blank">http://localhost:8080</a>).</p>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>BONUS : Automatisez le lancement et faites en sorte que les logs soient stockés de manière standard.</p>
                        </li>
                    </ol>
                    <h3>Exercice 3 : sécurisation Apache :</h3>
                    <ol>
                        <li>
                            <p>Sécurisez le site "siteHTML" avec un certificat auto-signé.</p>
<pre><code>apt-get install openssl
a2enmod ssl
systemctl restart apache2</code></pre>
<pre><code>openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt</code></pre>
<pre><code>&lt;VirtualHost *:443&gt;
    ServerName siteHTML
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/htdocs/monsite
    ErrorLog ${APACHE_LOG_DIR}/monsite_error.log
    CustomLog ${APACHE_LOG_DIR}/monsite_access.log combined
    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/apache.crt
    SSLCertificateKeyFile /etc/apache2/ssl/apache.key
    &lt;Directory /var/www/siteHTML&gt;
        Require all granted
        AllowOverride All
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
                        </li>
                        <li>
                            <p>Tester votre installation.</p>
                            <ol>
                                <li>
<pre><code>lynx https://siteHTML</code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <p>Bonus : Faites une redirection http to https. Vous avez sans doute remarquez que si vous interrogez le siteHTML en HTTP au lieu d'HTTPS, vous avez un message d'erreur. Lorsque l'utilisateur tape <a href="http://siteHTML/" target="_blank">http://siteHTML/</a>.</p>
                            <ol>
                                <li>
                                    <p>Faites une recherche sur Internet.</p>
                                </li>
                            </ol>
                        </li>
                    </ol>
                </article>
                <article>
                    <h2 id="nfs">Admin Linux fiche : NFS :</h2>
                    <p>NFS (Network File System) est un système de fichiers en réseau permettant de partager des données. Il permet aux clients d'avoir accès à un réseau. Nous allons voir ici comment rendre accessibles différents répertoires, publics et privés, via le protocole NFS.</p>
                    <ol>
                        <li>
                            <h3>Installation :</h3>
                            <ol>
                                <li>
                                    <h4>Du côté serveur :</h4>
                                    <p>Avant de pouvoir commencer à partager des fichiers, il faut installer le module nous permettant de partagerles dossiers aux clients.</p>
<pre><code>apt-get install nfs-ernel-server nfs-common</code></pre>
                                    <p><span class="em">nfs-kernel-server</span> permet la gestion du serveur tandis que <span class="em">nfs-common</span> prend en charge les données partagées entre la machine serveur et la machine client.</p>
                                    <p>Après avoir défini vos partages dans le fichier <span class="em">/etc/exports</span> il suffit de relancer le service nfs :</p>
<pre><code>sudo service nfs-kernel-server restart</code></pre>
                                    <p>Cette commande ne coupe pas les transferts en cours si la nouvelle configuration permet toujours leur accès au serveur. Vous pouvez donc la lancer plus ou moins à n'importe quel moment.</p>
                                    <p>Pour vérifier que l'export a bien eu lieu, taper sur le serveur NFS la commande :</p>
<pre><code>showmount -e</code></pre>
                                </li>
                                <li>
                                    <h4>Du côté client :</h4>
                                    <p>Du côté client, il faut installer le module <span class="em">nfs-common</span> et <span class="em">portmap</span>.</p>
<pre><code>apt-get install nfs-common portmap</code></pre>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <h3>Configuration :</h3>
                            <ol>
                                <li>
                                    <h4>Du côté serveur :</h4>
                                    <p>Les 3 fichiers de configuration à modifier du côté serveur permettant le partage de fichiers sont <span class="em">/etc/exports</span>, <span class="em">/etc/hosts.allow</span>, <span class="em">/etc/hosts.deny</span>. On peut modifier que <span class="em">/etc/exports</span> pour partager des fichiers mais cela rendra le serveur très fragile aux attaques.</p>
                                    <p><span class="em">/etc/hosts.allow</span> et <span class="em">/etc/hosts.deny</span> spécifient qui a accès au serveur et qui ne l'a pas.</p>
                                    <p><span class="em">/etc/exports</span> est compsé de ligne d'entrée indiquant quel dossier est partagé et à quel machine.</p>
<pre><code>/Dossier/APartager/ ip_master(rw,sync) i^_trusty(rw,sync)</code></pre>
                                    <p>Master et trusty correspondant aux machines à laquelle le dossier est partagé, pour plus de précision il est conseillé d'utiliser les IP des machines. <span class="em">Rw</span> et <span class="em">no_root_squash</span> sont des options qui décrivent l'accès qu'à l'utilisateur au fichier, les plus importantes sont :</p>
                                    <ul>
                                        <li>
                                            <p><span class="em">-ro</span> : read only.</p>
                                        </li>
                                        <li>
                                            <p><span class="em">-rw</span> : read write, l'utilisateur peut modifier le fichier.</p>
                                        </li>
                                        <li>
                                            <p><span class="em">-sync</span> : l'accès au partage nfs se fasse de manière synchrone.</p>
                                        </li>
                                    </ul>
                                    <p>Pour rendre les lignes de configurations effectives, il faut redémarrer le <span class="em">nfs-kernel-server</span> avec la commande :</p>
<pre><code>nfs-kernel-server restart</code></pre>
                                </li>
                                <li>
                                    <h4>Du côté client :</h4>
                                    <p>Il y a deux moyens de monter les fichiers chez le client : on peut le faire manuellement avec <span class="html">mount</span> ou installer un module qui le fait automatiquement (<span class="em">autofs</span>).</p>
                                    <p>Côté client version manuelle :</p>
                                    <p>Disons que nous avons un dossier home disponible sur le serveur NFS et qu'on voudrait le monter chez un client. On rentrera dans le terminal une ligne de code de ce genre :</p>
<pre><code>mount -t nfs -o ro,soft,intr adresse_serveur:/home client/ usrXX/nfs_public</code></pre>
                                    <p>Le dossier <span class="em">nfs_public</span> doit être créé préalablement.</p>
                                    <p><span class="em">-t</span> signifie qu'on va spécifier le type de filesystem.</p>
                                    <p><span class="em">-intr</span> : Le processus de montage.</p>
                                    <p><span class="em">-soft</span> : va tenter de se connecter pendant un temps défini et en cas d'échec renvoie une erreur.</p>
                                    <p><span class="em">-hard</span> : va tenter de se connecter et ne s'arrêtera pas tant qu'il n'aura pas réussi.</p>
                                    <p>Le dossier dans lequel on va partager le dossier du serveur doit être créé avec le montage.</p>
                                    <p>On peut démonter le dossier partagé chez le client en utilisant la commande <span class="html">umount</span>.</p>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <h3>Monter les fichiers automatiquement avec autofs :</h3>
                            <p>Autofs est un programme qui monte automatiquement les dossiers, il resout les problèmes du montage manuel ou munt_fstab tel que les dossiers restent montés et prennent de la ressource même lorsqu'ils ne sont pas utilisés ou encore que sans wifi l'auto-montage ne s'exécute pas.</p>
                            <p>Installation &#8594; <span class="html">apt-get install autofs</span></p>
                            <p>Fichiers à configurer :</p>
                            <ol>
                                <li>
                                    <h4>/etc/auto.master :</h4>
                                    <p><span class="em">auto.master</span> est le fichier dans lequel il faut déclarer le répertoire parent de montage et le type de système de fichier.</p>
                                    <p>Une ligne de configuration doit être écrite souss ce format :</p>
<pre><code>/&lt;point_de_montage_parent&gt; /etc/auto.&lt;type&gt; --ghost,--timeout=30</code></pre>
                                    <p>où <span class="em">point_de_montage_parent</span> est le dossier dans lequel on va monter les fichiers reçus du serveur nfs.</p>
                                    <p><span class="em">type</span> : le type de système de fichier qu'il s'agit.</p>
                                    <p><span class="em">--ghost</span> : créer des dossiers vides pour chaque point de montage.</p>
                                    <p><span class="em">--timeout</span> : indique le temps d'attente avant de démonter les fichiers.</p>
                                    <p>exemple :<span class="em">/net /etc/auto.nfs --ghost,--timeout=30</span></p>
                                </li>
                            </ol>
                        </li>
                        <li>
                            <h3>Solution au problème posé :</h3>
                            <p>Le problème posé par le professeur était de partager à plusieurs utilisateurs un dossier public en read-only et que chaque utilisateur connecté au serveur ait son dossier privé seulement accessible à l'utilisateur lui-même.</p>
                            <h4>Du côté client :</h4>
                            <p>Nous avons créer des utilisateurs sur la machine client avec adduser et chaque utilisateur créé à un UID qui va permettre de le reconnaître sur la machine serveur.</p>
                            <p>On crée des dossiers pour chaque client sur la machine et on mount pour chaque client son dossier privé.</p>
<pre><code>#!/bin/bash


if [ -z $1 ]
then
    echo "Usage : $0 [nbr_clients]"
    exit 1
fi

if [ ! -e /nfs ]
then
    mkdir /nfs
fi

for i in `seq 1 $1`
do
    if [ ! -e /nfs/priv_client$i ]
    then
        mkdir /nfs/priv_client$i
    fi

    mount -t nfs -o rw,soft,intr "192.168.0.1:/home/client$i" "/nfs/priv_client$i"

done

if [ !-e /nfs/public_nfs ]
then
    mkdir /nfs/public_nfs
fi

mount -t nfs -o ro,soft,intr 192.168.0.1:/home/public_nfs /nfs/public_nfs</code></pre>
                            <h4>Du côté serveur :</h4>
                            <p>Nous avons aussi créer des utilisateurs qui ont un UID correspondant à ceux créés du côté client.</p>
                            <p>Script qui crée un dossier public et qui met un fichier dedans, on ajoute ensuite une ligne de configuration dans <span class="em">/etc/exports</span> qui partage le dossier en read only à l'IP de la machine client.</p>
                            <p>Ensuite, le script ajoutera une ligne de configuration, pour chaque utilisateur de la machine client, dans <span class="em">/etc/exports</span> qui partagera le dossier de l'utilisateur créé sur le serveur qui a un UID correspondant à celui sur le client en rw.</p>
                            <p>Et pour finir nous rajoutons dans <span class="em">/etc/hosts.deny</span> et <span class="em">/etc/hosts.allow</span> des lignes de configurations qui vont donner l'accès à seulement l'IP de la machine cliente.</p>
<pre><code>#!/bin/bash
# Ne fonctionne pas quand on est en réseau interne car pas de DNS
# apt-get install -y portmap nfs-common nfs-kernel-server

if [ -z $1 ] || [ -z $2 ]
then
    echo "Usage : $0 [nbr_clients] [ip_client]"
    exit 1
fi

nbr_clients=$1
ip_client=$2

for i in `seq 1 $nbr_clients`
do
    # Il faut avoir créer les comptes clients sur le serveur au pr&alable
    # /home/client$i correspond au home directory
    echo "/home/clien$i $ip_client(rw,sync)" | sudo tee --append /etc/exports 2&gt; /dev/null
done

if [ ! -e "/home/public_nfs" ]
then
    sudo mkdir /home/public_nfs
    sudo echo "salut ce rep est public !" | sudo tee /home/public_nfs/read
fi

sudo echo "/home/public_nfs $ip_client(ro,sync)" | sudo tee --append /etc/exports 2&gt; /dev/null

sudo echo "portmap : ALL | sudo tee -append /etc/hosts.deny 2&gt; /dev/null

sudo echo "nfs : ALL" | sudo tee --append /etc/hosts.deny 2&gt; /dev/null

sudo echo "mountd : ALL" | sudo tee --append /etc/hosts.deny 2&gt; /dev/null

sudo echo "portmap : $ip_client" | sudo tee --append /etc/hosts.allow 2&gt; /dev/null

sudo echo "nfsd : $ip_client" | sudo tee --append /etc/hosts.allow 2&gt; /dev/null

sudo echo "mountd : $îpclient" | sudo tee --append /etc/hosts.allow 2&gt; /dev/null

sudo /etc/init.d/nfs-kernel-server restart</code></pre>
                        </li>
                        <li>
                            <h3>NFS VS SAMBA :</h3>
                            <p>Comme dit plus haut, NFS est surtout utilisé dans le monde Unix et permet le partage de dossier. Samba, lui, est utilisé afin d'interconnecter le monde Windows au monde Unix.</p>
                            <p>La différence est que NFS ne nécessite pas d'un utilisateur et d'un mot de passe mais bien juste sur base d'une identification d'hôte et non pas d'utilisateur.</p>
                            <p>NFS devient dès lors très complexe si on doit bien séparer les dossiers par rapport au home/utilisateurs et l'utilisation de Samba devient plus efficace.</p>
                            <p>Par contre s'il s'agit de logiciels, CD-ROM ou encores des mises à jour, il est plus simple d'utiliser NFS qui reste très simple d'utilisation dans ces cas-ci.</p>
                        </li>
                    </ol>
                </article>
            <!-- fin de section -->
            </section>
        </main>
        <footer role="contentinfo">
            <div>
                <address>
                    Professeurs :
                    <a class="mail" href="mailto:olivier.choquet@vinci.be">Choquet Olivier</a>
                    <a class="mail" href="mailto:driss.vandenheede.techinfo@gmail.com">Vandenheede Driss</a>
                </address>
            </div>
            <div>
                <p>Si vous détectez une erreur, une faute d'orthographe, n'hésitez pas à envoyer un mail aux adresses juste à côté avec le nom de la page et l'erreur détectée.</p>
            </div>
            <div id="version">
                <p>Syllabus HTML</p>
                <p>Version 5.0</p>
            </div>
        </footer>
        <script src="../pre.js"></script>
    </body>

</html>